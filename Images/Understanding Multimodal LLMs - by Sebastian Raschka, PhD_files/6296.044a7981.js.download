"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["6296"],{42952:function(t,e,l){l(16584),l(4473),l(63718),l(7028),l(98914),l(15771),l(19081);var n=l(63474);l(58175),l(91400),(0,n.zo)({display:"flex",justifyContent:"center",alignItems:"center",flex:"grow",minWidth:0});let o=(0,n.zo)({display:"flex",alignItems:"center",flex:"auto",gap:12});(0,n.zo)({justifyContent:"start"},o),(0,n.zo)({justifyContent:"end"},o)},88452:function(t,e,l){l.d(e,{Z:()=>i});var n=l(27412),o=l(6400),s=l(68833),a=l(98914);class i extends o.Component{componentWillUnmount(){this.state.uploading&&this.cancelUpload()}acceptsFile(t){return(this.props.accepts||this.accepts||"*").split(",").map(t=>new RegExp(t.trim().replace(/\./g,"\\.").replace(/\*/g,".*"))).reduce((e,l)=>e||l.test(t.type),!1)}uploadFile(t,e){let{urls:l=null,method:n="POST",rehost:o=!1,fileUrl:s=null,path:a=null,withCredentials:i=!0,useFormData:r=!0,mediaUpload:d=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var u,p=this;if(this.state.uploading)return;if(!window.FormData||!window.XMLHttpRequest){alert("Your browser does not support uploading files!");return}if(t&&!this.acceptsFile(t)){alert("Please select a valid file");return}let h=l||this.props.urls||this.urls,c=[];if(!r&&this.chunkSize>0)for(let e=0;e<h.length;e++)c.push(t.slice(this.chunkSize*e,this.chunkSize*(e+1)));else h=[h[0]],c.push(t);let m=[],g=function(t){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=new XMLHttpRequest;if(o.upload&&o.upload.addEventListener("progress",t=>p.onProgress(t),!1),o.addEventListener("load",e=>{d&&p.onPartUploadCompleted(d,o,t),p.uploadNextFile(e)},!1),o.addEventListener("error",e=>{console.error("failed to upload",e),l<10?(console.warn("retrying attempt=".concat(l+1),e),setTimeout(()=>{let e=g(t,l+1);p.setState({uploading:e,uploadingXhrs:[...p.state.uploadingXhrs.slice(0,-1),e]})},1e3*Math.pow(2,l))):p.onError(e)},!1),o.addEventListener("abort",t=>p.onAbort(t),!1),o.withCredentials=i,d&&p.onPartUploadStarted(d,o,t),o.open(n,h[t],!0),r){let l=new FormData;if(c[t]&&l.append(p.fileName||"file",c[t]),e)for(let t of Object.keys(e))l.append(t,e[t]);o.send(l)}else if(c[t]){var s,a;(null===(s=c[t])||void 0===s?void 0:s.type)&&o.setRequestHeader("Content-Type",null===(a=c[t])||void 0===a?void 0:a.type),o.send(c[t])}return o};for(let t=0;t<h.length;t++){if(d){let e=(null!==(u=d.parts)&&void 0!==u?u:[]).find(e=>e.part_number===t+1);if(null==e?void 0:e.etag){console.warn("already uploaded part ".concat(t+1));continue}}m.push(()=>g(t))}if(m.length)return this.resetUpload(m,o,s,a,d),m;this.onComplete()}uploadNextFile(t){let{uploadingXhrs:e,uploadingXhrGenerators:l}=this.state;if(e&&l&&e.length<l.length){let t=l[e.length]();this.setState({uploading:t,uploadingXhrs:e.concat([t])});return}this.onComplete(t)}resetUpload(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;arguments.length>4&&arguments[4];let o=null,s=null==t?void 0:t[0];s?o=s():t=null,clearInterval(this.state.percentCompleteInterval),this.setState({uploading:o,uploadingXhrs:o?[o]:null,uploadingXhrGenerators:t,startedAt:new Date().getTime(),percentComplete:null,percentCompleteInterval:null,estimatedTimeLeft:null,estimatedTimeLeftAt:null,rehost:e,fileUrl:l,path:n})}startPercentCompleteInterval(){this.setState({uploadedAt:new Date().getTime(),percentCompleteInterval:window.setInterval(()=>this.onPercentCompleteInterval(),100)})}onPercentCompleteInterval(){if(!this.state.uploading)return;let t=this.state.uploadedAt-this.state.startedAt,e=t*(1/this.fudgeFactor-1),l=t+e,n=Date.now()-this.state.startedAt;n<l?this.setEstimatedTimeLeft(n/l):null!==this.state.percentComplete&&this.state.percentComplete<1&&this.setEstimatedTimeLeft(1)}cancelUpload(){if(this.state.uploading)try{this.state.uploading.abort()}catch(t){console.error("Failed to cancel upload",t)}}setEstimatedTimeLeft(t){let e=0,l=new Date().getTime();if(this.state.startedAt&&Date.now()-this.state.startedAt>=5e3&&t&&t<1){let n=Date.now()-this.state.startedAt,o=n/t-n;o>=6e4&&(this.state.estimatedTimeLeft&&this.state.estimatedTimeLeft<o&&this.state.estimatedTimeLeftAt-Date.now()<5e3?(e=this.state.estimatedTimeLeft,l=this.state.estimatedTimeLeftAt):e=o)}return this.state.estimatedTimeLeft!==e&&this.setState({estimatedTimeLeft:e,estimatedTimeLeftAt:l}),e}getEstimatedTimeLeftMs(){return this.state.estimatedTimeLeft}onProgress(t){let{existingEtags:e=[],uploadingXhrs:l,uploadingXhrGenerators:n,percentCompleteInterval:o}=this.state;if(!o&&t.lengthComputable){var s,a;let o=(null!==(s=null==n?void 0:n.length)&&void 0!==s?s:1)+e.length,i=((null!==(a=null==l?void 0:l.length)&&void 0!==a?a:1)-1+e.length)/o+t.loaded/t.total/o,r=Math.min(i,1);this.setState({percentComplete:r}),this.props.onProgress&&this.props.onProgress({percentComplete:100*r});let d=(null==n?void 0:n.length)||1,u=(((null==l?void 0:l.length)||1)-1)/d+t.loaded/t.total/d;this.setEstimatedTimeLeft(u*this.fudgeFactor),i>=1&&this.startPercentCompleteInterval()}}async onComplete(t){var e,l;let n;let o=this.state.uploading&&this.state.uploading.status;if(!o||o<200||o>=400){this.onError();return}let s=null!==(l=null===(e=this.state.uploading)||void 0===e?void 0:e.responseText)&&void 0!==l?l:"";try{n=JSON.parse(s)}catch(t){console.error("Failed to parse response:",t)}this.resetUpload(),this.props.onUpload&&this.props.onUpload(n,s)}onError(t,e){let l=e||(0,a.zm)(this.state.uploading);alert(l),this.resetUpload(),this.props.onError&&this.props.onError(Error(l))}onAbort(t){this.resetUpload(),this.props.onAbort&&this.props.onAbort()}render(t,e){return console.error("should be implemented by subclass"),null}constructor(t,e){super(t,e),(0,n._)(this,"fudgeFactor",.8),(0,n._)(this,"accepts",null),(0,n._)(this,"chunkSize",null),(0,n._)(this,"fileName",""),(0,n._)(this,"urls",[]),(0,n._)(this,"onPartUploadStarted",async(t,e,l)=>{(0,s.j)(s.FP.MEDIA_UPLOAD_PART_STARTED,{media_upload_id:t.id,post_id:t.post_id,part_number:l})}),(0,n._)(this,"onPartUploadCompleted",async(t,e,l)=>{(0,s.j)(s.FP.MEDIA_UPLOAD_PART_COMPLETED,{media_upload_id:t.id,post_id:t.post_id,part_number:l})}),this.state={uploading:null,uploadingXhrGenerators:[],uploadingXhrs:[],existingEtags:[],startedAt:null,uploadedAt:null,percentComplete:null,percentCompleteInterval:null,estimatedTimeLeft:null,estimatedTimeLeftAt:null,rehost:null,fileUrl:null,path:null}}}},7028:function(t,e,l){l(98661)},3411:function(t,e,l){function n(t,e){return t&&"rgba(".concat(t.join(","),",").concat(e,")")}l.d(e,{LE:()=>s,mX:()=>o,zn:()=>n});let o=t=>{var e,l;let{palette:o,colorKey:s="DarkMuted",defaultColor:a="var(--color-dark-bg-secondary)",bgColor:i="var(--color-dark-bg-secondary)"}=t;if(!o&&!a)return null;let r=null!==(l=n(null==o?void 0:null===(e=o[s])||void 0===e?void 0:e.rgb,.75))&&void 0!==l?l:a;return{background:"linear-gradient(180deg, ".concat(r,", ").concat(r,"), ").concat(i)}},s=t=>{var e,l,o,s,a,i;let{palette:r,defaultColor:d="var(--color-dark-bg-primary)",bgColor:u="var(--color-dark-bg-primary)"}=t;if(!r&&!d)return null;let p=null!==(s=n(null==r?void 0:null===(e=r.Muted)||void 0===e?void 0:e.rgb,.75))&&void 0!==s?s:d,h=null!==(a=n(null==r?void 0:null===(l=r.DarkMuted)||void 0===l?void 0:l.rgb,.75))&&void 0!==a?a:d,c=null!==(i=n(null==r?void 0:null===(o=r.DarkVibrant)||void 0===o?void 0:o.rgb,.75))&&void 0!==i?i:d;return{background:"linear-gradient(135deg, ".concat(p,", ").concat(h,", ").concat(c,"), ").concat(u),backgroundSize:"400% 400%"}}}}]);