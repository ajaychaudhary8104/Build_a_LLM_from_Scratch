"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1709"],{10968:function(e,t,n){n.d(t,{Li:()=>Z,kw:()=>T});var o=n(7409),r=n(99282),a=n(16584),i=n(30396),l=n(94184),s=n.n(l),c=n(16864),u=n(24202),d=n(92291),p=n(71068),h=n(15771),m=n(19081),g=n(17172),_=n(45783),v=n(91400),f=n(54796);function Z(e){let{className:t,assets:n,readOnly:l,isRestack:c,isPermalink:d,maxHeight:p=420,onClick:h,onSwipe:Z,children:k,parent:T}=e,x=(0,u.dz)(n),E=(0,v.XA)(),N=c?12:d?0:E?64:48,S=c?12:16*!!E,D=N+S,A=(0,i.sO)(null),I=(0,u.yU)(A,D),B=Math.max(I-20-6,0),O=(0,i.sO)(!1),P=C(x,p,B),M=T&&""===T.body,[z,L]=(0,i.eJ)(null),R=(0,g.aZ)(A),j=(0,_.eK)(A,{inset:N,pageSizeAdjust:-.4*(I||0),initialState:{showLeft:!1,showRight:!0}}),{state:{showLeft:F,showRight:X},handleArrowClick:G}=E?{state:{showLeft:!1,showRight:!1},handleArrowClick:()=>()=>{}}:j;return(0,i.d4)(()=>{let e=A.current,t=()=>{!O.current&&(O.current=!0,Z&&Z())};return null==e||e.addEventListener("scroll",t),()=>null==e?void 0:e.removeEventListener("scroll",t)},[Z]),(0,a.BX)(m.tu,{className:s()(f.Z.imageCarouselContainer,c&&f.Z.restack),position:"relative",draggable:!1,paddingTop:M?12:void 0,style:{"--carousel-inset-left":"-".concat(N,"px"),"--carousel-inset-right":"-".concat(S,"px")},children:[(0,a.BX)(m.hs,(0,r._)((0,o._)({},R.props),{ref:A,className:s()(f.Z.imageCarousel,c&&f.Z.restack,t),overflow:"auto",flex:"auto",style:{"--carousel-height":"".concat(P,"px"),"--carousel-gap":"".concat(6,"px")},children:[(0,a.tZ)(b,{width:N}),x.map((e,t)=>{let{src:n,explicit:o,width:r,height:i,id:s}=e;return(0,a.tZ)(w,{asset:n,explicit:o,readOnly:l,width:r,height:i,carouselHeight:P,onClick:l?void 0:e=>{e.preventDefault(),h&&h({attachmentId:s,attachmentType:"image"}),L({index:t})},children:k},n)}),(0,a.tZ)(u.$9,{assets:x,imageViewer:z,setImageViewer:L,readOnly:l})]})),!E&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(y,{direction:"left",visible:F,onClick:G(-1)}),(0,a.tZ)(y,{direction:"right",visible:X,onClick:G(1)})]})," "]})}function b(e){let{width:t}=e;return(0,a.tZ)(p.xu,{as:"span",className:f.Z.carouselSpacer,width:t})}function w(e){let{asset:t,explicit:n,onClick:o,readOnly:r,width:i,height:l,carouselHeight:s,children:c}=e,d=s*(i&&l?i/l:1);return(0,a.tZ)(u.Z4,{asset:t,explicit:n,onClick:o,readOnly:r,width:d,height:s,className:f.Z.carouselImage,maxWidth:d,children:c})}function y(e){let{direction:t,visible:n,onClick:o}=e;return(0,a.tZ)(m.hs,{position:"absolute",className:s()(f.Z.arrowContainer,f.Z["".concat(t)]),alignItems:"center",justifyContent:"center",children:(0,a.tZ)(h.kG,{onClick:e=>{e.preventDefault(),e.stopPropagation(),null==o||o()},resetCss:!0,className:s()(f.Z.arrowButton,!n&&f.Z.hidden),display:"flex",alignItems:"center",justifyContent:"center","aria-label":"left"===t?"Previous":"Next",children:(0,a.tZ)(c.Z,{size:20,className:f.Z.arrowIcon})})})}function k(e){return e.filter(e=>"string"!=typeof e&&"number"==typeof e.width&&"number"==typeof e.height&&e.width>0&&e.height>0)}function C(e,t,n){let o=k(e);return 0===o.length?t:Math.min(n/Math.max(...o.map(e=>e.width/e.height)),t)}function T(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:420,o=e.map(d.kN),r=C(o,n,t);return k(o).reduce((e,t)=>e+r*(t.width&&t.height?t.width/t.height:1),0)+6*(o.length-1)}},16451:function(e,t,n){n.d(t,{Fb:()=>N,Ku:()=>T,Zb:()=>x,oM:()=>w,sP:()=>E});var o=n(7409),r=n(99282),a=n(98848),i=n(16584),l=n(94184),s=n.n(l),c=n(85685),u=n(80143),d=n(94874),p=n(19081),h=n(63474),m=n(58175),g=n(2009),_=n(50312),v=n(98012),f=n(63651),Z=n(47929),b=n(5749);function w(e){let t;var{showGutter:n=!1,hasAvatar:r=!0,hasContext:l=!1,onClick:c,className:d,entityKey:p}=e,h=(0,a._)(e,["showGutter","hasAvatar","hasContext","onClick","className","entityKey"]);let m=c?e=>{let n=window.getSelection();if(n&&!n.isCollapsed&&(null==n?void 0:n.toString())!==t)return;let{target:o}=e;!(o instanceof Element&&o.closest("button, a"))&&!e.defaultPrevented&&c(e)}:void 0;return(0,i.tZ)(u.Q,{entityKey:p,children:(0,i.tZ)("div",(0,o._)({className:s()(y,b.Z.feedUnit,n?b.Z.showThreadGutter:void 0,l?b.Z.hasContext:void 0,r?b.Z.hasAvatar:void 0,d),onPointerDown:()=>{var e;t=null===(e=window.getSelection())||void 0===e?void 0:e.toString()},onClick:m,onAuxClick:m},h))})}let y=s()((0,h.oB)({gap:12}),h.sg.styles),k=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),C=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});function T(e){let t,{timestamp:n}=e,o=(0,v.Z)(),r=(0,v.Z)(n),a=o.diff(r,"day"),l=o.diff(r,"month");return t=!o.isSame(r,"year")&&l>6?C.format(r.toDate()):a>7?k.format(r.toDate()):r.fromNowShort(),(0,i.tZ)(m.xv.B4,{as:"span",color:"secondary",children:n&&t})}function x(e){let{user:t,className:n,size:o=36}=e;return(0,i.tZ)(d.qE,{size:o,user:t,className:n})}function E(e){let{children:t}=e;return(0,i.tZ)(m.xv.B3,{className:b.Z.feedCommentBodyInner,color:"primary",children:t})}function N(e){let{user:t,onClick:n,utm_content:a}=e,l=(0,_.F)({href:(0,f.NNq)(t,{noBase:g.L,utm_source:Z.b3.substackFeedItem}),state:{showBack:!0},onClick:n,campaign:{content:a}});return(0,i.tZ)(p.hs,(0,r._)((0,o._)({as:"a",flex:"auto",alignSelf:"start",radius:"full",showFocus:!0,animate:!0,draggable:!1},l),{children:(0,i.tZ)(c.ProfileHoverCard,{subject:t,dontStopPropagation:!0,utmSource:"feed",children:(0,i.tZ)(x,{user:t})})}))}},78088:function(e,t,n){n.d(t,{Qe:()=>T,iL:()=>C,k2:()=>S,zw:()=>E});var o=n(7409),r=n(16584),a=n(30396),i=n(57061),l=n(63049),s=n(53687),c=n(44404),u=n(95441),d=n(68833),p=n(98914),h=n(15771),m=n(19081),g=n(6490),_=n(63474),v=n(96302),f=n(58175),Z=n(11742),b=n(73943),w=n(60308),y=n(63029);let k=(e,t)=>{var n;let{postCoverImageUrl:o,pubCoverImageUrl:r,pub:a,themeVariables:i}=t,l=[],s=[],c=!1,u=i||a.theme,d=null!==(n=(null==u?void 0:u.web_bg_color)||(null==u?void 0:u.cover_bg_color))&&void 0!==n?n:"";switch(e){case"post_asset":o&&l.push("image"),((null==u?void 0:u.background_pop_color)||(null==u?void 0:u.background_pop))&&l.push("accent"),l.push("primary"),"#ffffff"!==d.toLowerCase()&&l.push("black&white"),c=!0;break;case"pub_shareable_image":r&&l.push("image"),l.push("primary"),s.push({type:"logo",label:"Logo"}),a.has_posts&&s.push({type:"posts",label:"Top posts"}),a.hero_text&&s.push({type:"description",label:"Description"});break;case"paid_subscription":case"pledged_subscription":((null==u?void 0:u.background_pop_color)||(null==u?void 0:u.background_pop))&&l.push("accent"),l.push("primary")}return{assetThemes:l,assetTypes:s,includePreviewTextToggle:c}};function C(e){var t;let n,_,v,f,C,D,{pub:A,item:I,isOpen:B,setOpen:O,themeVariables:P,width:M}=e,{iString:z}=(0,u.M1)(),{type:L,target_user:R,target_user_id:j,target_pledge_note:F,target_subscription_note:X,post:G}=I,W=A.logo_url||A.cover_photo_url||A.author_photo_url||(null===(t=A.author)||void 0===t?void 0:t.photo_url),q=null==G?void 0:G.cover_image,U="post_asset"===L,{assetThemes:H,assetTypes:K,includePreviewTextToggle:J}=k(L,{postCoverImageUrl:q,pubCoverImageUrl:W,pub:A,themeVariables:P}),Q=P||A.theme,[V,$]=(0,a.eJ)(U?"instagram":"stories"),[Y,ee]=(0,a.eJ)(H.find(e=>"image"===e)&&W?"image":H.find(e=>"accent"===e)&&((null==Q?void 0:Q.background_pop_color)||(null==Q?void 0:Q.background_pop))?"accent":"primary"),[et,en]=(0,a.eJ)("logo");(0,a.d4)(()=>{B&&(0,d.j)(d.FP.SHARE_CENTER_CUSTOMIZE_ASSETS_MODAL_OPENED)},[B]);let[eo,er]=(0,a.eJ)(!0),ea=()=>{switch(Y){case"image":return(0,o._)({aspectRatio:V,bgImage:!0},K.length&&{type:et},J&&eo&&{hidePreviewText:!0});case"accent":return(0,o._)({aspectRatio:V,bgColor:(null==Q?void 0:Q.background_pop_color)||(null==Q?void 0:Q.background_pop),textColor:null==Q?void 0:Q.print_on_pop},K.length&&{type:et},J&&eo&&{hidePreviewText:!0});case"primary":return(0,o._)({aspectRatio:V,bgColor:(null==Q?void 0:Q.web_bg_color)||(null==Q?void 0:Q.cover_bg_color),textColor:(null==Q?void 0:Q.print_on_web_bg_color)||(null==Q?void 0:Q.cover_print_primary)},K.length&&{type:et},J&&eo&&{hidePreviewText:!0});default:return(0,o._)({aspectRatio:V,bgColor:"#ffffff",textColor:"#404040"},K.length&&{type:et},J&&eo&&{hidePreviewText:!0})}},ei=(0,p.K1)(),el=()=>{O(!1)};switch(L){case"arr_10k_milestone":v=b.dD.ARR10K,_=(0,r.tZ)(i.d,{pub:A,milestone:v,style:{aspectRatio:V}}),f=(0,w.iNT)(A,v,{aspectRatio:V},"".concat(v," - ").concat("stories"===V?"vertical":V));break;case"arr_1k_milestone":v=b.dD.ARR1K,_=(0,r.tZ)(i.d,{pub:A,milestone:v,style:{aspectRatio:V}}),f=(0,w.iNT)(A,v,{aspectRatio:V},"".concat(v," - ").concat("stories"===V?"vertical":V));break;case"list_100_milestone":v=b.bq.List100,_=(0,r.tZ)(i.d,{pub:A,milestone:v,style:{aspectRatio:V}}),f=(0,w.iNT)(A,v,{aspectRatio:V},"".concat(v," - ").concat("stories"===V?"vertical":V));break;case"list_1k_milestone":v=b.bq.List1K,_=(0,r.tZ)(i.d,{pub:A,milestone:v,style:{aspectRatio:V}}),f=(0,w.iNT)(A,v,{aspectRatio:V},"".concat(v," - ").concat("stories"===V?"vertical":V));break;case"paid_subscription":_=(0,r.tZ)(c.uP,{pub:A,note:X,user:R||{id:j||0},style:ea()}),f=(0,w.gGz)(A,R||{id:j||0},ea(),{fileToDownload:"Message - ".concat("stories"===V?"vertical":V)}),D=()=>{(0,d.j)(d.FP.SUBSCRIPTION_NOTE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{note_from_user_id:(null==R?void 0:R.id)||j,aspectRatio:V,source:"download-button"})};break;case"pledged_subscription":_=(0,r.tZ)(c.hi,{pub:A,note:F,user:R||{id:j||0},style:ea()}),f=(0,w.uQO)(A,R||{id:j||0},ea(),{fileToDownload:"Message - ".concat("stories"===V?"vertical":V)}),D=()=>{(0,d.j)(d.FP.PLEDGE_NOTE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{note_from_user_id:(null==R?void 0:R.id)||j,aspectRatio:V,source:"download-button"})};break;case"pub_shareable_image":n=z("Create shareable image"),_=(0,r.tZ)(l.H,{pub:A,style:ea()}),C="".concat(A.name," - ").concat("stories"===V?"vertical":V),f=(0,w.p5u)(A,null,ea(),{fileToDownload:C}),D=()=>{(0,d.j)(d.FP.PUBLICATION_MEDIA_ASSETS_IMAGE_DOWNLOADED,{aspectRatio:V,source:"download-button"})};break;case"post_asset":{let e=ea(),{text:t,translatedText:o}="image"===Y?{text:"Image".concat(eo?" - no preview":""),translatedText:z(eo?"Image - no preview":"Image")}:"accent"===Y?{text:"Accent Color".concat(eo?" - no preview":""),translatedText:z(eo?"Accent Color - no preview":"Accent Color")}:"primary"===Y?{text:"Background Color".concat(eo?" - no preview":""),translatedText:z(eo?"Background Color - no preview":"Background Color")}:{text:"Black and White".concat(eo?" - no preview":""),translatedText:z(eo?"Black and White - no preview":"Black and White")};n=z("Create shareable image"),_=G&&(0,r.tZ)(Z.g,{pub:A,post:G,style:e,translatedText:o,size:420,hoverOverlay:!1}),C="".concat(o," - ").concat("stories"===V?"vertical":V),f=G&&(0,w.ChS)(A,G,e,C),D=()=>{(0,d.j)(d.FP.WRITER_MEDIA_ASSETS_IMAGE_DOWNLOADED,{post_id:null==G?void 0:G.id,type:t,aspectRatio:e.aspectRatio,share_center:!0,inline:!1,source:"download-button"})}}}["arr_10k_milestone","arr_1k_milestone","list_100_milestone","list_1k_milestone"].includes(L)?(n=z("Share milestone"),C="".concat(v," - ").concat("stories"===V?"vertical":V),D=()=>{(0,d.j)(d.FP.MILESTONE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{milestone:v,aspectRatio:V,source:"download-button"})}):["paid_subscription","pledged_subscription"].includes(L)&&(n=z("Share message"),C="Message - ".concat("stories"===V?"vertical":V));let es=async()=>{null==D||D();let e=document.createElement("a");e.href=f,e.download=C,e.target="_blank",e.rel="noopener noreferrer",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},ec=H.length>1,eu=K.length>1,ed=s.sl.length>1;return(0,r.BX)(g.u_,{isOpen:B,onClose:el,width:M||640,overflow:"hidden",renderOverReactLaagPortal:!0,fullscreenMobile:!0,children:[(0,r.tZ)(g.xB,{onClose:el,title:n,showClose:!0,showDivider:!0}),(0,r.tZ)(g.fe,{children:(0,r.BX)(m.tu,{gap:20,children:[(0,r.tZ)(m.hs,{className:y.Z.imageContainer,alignItems:"center",justifyContent:"center",children:_}),(0,r.BX)(S,{children:[ec&&(0,r.tZ)(T,{assetThemes:H,assetTheme:Y,setAssetTheme:ee,theme:Q,pubCoverImageUrl:W}),eu&&(0,r.tZ)(x,{assetTypes:K,assetType:et,setAssetType:en}),ed&&(0,r.tZ)(E,{aspectRatio:V,setAspectRatio:$,includeInstagram:U}),J&&(0,r.tZ)(N,{hidePreviewText:eo,setHidePreviewText:er})]})]})}),!ei&&(0,r.tZ)(g.mz,{showDivider:!0,direction:"column",primaryButton:(0,r.tZ)(h.zx,{priority:"primary",onClick:es,children:z("Download image")})})]})}function T(e){let{assetThemes:t,assetTheme:n,setAssetTheme:o,theme:a,pubCoverImageUrl:i}=e;return(0,r.BX)(m.tu,{gap:8,children:[(0,r.tZ)(f.xv.B4,{weight:"medium",translated:!0,children:"Background"}),(0,r.tZ)(m.gq,{gap:8,children:t.map(e=>(0,r.tZ)(s.rn,{value:e,isSelected:e===n,onClick:()=>o(e),themeVariables:a,coverImageUrl:i}))})]})}function x(e){let{assetTypes:t,assetType:n,setAssetType:o}=e;return(0,r.BX)(m.tu,{gap:8,children:[(0,r.tZ)(f.xv.B4,{weight:"medium",translated:!0,children:"Type"}),(0,r.tZ)(m.gq,{gap:8,children:t.map(e=>{let{type:t,label:a}=e;return(0,r.tZ)(s.$I,{label:a,isSelected:t===n,onClick:()=>o(t)})})})]})}function E(e){let{aspectRatio:t,setAspectRatio:n,includeInstagram:o}=e,a=o?s.sl:s.sl.filter(e=>"instagram"!==e);return(0,r.BX)(m.tu,{gap:8,children:[(0,r.tZ)(f.xv.B4,{weight:"medium",translated:!0,children:"Aspect Ratio"}),(0,r.tZ)(m.gq,{gap:8,children:a.map(e=>(0,r.tZ)(s.ar,{value:e,isSelected:e===t,onClick:()=>n(e)}))})]})}function N(e){let{hidePreviewText:t,setHidePreviewText:n}=e;return(0,r.BX)(m.tu,{gap:8,children:[(0,r.tZ)(f.xv.B4,{weight:"medium",translated:!0,children:"Preview Text"}),(0,r.tZ)(m.hs,{flex:"grow",alignItems:"center",children:(0,r.tZ)(v.rs,{checked:!t,onChange:e=>{n(!e),(0,d.j)(d.FP.SHARE_CENTER_CUSTOMIZE_ASSETS_PREVIEW_TEXT_TOGGLED,{includePreviewText:e})}})})]})}let S=(0,_.zo)({display:"flex",gap:20,overflowX:"auto",flex:"auto",justifyContent:"space-between"})},27661:function(e,t,n){n.d(t,{Dx:()=>g,HD:()=>b,MN:()=>w,OD:()=>T,Oz:()=>Z,QC:()=>y,Z9:()=>f,mn:()=>C,nr:()=>k,pW:()=>m,uf:()=>v,ws:()=>_});var o=n(16584),r=n(47737),a=n(59719),i=n(57420),l=n(40792),s=n(23218),c=n(42297),u=n(56841),d=n(87966),p=n(5097),h=n(5264);function m(e){let{size:t,className:n}=e;return(0,o.tZ)(r.Z,{size:t,className:n})}function g(e){let{size:t,className:n}=e;return(0,o.tZ)(a.Z,{size:t,className:n})}function _(e){let{size:t,className:n}=e;return(0,o.tZ)(i.Z,{size:t,className:n})}function v(e){let{size:t,className:n}=e;return(0,o.tZ)(l.Z,{size:t,className:n})}function f(e){let{size:t,className:n}=e;return(0,o.tZ)(s.Z,{size:t,className:n})}function Z(e){let{size:t,className:n}=e;return(0,o.tZ)(c.Z,{size:t,className:n})}function b(e){let{size:t,className:n}=e;return(0,o.tZ)(a.Z,{size:t,className:n})}function w(e){let{size:t,className:n}=e;return(0,o.tZ)(u.Z,{size:t,className:n})}function y(e){let{size:t,className:n}=e;return(0,o.tZ)(d.Z,{size:t,className:n})}function k(e){let{size:t,className:n}=e;return(0,o.tZ)(p.Z,{size:t,className:n})}function C(e){let{size:t,className:n}=e;return(0,o.tZ)(a.Z,{size:t,className:n})}function T(e){let{size:t,className:n}=e;return(0,o.tZ)(h.Z,{size:t,className:n})}},86190:function(e,t,n){n.d(t,{U:()=>r});var o=n(48980);let r=e=>async t=>{let n="before";t({type:"conversation-request_initial",payload:{conversationId:e}});try{let r=await (0,o.rd)("/api/v1/messages/dm/".concat(e));t({type:"conversation-load_more",payload:{edge:n,cursor:null,page:r}})}catch(o){t({type:"conversation-request_error",payload:{conversationId:e,edge:n,cursor:null,error:o}})}}}}]);