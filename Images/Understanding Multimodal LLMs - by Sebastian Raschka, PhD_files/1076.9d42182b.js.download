"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1076"],{66824:function(e,t,i){i.d(t,{Z:()=>o});let o={container:"container-D8CZbL","videoContainer-clip":"videoContainer-clip-KcDC9v",videoContainerClip:"videoContainer-clip-KcDC9v",videoContainerWrapper:"videoContainerWrapper-VrqlAM",videoIcon:"videoIcon-JWfwBB",videoContainer:"videoContainer-S7toSI",video:"video-dep_Pc",fullScreenContainer:"fullScreenContainer-oPOI4W","playerContainer-vertical":"playerContainer-vertical-nqZGWC",playerContainerVertical:"playerContainer-vertical-nqZGWC","playerContainer-landscape":"playerContainer-landscape-R9mTfd",playerContainerLandscape:"playerContainer-landscape-R9mTfd","playerContainer-vertical_fit":"playerContainer-vertical_fit-j9atXq",playerContainerVerticalFit:"playerContainer-vertical_fit-j9atXq","videoContainer-vertical_fit":"videoContainer-vertical_fit-ku5xgX",videoContainerVerticalFit:"videoContainer-vertical_fit-ku5xgX","video-vertical_fit":"video-vertical_fit-aJ3XQJ",videoVerticalFit:"video-vertical_fit-aJ3XQJ","playerContainer-vertical_fill":"playerContainer-vertical_fill-As6E90",playerContainerVerticalFill:"playerContainer-vertical_fill-As6E90","videoContainer-vertical_fill":"videoContainer-vertical_fill-pCmPd2",videoContainerVerticalFill:"videoContainer-vertical_fill-pCmPd2","video-vertical_fill":"video-vertical_fill-UOGFke",videoVerticalFill:"video-vertical_fill-UOGFke",videoPlayer:"videoPlayer-ySwQUq",generateClips:"generateClips-qHOZUt",spinner:"spinner-FpLDBB",backDrop:"backDrop-EWGPYa",downloadModal:"downloadModal-SupuMR"}},96164:function(e,t,i){i.d(t,{fg:()=>a}),i(69572);let o={user:"recentUserQ",pub:"recentPubQ",importsReviewPageSize:"importsReviewPageSize",importsReviewColumns:"importsReviewColumns"},a=()=>{"undefined"!=typeof localStorage&&(localStorage.getItem(o.user)&&localStorage.setItem(o.user,"[]"),localStorage.getItem(o.pub)&&localStorage.setItem(o.pub,"[]"),localStorage.removeItem(o.importsReviewPageSize),localStorage.removeItem(o.importsReviewColumns))}},10797:function(e,t,i){i(16584),i(30396),i(23279),i(40827),i(80569),i(95441),i(71068),i(15771),i(86075),i(19081),i(6490),i(65523),i(98248);var o=i(63474);i(58175),i(51776),i(52684);var a=i(1747);(0,o.zo)({display:"flex",position:"absolute",gap:8,padding:8,paddingTop:32,alignItems:"center",justifyContent:"end",className:a.Z.footer})},1055:function(e,t,i){i.d(t,{Z:()=>d});var o=i(7409),a=i(99282),n=i(16584),l=i(64515);let d=e=>(0,n.tZ)(l.l,(0,a._)((0,o._)({},e),{name:"PlayIconRounded",svgParams:{height:16,width:16},stroke:"none",children:(0,n.tZ)("path",{d:"M3.35866 16C2.58101 16 2 15.4101 2 14.4447V1.55531C2 0.598883 2.58101 0 3.35866 0C3.75196 0 4.10056 0.134078 4.54749 0.393296L15.1575 6.54302C15.9531 7.00782 16.3106 7.39218 16.3106 8C16.3106 8.61676 15.9531 9.00112 15.1575 9.45698L4.54749 15.6067C4.10056 15.8659 3.75196 16 3.35866 16Z"})}))},81924:function(e,t,i){i.d(t,{w:()=>f});var o=i(16584),a=i(30396),n=i(55679),l=i(70109),d=i(94184),r=i.n(d);i(23279);var s=i(77705);i(95441);var c=i(5780);i(68833);var p=i(98914);i(15771),i(86075);var u=i(19081);i(6490);var v=i(58175);i(64300);var h=i(81355),m=i(60520);let f=e=>{let{node:t,id:i}=e,[d,f]=(0,a.eJ)(t.attrs.persistentExpression);return(0,a.d4)(()=>{f(t.attrs.persistentExpression)},[t]),(0,a.d4)(()=>{let e=e=>{let{detail:i}=e;i.node.attrs.id===t.attrs.id&&f(i.persistentExpression)};return(0,c.oj)().addEventListener("close",e),()=>{(0,c.oj)().removeEventListener("close",e)}},[]),(0,o.tZ)(n.T5,{"data-drag-handle":"",children:(0,o.tZ)(h.e,{children:(0,o.tZ)("div",{className:"latex-block",id:i,children:(0,o.tZ)(u.tu,{className:r()(m.Z.latexWrapper,t.attrs.persistentExpression||(0,p.K1)()?m.Z.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:d,id:t.attrs.id}),onClick:()=>{d!==t.attrs.persistentExpression&&f(t.attrs.persistentExpression),(0,c.oj)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,o.BX)(u.gq,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[d||t.attrs.persistentExpression?(0,o.tZ)(u.tu,{alignItems:"center",justifyContent:"center",children:(0,o.tZ)(l.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(d||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,o.tZ)(u.tu,{alignSelf:"center",children:(0,o.tZ)(v.xv.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,o.tZ)(u.tu,{children:(0,o.tZ)("button",{className:m.Z.latexEdit,children:(0,o.tZ)(s.Z,{width:20,height:20})})})]})})})})})}},1148:function(e,t,i){i.d(t,{H:()=>a});var o=i(16584);let a=e=>(0,o.tZ)("div",{className:"file-embed-wrapper-editor",children:(0,o.tZ)("div",{className:"file-embed-aligner",children:(0,o.tZ)("div",{className:"file-embed-container placeholder",children:(0,o.tZ)(n,{})})})}),n=()=>(0,o.BX)("div",{className:"embed-loader-container",children:[(0,o.tZ)("div",{className:"embed-loader"}),(0,o.tZ)("div",{className:"embed-loader-text",children:"Loading..."})]})},43148:function(e,t,i){i.d(t,{H:()=>p,o:()=>c});var o=i(16584),a=i(98661),n=i(30396),l=i(15771),d=i(19081),r=i(58175),s=i(12811);let c=(0,a.forwardRef)((e,t)=>{let{onClick:i,children:a,disabled:n=!1,size:d="md"}=e;return(0,o.tZ)(l.GI,{ref:t,rounded:!0,onClick:i,disabled:n,size:d,children:a})}),p=e=>{let{label:t,children:i}=e,[a,l]=(0,n.eJ)(!1);return(0,o.BX)(d.gq,{gap:8,justifyContent:"center",alignItems:"center",children:[t&&(0,o.tZ)(d.gq,{bg:"glass-inverted-medium",justifyContent:"center",alignItems:"center",radius:"sm",paddingY:6,paddingX:8,className:s.Z.verticalMenuLabel,style:{opacity:+!!a},children:(0,o.tZ)(r.xv.B4,{color:"white",children:t})}),(0,o.tZ)("div",{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:i})]})}},42684:function(e,t,i){i(27412),i(7409),i(99282),i(16584),i(84892),i(86657),i(64819),i(24763);var o=i(21903);i(24791),i(60308),o.ZP},28771:function(e,t,i){i.d(t,{M$:()=>l}),i(16584);var o=i(6400),a=i(30396);i(94184),i(1852),i(71068),i(4615),i(70379),i(7149);let n=(0,o.createContext)({initialTab:"settings",isDrawerOpen:()=>!1,openDrawerId:null,setInitialTab:()=>void 0,setIsDrawerOpen:()=>void 0,setPreventChange:()=>void 0});function l(){return(0,a.qp)(n)}},19908:function(e,t,i){i.d(t,{M:()=>a});var o=i(83857);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let a=e=>(t,i,a)=>{if(i){var n,l,d;(0,o.d)(e.marks.link,{scrollParent:".editor-scroll",language:"undefined"!=typeof window?null===(d=window)||void 0===d?void 0:null===(l=d._preloads)||void 0===l?void 0:null===(n=l.publication)||void 0===n?void 0:n.language:null}).spec.run(t,i,a)}return!0}},21903:function(e,t,i){i.d(t,{QM:()=>T,ZP:()=>E,hJ:()=>_});var o=i(27412),a=i(7409),n=i(58865),l=i(6400),d=i(14293),r=i.n(d),s=i(81763),c=i.n(s),p=i(80569),u=i.n(p),v=i(88452),h=i(40647),m=i(68833),f=i(98914),g=i(10656),y=i(98012),x=i(84864);function w(){let e=(0,n._)(["This will remove your audio. Are you sure?"]);return w=function(){return e},e}function U(){let e=(0,n._)(["This will remove your video. Are you sure?"]);return U=function(){return e},e}function b(){let e=(0,n._)(["File too large. Your file is ","; the maximum is ",".  Try encoding at a lower bitrate."]);return b=function(){return e},e}function C(){let e=(0,n._)(["It looks like your file is empty (0 bytes). Please check that the file you are trying to upload is not corrupted."]);return C=function(){return e},e}let _="video/*";class E extends l.Component{componentDidMount(){this.syncUploads()}componentWillUnmount(){this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime()}componentDidUpdate(e,t){e.mediaUploadId!==this.props.mediaUploadId&&null===this.props.mediaUploadId&&(this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime(),this.setState({mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null})),this.checkTranscodeStates(t),this.checkForNewUploads(e)}getMediaUploadId(){return this.state.mediaUploadId}stopUpdatingTranscodingTime(){clearTimeout(this.updateTranscodingTimeout),this.updateTranscodingTimeout=null}getEstimatedTranscodingTime(){let e=1,t=0,i=new Date().getTime(),{mediaUpload:o}=this.state;if((null==o?void 0:o.state)==="uploaded"&&o.uploaded_at&&o.duration&&o.duration>0){let a="video"===this.props.mediaType?.7:.03,n=1e3*Math.max("video"===this.props.mediaType?60:5,o.duration*a),l=Math.max(0,n-Math.max(0,Date.now()-new Date(o.uploaded_at).getTime()));e=Math.max(0,1-l/n),this.state.timeLeft&&this.state.timeLeft<l&&this.state.estimatedTimeLeftAt-Date.now()<5e3?(t=this.state.timeLeft,i=this.state.estimatedTimeLeftAt):t=l}return{estimatedTimeLeftAt:i,percentComplete:e,timeLeft:t}}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){var i;super(e,t),i=this,(0,o._)(this,"updateTranscodingTimeout",void 0),(0,o._)(this,"syncMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractPreviewMediaUploadTimeout",void 0),(0,o._)(this,"optionsDropdown",void 0),(0,o._)(this,"syncingMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractPreviewMediaUpload",void 0),(0,o._)(this,"i18n",void 0),(0,o._)(this,"updateTranscodingTime",()=>{var e;this.updateTranscodingTimeout||(this.setState(this.getEstimatedTranscodingTime()),(null===(e=this.state.mediaUpload)||void 0===e?void 0:e.state)==="uploaded"&&(this.updateTranscodingTimeout=window.setTimeout(()=>{this.updateTranscodingTimeout=null,this.updateTranscodingTime()},1e3)))}),(0,o._)(this,"onMediaUpload",e=>{var t;let{mediaUpload:i}=e;clearTimeout(null!==(t=this.syncMediaUploadTimeout)&&void 0!==t?t:void 0),this.setState({mediaUploadId:null==i?void 0:i.id,mediaUpload:i},()=>{var e,t;this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),null===(e=(t=this.props).onChange)||void 0===e||e.call(t,{mediaUpload:i})})}),(0,o._)(this,"onAudioExtractMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.setState({audioExtractMediaUploadId:null==t?void 0:t.id,audioExtractMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onAudioExtractPreviewMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.onAudioExtractPreviewMediaUpload),this.setState({audioExtractPreviewMediaUploadId:null==t?void 0:t.id,audioExtractPreviewMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractPreviewChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onMediaUploadUpdated",e=>{var t,i;null===(t=(i=this.props).onChange)||void 0===t||t.call(i,{mediaUpload:(0,a._)({},this.props.mediaUpload,e)})}),(0,o._)(this,"removeUpload",function(){var e;let{skipConfirm:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{iTemplate:o}=i.i18n,{mediaUploadId:a,mediaUpload:n}=i.state;if(a){if(!t&&!["cancelled","error"].includes(null==n?void 0:n.state)&&!confirm(o((null==n?void 0:n.media_type)==="audio"?w():U())))return;null===(e=i.optionsDropdown)||void 0===e||e.close(),i.clearSyncMediaUploadTimeouts(),i.setState({mediaUploadId:null,mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null},()=>{var e,t,o,a,n,l;null===(e=(t=i.props).onChange)||void 0===e||e.call(t,{mediaUpload:null}),null===(o=(a=i.props).onAudioExtractChange)||void 0===o||o.call(a,{mediaUpload:null}),null===(n=(l=i.props).onAudioExtractPreviewChange)||void 0===n||n.call(l,{mediaUpload:null})})}}),(0,o._)(this,"syncUploads",()=>{this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"})}),(0,o._)(this,"getTimeoutDuration",e=>(0,y.Z)(e).add(6e4,"milliseconds").isBeforeNow()?3e4:1e4),(0,o._)(this,"clearSyncMediaUploadTimeouts",()=>{this.syncMediaUploadTimeout&&clearTimeout(this.syncMediaUploadTimeout),this.syncAudioExtractMediaUploadTimeout&&clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.syncAudioExtractPreviewMediaUploadTimeout&&clearTimeout(this.syncAudioExtractPreviewMediaUploadTimeout)}),(0,o._)(this,"syncUpload",async e=>{var t,i;let{uploadIdKey:o,uploadKey:a,uploadTimeoutKey:n,uploadSyncingKey:l,endpoint:d}=e,r=this.state[o],s=this.state[a];if(!r){s&&this.setState({[a]:null});return}if((null==s?void 0:s.state)!=="transcoded"&&!this[l]){this[l]=!0;try{let e=await u().get(d.replace("{id}",r));this.setState({[a]:e.body},()=>{"uploaded"!==e.body.state?this.stopUpdatingTranscodingTime():this.updateTranscodingTime()})}catch(e){alert((0,f.zx)(e))}this.state[a]&&(null===(t=this.state[a])||void 0===t?void 0:t.state)!=="uploaded"||(this[n]=window.setTimeout(()=>this.syncUpload({uploadIdKey:o,uploadKey:a,uploadTimeoutKey:n,uploadSyncingKey:l,endpoint:d}),this.getTimeoutDuration(null===(i=this.state[a])||void 0===i?void 0:i.created_at))),this[l]=!1}}),(0,o._)(this,"checkTranscodeStates",e=>{var t,i,o,a,n,l,d,r,s,c,p,u,v,h,m,f;(null===(t=this.state.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"&&(null===(i=e.mediaUpload)||void 0===i?void 0:i.state)!==(null===(o=this.state.mediaUpload)||void 0===o?void 0:o.state)&&(null===(p=(u=this.props).onChange)||void 0===p||p.call(u,{mediaUpload:this.state.mediaUpload})),((null===(a=this.state.audioExtractMediaUpload)||void 0===a?void 0:a.state)==="transcoded"||(null===(n=this.state.audioExtractMediaUpload)||void 0===n?void 0:n.state)==="error")&&(null===(l=e.audioExtractMediaUpload)||void 0===l?void 0:l.state)!==(null===(d=this.state.audioExtractMediaUpload)||void 0===d?void 0:d.state)&&(null===(v=(h=this.props).onAudioExtractChange)||void 0===v||v.call(h,{mediaUpload:this.state.audioExtractMediaUpload})),(null===(r=this.state.audioExtractPreviewMediaUpload)||void 0===r?void 0:r.state)==="transcoded"&&(null===(s=e.audioExtractPreviewMediaUpload)||void 0===s?void 0:s.state)!==(null===(c=this.state.audioExtractPreviewMediaUpload)||void 0===c?void 0:c.state)&&(null===(m=(f=this.props).onAudioExtractPreviewChange)||void 0===m||m.call(f,{mediaUpload:this.state.audioExtractPreviewMediaUpload}))}),(0,o._)(this,"checkForNewUploads",e=>{var t,i,o,a,n,l;(e.mediaUpload!==this.props.mediaUpload||e.mediaUploadId!==this.props.mediaUploadId)&&this.setState({mediaUpload:null!==(t=this.props.mediaUpload)&&void 0!==t?t:null,mediaUploadId:null!==(i=this.props.mediaUploadId)&&void 0!==i?i:null}),(e.audioExtractMediaUpload!==this.props.audioExtractMediaUpload||e.audioExtractMediaUploadId!==this.props.audioExtractMediaUploadId)&&this.setState({audioExtractMediaUpload:null!==(o=this.props.audioExtractMediaUpload)&&void 0!==o?o:null,audioExtractMediaUploadId:null!==(a=this.props.audioExtractMediaUploadId)&&void 0!==a?a:null}),(e.audioExtractPreviewMediaUpload!==this.props.audioExtractPreviewMediaUpload||e.audioExtractPreviewMediaUploadId!==this.props.audioExtractPreviewMediaUploadId)&&this.setState({audioExtractPreviewMediaUpload:null!==(n=this.props.audioExtractPreviewMediaUpload)&&void 0!==n?n:null,audioExtractPreviewMediaUploadId:null!==(l=this.props.audioExtractPreviewMediaUploadId)&&void 0!==l?l:null})}),this.state={mediaUploadId:e.mediaUploadId,mediaUpload:e.mediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1},this.updateTranscodingTimeout=null,this.syncMediaUploadTimeout=null,this.syncAudioExtractMediaUploadTimeout=null,this.syncAudioExtractPreviewMediaUploadTimeout=null,this.syncingMediaUpload=!1,this.syncingAudioExtractMediaUpload=!1,this.syncingAudioExtractPreviewMediaUpload=!1,this.i18n=I18N.i(e.language)}}E.contextType=h.QA;class T extends v.Z{componentDidUpdate(e){this.props.initialFile!==e.initialFile&&(this.onFileSelected(this.props.initialFile),e.initialFile&&this.cancelUpload())}trackUploadClicked(){}onError(){var e,t,i;let{upload_state:o="uploading",customMessage:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.j)(m.FP.MEDIA_UPLOAD_FAILED,{upload_state:o,media_upload_id:null===(e=this.state.mediaUpload)||void 0===e?void 0:e.id,post_id:this.props.postId,customMessage:a}),null===(t=(i=this.props).onUploadCanceled)||void 0===t||t.call(i),super.onError({upload_state:o},a)}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){if(super(e,t),(0,o._)(this,"accepts",void 0),(0,o._)(this,"chunkSize",void 0),(0,o._)(this,"input",null),(0,o._)(this,"i18n",void 0),(0,o._)(this,"onUploadClicked",async()=>{this.trackUploadClicked()}),(0,o._)(this,"uploadToS3",async e=>{var t,i,o,n,l,d,r,s,c,p;let v;if((null===(t=this.state)||void 0===t?void 0:t.preuploading)||(null===(i=this.state)||void 0===i?void 0:i.uploading))return;null===(o=(n=this.props).onUploadStarted)||void 0===o||o.call(n),this.setState({preuploading:!0});let{iTemplate:h}=this.i18n;if(e.size>x.MAX_MEDIA_FILE_SIZE){this.onError({upload_state:"preupload",customMessage:h(b(),(0,x.formatBytes)(e.size),(0,x.formatBytes)(x.MAX_MEDIA_FILE_SIZE))});return}if(0===e.size){this.onError({upload_state:"preupload",customMessage:h(C())});return}this.props.postId||(this.props.setPostId?await (null===(l=(d=this.props).setPostId)||void 0===l?void 0:l.call(d)):console.warn("missing postId and cannot set postId, likely a non post editor")),this.setState({durationPromise:(0,g.Iw)(e)});try{let t="video"===this.props.mediaType?"/api/v1/video/upload":"/api/v1/audio/upload";v=await u().post(t).query((0,a._)({filetype:e.type,fileSize:e.size,fileName:"".concat(null==e?void 0:e.name)},this.props.postId?{post_id:this.props.postId}:{})),(0,m.j)(m.FP.MEDIA_UPLOAD_CREATED,{media_type:this.props.mediaType,file_size:e.size,file_type:e.type,parts_size:(null!==(r=v.body.multipartUploadUrls)&&void 0!==r?r:[]).length,post_id:this.props.postId})}catch(e){console.error("Failed to create media upload:",e),this.onError({upload_state:"preupload",customMessage:(0,f.zx)(e)});return}let{mediaUpload:y,multipartUploadId:w,multipartUploadUrls:U}=v.body,_=(null!==(s=null==y?void 0:y.parts)&&void 0!==s?s:[]).map(e=>e.etag).filter(Boolean);"created"===y.state&&_.length===U.length?(this.setState({mediaUpload:y,mediaUploadId:y.id}),await this.initTranscode(y,_)):"uploaded"===y.state||"transcoded"===y.state?null===(c=(p=this.props).onUpload)||void 0===c||c.call(p,v.body):(this.setState({preuploading:!1,mediaUpload:y,multipartUploadId:w,existingEtags:_}),(0,m.j)(m.FP.MEDIA_UPLOAD_STARTED,{media_upload_id:y.id,media_type:this.props.mediaType,post_id:this.props.postId}),super.uploadFile(e,null,{urls:U,method:"PUT",withCredentials:!1,useFormData:!1,mediaUpload:y}))}),(0,o._)(this,"onFileSelected",async e=>{var t,i,o,a;if(this.setState({recording:!1}),e=e||(null===(i=this.input)||void 0===i?void 0:null===(t=i.files)||void 0===t?void 0:t[0]),this.input&&(this.input.value=""),e){if(!r()(this.props.maxVideoDurationSeconds))try{let t=await (0,g.Iw)(e);if("number"==typeof t&&t>this.props.maxVideoDurationSeconds){(0,m.j)(m.FP.VIDEO_UPLOAD_IN_NOTES_FAILED,{duration_seconds:t,reason:"too_long"}),null===(o=(a=this.props).onVideoTooLong)||void 0===o||o.call(a);return}}catch(e){console.warn("could not get video duration",e)}this.uploadToS3(e)}}),(0,o._)(this,"onComplete",async()=>{var e,t,i;let o=null===(e=this.state.uploading)||void 0===e?void 0:e.status;if(!o||o<200||o>=400){this.onError();return}(0,m.j)(m.FP.MEDIA_UPLOAD_COMPLETED,{media_upload_id:this.state.mediaUpload.id,post_id:this.props.postId});let a=[...null!==(i=this.state.existingEtags)&&void 0!==i?i:[],...null===(t=this.state.uploadingXhrs)||void 0===t?void 0:t.map(e=>e.getResponseHeader("Etag")).filter(Boolean)];await this.initTranscode(this.state.mediaUpload,a)}),(0,o._)(this,"initTranscode",async(e,t)=>{let i=null;try{if((i=await this.state.durationPromise)&&"object"==typeof i&&"is_error"in i)throw i}catch(e){console.error("Failed to fetch video duration:",e)}try{var o,a;let n=await u().post("/api/v1/".concat(this.props.mediaType,"/upload/").concat(e.id,"/transcode")).send({duration:c()(i)?i:null,multipart_upload_id:e.multipart_upload_id,multipart_upload_etags:t});this.setState({mediaUpload:null,audioExtractMediaUpload:null,multipartUploadId:null}),this.resetUpload(),null===(o=(a=this.props).onUpload)||void 0===o||o.call(a,n.body,"")}catch(e){throw alert((0,f.zx)(e)),this.onError({upload_state:"transcoding"}),e}}),!["video","audio"].includes(e.mediaType))throw Error("unsupported media type: ".concat(e.mediaType));this.accepts="video"===e.mediaType?_:"audio/mpeg,audio/mp3,audio/m4a,audio/x-m4a,audio/aac,audio/aiff,audio/x-aiff,audio/amr,audio/flac,audio/ogg,audio/wav,audio/x-wav",this.fudgeFactor=.9,this.chunkSize=x.MAX_MEDIA_UPLOAD_CHUNK_SIZE,this.i18n=I18N.i(e.language),e.initialFile&&this.onFileSelected(this.props.initialFile)}}T.contextType=h.QA},44369:function(e,t,i){i.d(t,{$4:()=>r,Sm:()=>v,cS:()=>m,nv:()=>u,om:()=>g,pA:()=>f,vM:()=>h});var o=i(27412),a=i(42249),n=i(68833),l=i(98914),d=i(60308);class r extends a.sN{static fromMenuItem(e,t){let{spec:i}=e;return new r(i,t)}constructor(e,t){super(e);let i=this.spec.run;this.spec.run=(e,o,a,l)=>((0,n.j)(n.FP.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),i.call(this,e,o,a,l))}}let s="ProseMirror-prompt",c="".concat(s,"-visible");class p{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,o._)(this,"options",void 0),this.options=e}}class u extends p{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class v extends u{constructor(e,t,i="en"){let{iString:o}=I18N.i(i);super({label:o("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,d.SVA)(),"/publish/post/"))&&alert(o("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return o("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){}return e.startsWith("http")?o("Invalid URL"):o("Invalid URL. Try using http://")}}})}}function h(e,t){let{from:i,$from:o,to:a,empty:n}=e.selection;return n?!!t.isInSet(e.storedMarks||o.marks()):e.doc.rangeHasMark(i,a,t)}function m(e){if(f(e))return;let{iString:t}=I18N.i(e.language||"en"),i="".concat(s,"-").concat(e.parentClass),o=e.root||document.body,a=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(o)||window,n=o.appendChild(document.createElement("div"));n.classList.add(s),e.className&&n.classList.add(e.className),n.id=i,(0,l.cn)(document.body,c);let d=e=>{n.contains(e.target)||u()},r=()=>{if(e.position)e.position(n,v);else{var t,i;let o=e.parentClass&&(null===(t=(i=document).querySelector)||void 0===t?void 0:t.call(i,".".concat(e.parentClass)));if(o){let t=o.getBoundingClientRect();n.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),n.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=n.getBoundingClientRect();n.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),n.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},p=t=>{var i;t&&t.preventDefault();let o=function(e,t){let i={},o=0;for(let a in e){let n=e[a],l=t[o++],d=n.read(l),r=n.validate(d);if(r)return function(e,t){let i=e.parentNode;if(!i)return;let o=i.appendChild(document.createElement("div"));o.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),o.style.top="".concat(e.offsetTop-5,"px"),o.className="ProseMirror-invalid",o.textContent=t,setTimeout(()=>i.removeChild(o),1500)}(l,r),null;i[a]=n.clean(d)}return i}(null!==(i=e.fields)&&void 0!==i?i:{},h);o&&u(o)},u=t=>{(0,l.IV)(document.body,c),window.removeEventListener("mousedown",d),window.removeEventListener("resize",r,!1),a.removeEventListener("scroll",r,!1),n.parentNode&&n.parentNode.removeChild(n),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",d),50),window.addEventListener("resize",r,!1),a.addEventListener("scroll",r,!1);let v=n.appendChild(document.createElement("span"));v.className="head";let h=[],m=0;for(let t in e.fields){m++;let i=e.fields[t].render();i.tabIndex=m,h.push(i)}let g=n.appendChild(document.createElement("form"));if(e.title&&(g.appendChild(document.createElement("h5")).textContent=e.title),h.forEach(e=>{g.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let i=document.createElement("button");i.type="submit",i.className="".concat(s,"-submit"),i.textContent=e.submitText||"OK",i.addEventListener("click",p);let o=document.createElement("button");o.type="button",o.className="".concat(s,"-cancel"),o.textContent=t("Cancel"),o.addEventListener("click",()=>u());let a=g.appendChild(document.createElement("div"));a.className="".concat(s,"-buttons"),a.appendChild(i),a.appendChild(document.createTextNode(" ")),a.appendChild(o)}if(e.footer&&g.appendChild(e.footer),e.openseaEmbedFooter&&g.appendChild(e.openseaEmbedFooter),r(),g.addEventListener("submit",p),e.onInput&&g.addEventListener("input",t=>{var i;null===(i=e.onInput)||void 0===i||i.call(e,t,n)}),g.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),u();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{n.contains(document.activeElement)||u()},500),h.length>1)){for(let t=0;t<h.length;t++)if(document.activeElement===h[t]){0===t&&e.shiftKey?(e.preventDefault(),h[h.length-1].focus()):t!==h.length-1||e.shiftKey||(e.preventDefault(),h[0].focus());break}}}else e.preventDefault(),p()}),g.elements.length>0){let e=g.elements[0];for(let t of Array.from(g.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function f(e){let t="".concat(s,"-").concat(e.parentClass),i=document.getElementById(t);if(i){let e;if(i.querySelector&&(e=i.querySelector(".".concat(s,"-cancel"))),e)e.click();else{var o;null===(o=i.parentNode)||void 0===o||o.removeChild(i),(0,l.IV)(document.body,c)}return!0}}function g(e,t){let i=e.selection.$from;for(let e=i.depth;e>=0;e--){let o=i.index(e);if(i.node(e).canReplaceWith(o,o,t))return!0}return!1}},66586:function(e,t,i){i(16584);var o=i(23493),a=i.n(o);i(98661),i(84892),i(95441),i(42684),i(89874),i(68833),i(15771),i(82402),i(80026),i(19081),i(58175),i(87077),a()((e,t,i)=>{let{downloadable:o}=i;e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t,downloadable:o})},1e3,{trailing:!1})},89871:function(e,t,i){i.d(t,{z:()=>l}),i(16584);var o=i(98661),a=i(30396);i(89734),i(80569),i(40647),i(61381),i(63018);let n=(0,o.createContext)({existingClips:[],mediaClipsRequest:null,isTranscribing:!1,podcastUpload:null,setExistingClips:()=>void 0,setIsTranscribing:()=>void 0,setMediaClipsRequest:()=>void 0,setTranscription:()=>void 0,setUploadProgress:()=>void 0,syncClips:()=>Promise.resolve(),transcription:null,transcriptionGenerated:!1,uploadProgress:null,transcodeProgress:null,setTranscodeProgress:()=>void 0,nonStandardInputReasons:{},uploadState:"no-upload",videoUpload:null,onVideoTranscodeUpdate:()=>Promise.resolve(),postMediaComposition:null,setPostMediaComposition:()=>void 0,updatingActivePostMediaComposition:!1,setUpdatingActivePostMediaComposition:()=>void 0,fetchPostMediaComposition:()=>Promise.resolve()}),l=()=>(0,a.qp)(n)},89874:function(e,t,i){i(16584),i(71068),i(15771),i(19081),i(6400),i(98661),i(30396),i(94184),i(4615),i(58175)},66067:function(e,t,i){i(16584),i(30396);var o=i(23493),a=i.n(o);i(95441),i(28771),i(89874),i(82061),i(68833),i(93687),i(15771),i(19081),i(58175),i(87077),a()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1})},61381:function(e,t,i){i.d(t,{y:()=>d});var o=i(7409),a=i(99282),n=i(30396),l=i(28771);let d=()=>{let{initialTab:e,isDrawerOpen:t,setInitialTab:i,setIsDrawerOpen:d,setPreventChange:r}=(0,l.M$)(),s=(0,n.I4)(e=>{d((0,a._)((0,o._)({},e),{drawerId:"podcast",variant:"push"}))},[d]);return{initialTab:e,isPodcastDrawerOpen:t("podcast"),setInitialTab:i,setIsPodcastDrawerOpen:s,setPreventChange:e=>r({preventChange:e,preventChangeMessage:"Please wait until the upload is finished before closing the drawer"})}}},5780:function(e,t,i){i.d(t,{oj:()=>g});var o=i(7409),a=i(99282),n=i(98848),l=i(16584),d=i(98661),r=i(30396),s=i(94184);i(80569),i(10797),i(86374),i(66067);var c=i(15771);i(81924),i(95441),i(14952),i(56629),i(60807),i(80026),i(6490),i(39693),i(24350),i(57557),i(71171),i(98914),i(55014),i(19081),i(8594),i(68709),i(88e3),i(98248),i(58175),i(51776),i(70379),i(63651),i(7882),i(17688),i(40827),i(64515),i(69791);var p=i(71068);i(86075),i(65523),i(85930),i(52684),i(70293);var u=i(25871);(0,p.zo)({display:"flex",position:"absolute",gap:8,padding:8,paddingTop:32,alignItems:"center",animate:!0,className:u.Z.footer}),i(44369),i(66586);var v=i(68833);i(49762),i(61254);var h=i(99916);i(73857),i(73943),i(6070),i(84864);let m=(e,t,i)=>{(0,v.j)(v.FP.EDITOR_MENU_ICON_CLICKED,{button:i}),t(e)};function f(e,t){return(0,r.I4)(i=>{e&&(t?m(i,e,t):e(i))},[e,t])}(0,d.forwardRef)((e,t)=>{var{trackedName:i,testId:d,priority:r="tertiary",onClick:s}=e,p=(0,n._)(e,["trackedName","testId","priority","onClick"]);let u=f(s,i);return(0,l.tZ)(c.hU,(0,a._)((0,o._)({},p),{size:"sm","data-testId":d,onClick:u,ref:t,priority:r}))}),(0,d.forwardRef)((e,t)=>{var{trackedName:i,testId:d,priority:r="tertiary",onClick:s}=e,p=(0,n._)(e,["trackedName","testId","priority","onClick"]);let u=f(s,i);return(0,l.tZ)(c.zx,(0,a._)((0,o._)({},p),{size:"sm","data-testId":d,onClick:u,ref:t,priority:r}))}),(0,d.forwardRef)((e,t)=>{var{trackedName:i,testId:d,onClick:r}=e,s=(0,n._)(e,["trackedName","testId","onClick"]);let c=f(r,i);return(0,l.tZ)(h.sN,(0,a._)((0,o._)({},s),{"data-testId":d,onClick:c,ref:t}))});let g=()=>{if(window)return window.LatexModalEvent||(window.LatexModalEvent=new EventTarget),window.LatexModalEvent}},70232:function(e,t,i){i.d(t,{zF:()=>o}),i(98914);let o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAY4AAAB0BAMAAABgVMiEAAAAMFBMVEX////7+/vt7e3o6Ojm5ubn5+fu7u709PTs7Oz39/f19fX29vby8vLx8fHz8/Pw8PCxY+A8AAAAoklEQVR4AWJgVHYZ+sBIgEE0vXzog7JAhrZZq4Y+WJnB4A5o5w5oAAYBGAi6mcKpQgIaClhCBklz7+AM/Gjo5+Dg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgeO7g4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OD4Zse3dmVXfIST0/B1vh0UtMKbNF7rAAAAAElFTkSuQmCC"},82061:function(e,t,i){i.d(t,{n:()=>Z});var o=i(27412),a=i(7409),n=i(99282),l=i(58865),d=i(16584),r=i(94184),s=i.n(r),c=i(66784),p=(i(95999),i(28142)),u=i(80569),v=i(13304),h=(i(12281),i(95441)),m=i(41688),f=(i(31098),i(71825),i(21903)),g=(i(21680),i(40165)),y=(i(40158),i(29719),i(68833)),x=(i(98914),i(88788)),w=i(69791),U=i(15771),b=i(19081),C=(i(99916),i(58175),i(74134),i(18618),i(84864)),_=i(96085);function E(){let e=(0,l._)([""," remaining"]);return E=function(){return e},e}f.ZP;let T=e=>{let{onCancel:t,percentComplete:i,msLeft:o}=e,{iString:a,iTemplate:n}=(0,h.M1)(),l=(0,C.secondsToLargestUnit)(o/1e3,{long:!0,secondsCutoff:30});return(0,d.BX)("div",{className:"video-uploader-progress",children:[(0,d.BX)("div",{className:"video-uploader-progress-label",children:[a("Uploading video..."),o?n(E(),l):""]}),(0,d.BX)("div",{className:"video-uploader-progress-status",children:[(0,d.tZ)(U.hU,{size:"sm",priority:"quaternary",onClick:()=>{t()},children:(0,d.tZ)(v.Z,{})}),(0,d.tZ)("div",{className:"video-uploader-progress-bar",children:(0,d.tZ)("div",{className:"video-uploader-progress-bar-filled",style:"width: ".concat(100*i,"%;")})})]})]})};f.QM;class Z extends f.QM{trackUploadClicked(){(0,y.j)(y.FP.UPLOAD_VIDEO_CLICKED,{source:"notes"})}render(e,t){return null}constructor(e,t){super(e,t),this.state=(0,n._)((0,a._)({},this.state),{hideVideoInfoPanel:!1})}}},70717:function(e,t,i){i.d(t,{w:()=>d});var o=i(16584),a=i(19081),n=i(58175),l=i(84864);let d=e=>{let{duration:t,icon:i,position:d="bottom-left",previewDuration:r}=e;return(0,o.BX)(a.gq,{alignItems:"center",bg:"glass-inverted-medium",gap:6,paddingX:8,paddingY:2,position:"absolute",radius:"sm",style:"bottom-left"===d?{left:8,bottom:8}:{right:8,bottom:8},children:[i,(0,o.tZ)(n.xv.Meta,{color:"white",lineHeight:20,children:r?"".concat((0,l.secondsToHHMMSS)(r)," / ").concat((0,l.secondsToHHMMSS)(null!=t?t:0)):(0,l.secondsToHHMMSS)(null!=t?t:0)})]})}},69791:function(e,t,i){i.d(t,{b:()=>u});var o=i(16584),a=i(94184),n=i.n(a),l=i(41352),d=i(71068),r=i(15771),s=i(19081),c=i(58175),p=i(98866);let u=e=>{let{title:t,description:i,Icon:a,onDismiss:n,theme:l="default",priority:d="tertiary",showClose:r=!0,flex:s="grow"}=e;return(0,o.BX)(y,{theme:l,priority:d,flex:s,children:[a&&(0,o.tZ)(v,{Icon:a}),(0,o.BX)(x,{children:[t&&(0,o.tZ)(h,{children:t}),i&&(0,o.tZ)(m,{children:i})]}),r&&(0,o.tZ)(f,{onClose:n,priority:d})]})},v=e=>{let{Icon:t}=e;return(0,o.tZ)(g,{children:(0,o.tZ)(t,{size:18,className:p.Z.icon})})},h=e=>{let{children:t}=e;return(0,o.tZ)(c.xv.B4,{weight:"medium",color:"primary",className:p.Z.title,children:t})},m=e=>{let{children:t}=e;return(0,o.tZ)(c.xv.B4,{weight:"regular",color:"secondary",className:p.Z.description,children:t})},f=e=>{let{onClose:t,priority:i}=e;return(0,o.tZ)(g,{children:(0,o.tZ)(r.hU,{priority:"quaternary",onClick:t,size:"xs",children:(0,o.tZ)(l.Z,{size:18,className:n()(p.Z.dismissIcon,p.Z["priority_".concat(i)])})})})},g=(0,d.zo)({display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}),y=e=>{let{theme:t,priority:i,children:a,flex:l}=e;return(0,o.tZ)(s.X2,{flex:l,gap:12,paddingX:16,paddingY:12,radius:"sm",className:n()(p.Z.alert,p.Z["theme_".concat(t)],p.Z["priority_".concat(i)]),children:a})},x=(0,d.zo)({display:"flex",direction:"column",flex:"grow",alignItems:"start"})},8594:function(e,t,i){i.d(t,{A:()=>v,L:()=>h});var o=i(7409),a=i(99282),n=i(98848),l=i(16584),d=i(94697),r=i(45587),s=i(24285),c=i(71068);let p={opacity:.5,zIndex:1e3},u=e=>"item-".concat(e);function v(e){let{children:t,items:i,onReorder:o}=e,a=(0,d.Dy)((0,d.VT)(d.we,{activationConstraint:{distance:2}}),(0,d.VT)(d.Lg,{coordinateGetter:r.is}));return(0,l.tZ)(d.LB,{sensors:a,collisionDetection:d.pE,onDragEnd:e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let n=i.findIndex(e=>u(e)===t.id),l=i.findIndex(e=>u(e)===a.id);o((0,r.Rp)(i,n,l))},autoScroll:!1,children:(0,l.tZ)(r.Fo,{items:i.map(e=>u(e)),strategy:r.U2,children:t})})}function h(e){var{item:t}=e,i=(0,n._)(e,["item"]);return(0,l.tZ)(m,(0,o._)({id:u(t)},i))}let m=e=>{let{children:t,id:i,useDragHandle:n=!1}=e,{listeners:d,setNodeRef:u,transform:v,transition:h,isDragging:m}=(0,r.nB)({id:i});return(0,l.tZ)(c.xu,(0,a._)((0,o._)({ref:e=>u(e),style:(0,o._)({transform:s.ux.Translate.toString(v),transition:h},m?p:{})},n?{}:(0,o._)({},d)),{children:"function"==typeof t?t({listeners:d}):t}))}},61527:function(e,t,i){i.d(t,{Vo:()=>b,ql:()=>_,to:()=>C});var o=i(16584),a=i(30396),n=i(61649),l=i(68833),d=i(98422),r=i(19081),s=i(28797),c=i(49233),p=i(90630),u=i(63587),v=i(32782),h=i(84945),m=i(76671),f=i(68260),g=i(30730),y=i(27420),x=i(91189),w=i(6511),U=i(73798);let b=e=>{var t,i,b,C;let{autoPlayMuted:_,forLiveStream:E=!1,disableSharing:T=!1,disableShortcuts:Z=!1,disableTooltips:M=!1,disableCaptions:I=!1,duration:S,handle:A,hasPaywall:k=!1,hasTranscript:P=!1,hideNextVideoButton:D=!1,hidePip:N=!1,hideCaptions:B=!1,hideSettings:L=!1,isActive:O,isAudio:z=!1,isFocused:F,mediaRef:X,mediaUpload:R,podcastUpload:q,post:K,pub:j,showPaywall:V,showTranscript:H,size:W="md",onShareMenuClose:Y,onShareMenuOpen:J,onToggleShowTranscript:G,onBlur:Q,hoverOptions:$}=e,{transition:ee=.5,transitionDelay:et=.1}=null!=$?$:{},{isClipping:ei}=(0,n.Sr)(),{isMobile:eo}=(0,d.v9)(),ea=O&&!V,en=(0,a.sO)(null),[el,ed]=(0,a.eJ)(!1),[er,es]=(0,a.eJ)(!1),[ec,ep]=(0,a.eJ)(null),eu=e=>{let{current:t}=X;t&&(t.isShowingCaptionsElsewhere=e),es(e)};(0,a.d4)(()=>{(ei||_)&&ev({showCaptions:!0,userInitiated:!1})},[ei,_]);let ev=e=>{let{showCaptions:t,userInitiated:i}=e;eu(t),t&&(null==eh?void 0:eh.length)&&eh[0]&&(ep(eh[0].language),i&&(0,l.j)(l.FP.VIDEO_CLOSED_CAPTIONS_BUTTON_CLICKED,{language:eh[0].language}))};(0,a.d4)(()=>{ea||ed(!1)},[ea]);let eh=null!==(b=null==q?void 0:null===(t=q.transcription)||void 0===t?void 0:t.signed_captions)&&void 0!==b?b:[],em=!!(null==q?void 0:null===(i=q.transcription)||void 0===i?void 0:i.approved_at);return(0,o.BX)("div",{ref:en,style:{zIndex:ei?10:+!!el},onBlur:Q,children:[(null==A?void 0:A.active)?(0,o.tZ)("div",{className:U.Z.topOverlaysContainer,style:{opacity:+!!ea,transform:ea||eo?"translateY(0)":"translateY(-20%)"},children:(0,o.BX)(r.gq,{justifyContent:"space-between",paddingBottom:32,children:[(0,o.tZ)(r.gq,{padding:16}),(0,o.tZ)(r.gq,{padding:16})]})}):null,(0,o.tZ)("div",{}),!E&&(0,o.tZ)("div",{className:U.Z.settingsControlsContainer,style:{opacity:el&&ea?1:0,pointerEvents:el?"auto":"none"},children:(0,o.BX)(r.tu,{children:[(0,o.tZ)(r.gq,{className:U.Z.settingsControlsBox,children:(0,o.tZ)(g.Z,{hideSharePostAtCurrentTime:z,mediaRef:X,post:K,pub:j,podcastUpload:q,subtitles:ec,setSubtitles:e=>{ep(e),!e&&er?eu(!1):e&&!er&&eu(!0)},setIsSettingsOpen:ed})}),(0,o.tZ)("div",{style:{height:"60px"}})]})}),(0,o.BX)("div",{className:U.Z.bottomControlsContainer,style:{transform:ea||eo?"translateY(0)":"translateY(40px)",transition:"transform ".concat(ee,"s ease"),transitionDelay:"".concat(et,"s")},children:[(0,o.tZ)("div",{className:U.Z.backDrop,style:{opacity:+!!ea}}),(0,o.BX)(r.tu,{flex:"grow",gap:8,paddingY:4,children:[X.current&&q&&!k&&A&&R&&!I&&(0,o.tZ)("div",{className:U.Z.captionsContainer,children:(0,o.tZ)(s.Z,{handle:A,mediaUpload:q,showCaptions:er,size:W,subtitles:ec,videoEle:null!==(C=X.current.player)&&void 0!==C?C:null,withHighlight:ei})}),(0,o.tZ)("div",{className:U.Z.bottomInnerControlsContainer,style:{opacity:+!!ea,transition:void 0!=ee?"opacity ".concat(ee,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(r.tu,{flex:"grow",children:[!E&&(0,o.tZ)(r.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:z||T,mediaRef:X,mediaUpload:R,post:K,pub:j,size:W,onShareMenuClose:Y,onShareMenuOpen:J})}),(0,o.BX)(r.gq,{paddingX:4,children:[(0,o.BX)(r.hs,{gap:8,alignItems:"center",children:[!E&&(0,o.tZ)(m.Z,{disableShortcuts:Z,disableTooltips:M,isFocused:F,mediaRef:X}),!D&&(null==R?void 0:R.post_id)&&(0,o.tZ)(u.Z,{disableShortcuts:Z,isFocused:F,postId:R.post_id,pub:j}),(0,o.tZ)(w.Z,{disableShortcuts:Z,disableTooltips:M,isFocused:F,mediaRef:X}),!E&&(0,o.tZ)(h.Z,{duration:z&&null!=S?S:null,mediaRef:X})]}),(0,o.tZ)(r.hs,{flex:"grow"}),(0,o.BX)(r.hs,{gap:8,alignItems:"center",children:[!z&&G&&!E&&(0,o.tZ)(x.Z,{disableShortcuts:Z,disableTooltips:M,disabled:k||!P,isFocused:F,showTranscript:null!=H&&H,onToggleShowTranscript:G}),!z&&!B&&!E&&(0,o.tZ)(c.Z,{disableShortcuts:Z,disableTooltips:M,disabled:!em||k,isFocused:F,setShowCaptions:ev,showCaptions:er}),!z&&!N&&(0,o.tZ)(v.Z,{disableShortcuts:Z,disableTooltips:M,isFocused:F,mediaRef:X}),!z&&A&&(0,o.tZ)(p.Z,{disableShortcuts:Z,disableTooltips:M,handle:A,isFocused:F}),!E&&!L&&(0,o.tZ)(f.Z,{disableTooltips:M,isSettingsOpen:el,setIsSettingsOpen:ed})]})]})]})})]})]})]})},C=e=>{var t,i,n,u,v,f;let{mediaRef:g,mediaUpload:x,handle:b,isActive:C,pub:_,size:E="sm",startTime:T,duration:Z,useCaptions:M=!1,captionsStyle:I,hoverOptions:S,onBlur:A}=e,{transition:k=.5,transitionDelay:P=.1}=null!=S?S:{},{isMobile:D}=(0,d.v9)(),N=(0,a.sO)(null),[B,L]=(0,a.eJ)(!1),[O,z]=(0,a.eJ)(null),F=null!==(v=null==x?void 0:null===(i=x.extractedAudio)||void 0===i?void 0:null===(t=i.transcription)||void 0===t?void 0:t.signed_captions)&&void 0!==v?v:[],X=!!(null==x?void 0:null===(u=x.extractedAudio)||void 0===u?void 0:null===(n=u.transcription)||void 0===n?void 0:n.approved_at);return(0,a.d4)(()=>{let e=()=>{var e;(null===(e=g.current)||void 0===e?void 0:e.player)&&!isNaN(g.current.player.duration)&&(g.current.player.currentTime=T)};if(g.current){var t;null===(t=g.current.player)||void 0===t||t.addEventListener("durationchange",e)}return()=>{if(g.current){var t;null===(t=g.current.player)||void 0===t||t.removeEventListener("durationchange",e)}}},[g]),(0,o.BX)("div",{ref:N,onBlur:A,children:[(null==b?void 0:b.active)?(0,o.tZ)("div",{className:U.Z.topOverlaysContainer,style:{opacity:+!!C,transform:C||D?"translateY(0)":"translateY(-20%)"},children:(0,o.BX)(r.gq,{justifyContent:"space-between",paddingBottom:32,children:[(0,o.tZ)(r.gq,{padding:16}),(0,o.tZ)(r.gq,{padding:16})]})}):null,g.current&&(null==x?void 0:x.extractedAudio)&&b&&M&&(0,o.tZ)("div",{className:U.Z.captionsContainer,style:{bottom:0},children:(0,o.tZ)(s.Z,{handle:b,mediaUpload:x.extractedAudio,showCaptions:B,size:E,subtitles:O,videoEle:null!==(f=g.current.player)&&void 0!==f?f:null,captionsStyle:I,withHighlight:!0})}),(0,o.BX)("div",{className:U.Z.bottomControlsContainer,style:{transform:C||D?"translateY(0)":"translateY(40px)",transition:void 0!=k?"transform ".concat(k,"s ease"):"transform 0.5s ease",transitionDelay:void 0!=P?"".concat(P,"s"):"0.1s"},children:[(0,o.tZ)("div",{className:U.Z.backDrop,style:{opacity:+!!C}}),(0,o.tZ)(r.tu,{flex:"grow",gap:8,paddingY:4,children:(0,o.tZ)("div",{className:U.Z.bottomInnerControlsContainer,style:{opacity:+!!C,transition:void 0!=k?"opacity ".concat(k,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(r.tu,{flex:"grow",children:[(0,o.tZ)(r.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:!0,mediaRef:g,mediaUpload:x,post:void 0,pub:_,size:"sm",startTime:T,endTime:Z?T+Z:void 0})}),(0,o.BX)(r.gq,{paddingX:4,children:[(0,o.BX)(r.hs,{gap:8,alignItems:"center",children:[(0,o.tZ)(m.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:g}),(0,o.tZ)(w.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:g}),(0,o.tZ)(h.L,{startTime:T,duration:null!=Z?Z:null,mediaRef:g})]}),(0,o.tZ)(r.hs,{flex:"grow"}),(0,o.tZ)(c.Z,{disableShortcuts:!0,disableTooltips:!0,disabled:!X,setShowCaptions:e=>{let{showCaptions:t,userInitiated:i}=e;L(t),t&&(null==F?void 0:F.length)&&F[0]&&(z(F[0].language),i&&(0,l.j)(l.FP.VIDEO_CLOSED_CAPTIONS_BUTTON_CLICKED,{language:F[0].language}))},showCaptions:B,isFocused:!1}),b&&(0,o.tZ)(p.Z,{disableShortcuts:!0,disableTooltips:!0,handle:b,isFocused:!1})]})]})})})]})]})},_=e=>{let{mediaRef:t,mediaUpload:i,isActive:n,pub:l,startTime:s,duration:c,hoverOptions:p,onBlur:u}=e,{transition:v=.5,transitionDelay:f=.1}=null!=p?p:{},{isMobile:g}=(0,d.v9)(),x=(0,a.sO)(null);return(0,a.d4)(()=>{let e=()=>{var e;(null===(e=t.current)||void 0===e?void 0:e.player)&&!isNaN(t.current.player.duration)&&(t.current.player.currentTime=s)};if(t.current){var i;null===(i=t.current.player)||void 0===i||i.addEventListener("durationchange",e)}return()=>{if(t.current){var i;null===(i=t.current.player)||void 0===i||i.removeEventListener("durationchange",e)}}},[t]),(0,o.tZ)("div",{ref:x,onBlur:u,children:(0,o.BX)("div",{className:U.Z.bottomControlsContainer,style:{transform:n||g?"translateY(0)":"translateY(40px)",transition:"transform ".concat(v,"s ease"),transitionDelay:"".concat(f,"s")},children:[(0,o.tZ)("div",{className:U.Z.backDrop,style:{opacity:+!!n}}),(0,o.tZ)(r.tu,{flex:"grow",gap:8,paddingY:4,children:(0,o.tZ)("div",{className:U.Z.bottomInnerControlsContainer,style:{opacity:+!!n,transition:void 0!=v?"opacity ".concat(v,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(r.tu,{flex:"grow",children:[(0,o.tZ)(r.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:!0,mediaRef:t,mediaUpload:i,post:void 0,pub:l,size:"sm",startTime:s,endTime:c?s+c:void 0})}),(0,o.BX)(r.gq,{paddingX:4,children:[(0,o.BX)(r.hs,{gap:8,alignItems:"center",children:[(0,o.tZ)(m.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:t}),(0,o.tZ)(w.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:t}),(0,o.tZ)(h.L,{startTime:s,duration:null!=c?c:null,mediaRef:t})]}),(0,o.tZ)(r.hs,{flex:"grow"})]})]})})})]})})}},12988:function(e,t,i){i.d(t,{Ws:()=>o}),i(75472);let o=(e,t)=>{let i;let{showLiveOverlay:o,subtitle:a,aspectRatio:n,pub:l,includeBumper:d,includeHeadlines:r,headlineText:s}=null!=t?t:{},c={skip_bumper:!d},p=!1,u=e.width&&e.height?e.width/e.height:1,v=!!e.live_stream_id,h=!(e.live_stream_id&&u>=1);if(e.liveStream){var m,f,g;p=(null!==(f=e.liveStream.joinedOrCompletedLiveStreamInvites)&&void 0!==f?f:[]).length>0,i=null!==(g=null===(m=e.liveStream.user)||void 0===m?void 0:m.handle)&&void 0!==g?g:void 0}return(null==l?void 0:l.author_handle)&&(i=l.author_handle),(v||o)&&(h||(c.legacy_watermark={type:"legacy_watermark",show:!1}),(u<1||["vertical_fill","vertical_fit"].includes(null!=n?n:""))&&(o&&(c.live_overlay={type:"live_overlay",position:p?"bottom":"center",subtitle:a||(i?"@".concat(i):void 0)}),c.captions={type:"captions",position:p?["center","center"]:["center",700]})),r&&s&&(c.headline={type:"headline",text:s,position:v&&p?["center","center"]:["center",142]},c.legacy_watermark={type:"legacy_watermark",show:!1},delete c.live_overlay),c}},54809:function(e,t,i){let o;i.d(t,{ER:()=>n,Lz:()=>r,Nf:()=>c,Xb:()=>s,Z$:()=>d,uM:()=>l});var a=i(84864);i.e("3889").then(i.t.bind(i,80983,19)).then(e=>{o=e.default});let n={"application/x-cbr":[[82,97,114,33,26,7,0],[82,97,114,33,26,7,1,0],[127,69,76,70]],"application/x-cbz":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},l={"application/vnd.amazon.kfx":[[75,70,88,32]],"application/vnd.amazon.kpf":[[80,75,3,4]],"application/epub+zip":[[80,75,3,4]],"application/x-mobipocket-ebook":[[77,79,66,73]]},d={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},r={"application/pdf":[[37,80,68,70]]};function s(e){let{mimeTypesToSignature:t,substackType:i,actionButtonAttr:o}=e;return[{tag:"div.file-embed-wrapper",getAttrs:e=>{let n={};try{var l,d,r;let[s,c,p]=e.children[0].children;if(!s)return!1;let[u,v]=s.children;if(!v||!u)return!1;let[h,m]=v.children;if(!m)return!1;n.title=null==h?void 0:h.textContent;let[f,g]=(null===(l=m.textContent)||void 0===l?void 0:l.split("∙"))||[];if(!f||!g)return!1;n.filesize=(0,a.formattedBytesToNumber)(f);let y=null===(r=g.split("File"))||void 0===r?void 0:null===(d=r[0])||void 0===d?void 0:d.trim().toLowerCase();if(!y)return!1;if(t[y]||i===y)n.filetype=y;else{if("file"!==i)return!1;n.filetype=y}return(null==u?void 0:u.classList.contains("file-embed-thumbnail-default"))||(n.thumbnail=u.getAttribute("src")||""),n.description=null==c?void 0:c.innerText,n[o]=null==p?void 0:p.getAttribute("href"),n}catch(e){return!1}}}]}function c(e){var t;let{attrs:i}=e;return"".concat((0,a.numberToHumanFileSize)(null!==(t=Number(i.filesize))&&void 0!==t?t:void 0)," ∙ ").concat(function(e){var t,i,a,n;let{filetype:l}=e;return o&&l?["application/vnd.amazon.kfx","application/vnd.amazon.kpf","application/vnd.amazon.ebook"].includes(l)?"Kindle":null!==(n=null===(i=o.extension(l)||(null===(a=l.split("/").pop())||void 0===a?void 0:a.split("-").pop()))||void 0===i?void 0:null===(t=i.toUpperCase)||void 0===t?void 0:t.call(i))&&void 0!==n?n:"":""}({filetype:i.filetype})," file")}},62092:function(e,t,i){function o(e){let{fragment:t}=e;return"content"in t?t.content:[]}function a(e){let{fragment:t,content:i}=e;t.content=i}function n(e){return"type"in e&&"object"==typeof e.type}function l(e){return"type"in e&&"string"==typeof e.type}i.d(t,{PH:()=>n,f5:()=>l,uR:()=>a,yX:()=>o})},68303:function(e,t,i){i.d(t,{$9:()=>j,$_:()=>R,C4:()=>W,Co:()=>S,DY:()=>w,Dg:()=>A,E5:()=>U,Hs:()=>H,N5:()=>y,PH:()=>f,S7:()=>P,Wi:()=>z,cb:()=>h.cb,do:()=>L,fX:()=>Z,fp:()=>x,gR:()=>N,je:()=>h.je,k:()=>k,lr:()=>M,o4:()=>V,qe:()=>D,qj:()=>m});var o=i(7409),a=i(99282),n=i(92007);i(39693);var l=i(14293),d=i.n(l),r=i(10691),s=i.n(r),c=i(19834),p=i(36186),u=i(84864),v=i(88956),h=i(22498);let m=[["list_item","listItem"],["bullet_list","bulletList"],["ordered_list","orderedList"],["hard_break","hardBreak"],["horizontal_rule","horizontalRule"],["code_block","codeBlock"]],f=[["em","italic"],["strong","bold"],["strikethrough","strike"]],g={image2:1,image:0,horizontal_rule:0,audio:0,video:0,youtube:0,youtube2:0,vimeo:0,opensea:0,twitter:0,twitter2:0,spotify:0,spotify2:0,soundcloud:0,bandcamp:0,kindle:0,tiktok:0,prediction_market:0,lichess:0,datawrapper:0,recipe:0,pinterest:0},y=function(e){let{maxLength:t=356,getAfterCutoff:i=!1,withEllipsis:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="",n=!1,l={},d=W(e),r=!1,s=(0,v.Y)(e,e=>{var o;if(n)return i;if("paywall"===e.type)return n=!0,!1;if(d)return!0;let s=null!==(o=e.type)&&void 0!==o?o:"undefined";if(l[s]=(l[s]||0)+1,e.type&&e.type in g&&l[s]>g[e.type])return n=!0,i;let c=t-a.length;if(c<=0&&!d||!(c>0))return i;if(i){if("text"===e.type&&e.text){if(!(t-(a+=e.text).length<=0))return!1;e.text=e.text.substring(e.text.length+t-a.length-1,e.text.length)}}else if("text"===e.type&&e.text){a+=e.text;let t=e.text;e.text=(0,u.truncateText)(t,c),r=t!==e.text}return!0});if(s&&o&&!r){let e=function(e){let t=[],i=[e];for(;i.length;){var o;let e=i.pop();if(!e)break;if(e.content&&(null===(o=e.content)||void 0===o?void 0:o.length)>0)for(let t=e.content.length-1;t>=0;t--){let o=e.content[t];o&&i.push(o)}else t.push(e)}return t}(s),t=null,i=null;for(let o=e.length-1;o>=0&&(!t||!i);o--){let a=e[o];null===t&&(null==a?void 0:a.type)==="text"&&(t=o),null===i&&(null==a?void 0:a.type)!=="text"&&(null==a?void 0:a.type)!=="paragraph"&&(i=o)}let o=null!==t?e[t]:null,a=o&&null!==i&&null!==t&&i>t;o&&!a&&(o.text=I(o.text))}return s},x=(e,t)=>{let i=[];if(e&&(t(e)&&i.push(e),e.content))for(let o of e.content)i=i.concat(x(o,t));return i},w=(e,t)=>{if(e){if(t(e))return e;if(e.content)for(let i of e.content){let e=w(i,t);if(e)return e}}return null},U=e=>{let t=[];return e.nodesBetween(0,e.content.size,e=>{var i;(null===(i=e.type)||void 0===i?void 0:i.name)==="cashtag"&&t.push(e.attrs.symbol)},0),t},b=new Set(["caption","footnote","captionedImage","image","image2"]),C=new Set(["bullet_list","bulletList","ordered_list","orderedList","blockquote"]),_="x_li_start_placeholder_x",E=(e,t)=>{var i,o,a,n;if((null===(i=e.type)||void 0===i?void 0:i.name)==="list_item"||(null===(o=e.type)||void 0===o?void 0:o.name)==="listItem")return{open:_,close:""};if((null===(a=e.type)||void 0===a?void 0:a.name)==="paragraph"||e.isBlock&&e.textContent.length>0&&!C.has(null===(n=e.type)||void 0===n?void 0:n.name)){let e="<p>";return(t.length>0?t[t.length-1]:null)===_&&(t.pop(),e+="* "),{open:e,close:"</p>"}}return null},T=e=>{var t,i,o;let{node:a,recursiveDepth:n,tokens:l}=e;if(n>100)return console.warn("Reached max recursive depth while converting document to HTML for podcast"),!1;let d=!0;if(b.has(null===(t=a.type)||void 0===t?void 0:t.name))d=!1;else if(a.isText){if(a.text&&a.text.length>0){let e=a.marks.find(e=>"link"===e.type.name&&e.attrs.href),t=a.marks.find(e=>"em"===e.type.name),i=a.marks.find(e=>"strong"===e.type.name),o=a.text;t&&(o="<em>".concat(o,"</em>")),i&&(o="<strong>".concat(o,"</strong>")),e&&(o='<a target="_blank" href="'.concat((0,c.Z)(e.attrs.href),'">').concat(o,"</a>")),l.push(o)}}else if(E(a,[])){let e=E(a,l);e&&l.push(e.open),a.descendants(e=>T({node:e,recursiveDepth:n+1,tokens:l})),e&&l.push(e.close),d=!1}else if((null===(i=a.type)||void 0===i?void 0:i.name)==="cashtag")l.push("".concat(a.attrs.symbol," "));else if((null===(o=a.type)||void 0===o?void 0:o.name)==="substack_mentions"){let e=a.marks.find(e=>"em"===e.type.name),t=a.marks.find(e=>"strong"===e.type.name),i=a.attrs.name;if(e&&(i="<em>".concat(i,"</em>")),t&&(i="<strong>".concat(i,"</strong>")),"user"===a.attrs.type){let e=(0,p.GR)(a.attrs.id,a.attrs.name);l.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}else if("pub"===a.attrs.type){let e=a.attrs.url;l.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}}return d},Z=e=>{let t=[];return e.descendants(e=>T({node:e,recursiveDepth:1,tokens:t})),t.filter(e=>e!==_).join("").trim()},M=function(e){let{withLinks:t=!0,withCaptionsAndFootnotes:i=!1,withQuotes:o=!0,forPodcast:a=!1,truncateAt:n=null,truncateTo:l=n,truncateEllipsis:r="…",truncateExtension:s=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p="",v="",h="",m=!0;return e.nodesBetween(0,e.content.size,e=>{var n,f,g,y,x,w,U;if(!i&&["caption","footnote"].includes(null===(n=e.type)||void 0===n?void 0:n.name)||!o&&((null===(f=e.type)||void 0===f?void 0:f.name)==="pullquote"||(null===(g=e.type)||void 0===g?void 0:g.name)==="blockquote"||(null===(y=e.type)||void 0===y?void 0:y.name)==="calloutBlock"))return!1;if(e.isText){if(e.text&&e.text.length>0){let i;m=!1,!d()(l)&&p.length<l&&p.length+e.text.length>=l&&(i=(0,u.truncateText)(e.text,l-p.length,{ellipsis:r,extension:s}));let o=e.marks.filter(e=>"link"===e.type.name&&e.attrs.href)[0],n=e.marks.filter(e=>"em"===e.type.name)[0],f=e.marks.filter(e=>"strong"===e.type.name)[0],g=e.text;p+=g,n&&a&&(i&&(i="<em>".concat(i,"</em>")),g="<em>".concat(g,"</em>")),f&&a&&(i&&(i="<strong>".concat(i,"</strong>")),g="<strong>".concat(g,"</strong>")),o&&t?a?(i&&(h="".concat(v,'<a target="_blank" href="').concat((0,c.Z)(o.attrs.href),'">').concat(i,"</a>")),v+='<a target="_blank" href="'.concat((0,c.Z)(o.attrs.href),'">').concat(g,"</a>")):(i&&(h="".concat(v).concat(i," [ ").concat(o.attrs.href," ]")),v+="".concat(g," [ ").concat(o.attrs.href," ]")):(i&&(h=v+i),v+=g)}}else!m&&["hard_break","hardBreak"].includes(null===(x=e.type)||void 0===x?void 0:x.name)?(m=!0,p+="\n",a?v+="<br/>":v+="\n"):!m&&e.isBlock?(m=!0,p+="\n",a?v+="<br/><br/>":v+="\n"):(null===(w=e.type)||void 0===w?void 0:w.name)==="cashtag"?v+="".concat(e.attrs.symbol," "):(null===(U=e.type)||void 0===U?void 0:U.name)==="substack_mentions"&&(v+="".concat(e.attrs.name," "))},0),!d()(n)&&p.length>n&&h&&(v=h),v=v.trim(),a&&(v=v.replace(/\s*(<br\/>)+$/,"").trim()),v},I=e=>"".concat(s()(e,"."),"..."),S=(e,t)=>(0,a._)((0,o._)({name:e},t),{addAttributes:()=>t.attrs||{},parseHTML:()=>t.parseDOM,renderHTML(i){let{node:o}=i;return t.toDOM?t.toDOM(o):(console.warn("trying to create TipTapNode, no toDOM found for node",e),["span"])}}),A=(e,t)=>{let i,o,a;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,n)=>{if(i||o)return!1;let l=e.marks.find(e=>e.type===t);l&&(i=e,o=l,a={from:n,to:n+e.nodeSize})}),i)return{node:i,mark:o,pos:a}},k=(e,t)=>{let i,o,a;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(n,l)=>{if(i||o||!(l<=e.selection.from)||!(e.selection.to<=l+n.nodeSize))return!1;{let e=n.marks.find(e=>e.type===t);e&&(i=n,o=e,a={from:l,to:l+n.nodeSize})}}),!i){if(e.selection.empty){let d=e.doc.resolve(e.selection.from),r=d.nodeBefore&&d.nodeBefore.marks.find(e=>e.type===t),s=d.nodeAfter&&d.nodeAfter.marks.find(e=>e.type===t);if(r||s){var n,l;i=s?d.nodeAfter:d.nodeBefore,o=s||r,a=s?{from:d.pos,to:d.pos+d.nodeAfter.nodeSize}:{from:d.pos-(null!==(l=null===(n=d.nodeBefore)||void 0===n?void 0:n.nodeSize)&&void 0!==l?l:0),to:d.pos}}}if(!i)return}return{node:i,mark:o,pos:a}},P=function(e){let{allowedMarks:t=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!e.selection.empty||D(e,e.selection.from,e.selection.to,{allowedMarks:t})},D=function(e,t,i){let{allowedMarks:o=[]}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=!0,n=!1;return e.doc.nodesBetween(t,i,t=>{if(!a)return!1;t.type!==e.schema.nodes.text?n?a=!1:n=!0:t.marks.find(e=>!o.includes(e.type))&&(a=!1)}),a},N=(e,t)=>{if(e.selection.empty)return!1;let i=Array.isArray(t)?t:[t];if("node"in e.selection){var o;let t=e.selection;return i.includes(null===(o=t.node)||void 0===o?void 0:o.type)}return B(e,e.selection.from,e.selection.to,i)},B=(e,t,i,o)=>{let a=null;return e.doc.nodesBetween(t,i,e=>{if(!(!1!==a&&o.includes(e.type)))return a=!1,!1;a=!0}),a||!1},L=e=>e.selection.empty?null:O(e,e.selection.from,e.selection.to),O=(e,t,i)=>{let o=null;return e.doc.nodesBetween(t,i,t=>!o&&(t.type===e.schema.nodes.image2?(o=t.attrs.href,!1):void(t.type===e.schema.nodes.image3&&(o=t.attrs.href)))),o||null},z=(e,t,i)=>{e.selection.empty||F(e,t,e.selection.from,e.selection.to,i)},F=(e,t,i,o,a)=>{e.doc.nodesBetween(i,o,(i,o)=>{(i.type===e.schema.nodes.image2||i.type===e.schema.nodes.image3)&&t.setNodeMarkup(o,i.type,Object.assign({},i.attrs,{href:a}),i.marks)})},X=e=>({top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}),R=(e,t,i,o)=>{let a=document.body,n=window.innerWidth<=481,l=q(e,t.from,t.to,t=>[e.state.schema.nodes.image,e.state.schema.nodes.image2].includes(t.type))?-44:8,d=X(e.coordsAtPos(t.from)),r=X(e.coordsAtPos(t.to));i.style.position="fixed";let s=r.bottom+(n?a.scrollTop:0),c=a.clientHeight-i.clientHeight-96-l;d.top<r.top?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(Math.min(d.left,r.left),"px")):a.clientWidth-d.left>i.clientWidth?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(d.left,"px")):(o&&(o.style.left="".concat(d.left-a.clientWidth+i.clientWidth,"px")),i.style.right="10px",i.style.left=""),n||s<c?(o&&(o.style.top="-9px",o.style.bottom="auto",o.style.transform=""),i.style.top="".concat(s+l,"px")):(o&&(o.style.top="auto",o.style.bottom="-9px",o.style.transform="rotate(180deg)"),i.style.top="".concat(c+l,"px"))},q=(e,t,i,o)=>{let a=!1;return e.state.doc.nodesBetween(t,i,e=>{if(a)return!1;a=o(e)}),a},K=e=>e.doc.resolve(e.selection.from).node(1),j=(e,t)=>{var i;return t.includes(null===(i=K(e))||void 0===i?void 0:i.type)},V=(e,t)=>{var i,o,a;let l=e.tr,d=l.selection instanceof n.Bs,r=d&&(null===(a=l.selection.$from)||void 0===a?void 0:null===(o=a.parent)||void 0===o?void 0:null===(i=o.content)||void 0===i?void 0:i.size)===0?e.selection.to-1:e.selection.to;if(Array.isArray(t))for(let e of t.slice().reverse())l.insert(r,e);else l.insert(r,t);return d||l.setSelection(n.qv.near(l.doc.resolve(r))),l},H=(e,t)=>{let i=e.tr;return i.replaceSelectionWith(t),i},W=e=>!!w(e,e=>"paywall"===e.type)},80870:function(e,t,i){function o(e,t){let i=1,o=1;e.doc.descendants((a,n)=>{if(a.type===t.nodes.footnote){if(a.attrs.number!==i){let o=t.nodes.footnote.create({number:i},a.content);e.replaceWith(n,n+a.nodeSize,o)}i+=1}else if(a.type===t.nodes.footnoteAnchor){if(a.attrs.number!==o){let i=t.nodes.footnoteAnchor.create({number:o});e.replaceWith(n,n+a.nodeSize,i)}o+=1}})}function a(e,t){let i=0;e.doc.nodesBetween(0,e.selection.from,e=>{e.type===t.nodes.footnoteAnchor&&(i+=1)});let o=[];return(e.doc.forEach((e,i)=>{e.type===t.nodes.footnote&&o.push(i)}),i<o.length)?o[i]:e.doc.resolve(0).end()}i.d(t,{A0:()=>o,dG:()=>a})}}]);