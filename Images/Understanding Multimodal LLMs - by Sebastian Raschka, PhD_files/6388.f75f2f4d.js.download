"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["6388"],{89043:function(e,t,n){n.d(t,{Z:()=>o});let o={container:"container-PNh5cP",containerBulwark:"containerBulwark-Y0wz4B",noPodcasts:"noPodcasts-reia2s"}},2881:function(e,t,n){n.d(t,{m:()=>en});var o=n(16584),i=n(30396),r=n(80569),a=n.n(r),l=n(95441),s=n(15771),d=n(19081),c=n(6490),u=n(58175);let m=e=>{let{isOpen:t,onContinue:n}=e,{iString:r}=(0,l.M1)(),[a,m]=(0,i.eJ)(!1);return(0,o.BX)(c.u_,{isOpen:t,children:[(0,o.tZ)(c.xB,{title:r("Switch to Bitcoin"),showClose:!1}),(0,o.tZ)(c.fe,{children:(0,o.BX)(d.tu,{gap:24,children:[(0,o.BX)(d.tu,{gap:16,children:[(0,o.tZ)(u.xv.B4,{translated:!0,children:"Switching to Bitcoin will end your auto-renewing credit card payments."}),(0,o.BX)(u.xv.B4,{translated:!0,children:["Please note that Substack cannot process refunds or auto-renewals for Bitcoin payments. You will now be sent to"," ",(0,o.tZ)("a",{href:"https://opennode.com",target:"_blank",rel:"noopener",children:"OpenNode"})," ","to complete your checkout."]})]}),(0,o.tZ)(s.zx,{onClick:()=>{m(!0),n()},disabled:a,children:r("Continue")})]})})]})};var p=n(57407),_=n(61108),h=n(94184),g=n.n(h),v=n(51776);let y="themed-qm5g5y",b=e=>{let{placeholder:t,maxLength:n,value:i,symbol:r,themed:a=!1,onChange:l}=e;return(0,o.BX)(d.gq,{alignItems:"center",justifyContent:"start",className:g()("inputContainer-JJXl4U",{[y]:a}),children:[(0,o.tZ)(u.xv.B3,{as:"span",color:a?"pub-secondary-text":"secondary",weight:"semibold",className:"currencyInput-n4aG03",children:r}),(0,o.tZ)(v.oi,{name:"Confirm Founding Price","aria-label":"Confirm founding price",value:i,placeholder:t,maxLength:n,onChange:e=>l(e.currentTarget.value),onInput:e=>l(e.currentTarget.value),className:g()("inputField-ZlLLCs",{[y]:a})})]})};var f=n(68833),Z=n(84864);let w=e=>{let{currency:t,isValid:n,newUpgradeModal:r,planName:a,price:s,setValidationState:c}=e,[m,h]=(0,i.eJ)(""),g=parseInt(s);(0,i.d4)(()=>((0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_REQUIRED,{price:s,source:"upgrade modal"}),()=>{n||(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_DISMISSED,{price:s,source:"upgrade modal"})}),[]);let{iString:v}=(0,l.M1)(),y=(0,Z.isZeroDecimalCurrency)(t)?1:100;return(0,o.BX)(d.tu,{font:r?"text":void 0,gap:8,paddingTop:8*!r,borderTop:r?void 0:"detail",alignItems:"start",justifyContent:"start",children:[(0,o.BX)(u.xv,{translated:!0,as:"p",size:r?14:17,color:"secondary",children:["Please confirm you want to pay"," ",(0,o.tZ)(u.xv,{as:"span",color:"primary",weight:"semibold",children:I18N.p(g?(0,Z.centsToPriceString)(g*y,t):s)})," ","per year for a ",I18N.p(null!=a?a:v("Founding Member"))," subscription by typing the price below."]}),(0,o.BX)(d.gq,{alignItems:"center",justifyContent:"start",gap:8,style:{width:"100%"},children:[(0,o.tZ)(b,{placeholder:s,symbol:(0,Z.currencySymbol)(t),maxLength:s.length,value:m,themed:!1,onChange:e=>{e===s?(c(!0),h(e)):e!==m&&(c(!1),h(e))}}),n?(0,o.tZ)(p.Z,{size:24,style:{color:"var(--color-accent-fg-green)"}}):(0,o.tZ)(_.Z,{size:24,style:{color:"var(--color-accent-fg-red)"}})]})]})};var C=n(89734),x=n.n(C),P=n(58865),I=n(7409),S=n(99282),k=n(64515);let B=e=>(0,o.tZ)(k.l,(0,S._)((0,I._)({},e),{name:"WarningIcon",svgParams:{viewBox:"-2 -2 18 18"},children:(0,o.tZ)("path",{d:"M8 0C3.582 0 0 3.582 0 8s3.582 8 8 8 8-3.582 8-8S12.418 0 8 0zM9 12H7v-2h2V12zM9 8H7V4h2V8z"})}));var N=n(87077),E=n(31582);let R={outlineWrapper:"outlineWrapper-MqmfKS",outlineWrapperWithWarning:"outlineWrapperWithWarning-x5ALXu",warningContainer:"warningContainer-lQlVcA",outlineWrapperSelected:"outlineWrapperSelected-KXkgz5",amountInput:"amountInput-pcn7kh",amountInputDeselected:"amountInputDeselected-W75Nrd"};function F(){let e=(0,P._)([" per ",""]);return F=function(){return e},e}function A(){let e=(0,P._)(["Amount must be greater than ",""]);return A=function(){return e},e}let M=e=>{var t;let{amount:n,currency:r,isSelected:a,outlineOnSelect:s,plan:d,usePer:c,showDuration:u=!0,disableInput:m=!1,className:p,disableWarning:_,onChangeAmount:h,truncateInterval:v=!1}=e,y=(0,i.sO)(null),[b,f]=(0,i.eJ)(!1),w=(0,i.I4)(e=>{h(e.toString().replace(/[^\d.]/g,""))},[h]);r||(r=d.currency),(0,i.d4)(()=>{let e=(0,E.vq)(d,r);f(!!(!_&&e&&null!==n&&r&&parseFloat(Number((0,Z.isZeroDecimalCurrency)(r)?n:100*Number(n)).toFixed(2))<e&&a))},[n,r,_,a,d]),(0,i.bt)(()=>{setTimeout(()=>{y.current&&(y.current.style.width="1px",y.current.style.width="".concat(y.current.scrollWidth,"px"),y.current.scrollLeft=0)},0)},[n,y]),(0,i.d4)(()=>{a&&(y.current.focus(),y.current.select())},[y,a]);let{iTemplate:C,iString:x}=(0,l.M1)(),P=v&&"year"===d.interval?"yr":v&&"month"===d.interval?"mo":d.interval;return(0,o.BX)("span",{className:g()(R.outlineWrapper,p,{[R.outlineWrapperSelected]:s&&a,[R.outlineWrapperWithWarning]:b}),children:[(0,Z.centsToPriceString)(100,r).replace("1",""),(0,o.tZ)("input",{disabled:m,ref:y,className:g()(R.amountInput,{[R.amountInputDeselected]:!a}),id:"money-variable-amount",type:"text","aria-label":"founding member amount",autoComplete:"off",value:"string"==typeof n?n:d.amount/100,onKeyDown:e=>{"ArrowUp"===e.key?(w(Number(n||d.amount/100)+5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0)):"ArrowDown"===e.key&&(!n||Number(n)>=5)&&(w(Number(n||d.amount/100)-5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0))},onInput:e=>{w(e.target.value)}}),(0,o.tZ)("input",{name:"amount",type:"hidden",value:"string"==typeof n?100*(Number(n)||0):d.amount}),u&&"forever"!==d.interval&&(c?C(F(),x(P)):"/".concat(x(P))),b&&(0,o.tZ)("div",{className:R.warningContainer,children:(0,o.tZ)(N.u,{text:C(A(),(0,Z.centsToPriceString)(null!==(t=(0,E.vq)(d,r))&&void 0!==t?t:0,r)),children:(0,o.tZ)(B,{stroke:"white",height:20,fill:"red",strokeWidth:1})})})]})};var L=n(43570);let D=e=>{let{currency:t,foundingAmount:n,foundingName:i,isSelected:r,isCurrent:a,plan:s,onChangeAmount:c}=e,{iString:m}=(0,l.M1)();return(0,o.BX)(d.X2,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,o.BX)(d.sg,{children:[(0,o.tZ)(u.xv,{children:i}),(0,o.tZ)(M,{amount:n?n.toString():"",currency:t,isSelected:r,plan:s,usePer:!0,onChangeAmount:e=>{c(Number(e))}})]})}),a&&(0,o.tZ)(L.Vp,{priority:"secondary",children:m("Current")})]})};var X=n(10656);let T=e=>{let{currency:t,plan:n,isCurrent:i,isSelected:r,language:a}=e,{iString:s}=(0,l.M1)();return(0,o.BX)(d.X2,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,X.tS)(n,{currency:t,noTrial:!0,recurring:!0,language:a})}),i&&(0,o.tZ)(L.Vp,{priority:"secondary",children:s("Current")})]})};var z=n(17352),O=n(57640),U=n(51699);let q={selected:"selected-Rkwzkv"},W=e=>{let{currency:t,foundingAmount:n,foundingName:i,isCurrent:r,language:a,plan:l,isSelected:s,onChangePlan:d,onChangeFoundingAmount:c}=e;return(0,o.BX)(z.Z,{as:"label",direction:"row",alignItems:"center",gap:12,padding:16,radius:"sm",cursor:"pointer",pressable:"lg",outline:s?"accent":"detail",className:s&&q.selected,children:[(0,o.tZ)(O.Y,{checked:s,name:"plan",value:l.id,onClick:e=>{d({planId:e.target.value})}}),(0,U.F)({plan:l})?(0,o.tZ)(D,{currency:t,foundingAmount:n,foundingName:i,isCurrent:r,isSelected:s,plan:l,onChangeAmount:c}):(0,o.tZ)(T,{currency:t,plan:l,isCurrent:r,isSelected:s,language:a})]})},j=e=>{let{currency:t,foundingAmount:n,foundingName:i,getIsCurrentPlan:r,language:a,plans:l,selectedPlanId:s,onChangeFoundingAmount:c,onChangePlan:u}=e,m=x()(l,"amount").filter(e=>{var t;return!(null===(t=e.metadata)||void 0===t?void 0:t.bitcoin)}),p=null!=s?s:"";return(0,o.tZ)(d.sg,{gap:12,flex:{desktop:"grow",mobile:"auto"},children:m.map(e=>(0,o.tZ)(W,{currency:t,foundingAmount:n,foundingName:i,isCurrent:r(e),isSelected:e.id===p,language:a,plan:e,onChangePlan:u,onChangeFoundingAmount:c}))})};var V=n(61254),H=n(24791);let K=e=>{let{currency:t,foundingAmount:n,foundingAmountLessThanMinimum:i,foundingName:r,hasChanges:a,sub:s,isNewPlanClassicFounding:c,newPlan:m}=e,{iString:p,language:_}=(0,l.M1)(),h=(0,Z.isZeroDecimalCurrency)(t)?1:100,g=a&&m&&(!c||!i),v=g?c?"".concat((0,Z.centsToPriceString)((null!=n?n:0)*h,t)," ").concat(p("per year")):(0,X.tS)(m,{language:_,currency:t}):p("n/a");return(0,o.BX)(z.Z,{shadow:"none",gap:20,padding:16,children:[(0,o.tZ)(u.xv.B3,{weight:"semibold",children:p("Summary")}),(0,o.BX)("div",{className:"grid-NonZWA",children:[s.plan&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(u.xv.B4,{children:p("Current plan")}),(0,o.BX)(d.sg,{"data-testid":"upgrade-summary-current-plan",gap:4,children:[(0,o.tZ)(u.xv.B4,{align:"right",children:(0,H.sM)({sub:s})?r:G({plan:s.plan,language:_,currency:t})}),(0,H.sM)({sub:s})&&(0,o.tZ)(u.xv.B4,{color:"secondary",align:"right",children:(0,X.tS)(s.plan,{language:_,currency:t})})]})]}),(0,o.tZ)(u.xv.B4,{children:p("New plan")}),(0,o.tZ)(d.sg,{"data-testid":"upgrade-summary-new-plan",gap:4,children:(0,o.tZ)(u.xv.B4,{align:"right",weight:"regular",color:g?"primary":"secondary",children:v})}),(0,o.tZ)(V.iz,{className:"table-divider-O5XQ7c"}),(0,o.tZ)(u.xv.B4,{weight:"semibold",children:p("Total")}),(0,o.tZ)(u.xv.B4,{"data-testid":"upgrade-summary-total",align:"right",color:g?"primary":"secondary",weight:g?"semibold":"regular",children:v})]})]})},G=e=>{var t,n,o;let{plan:i,language:r,currency:a}=e;return(null===(t=i.metadata)||void 0===t?void 0:t.founding)==="yes"?null!==(o=null===(n=i.metadata)||void 0===n?void 0:n.short_description)&&void 0!==o?o:"Founding membership":(0,X.tS)(i,{language:r,currency:a})};var J=n(40647),Y=n(98914),Q=n(26111);let $=e=>{var t,n;let{pub:o,sub:i}=e,r=(0,H.MO)(o);if(!r)return 0;let a=(0,E.$e)(r,i.currency),l=i.is_founding&&i.plan&&(0,H.sM)({sub:i})&&r.interval===i.plan.interval?(0,E.$e)(i.plan,i.currency):null,s=(0,Z.isZeroDecimalCurrency)(null!==(t=i.currency)&&void 0!==t?t:"usd")?1:100;return(null!==(n=null!=l?l:a)&&void 0!==n?n:0)/s},ee=e=>{let{pub:t,sub:n}=e,o=null==n?void 0:n.plan;if(!o)return null;if((0,H.sM)({sub:n})){let e=(0,H.MO)(t);if(e&&e.interval===o.interval)return e}return o},et=e=>{var t,n;let{plan:o,sub:i}=e;return!!o&&!!i.plan&&(!!(o.id===i.plan.id||(0,H.sM)({sub:i})&&(0,U.F)({plan:o})&&o.interval===i.plan.interval)||o.amount===i.plan.amount&&o.interval===i.plan.interval&&o.currency===i.plan.currency&&(null===(t=o.metadata)||void 0===t?void 0:t.bitcoin)===(null===(n=i.plan.metadata)||void 0===n?void 0:n.bitcoin))},en=e=>{var t,n,r,p;let{isOpen:_,preselectedPlan:h,pub:g,sub:v,onClose:y}=e,{iString:b,language:C}=(0,l.M1)(),{getConfigFor:x}=(0,J.xR)(),[P,I]=(0,i.eJ)(!1),[S,k]=(0,i.eJ)(ee({pub:g,sub:v})),[B,N]=(0,i.eJ)($({pub:g,sub:v})),[E,R]=(0,i.eJ)(!1),[F,A]=(0,i.eJ)(!1),[M,L]=(0,i.eJ)(null),D=(0,i.Ye)(()=>(g.plans||[]).filter(e=>{if(g.disable_annual_subscriptions){var t;return"year"!==e.interval||(null===(t=e.metadata)||void 0===t?void 0:t.founding)}return!g.disable_monthly_subscriptions||"month"!==e.interval}),[g.plans]),X=D.some(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.bitcoin}),T=null!==(n=(0,H.H$)(g))&&void 0!==n?n:"",z=null!==(r=v.currency)&&void 0!==r?r:"usd",O=(0,Z.isZeroDecimalCurrency)(z),q=O?1:100,W=S&&!et({plan:S,sub:v}),V=B!==$({pub:g,sub:v}),G=W||V,en=parseFloat((B*q).toFixed(2))<(null!==(p=(0,H.rm)({pub:g,currency:z}))&&void 0!==p?p:0),eo=S&&(0,U.F)({plan:S}),ei=eo&&V&&(null!=B?B:0)>=(O?1e6:1e4),er=!!(P||!G||ei&&!E||eo&&en||M),ea=!!(null==S?void 0:null===(t=S.metadata)||void 0===t?void 0:t.founding)&&x("founding_plan_upgrade_warning");(0,i.d4)(()=>{if(_&&h){if("yearly"===h){let e=D.find(e=>"year"===e.interval&&1===e.interval_count);e&&k(e)}else if("founding"===h){let e=(0,H.MO)(g);e&&k(e)}}},[_,D,h,g]);let el=(0,i.I4)(()=>{k(ee({pub:g,sub:v})),N($({pub:g,sub:v}))},[g,v]),es=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&el(),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_DISMISSED,{plan:S}),y()},ed=async function(){let{quantity:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!S)return;I(!0);let t=B&&eo?B*q:void 0;if(ei&&!E){I(!1);return}try{var n;let o=await a().post("/api/v1/subscription/change_plan").send({planId:S.id,foundingAmount:t,quantity:e,token:(0,Q.x)(window._preloads.original_url,"token")});(null===(n=o.body)||void 0===n?void 0:n.opennodePaymentUrl)?setTimeout(()=>{window.location.href=o.body.opennodePaymentUrl},30):(I(!1),alert(b("Success! You've changed your plan")),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_SUBMITTED,{plan:S,amount:null!=t?t:null}),(0,Q.x)("redirect")?(0,Y.uX)((0,Q.x)("redirect"),{local_navigation:!1}):((0,Y.iO)("change_plan"),window.location.reload()))}catch(e){I(!1),L((0,Y.zx)(e))}},ec=e=>{R(e),e&&(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_SUBMITTED,{price:B,source:"upgrade modal"})};return D.length?(0,o.BX)("div",{children:[X&&(0,o.tZ)(m,{isOpen:F,onContinue:()=>ed()}),(0,o.BX)(c.u_,{isOpen:_,testId:"upgrade-plan-modal",width:700,onClose:P?()=>{}:y,fullscreenMobile:!0,children:[(0,o.tZ)(c.xB,{title:b("Change plan"),onClose:y,showDivider:!0,showClose:!0}),(0,o.BX)(c.fe,{children:[(0,o.BX)(d.hs,{direction:{desktop:"row",mobile:"column"},gap:20,children:[(0,o.tZ)(j,{currency:z,foundingAmount:B,foundingName:T,getIsCurrentPlan:e=>et({plan:e,sub:v}),language:C,plans:D,selectedPlanId:null==S?void 0:S.id,onChangeFoundingAmount:e=>{N(e),L(null),R(!1)},onChangePlan:e=>{let{planId:t}=e,{plans:n}=g,o=null==n?void 0:n.find(e=>e.id===t);o&&((0,f.j)(f.FP.UPGRADE_PLAN_MODAL_PLAN_CHANGED,{oldPlan:S,newPlan:o}),k(o),L(null))}}),(0,o.BX)(d.sg,{gap:40,flex:"grow",children:[(0,o.tZ)(K,{currency:z,foundingAmount:B,foundingAmountLessThanMinimum:en,foundingName:T,hasChanges:G,isNewPlanClassicFounding:!!eo,newPlan:S,sub:v}),ei&&(0,o.tZ)(w,{price:B?B.toString():"",isValid:E,planName:T,currency:z,setValidationState:e=>ec(e),newUpgradeModal:!0}),M&&(0,o.tZ)(u.xv,{color:"error",size:14,font:"text",children:M})]})]}),ea&&(0,o.tZ)(d.hs,{padding:12,children:(0,o.tZ)(u.xv.B3,{fontStyle:"italic",translated:!0,children:"Changing plan will charge you a prorated amount based on your current subscription"})})]}),(0,o.tZ)(c.mz,{showDivider:!0,primaryButton:(0,o.tZ)(s.zx,{priority:"primary",onClick:()=>{var e;(null==S?void 0:null===(e=S.metadata)||void 0===e?void 0:e.bitcoin)?(es(!1),A(!0)):ed()},loading:P,disabled:er,children:P?b("Loading..."):b("Change plan")}),secondaryButton:(0,o.tZ)(s.zx,{priority:"secondary",onClick:()=>es(),loading:P,children:b("Cancel")})})]})]}):null}},95031:function(e,t,n){n.d(t,{_:()=>a});var o=n(16584),i=n(75744),r=n(58175);let a=e=>{let{hideTerms:t,pub:n,showIntrinioAttrib:a}=e,l=n.has_custom_tos||n.has_custom_privacy,s=(0,o.BX)("div",{className:"footer-copyright-blurb",children:["\xa9 ",new Date().getFullYear()," ",n&&n.copyright||"Substack Inc"]}),d=(0,o.BX)(o.HY,{children:[a&&(0,o.BX)(r.xv,{translated:!0,as:"div",className:"footer-copyright-blurb",children:["Market data by ",(0,o.tZ)("a",{href:"https://intrinio.com/",children:"Intrinio"})]}),!t&&(0,o.tZ)("div",{className:"footer-terms-blurb",children:(0,o.tZ)(i.nO,{publication:n})})]});return l?(0,o.BX)(o.HY,{children:[(0,o.BX)("div",{className:"footer-blurbs",children:[s,!t&&(0,o.tZ)("div",{className:"footer-terms-blurb",children:(0,o.tZ)(i.Ug,{pub:n})})]}),(0,o.BX)("div",{className:"footer-blurbs",children:[(0,o.tZ)("div",{className:"footer-copyright-blurb",children:"Substack"}),d]})]}):(0,o.BX)("div",{className:"footer-blurbs",children:[s,d]})}},75716:function(e,t,n){n.d(t,{Z:()=>es});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),l=n(94184),s=n.n(l),d=n(14293),c=n.n(d),u=n(87764),m=n(80569),p=n.n(m),_=n(25256),h=n(71787),g=n(56953),v=n(48757),y=n(59154),b=n(79138),f=n(37632),Z=n(4473),w=n(39535),C=n(75697),x=n(95441),P=n(68833),I=n(15771),S=n(99916),k=n(78088),B=n(63651),N=n(47929);function E(e){let{pub:t,user:n}=e,{iString:o}=(0,x.M1)(),[i,l]=(0,a.eJ)(!1),s=(0,B.SVA)(t),d={utm_source:N.b3.navbar,utm_medium:N.lP.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},c=(0,B.n1t)(s,d),u=async()=>{(0,P.j)(P.FP.PUBLICATION_SHARE_BUTTON_CLICKED)};return(0,r.BX)(r.HY,{children:[(0,r.BX)(S.v2,{trigger:(0,r.tZ)(I.hU,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,r.tZ)(_.Z,{size:20})}),onOpen:u,children:[(0,r.BX)(S.xw,{isFirst:!0,children:[(0,r.tZ)(S.sN,{leading:(0,r.tZ)(h.Z,{}),onClick:()=>{(0,C.Ui)({shareUrl:c,pub:t,utm_campaign:N.VX.navbar})},children:o("Copy link")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(g.Z,{}),onClick:()=>{(0,C.WZ)({shareUrl:c,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:N.VX.navbar})},children:o("Send as email")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(v.Z,{}),onClick:()=>{(0,P.j)(P.FP.SHARE_PUBLICATION_MODAL_OPENED),l(!0)},children:o("Get shareable images")})]}),(0,r.BX)(S.xw,{children:[(0,r.tZ)(S.sN,{leading:(0,r.tZ)(Z.Z,{}),onClick:()=>{(0,C.BZ)({shareUrl:c,pub:t,utm_campaign:N.VX.navbar})},children:o("Share to Notes")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(b.Z,{}),onClick:()=>{(0,C.Po)({shareUrl:c,pub:t,utm_campaign:N.VX.navbar})},children:o("Share to Facebook")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(f.Z,{}),onClick:()=>{(0,C.lc)({shareUrl:c,pub:t,utm_campaign:N.VX.navbar})},children:o("Share to Linkedin")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(y.Z,{}),onClick:()=>{(0,C.bI)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:N.VX.navbar})},children:o("Share to Bluesky")}),(0,r.tZ)(S.sN,{leading:(0,r.tZ)(w.Z,{}),onClick:()=>{(0,C.Wn)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:N.VX.navbar})},children:o("Share to X")})]})]}),(0,r.tZ)(k.iL,{pub:t,isOpen:i,setOpen:l,item:{type:"pub_shareable_image"},width:718})]})}var R=n(63718),F=n(57391),A=n(36848),M=n(39648),L=n(56629),D=n(40647),X=n(65205),T=n(34552),z=n(98914),O=n(98422),U=n(80026),q=n(19081),W=n(10510),j=n(78096),V=n(70379),H=n(87077),K=n(91684),G=n(74583),J=n(31406),Y=n(98012),Q=n(24791),$=n(6070),ee=n(67914),et=n(60308),en=n(26111),eo=n(84864);let ei=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,O.v9)(),{iString:i}=(0,x.M1)();return(0,r.tZ)(j.gd,{priority:"secondary",size:o?"sm":"md",menuItems:n.map(e=>{let{logo_url:n,name:o,subdomain:i}=e;return(0,r.tZ)(S.sN,{href:(0,et.c0Q)(i,{params:{utm_source:N.b3.substack,utm_content:N.fZ.dashboardPubSwitcher}}),leading:(0,r.tZ)(W.wk,{size:24,radius:"xs",logoUrl:n}),priority:t.subdomain===i?"selected":"primary",children:o})}),href:(0,B.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:i("Dashboard")})};function er(){let{iString:e}=(0,x.M1)(),t=(0,M.O4)();return(0,r.tZ)(H.u,{text:e("Search"),placement:"bottom",delayEnter:H.$$,children:(0,r.tZ)(U.hU,{priority:"tertiary",onClick:()=>t.open(),children:(0,r.tZ)(u.Z,{size:20})})})}let ea=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,x.M1)(),{isMobile:i}=(0,O.v9)();return t.length>1?(0,r.tZ)(ei,{pub:n,dashboardPubs:t}):(0,r.tZ)(U.zx,{size:i?"sm":"md",priority:"secondary",href:(0,B.QK7)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})};function el(e){var t,n,i,a,l,s,d,u,m,_,h;let{user:g,pub:v,freeSignup:y,freeSignupEmail:b,hide_subscribe_cta:f,isMeetingsActive:Z,hasViralGiftsCount:w,siteConfigContext:C,getSettingFor:x,experimentApi:{exposeExperiment:I,getExperimentVariant:S},renewing:k,renewed:E,setToRenew:R,language:F,isMobile:A}=e,{iString:M,iPlural:L}=I18N.i(F);v.invite_only&&!((null==g?void 0:g.subscription_id)||(null==g?void 0:g.is_free_subscribed))&&(f=!0);let D=(0,J.gs)(),T=null==g?void 0:g.is_contributor,O=(null==g?void 0:g.is_subscribed)||T,q=(null==g?void 0:g.is_free_subscribed)||y,W=Q.oH(v)&&O&&["gift","comp"].includes(null!==(a=g.subscription_type)&&void 0!==a?a:"")&&!(0,ee.B9)({pub:v,subscriptionType:null==g?void 0:g.subscription_type})&&(0,Y.Z)(g.subscription_expiry).subtract(30,"days").isBeforeNow(),j=Q.oH(v)&&g&&Q.po(g)&&g.comp_expired_recently,V=(null==g?void 0:g.is_free_subscribed)&&(null==g?void 0:g.is_paused),H=(null==g?void 0:g.subscription_type)==="ios_app";if(T){let e=(null==g?void 0:g.dashboard_pubs)||[];return(0,r.tZ)(ea,{dashboardPubs:e,pub:v})}if(V)return(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,z.uX)((0,et.BhD)(v,{addBase:!0}),{local_navigation:!1})},children:M("Unpause my subscription")});if(W||j){if(!f)return(0,r.BX)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{var e;(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,z.uX)((0,et.W1P)(v,{utm_source:N.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,en.x)("referring_pub_ids"),addBase:!0,selectedPlanId:W&&(null==g?void 0:g.is_founding)&&v.plans?null===(e=v.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:M("Subscribe")}),(0,r.tZ)("span",{className:"desktop-only",children:M("Continue your support")})]})}else if(Q.oH(v)&&q&&!O&&!["thebulwark"].includes(v.subdomain)){if(!f)return(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,z.uX)((0,et.W1P)(v,{utm_source:N.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,en.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,eo.getSubscribeText)(v,{isFreeSubscribed:!0,isMobile:(0,z.K1)(),language:F})})}else if(Q.oH(v)?O:q||O){if(v.invite_only&&O&&!c()(g.invites)&&g.invites<v.subscriber_invites)return(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,z.uX)((0,et.UzE)(v),{local_navigation:!1})},children:(0,r.tZ)("span",{children:L("1 invite left","%1 invites left",v.subscriber_invites-g.invites)})});if(Q.oH(v)&&Z&&C&&!C.getConfigFor("hide_book_a_meeting_button"))return(0,r.BX)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,z.uX)((0,B.szv)(v,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:M("Book meeting")}),(0,r.tZ)("span",{className:"desktop-only",children:M("Book a meeting")})]});else if(Q.oH(v)&&g&&g.is_subscribed&&!H&&g.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(l=g.subscription_type)&&void 0!==l?l:""))return(0,r.BX)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),R()},disabled:k||E,style:{visibility:E?"hidden":"visible"},children:[(0,r.tZ)("span",{className:"mobile-only",children:M("Renew")}),(0,r.tZ)("span",{className:"desktop-only",children:M("Renew subscription")})]})}else if(!f){let e=null===(u=(0,en.x)("referring_pub_ids"))||void 0===u?void 0:null===(d=u.split)||void 0===d?void 0:null===(s=d.call(u,","))||void 0===s?void 0:s[0],t=null===(h=(0,en.x)("referring_pub_ids"))||void 0===h?void 0:null===(_=h.split)||void 0===_?void 0:null===(m=_.call(h,","))||void 0===m?void 0:m.slice(1);return(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:async()=>{let n=g&&!g.is_magic&&g.email||b;if((0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:v.homepage_type}),n){let i;try{i=(await p().post("/api/v1/free").send((0,o._)({source:"menu",email:n,first_url:X.xY,first_referrer:X.ip,current_url:X.UE,current_referrer:X.xU,first_session_url:X.ac,first_session_referrer:X.qR,referring_pub_id:e,additional_referring_pub_ids:t},D))).body.referral_token,(0,P.IU)()}catch(e){(0,P.j)(P.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,et.W1P)(v,{utm_source:N.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:i})}else window.location.href=(0,et.W1P)(v,{utm_source:N.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,en.x)("referring_pub_ids"),addBase:!0})},children:(0,eo.getSubscribeText)(v,{isFreeSubscribed:q,isMobile:(0,z.K1)(),language:F})})}if(Q.oH(v)&&g&&g.is_subscribed&&w){let e=(0,B.xdn)({pub:v,params:{utm_source:N.b3.menu}}),t=S("viral_gift_nav_bar_cta");if(I("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let n="treatment_send"===t?M(w>1?"Send free gifts":"Send free gift"):L("1 gift left","%1 gifts left",w);return(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,z.uX)(e,{local_navigation:!1})},children:n})}}if(Q.oH(v)&&g&&!g.is_founding&&!H&&(0,Y.Z)(g.subscription_first_payment_at).isBefore((0,Y.Z)().subtract(48,"hours"))&&((0,$.VL)({pub:v})||"pinespayments"===v.subdomain||(null==v?void 0:null===(i=v.plans)||void 0===i?void 0:null===(n=i.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===n?void 0:null===(t=n.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,B.yRy)({pub:v,user:g,params:{utm_source:N.b3.menu,next:document.location.href}});return(0,r.BX)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,z.uX)(e,{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:M("Upgrade")}),(0,r.tZ)("span",{className:"desktop-only",children:M("Upgrade to founding")})]})}return"disabled"===v.payments_state&&!v.invite_only&&x("payment_pledges_enabled")&&q&&!(null==g?void 0:g.is_pledged)?(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,z.uX)((0,et.W1P)(v,{utm_source:N.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:M("Pledge your support")}):Q.oH(v)&&!v.invite_only?(0,r.BX)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,z.uX)((0,$.HD)({pub:v})&&g&&(null==C?void 0:C.getConfigFor("enable_founding_gifts"))?(0,$.Iv)({user:g}):(0,et.W1P)(v,{utm_source:N.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:M("Give gift")}),(0,r.tZ)("span",{className:"desktop-only",children:M("Gift a subscription")})]}):!v.is_on_substack||(null==g?void 0:g.has_publication)?null:(0,r.tZ)(U.zx,{"data-testid":"noncontributor-cta-button",size:A?"sm":"md",onClick:()=>{(0,P.j)(P.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,z.uX)((0,et._HV)({utm_source:N.b3.menu}),{local_navigation:!1})},children:M("Start publishing")})}let es=e=>{let{className:t,fixedTooltip:n=!0,freeSignup:l,freeSignupEmail:d,hideCta:c,hideNotifications:u,hideChat:m,hideSearch:_,hideShare:h,hideUserIndicator:g,hide_subscribe_cta:v,isMeetingsActive:y,hasViralGiftsCount:b,pub:f,showCustomerSupportModeModal:Z,user:w}=e,{iString:C,language:P}=(0,x.M1)(),{isMobile:I}=(0,O.v9)(),{getSettingFor:S}=(0,L.So)(),k=(0,F.jc)(),[B,N]=(0,a.eJ)(!1),[M,X]=(0,a.eJ)(!1),U=(0,V.pm)(),{enableCustomerServiceMode:W,disableCustomerServiceMode:j,modalElement:H}=(0,T.Vc)({showCustomerSupportModeModal:Z}),J=async()=>{N(!0);try{await p().post("/api/v1/subscription/reactivate").send({}),X(!0),U.popToast(e=>(0,r.tZ)(V.FN,(0,i._)((0,o._)({},e),{text:C("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,z.zx)(e))}finally{N(!1)}};return(0,r.BX)(q.gq,{alignItems:"center",gap:I?4:8,className:s()("navbar-buttons",t),justifyContent:"end",children:[(0,r.tZ)(D.QA.Consumer,{children:e=>(0,r.tZ)(A.RD.Consumer,{children:t=>(0,r.BX)(r.HY,{children:[!I&&!w&&(0,r.BX)(q.gq,{gap:4,children:[!_&&(0,r.tZ)(er,{}),!h&&(0,r.tZ)(E,{pub:f,user:null!=w?w:void 0})]}),!I&&w&&(0,r.BX)(q.gq,{gap:4,children:[!_&&(0,r.tZ)(er,{}),m?!h&&(0,r.tZ)(E,{pub:f,user:w}):(0,r.tZ)(K.b,{}),!u&&(0,r.tZ)(G.f,{canShowAlerts:!f})]}),!c&&(0,r.tZ)(el,{pub:f,user:w,freeSignup:l,freeSignupEmail:d,hide_subscribe_cta:v,viralGiftsConfig:f.viralGiftsConfig,localeContext:t,siteConfigContext:e,isMeetingsActive:y,hasViralGiftsCount:b,getSettingFor:S,experimentApi:k,renewing:B,renewed:M,setToRenew:J,language:P,isMobile:I}),!g&&(0,r.tZ)(R.Co,{pub:f,user:w,enableCustomerServiceMode:W,disableCustomerServiceMode:j,fixedTooltip:n})]})})}),H]})}},34288:function(e,t,n){n.d(t,{$:()=>b});var o=n(16584),i=n(98661);n(30396);var r=n(94184),a=n.n(r),l=n(95031),s=n(55438);n(97742);var d=n(58319),c=n(57391),u=n(95441),m=n(45261),p=n(68833),_=n(58175),h=n(60308);n(6911);var g=n(81821),v=n(47929),y=n(8525);let b=(0,i.memo)(e=>{let{publication:t,user:n,path:i,hideTerms:r,showIntrinioAttrib:b}=e,{iString:f}=(0,u.M1)(),{getExperimentVariant:Z,exposeExperiment:w}=(0,c.jc)();void 0===r&&(r=!1);let C=(0,m.Tf)(),x=(0,g.tq)(),P=(0,g.s)(),I=(0,g.Dt)(),S=n&&!n.reader_installed_at,k=x&&(P||I)&&S,B=f("Start writing");return n||"treatment"!==Z("start_writing_text_in_footer_v2")||(B=f("Start your Substack")),(0,o.BX)("div",{className:"footer-wrap publication-footer",children:[(0,o.tZ)(d.Z,{onVisible:()=>{var e;(0,p.j)(p.FP.PUBLICATION_FOOTER_SEEN,{publication_id:null==t?void 0:t.id,user_id:null==n?void 0:n.id,source:(e=i)?"/"===e?"pub-homepage":e.startsWith("/p")?"pub-post":e:"unknown"}),w("start_writing_text_in_footer_v2")}}),(0,o.tZ)("div",{className:a()("footer",{"themed-background":C}),children:(0,o.BX)("div",{className:"container",children:[(0,o.tZ)(l._,{hideTerms:r,pub:t,showIntrinioAttrib:null!=b&&b}),(0,o.BX)("div",{className:"footer-buttons",children:[(0,o.BX)("a",{className:a()("footer-substack-cta","start-publishing",k&&"app-upsell"),native:!0,href:(null==n?void 0:n.has_publication)?"".concat((0,h.SVA)({subdomain:"your"}),"/publish"):"".concat((0,h.ZJn)(),"/signup?").concat((0,h.Y$Q)({utm_source:v.b3.substack,utm_medium:v.lP.web,utm_content:v.fZ.footer})),children:[(0,o.tZ)(s.Z,{})," ",B]}),!k&&(0,o.tZ)("a",{className:"footer-substack-cta get-the-app no-icon",native:!0,href:(0,h.D4e)({utm_campaign:v.VX.appMarketing,utm_content:v.fZ.webFooterButton}),children:f("Get the app")}),k&&P&&(0,o.tZ)("a",{className:y.Z.appBadge,href:(0,h.D4e)({utm_campaign:v.VX.appMarketing,utm_content:v.fZ.webFooterButton,force:"ios"}),children:(0,o.tZ)("img",{className:"app-upsell",src:(0,h.zF4)("/img/app_page/app-store.png",320)})}),k&&I&&(0,o.tZ)("a",{className:y.Z.appBadge,href:(0,h.D4e)({utm_campaign:v.VX.appMarketing,utm_content:v.fZ.webFooterButton,force:"android"}),children:(0,o.tZ)("img",{className:"app-upsell",src:(0,h.zF4)("/img/app_page/google-play.png",320)})})]}),(0,o.BX)(_.xv,{translated:!0,as:"div",className:"footer-slogan-blurb",children:[(0,o.tZ)("a",{href:"".concat((0,h.ZJn)()),native:!0,children:"Substack"})," ","is the home for great culture"]})]})})]})})},61665:function(e,t,n){n.d(t,{Y:()=>o});let o=(0,n(6400).createContext)(!1)},62110:function(e,t,n){n.d(t,{_:()=>v});var o=n(16584),i=n(30396),r=n(35162),a=n(64729),l=n(95441),s=n(42375),d=n(98170),c=n(85527),u=n(15771),m=n(19081),p=n(6490),_=n(58175),h=n(15503),g=n(5749);function v(e){let{item:t,pub:n,post:a}=e,[s,d]=(0,i.eJ)(!1),{iString:c}=(0,l.M1)();return(0,o.BX)(o.HY,{children:[(0,o.tZ)(u.hU,{priority:"quaternary",size:"sm",className:g.Z.moreButton,onClick:()=>d(!0),children:(0,o.tZ)(r.Z,{size:16})}),(0,o.BX)(p.u_,{isOpen:s,onClose:()=>d(!1),width:440,children:[(0,o.tZ)(p.xB,{icon:(0,o.tZ)(r.Z,{size:20}),title:c("Auto-generated clip"),showClose:!0,onClose:()=>d(!1)}),(0,o.tZ)(p.fe,{children:(0,o.tZ)(m.tu,{gap:16,children:(0,o.tZ)(_.xv.B3,{children:c("Substack automatically selected this clip for you from the full video below.")})})}),(0,o.tZ)(p.mz,{primaryButton:(0,o.tZ)(y,{item:t,pub:n,post:a,onClose:()=>d(!1)}),secondaryButton:(0,o.tZ)(u.zx,{priority:"secondary",onClick:()=>d(!1),children:c("Done")})})]})]})}let y=e=>{let{item:t,pub:n,post:r,onClose:m}=e,{iString:p}=(0,l.M1)(),_=(0,d.vE)({post:r,publication:n}),g=(0,s.rI)(),v=(0,i.qp)(c.q);return(0,o.tZ)(a.i,{children:(0,o.tZ)(u.zx,{priority:"primary",onClick:e=>{(0,h.rw)(t,g,"watch_full_episode",{tabId:v}),_(e),m()},children:p("View Full Episode")})})}},13748:function(e,t,n){n.d(t,{U:()=>en,v:()=>ei});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),l=n(30396),s=n(13718),d=n(71787),c=n(13025),u=n(71499),m=n(76789),p=n(12795),_=n(22448),h=n(95058),g=n(11607),v=n(71408),y=n(9404),b=n(89038),f=n(20816),Z=n(51455),w=n(94442),C=n(79094),x=n(19548),P=n(35543),I=n(95441),S=n(93155),k=n(40647),B=n(60807),N=n(42375),E=n(85527),R=n(48980),F=n(7882),A=n(98914),M=n(15771),L=n(19081),D=n(99916),X=n(15562),T=n(78096),z=n(70379),O=n(46585),U=n(15503),q=n(27744),W=n(2009),j=n(81043),V=n(75419),H=n(98012),K=n(31377),G=n(42886),J=n(33884),Y=n(63651),Q=n(84864),$=n(47929),ee=n(5749);let et=e=>{let{item:t,parentItem:n}=e;if(!t.comment&&!t.post)return null;let o=null;if("post"in t&&("post"===t.type||(null==n?void 0:n.type)==="post_reply"))o=t.post.id;else if((null==n?void 0:n.type)==="note_reply"){var i;let e=null===(i=t.parentComments[0])||void 0===i?void 0:i.id;e&&(o=e)}else o=t.comment.id;return o?{id:o,type:"post"in t&&("post"===t.type||(null==n?void 0:n.type)==="post_reply")?"post":"comment"}:null};function en(e){var t,n,r,b,f,w,j;let{publication:en,post:ei,comment:er,item:ea,parentItem:el,allowHide:es=!1}=e,ed=(0,z.pm)(),{getConfigFor:ec}=(0,k.xR)(),eu=(0,N.rI)(),em=(0,E.F)(),ep=(0,q.I0)(),e_=(0,q.kc)(),{iString:eh}=(0,I.M1)(),[eg,ev]=(0,l.eJ)(!1),[ey,eb]=(0,l.eJ)(!1),ef=(0,B.aF)(),{openModal:eZ,closeModal:ew}=(0,S.dd)(),eC=null!==(w=null==er?void 0:null===(t=er.ancestor_path)||void 0===t?void 0:t.split(".").filter(Boolean).map(Number).map(e=>e_.comments.get(e)))&&void 0!==w?w:[],ex=er?(0,K.getCommentAuthor)(er):en&&ei?(0,K.getPostAuthor)(en,ei):{id:0,name:"void"},eP=ea&&"entity_key"in ea?ea.entity_key:void 0,eI=(0,x.CH)(ex,{surface:eu,noteId:eP,onClick(e){ea&&(0,U.rw)(ea,eu,e,{tabId:em})}}),eS=(0,C.zH)({comment:er,publication:en,post:ei,item:ea}),ek=(0,P.oh)(ex,eu,eP),eB=(0,F.ib)({pathname:"/api/v1/comment/".concat(null!==(j=null==er?void 0:er.id)&&void 0!==j?j:0),method:"DELETE",json:{publication_id:null==en?void 0:en.id}}),eN=async()=>{if(!er||(ev(!1),eB.isLoading))return;let e=await eB.refetch();if(e instanceof Error){alert((0,A.zx)(e));return}ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Note deleted"),Icon:s.Z}))),ep({type:"comment_delete",payload:{publication:null!=en?en:void 0,post:null!=ei?ei:void 0,comment:er}})},eE=(0,V.i3)(),eR=async()=>{er&&eE.open({editComment:er,tabId:em,surface:eu,editingUserId:null==ef?void 0:ef.id})},eF=ea&&(0,G.D2)(ea)&&"post"===ea.type&&ea.mediaClip,eA=async(e,t)=>{await (0,R.rd)("/api/v1/comment/".concat(e.id,"/juice"),{method:"POST",json:{times_to_show:t}}),ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Juiced"),Icon:u.Z}))),eb(!1)},eM=async(e,t)=>{let n;let r=et({item:e,parentItem:el});if(!r)return;switch(t){case"1hour":n=1;break;case"8hours":n=8;break;case"24hours":n=24}let l=n?{expires_at:(0,H.Z)().add(n,"hour").toISOString()}:{},{id:s,type:d}=r;await (0,R.rd)("/api/v1/notification_settings/".concat(d,"/").concat(s,"/mute"),{method:"POST",json:l}),ep({type:"item_pause_notifications",payload:{entityKey:e.entity_key}}),ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Paused"),Icon:m.Z})))},eL=async e=>{let t=et({item:e,parentItem:el});if(!t)return;let{id:n,type:r}=t;await (0,R.rd)("/api/v1/notification_settings/".concat(r,"/").concat(n,"/mute"),{method:"DELETE"}),ep({type:"item_unpause_notifications",payload:{entityKey:e.entity_key}}),ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Unpaused"),Icon:m.Z})))},eD=async()=>{try{if(!er){ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Error starting workflow: comment not found")})));return}let{workflowId:e}=await (0,R.rd)("/api/v1/comment/".concat(er.id,"/workflow"),{method:"POST",json:{}});ed.popToast(t=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},t),{text:"Workflow started with id ".concat(e)})))}catch(e){ed.popToast(t=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},t),{text:"Error starting workflow: ".concat(e)})))}},eX=es&&ea&&"entity_key"in ea&&ef&&ef.id!==ex.id,eT=ef&&ef.id===ex.id,ez=ef&&!!(null==ea?void 0:null===(n=ea.post)||void 0===n?void 0:n.publishedBylines.find(e=>e.id===ef.id)),eO=ef&&(null==el?void 0:el.type)==="note_reply"&&(null==ea?void 0:null===(r=ea.parentComments[0])||void 0===r?void 0:r.user_id)===ef.id,eU=(eT||ez||eO)&&(null==ea?void 0:ea.type)&&["comment","post"].includes(ea.type),eq=[(0,a.tZ)(D.sN,{leading:(0,a.tZ)(d.Z,{}),onClick:()=>{let e={r:(0,Q.userReferralKey)(ef),utm_source:$.b3.notesShareAction,utm_medium:$.lP.web},t=er?(0,Y.Sgq)(er,{urlParams:e}):ei?(0,Y.mx9)(en,ei,{mediaClip:eF||void 0,urlParams:e}):null;(0,A.vQ)(t),ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Copied link to clipboard"),Icon:d.Z})))},children:eh("Copy link")}),!er&&ei&&(0,a.tZ)(eo,{post:ei}),...ek,(0,a.tZ)(D.sN,{leading:(0,a.tZ)(p.Z,{}),onClick:()=>{eZ({children:(0,a.tZ)(Z.I,{comment:er||void 0,onClose:ew}),width:540})},children:eh("Embed")}),er?(0,a.tZ)(D.sN,{leading:(0,a.tZ)(c.Z,{}),onClick:()=>{ed.popToast(e=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},e),{text:eh("Downloading image..."),Icon:c.Z})))},href:(0,J.IY)(er.id),target:"_blank",download:!0,children:eh("Save as image")}):null].filter(Boolean),eW=[(0,Q.canEditComment)(ef,er)&&(0,a.tZ)(D.sN,{leading:(0,a.tZ)(_.Z,{}),onClick:eR,children:eh("Edit")}),er&&((null==ef?void 0:ef.is_global_admin)||(null==ef?void 0:ef.id)===er.user_id||ec("show_note_stats_for_all_notes")||(0,Q.canManageCommentAsPrimaryUser)(ef,er))?(0,a.tZ)(D.sN,{leading:(0,a.tZ)(h.Z,{}),href:(0,J.wn)(er,{noBase:W.L}),native:!0,children:eh("View stats")}):null].filter(Boolean),ej=(null==ea?void 0:ea.type)&&["comment","post"].includes(ea.type)&&e_.mutedFeedItems.has(ea.entity_key),eV=[eX&&(0,a.tZ)(D.sN,{leading:(0,a.tZ)(g.Z,{}),onClick:async()=>{try{ep({type:"item_hide",payload:{entityKey:ea.entity_key}}),await (0,R.rd)("/api/v1/note/".concat(ea.entity_key,"/hide"),{method:"POST",json:{tabId:em,surface:eu}})}catch(e){ed.popToast(t=>(0,a.tZ)(z.FN,(0,i._)((0,o._)({},t),{text:(0,A.zx)(e)})))}},children:(ef.is_admin||ef.is_contributor)&&"post-page-restacks-list"===eu?eh("Hide note from post"):eh("Hide note")}),eU&&(ej?(0,a.tZ)(O.WS,{onClick:()=>eL(ea),customLabel:eh("Unpause notifications")}):(0,a.tZ)(O.KV,{onMute:e=>eM(ea,e),customLabel:eh("Pause notifications")})),(null==ef?void 0:ef.is_global_admin)&&er&&(null===(f=er.attachments)||void 0===f?void 0:null===(b=f[0])||void 0===b?void 0:b.type)==="video"?(0,a.tZ)(D.sN,{leading:(0,a.tZ)(v.Z,{}),priority:"secondary",onClick:eD,children:eh("Run workflow")}):null].filter(Boolean),eH=[...eI,eS,(0,Q.canDeleteComment)(ef,er,{pub:null!=en?en:void 0,post:null!=ei?ei:void 0,parentComments:eC})&&(0,a.tZ)(D.sN,{leading:(0,a.tZ)(s.Z,{}),priority:"destructive",onClick:()=>ev(!0),children:eh("Delete")}),(null==ef?void 0:ef.is_global_admin)&&er?(0,a.tZ)(D.sN,{leading:(0,a.tZ)(u.Z,{}),priority:"destructive",onClick:async()=>{eb(!0)},children:eh("Juice")}):null].filter(Boolean),eK=[0!==eq.length&&eq,0!==eW.length&&(0,a.tZ)(D.xw,{children:eW}),0!==eV.length&&(0,a.tZ)(D.xw,{children:eV}),0!==eH.length&&(0,a.tZ)(D.xw,{children:eH})];return 0===eK.length?null:(0,a.BX)(a.HY,{children:[(0,a.tZ)(L.M5,{className:ee.Z.moreButtonContainer,children:(0,a.tZ)(D.v2,{trigger:(0,a.tZ)(M.hU,{priority:"quaternary",size:"sm",className:ee.Z.moreButton,"aria-label":eh("More options"),children:(0,a.tZ)(y.Z,{size:16})}),onOpen:()=>{ea&&(0,U.rw)(ea,eu,"menu",{tabId:em})},children:eK})}),(0,a.tZ)(X.W,{isOpen:eg,title:eh("Delete note"),description:eh("Are you sure you want to permanently delete this note? This action cannot be undone."),primaryButton:(0,a.tZ)(M.zx,{priority:"destructive",onClick:eN,children:eh("Delete")}),secondaryButton:(0,a.tZ)(M.zx,{priority:"secondary",onClick:()=>ev(!1),children:eh("Cancel")}),onClose:()=>ev(!1)}),(null==ef?void 0:ef.is_global_admin)&&(0,a.tZ)(X.W,{isOpen:ey,title:eh("Juice note"),description:eh("How many additional impressions would you like this note to receive? 100 impressions equals roughly 1-3 likes."),primaryButton:(0,a.BX)(T.dm,{priority:"secondary-outline",size:"md",children:[(0,a.tZ)(T.yo,{onClick:async()=>{await eA(er,100)},children:"100"}),(0,a.tZ)(T.yo,{onClick:async()=>{await eA(er,500)},children:"500"}),(0,a.tZ)(T.yo,{onClick:async()=>{await eA(er,1e3)},children:"1000"})]}),secondaryButton:(0,a.tZ)(L.hs,{flex:"grow",children:(0,a.tZ)(M.zx,{priority:"secondary",onClick:()=>eb(!1),children:eh("Cancel")})}),onClose:()=>eb(!1)})]})}function eo(e){var{post:t}=e,n=(0,r._)(e,["post"]);let l=(0,B.aF)(),{requireLogin:s}=(0,j.SJ)(),d=()=>null==s?void 0:s({redirectOverride:(0,Y.uRy)(null,t,{urlParams:{triggerSave:!0}})}),c=ei(t),{iString:u}=(0,I.M1)();return(0,a.tZ)(D.sN,(0,i._)((0,o._)({leading:t.is_saved?(0,a.tZ)(b.Z,{}):(0,a.tZ)(f.Z,{}),onClick:()=>l?c():d()},n),{children:u(t.is_saved?"Unsave":"Save")}))}function ei(e){let t=(0,q.I0)(),n=(0,w.c1)();return()=>{let o=e.id,i=!e.is_saved;(0,w.TJ)(o,i,{surface:"reader"}),n(i),t({type:"post_save",payload:{postId:o,isSaved:i}})}}},59480:function(e,t,n){n.d(t,{Uu:()=>s});var o=n(68833);let i=["sort"],r=["sort","selection"],a=[];function l(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?r:i).includes(e)||n.searchParams.delete(e);return n.toString()}function s(e){setTimeout(()=>(function(e){var t,n;let{previous:i,url:r}=e;if("undefined"==typeof window)return;let s=l(r,!1),d=l(r,!0),{head:c}=document;null===(t=c.querySelector("link[rel=canonical]"))||void 0===t||t.setAttribute("href",s),null===(n=c.querySelector('meta[property="og:url"]'))||void 0===n||n.setAttribute("content",d),a.push(r),setTimeout(()=>{(0,o.jA)({previous:i,url:r})},100)})(e),0)}},34552:function(e,t,n){n.d(t,{Vc:()=>p});var o=n(16584),i=n(98661),r=n(31356),a=n(14952),l=n(60807),s=n(48980),d=n(98914),c=n(6490),u=n(60308),m=n(26111);function p(){var e;let{showCustomerSupportModeModal:t,allowAllDay:n,allowClose:p}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=(0,a.Ij)(),h=(0,l.aF)(),{canTurnOnCustomerSupportMode:g,isInCustomerSupportMode:v}={canTurnOnCustomerSupportMode:!!(null==(e=(0,l.aF)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},[y,b]=(0,i.useState)(!!(t&&g)),f=async()=>{try{await (0,s.rd)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,d.zx)(e))}},Z=async()=>{if(null==_?void 0:_.custom_domain){let e=window.location.pathname;(0,d.uX)((0,u.Q6L)(e,_),{local_navigation:!1})}else b(!0)},w=g&&(0,o.tZ)(c.u_,{isOpen:y,onClose:p?()=>b(!1):void 0,children:(0,o.tZ)(r.Z,{redirect:(0,m.x)("redirect")||"/publish/home",onClose:()=>b(!1),requiresMfa:null==h?void 0:h.requires_global_admin_mfa_challenge,allowAllDay:n,allowClose:p})});return{enableCustomerServiceMode:g?Z:void 0,disableCustomerServiceMode:v?f:void 0,modalElement:w}}},71e3:function(e,t,n){n.d(t,{A:()=>A});var o=n(16584),i=n(94184),r=n.n(i),a=n(30998),l=n.n(a),s=n(89734),d=n.n(s),c=n(82701),u=n(20888),m=n(95441),p=n(68833),_=n(98422),h=n(71068),g=n(15771),v=n(19081),y=n(58175),b=n(63651);let f={containerVertical:"containerVertical-L_u6LQ",logoVertical:"logoVertical-p9LsNy",listenLink:"listenLink-UqdzU4"},Z=e=>{var t;let{label:n,openInNewTab:i,podcastSettings:a,section:l,sectionUrl:s,setupUrl:d,subscribeUrl:Z,trackingSource:w,user:x}=e,{iString:P}=(0,m.M1)(),{isMobile:I}=(0,_.v9)(),S=I?80:160,k=(0,h.oB)({radius:"md",width:S}),B=(null==x?void 0:x.is_subscribed)&&null!==(t=a.paidEpisodeArtUrl)&&void 0!==t?t:a.artUrl;return(0,o.BX)(v.gq,{direction:I?"column":"row",gap:I?12:24,children:[B&&(0,o.tZ)(u.e,{className:r()(k),src:(0,b.zF4)(B,2*S),maxWidth:S,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,o.BX)(v.tu,{gap:8,children:[(0,o.BX)(v.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,o.tZ)(y.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",weight:"bold",href:s,rel:"noopener noreferrer",target:"_blank",children:a.title}),d&&(0,o.tZ)(g.zx,{priority:"secondary",size:"sm",href:d,newTab:i,onClick:()=>{(0,p.j)(p.FP.SET_UP_FEED_CLICKED,{section_id:l.id,source:w})},children:P("Set up")})]}),n&&(0,o.BX)(v.gq,{gap:8,alignItems:"center",children:[(0,o.tZ)(C,{label:n}),"free-with-ads"===n&&Z&&(0,o.tZ)(y.xv,{className:f.listenLink,color:"accent",font:"text",size:12,onClick:()=>{(0,p.j)(p.FP.LISTEN_AD_FREE_CLICKED,{section_id:l.id,source:w}),i?window.open(Z,"_blank","noopener,noreferrer"):window.location.href=Z},children:"Listen ad-free"})]}),(0,o.tZ)(y.xv.B3,{color:"pub-secondary-text",font:"text",children:a.description}),(0,o.tZ)("div",{children:(0,o.BX)(y.xv,{alignItems:"center",color:"accent",display:"inline-flex",font:"text",size:14,weight:"medium",gap:8,onClick:()=>{(0,p.j)(p.FP.SEE_ALL_EPISODES_CLICKED,{section_id:l.id,source:w}),i?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s},children:[(0,o.tZ)("span",{children:P("See all episodes")}),(0,o.tZ)(c.Z,{size:14})]})})]})]})},w=e=>{let{label:t,openInNewTab:n,podcastSettings:i,section:a,sectionUrl:l,trackingSource:s}=e,{iString:d}=(0,m.M1)(),_=(0,h.oB)({radius:"md"});return(0,o.BX)(v.tu,{className:f.containerVertical,border:"detail-themed",padding:20,radius:"md",gap:20,children:[(0,o.tZ)(v.gq,{justifyContent:"center",children:i.artUrl&&(0,o.tZ)(u.e,{className:r()(_,f.logoVertical),src:(0,b.zF4)(i.artUrl,440),maxWidth:164,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,o.BX)(v.tu,{gap:12,children:[(0,o.BX)(v.tu,{gap:8,children:[(0,o.tZ)(y.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",href:l,rel:"noopener noreferrer",target:"_blank",weight:"bold",children:i.title}),t&&(0,o.tZ)(v.gq,{children:(0,o.tZ)(C,{label:t})}),(0,o.tZ)(y.xv.B3,{color:"pub-secondary-text",font:"text",children:i.description})]}),(0,o.tZ)("div",{children:(0,o.BX)(y.xv,{display:"inline-flex",alignItems:"center",gap:8,color:"accent",font:"text",size:14,weight:"medium",onClick:()=>{(0,p.j)(p.FP.SEE_ALL_EPISODES_CLICKED,{section_id:a.id,source:s}),n?window.open(l,"_blank","noopener,noreferrer"):window.location.href=l},children:[(0,o.tZ)("span",{children:d("See all episodes")}),(0,o.tZ)(c.Z,{size:14})]})})]})]})},C=e=>{let{label:t}=e;return(0,o.tZ)(v.gq,{bg:"secondary",display:"inline-block",paddingX:6,radius:"sm",children:(0,o.tZ)(y.xv,{color:"pub-secondary-text",font:"text",size:12,weight:"semibold",lineHeight:20,children:"member-only"===t?"+ Member-only":"free-with-ads"===t?"Free with ads":"Free"})})};var x=n(46234),P=n(30733),I=n(24791),S=n(6070),k=n(17054),B=n(60308),N=n(26111),E=n(47929);let R={twoColumnGrid:"twoColumnGrid-pq1MC7",mainColumn:"mainColumn-cft5kf",sideColumn:"sideColumn-FFh4jo"},F=E.b3.podcastsPage,A=e=>{let{idToMagicLink:t,pub:n,user:i}=e,{isMobile:a}=(0,_.v9)(),s=d()((0,I.hK)(n),e=>{var t;return null!==(t=l()(n.navigationBarItems,t=>t.section_id===e.id))&&void 0!==t?t:999}),c=!!(null==i?void 0:i.is_subscribed),u=!c&&!a,m=s.filter(e=>c||!(0,S.QI)({sectionId:e.id})),p=c?[]:s.filter(e=>(0,S.QI)({sectionId:e.id})),h=null==t?void 0:t[n.id];return h||(h=(0,B.tS3)(n,{section:null,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:F}})),(0,o.tZ)(P.N,{columns:u?3:2,paddingTop:a?8:void 0,children:(0,o.BX)(v.hs,{className:r()({[R.twoColumnGrid]:u}),direction:u?"row":"column",gap:u?void 0:40,children:[!c&&(0,o.BX)(v.tu,{alignItems:a?"stretch":"start",className:R.sideColumn,gap:24,paddingLeft:u?32:void 0,children:[(0,o.BX)(v.tu,{gap:a?12:16,children:[(0,o.tZ)(y.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:"Member-only Shows"}),(0,o.tZ)(x.B,{firehoseFeedUrl:h,pub:n,trackingSource:F,variant:"member-only"})]}),(0,o.tZ)(v.tu,{gap:a?16:24,children:p.map((e,r)=>{let l=(0,k.d_)({pub:n,section:e}),s=(null==t?void 0:t[e.id])||(0,B.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:F}}),d=(0,b.Ucy)(n,{section:e,addBase:!0}),u=(0,S.hx)({sectionId:e.id})?"member-only":"free";return(0,o.BX)(o.HY,{children:[(0,o.tZ)(a?Z:w,{label:u,openInNewTab:!0,podcastSettings:l,section:e,sectionUrl:d,setupUrl:c?s:null,trackingSource:F,user:null!=i?i:null}),r!==p.length-1&&a&&(0,o.tZ)(v.gq,{borderBottom:"detail-themed"})]})})})]}),(0,o.BX)(v.tu,{className:R.mainColumn,gap:24,paddingRight:u?32:void 0,children:[(0,o.BX)(v.tu,{gap:a?12:16,children:[(0,o.BX)(y.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:[n.name," Shows"]}),c&&(0,o.tZ)(x.B,{pub:n,firehoseFeedUrl:h,trackingSource:F})]}),(0,o.tZ)(v.tu,{gap:a?16:24,children:m.map((e,r)=>{let a=(0,k.d_)({pub:n,section:e}),l=(null==t?void 0:t[e.id])||(0,B.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:F}}),s=(0,b.Ucy)(n,{section:e,addBase:!0}),d=(0,S.hx)({sectionId:e.id})?c?"member-only":"free-with-ads":"free";return(0,o.BX)(o.HY,{children:[(0,o.tZ)(Z,{label:d,openInNewTab:!0,podcastSettings:a,section:e,sectionUrl:s,setupUrl:c?l:null,subscribeUrl:(0,B.W1P)(n,{utm_source:F,simple:!0,next:document.location.href,referring_pub_ids:(0,N.x)("referring_pub_ids"),addBase:!0}),trackingSource:F,user:null!=i?i:null}),r!==m.length-1&&(0,o.tZ)(v.gq,{borderBottom:"detail-themed"})]})})})]})]})})}},12844:function(e,t,n){n.d(t,{k:()=>p,w:()=>u});var o=n(16584),i=n(95441),r=n(15771),a=n(17352),l=n(19081),s=n(10510),d=n(58175),c=n(60308);let u=(e,t)=>{var n;return{logoUrl:e.podcast_art_url||e.logo_url||(0,c.cse)(),mainClickUrl:(0,c.UVC)({pub:e,section:null,addBase:!0}),buttonClickUrl:t,name:e.podcast_title||e.name,description:null!==(n=e.podcast_description||e.hero_text)&&void 0!==n?n:void 0}},m=e=>{let{logoUrl:t,mainClickUrl:n,buttonClickUrl:c,name:u,description:m,showButton:p}=e,{iString:_}=(0,i.M1)();return(0,o.BX)(a.Z,{gap:12,direction:"row",alignItems:"center",padding:12,children:[t&&(0,o.tZ)(s.wk,{size:48,logoUrl:t}),(0,o.BX)(l.sg,{gap:2,flex:"grow",children:[(0,o.tZ)(d.xv.B3,{weight:"semibold",children:(0,o.tZ)(d.hh,{href:n,children:u})}),(0,o.tZ)(d.xv.B4,{color:"secondary",children:m})]}),p&&(0,o.tZ)(r.zx,{priority:"primary",href:c,newTab:!0,children:_("Set up")})]})},p=e=>{let{showButton:t,items:n}=e;return(0,o.tZ)(l.sg,{gap:12,children:n.map(e=>(0,o.tZ)(m,{logoUrl:e.logoUrl,mainClickUrl:e.mainClickUrl,buttonClickUrl:e.buttonClickUrl,name:e.name,description:e.description,showButton:t}))})}},87077:function(e,t,n){n.d(t,{$$:()=>Z,u:()=>w});var o=n(92002),i=n(73580),r=n(7409),a=n(99282),l=n(98848),s=n(16584),d=n(27506),c=n(26788),u=n(78493),m=n(98661),p=n(29032),_=n(20160),h=n(20888),g=n(71068),v=n(58076),y=n(19081),b=n(58175),f=n(165);let Z=500,w=e=>{var{children:t,text:n,title:o,imageUrl:i,as:p="span",leading:_,trailing:h,placement:g="top",disabled:y,delayEnter:b=Z,delayLeave:f=50}=e,w=(0,l._)(e,["children","text","title","imageUrl","as","leading","trailing","placement","disabled","delayEnter","delayLeave"]);let{floatingStyles:x,refs:P,getReferenceProps:I,getFloatingProps:S,isMounted:k,transitionStyles:B}=function(){let{placement:e="top",delayEnter:t=Z,delayLeave:n=50}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[o,i]=(0,m.useState)(!1),{refs:r,floatingStyles:a,context:l}=(0,d.YF)({placement:e,open:o,onOpenChange:i,whileElementsMounted:c.Me,middleware:[(0,u.cv)(8),(0,u.RR)(),(0,u.uY)()]}),{delay:s,isInstantPhase:p,currentId:_}=(0,d.Qu)(l),h=(0,d.XI)(l,{delay:s||{open:t,close:n}}),g=(0,d.KK)(l),v=(0,d.bQ)(l),y=(0,d.qs)(l,{role:"tooltip"}),{getReferenceProps:b,getFloatingProps:f}=(0,d.NI)([h,g,v,y]),{isMounted:w,styles:C}=(0,d.Y_)(l,{duration:p?{open:0,close:250*(_===l.floatingId)}:250,initial:e=>{let{side:t}=e;return{opacity:0,transform:({top:"translate3d(0, ".concat(8,"px, 0) scale(").concat(.975,")"),bottom:"translate3d(0, -".concat(8,"px, 0) scale(").concat(.975,")"),left:"translate3d(".concat(8,"px, 0, 0) scale(").concat(.975,")"),right:"translate3d(-".concat(8,"px, 0, 0) scale(").concat(.975,")")})[t]}},open:{opacity:1,transform:"translate3d(0, 0, 0) scale(1)"},common:e=>{let{side:t}=e;return{transition:"var(--animate-hover)",transitionTimingFunction:"var(--animation-smooth)",transformOrigin:({top:"bottom",bottom:"top",left:"right",right:"left"})[t]}}});return{refs:r,floatingStyles:a,getReferenceProps:b,getFloatingProps:f,isMounted:w,transitionStyles:C}}({placement:g,delayEnter:b,delayLeave:f});return y?(0,s.tZ)(s.HY,{children:t}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(p,(0,a._)((0,r._)({ref:P.setReference},I(w)),{children:t})),(0,s.tZ)(d.ll,{children:k&&(0,s.tZ)("div",(0,a._)((0,r._)({ref:P.setFloating},S()),{style:(0,a._)((0,r._)({},x),{maxWidth:320,zIndex:v.PU}),"data-tooltip-floating":"true",children:(0,s.tZ)("div",{style:B,"data-tooltip-content":"true",children:(0,s.tZ)(C,{text:n,title:o,imageUrl:i,leading:_,trailing:h})})}))})]})};function C(e){var t=(0,o._)({},(0,i._)(e));return(0,s.tZ)(p.C,{children:(0,s.tZ)(_.W,{children:(0,s.tZ)(N,{children:(0,s.tZ)(x,(0,r._)({},t))})})})}function x(e){let{leading:t,trailing:n,text:o,title:i,imageUrl:r,children:a}=e,l=o&&!i&&!r;return(0,s.BX)(B,{textOnly:!!l,children:[r&&(0,s.tZ)(k,{children:(0,s.tZ)(h.e,{src:r,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,s.BX)(S,{hasTitle:!!i,children:[t&&(0,s.tZ)(I,{children:t}),(0,s.BX)(P,{children:[i&&(0,s.tZ)(b.xv.B4,{weight:"medium",color:"primary",className:f.Z.title,children:i}),(0,s.tZ)(b.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof o?o.split("\n").map((e,t)=>(0,s.BX)(m.Fragment,{children:[t>0&&(0,s.tZ)("br",{}),e]},t)):o}),a]}),n&&(0,s.tZ)(I,{children:n})]})]})}let P=(0,g.zo)({display:"flex",direction:"column",gap:2});function I(e){let{children:t}=e;return(0,s.tZ)(y.X2,{alignItems:"center",justifyContent:"center",className:f.Z.endcapContainer,flex:"auto",gap:8,children:t})}function S(e){let{hasTitle:t,children:n}=e;return(0,s.tZ)(y.X2,{alignItems:t?"start":"center",gap:8,children:n})}function k(e){let{children:t}=e;return(0,s.tZ)(y.sg,{border:"detail",radius:"sm",className:f.Z.imageContainer,overflow:"hidden",children:t})}function B(e){let{textOnly:t,children:n}=e;return(0,s.tZ)(y.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,children:n})}let N=(0,g.zo)({radius:"sm",shadow:"md",border:"detail",bg:"primary"})},45783:function(e,t,n){n.d(t,{De:()=>h,R3:()=>y,eK:()=>_,rQ:()=>g});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),l=n(94184),s=n.n(l),d=n(98814),c=n(64998),u=n(98661),m=n(80026),p=n(68857);let _=function(e){let{inset:t=0,pageSizeAdjust:n=0,initialState:r,scrollFullPage:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[l,s]=(0,u.useState)(r||{showLeft:!1,showRight:!1});return(0,u.useEffect)(()=>{let{current:n}=e;if(n){let e=()=>{s(e=>{let r=e;!r.showLeft&&n.scrollLeft>t?r=(0,i._)((0,o._)({},e),{showLeft:!0}):r.showLeft&&n.scrollLeft<=t&&(r=(0,i._)((0,o._)({},e),{showLeft:!1}));let a=n.scrollWidth-n.offsetWidth-4-t;return!r.showRight&&n.scrollLeft<a?r=(0,i._)((0,o._)({},e),{showRight:!0}):r.showRight&&n.scrollLeft>=a&&(r=(0,i._)((0,o._)({},e),{showRight:!1})),r})};return n.addEventListener("scroll",e),setTimeout(()=>{e()},50),()=>{n.removeEventListener("scroll",e)}}},[]),{state:l,handleArrowClick:t=>()=>{let{current:o}=e;o&&o.scrollBy({left:t*(a?o.offsetWidth:o.offsetWidth/2-n),behavior:"smooth"})}}};function h(e){var{className:t,scrollRef:n}=e,l=(0,r._)(e,["className","scrollRef"]);return(0,a.tZ)(m.hs,(0,i._)((0,o._)({},l),{className:s()(p.Z.scrollBox,t),ref:n,overflowX:"auto",scrollBar:"hidden",minWidth:0,onTouchStart:e=>{let{pageX:t}=e;void 0!==t&&(!(t>10)||!(t<window.innerWidth-10))&&e.preventDefault()}}))}function g(e){let{direction:t,isVisible:n=!0,onClick:o}=e;return(0,a.tZ)(m.hs,{alignItems:"center",justifyContent:"center",position:"absolute",className:s()(p.Z.arrowButtonContainer,p.Z.arrowButtonOffsetContainer,n&&p.Z.visible,p.Z[t]),children:(0,a.tZ)(v,{direction:t,isVisible:n,onClick:o})})}function v(e){let{direction:t,isVisible:n=!0,onClick:o,className:i}=e;return(0,a.tZ)(m.hU,{size:"sm",priority:"quaternary",disabled:!n,className:i,onClick:o,"aria-hidden":!n,"aria-label":n?"left"===t?"Previous":"Next":void 0,children:"left"===t?(0,a.tZ)(d.Z,{}):(0,a.tZ)(c.Z,{})})}function y(e){let{direction:t,isVisible:n=!0,children:o,bg:i="primary"}=e;return(0,a.BX)(m.hs,{alignItems:"center",className:s()(p.Z.arrowButtonContainer,p.Z.arrowButtonOverlaidContainer,n&&p.Z.visible,p.Z[t]),children:[(0,a.tZ)("div",{className:s()(p.Z.overlay,p.Z[i])}),o]})}},74583:function(e,t,n){n.d(t,{$:()=>w,f:()=>Z});var o=n(16584),i=n(30396),r=n(94184),a=n.n(r),l=n(76789),s=n(95441),d=n(36518),c=n(68833),u=n(7882),m=n(71068),p=n(15771),_=n(19081),h=n(21685),g=n(87077),v=n(83010),y=n(74312),b=n(57693),f=n(21694);function Z(e){let{canShowAlerts:t=!1}=e,{iString:r}=(0,s.M1)(),a=(0,d.lR)(),_=(0,u.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,i.d4)(()=>{a.activityUnreadCount>0&&(0,c.j)(c.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:a.activityUnreadCount})},[a.activityUnreadCount]);let f=()=>Promise.all([n.e("9669"),n.e("4466"),n.e("7833"),n.e("8875")]).then(n.bind(n,79075)),Z=a.activityUnreadCount;return(0,o.BX)(v.H,{trackingProps:{surface:"dropdown"},children:[(0,o.tZ)(g.u,{text:r("Activity"),placement:"bottom",delayEnter:g.$$,children:(0,o.tZ)(h.J2,{trigger:(0,o.BX)(p.hU,{"aria-label":"View activity",priority:"tertiary",onMouseEnter:f,position:"relative",children:[(0,o.tZ)(l.Z,{"aria-hidden":!0,size:20}),Z>0&&(0,o.tZ)(w,{count:Z})]}),onOpen:()=>_.refetch(),children:(0,o.tZ)(y.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:f,resource:_,bellCount:Z,whileLoading:(0,o.tZ)(m.xu,{width:400})})})}),t&&(0,o.tZ)(b.l,{})]})}function w(e){let{count:t}=e;return(0,o.tZ)(_.hs,{className:a()(f.Z.badge,t<10&&f.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},91684:function(e,t,n){n.d(t,{b:()=>_});var o=n(16584),i=n(30396),r=n(5097),a=n(95441),l=n(68833),s=n(80026),d=n(21685),c=n(87077),u=n(97842),m=n(74312),p=n(74583);function _(){var e,t;let{iString:n}=(0,a.M1)(),_=null!==(t=null===(e=(0,u.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,i.d4)(()=>{(0,l.j)(l.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:_})},[_]),(0,o.tZ)(c.u,{text:n("Chat"),placement:"bottom",delayEnter:c.$$,children:(0,o.tZ)(d.J2,{trigger:(0,o.BX)(s.hU,{"aria-label":"View chats",priority:"tertiary",onMouseEnter:h,position:"relative",children:[(0,o.tZ)(r.Z,{size:20}),_>0&&(0,o.tZ)(p.$,{count:_})]}),onClose:()=>{(0,l.j)(l.FP.CHAT_DROPDOWN_CLOSED)},children:(0,o.tZ)(m.cr,{module:"./MiniInbox",onRequest:h,resolve:e=>e.MiniChatInbox,whileLoading:(0,o.tZ)(s.xu,{width:360})})})})}let h=()=>Promise.all([n.e("1697"),n.e("6930"),n.e("6855"),n.e("4937"),n.e("9669"),n.e("7696"),n.e("8336"),n.e("4466"),n.e("7833"),n.e("2888"),n.e("9593"),n.e("2937"),n.e("7299"),n.e("8472")]).then(n.bind(n,41358))},8113:function(e,t,n){n.d(t,{aM:()=>N});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),l=n(39693),s=n.n(l),d=n(44908),c=n.n(d),u=n(45578),m=n.n(u),p=n(69241),_=n(60807),h=n(12765),g=n(48980),v=n(9682),y=n(98914),b=n(8828),f=n(78308),Z=n(97842),w=n(54584),C=n(86190),x=n(46603),P=n(16889),I=n(91400),S=n(92039),k=n(98012),B=n(17440);function N(e){let{children:t,surface:n}=e,{user:l,userSettings:s}=(0,_.SE)(),d=s.newest_seen_chat_item_published_at,[{path:c}]=(0,v.tv)(),u=(0,I.XA)(),m=(0,S.rG)(),p=(0,S.m)(),[g,y]=(0,h.L)(M,(0,i._)((0,o._)({},Z.UX),{user:l,users:new Map(l?[[l.id,l]]:[])}));(0,Z.WG)({auto:!!l},{onSuccess:e=>{y({type:"inbox-unread_count",payload:e})}});let f=(0,a.sO)(0);return(0,a.d4)(()=>{if(m&&l)return m.listen({["user:".concat(l.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?y($(e)):"chat:updated-post"===e.type?y(ee(e)):"chat:new-post"===e.type&&y(et(e))}}})},[m]),(0,a.d4)(()=>{"open"===p&&l&&y((0,b.oH)())},[p]),(0,a.d4)(()=>{if("open"!==p){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;l&&e-f.current>5e3&&"hidden"!==t&&(f.current=e,y((0,b.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},o=(0,P.n)(t);return c.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[d,c,u,y,p]),(0,r.tZ)(w.o.Provider,{value:n,children:(0,r.tZ)(Z.ge.Provider,{value:y,children:(0,r.tZ)(Z.ky.Provider,{value:g,children:t})})})}let E={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},R={isLoading:!1,hasMore:!1,error:null},F={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},A={before:R,after:(0,i._)((0,o._)({},R),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function M(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,a=null!==(n=e.chats.get(r.id))&&void 0!==n?n:E;return(0,i._)((0,o._)({},e),{chats:(0,B.Rg)(e.chats,r.id,(0,i._)((0,o._)({},a),{publication:r})),publications:(0,B.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c}=t.payload,u=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...s()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,userStatus:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...s()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:a}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(a)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...s()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:E;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...s()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},F,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,a,l,s,d,c,u,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!==(c=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==c?c:null,muteStatus:null!==(u=t.muteStatus)&&void 0!==u?u:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(l=e.user)||void 0===l?void 0:null===(a=l.primary_publication)||void 0===a?void 0:a.id)||(null===(s=e.inbox.threads.get(t.id))||void 0===s?void 0:s.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(d=t.recentMessage)||void 0===d?void 0:d.id)&&void 0!==m?m:null,isPrimary:!1})}),p=Q(m),_=(0,B.zg)(e.inbox.threads,m,e=>e.id),h=Q([..._.values()]),{filter:g}=e.inbox,v=(0,f.A)(g);return O((0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[v]:{hasMore:r&&p===h,isLoading:!1}}),threads:_,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return O((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:l}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:l})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,f.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return O((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,j(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return O((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,j(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=j(n.id);return(0,i._)((0,o._)({},e),{chats:(0,B.i4)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.i4)(e.inbox.threads,j(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;j(n.id);let r=(0,B.Rg)(e.inbox.threads,j(n.id),{id:j(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},O((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,B.FN)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,B.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,o._)({},r,F))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=V(n);return(0,i._)((0,o._)({},e),{conversations:(0,B.i4)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:a,error:l}=t.payload,s=e.conversations.get(n);if(!s)return console.error("Attempting to set an error on missing conversation"),e;if(s[a].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,i._)((0,o._)({},s),{[a]:{isLoading:!1,cursor:r,error:l}}))})}case"conversation-load_more":{let r;let{edge:a,cursor:l,page:{thread:d,replies:c,publications:u,comments:m,pastCursor:p,futureCursor:_,profile:h,subscriberContext:g}}=t.payload,v=c.map(e=>e.comment.id),y=new Set(v),b=e.conversations.get(d.id);if(!b)return console.error("Attempting to load messages for missing conversation"),e;if(b[a].cursor!==l)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let f=b.replyIds.filter(e=>!y.has(e));f="before"===a?v.concat(f):f.concat(v),r=l?{[a]:{isLoading:!1,cursor:"before"===a?p:_,error:null}}:{before:{isLoading:!1,cursor:p,error:null},after:{isLoading:!1,cursor:_,error:null}};let Z=(0,i._)((0,o._)({},b,r),{thread:d,replyIds:f}),w=h&&(null===(n=d.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),C=(0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,d.id,Z),communityComments:Y(e.communityComments,c.flatMap(e=>s()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.created_at),users:(0,B.zg)(e.users,c.flatMap(e=>{var t;return s()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,B.Rg)(e.profiles,h.id,(0,i._)((0,o._)({},w,h),{subscriberContext:g})):e.profiles,publications:u?(0,B.zg)(e.publications,u,e=>e.id):e.publications,notes:m?(0,B.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===a||!l)return T(C,d.id,null);return C}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:l}=t.payload,s=e.conversations.get(n);if(!s)throw Error("Attempted to post message to missing conversation");let d={comment:(0,i._)((0,o._)({},X(e,t.payload)),{quote_id:null!==(r=s.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,y.Fo)(a)}:void 0,quote:l,quoteId:null==l?void 0:l.comment.id},c=(0,i._)((0,o._)({},s),{quoteReply:null,replyIds:[...s.replyIds,d.comment.id]});return T((0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,d.comment.id,d),conversations:(0,B.Rg)(e.conversations,n,c)}),n,d.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:a,publications:l,comments:s}=t.payload;n=null!=n?n:a.client_id;let d=e.conversations.get(r);if(!d)throw Error("Attempted to post message to missing conversation");let c=n&&e.communityComments.get(n),u=new Map(e.communityComments),m=H(a);u.set(a.comment.id,c?(0,i._)((0,o._)({},m),{clientId:c.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:c.comment.media_uploads})}):m),a.quote&&u.set(a.quote.comment.id,H(a.quote));let p=d.replyIds,_=a.comment.id;return n&&(p=p.map(e=>e===n?_:e)),p.includes(_)||(p=[...p,_]),p=[...new Set(p)],T((0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,r,(0,i._)((0,o._)({},d),{replyIds:p})),communityComments:u,publications:l?(0,B.zg)(e.publications,l,e=>e.id):e.publications,notes:s?(0,B.zg)(e.notes,s,e=>"c-".concat(e.id)):e.notes}),r,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,n,(0,i._)((0,o._)({},a),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return W(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return W(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return W(e,n,{unmute_at:o?(0,k.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let l=r!==a.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,l)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,a,l,s,d;let{publication_id:u}=t.payload,m=null!==(n=e.chats.get(u))&&void 0!==n?n:E;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),l=Y(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),s=j(u),d=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},p=(0,i._)((0,o._)({},e),{users:(0,B.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:l,chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m,d),{posts:c()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return J(null===(n=l.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(o=l.get(t))||void 0===o?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,s,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!==(t=null==a?void 0:a.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,i._)((0,o._)({},p),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(p)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,j(u),{lastViewedAt:new Date().toISOString()})}),chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),l={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(a=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==a?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0,userStatus:null};return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,l.communityPost.id,l),chats:(0,B.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{posts:[l.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:a}=t.payload,l=new Map(e.communityPosts);l.set(a,n);let s=Array.from(new Set([a,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,j(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,B.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:l,chats:(0,B.Rg)(e.chats,r,(0,i._)((0,o._)({},m),{posts:s}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:a}=t.payload,l=new Map(e.communityPosts);l.delete(n),l.set(r.communityPost.id,r);let s=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.F5)(e.inbox.threads,j(a),{communityPostId:r.communityPost.id})}),communityPosts:l,chats:(0,B.Rg)(e.chats,a,(0,i._)((0,o._)({},m),{posts:s}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(l=a.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:z(a.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(s=a.communityPost)||void 0===s?void 0:s.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:z(a.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let l=new Map(e.communityComments),s=e.comments.get(n);s&&s.comments.forEach(t=>{D(t,l);let n=e.replies.get(t);n&&n.comments.forEach(e=>{D(e,l)})});let c=null===(d=e.chats.get(r))||void 0===d?void 0:d.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i?void 0:null===(o=i.communityPost)||void 0===o?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null===(o=e.communityPosts.get(t))||void 0===o?void 0:o.communityPost,a=null===(i=e.communityPosts.get(n))||void 0===i?void 0:i.communityPost;return J(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],u=(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:l,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.FN)(e.inbox.threads,j(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=c?c:null}):e)})});return(0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},u.inbox),{threadList:U(u)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!K(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:a}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,B.Rg)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,o._)({},a.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,a,l,d,u,m,p,_;let h,v=null,y=null;"parentCommentId"in(_=t).payload&&_.payload.parentCommentId?y=t.payload.parentCommentId:"postId"in t.payload&&(v=t.payload.postId);let b=e=>y?{replies:e}:{comments:e};h=y?null!==(n=e.replies.get(y))&&void 0!==n?n:A:v&&null!==(r=e.comments.get(v))&&void 0!==r?r:A;let f=y?e.replies:e.comments,Z=null!=y?y:v;switch(t.type){case"replies-clear":case"comments-clear":return Z?(0,o._)({},e,b((0,B.Rg)(f,Z,A))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,l=(0,i._)((0,o._)({},R),{isLoading:!0,hasMore:!1}),s=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{before:"desc"===n?l:R,after:"asc"===n?l:R,order:n,target:null!=r?r:null,isLoaded:(!r||!!s)&&null!==(a=null==h?void 0:h.isLoaded)&&void 0!==a&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:a,replies:l,more:d,moreAfter:u,moreBefore:m,lastViewedAt:p}}=t.payload,_=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||E;n.muteStatus||(_=(0,B.Rg)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let g=l.map(e=>e.comment.id),v=Y(e.communityComments,l.flatMap(e=>s()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.updated_at);if(a)v.set(a.comment.id,(0,i._)((0,o._)({},a),{userId:a.user.id}));let y=(0,B.zg)(e.users,s()([null==r?void 0:r.communityPost.user,null==a?void 0:a.user]),e=>e.id),w=Z?f.get(Z):null,C=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:d,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:u,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,B.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:v}),_?{chats:_}:{}),{users:new Map([...y,...l.map(e=>[e.user.id,e.user])])}),b((0,B.Rg)(f,Z,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:c()([...h.comments,...g]).sort((e,t)=>{var n,o;return J(null===(n=v.get(e))||void 0===n?void 0:n.comment.created_at,null===(o=v.get(t))||void 0===o?void 0:o.comment.created_at)}).filter(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||d?h.order:"desc",isLoaded:!0,lastViewedAt:p}))))}case"replies-target":case"comments-target":return Z?(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,B.FN)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,B.FN)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return Z?(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return Z?(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},X(e,n)),{quote_id:null!==(u=null===(l=n.quoteReply)||void 0===l?void 0:l.comment.id)&&void 0!==u?u:null,post_id:n.postId,parent_id:y}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(d=n.quoteReply)||void 0===d?void 0:d.comment.id,pub_roles:n.pubRoles},a=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,r.comment.id,r)}),b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(y){let n=e.communityComments.get(y);if(n&&G(n)){let r=L(n.comment,e.user,t.payload.postId);a.communityComments.set(y,(0,i._)((0,o._)({},n),{comment:r}))}}let s=e.communityPosts.get(t.payload.postId);if(s&&K(s)){let n=L(s.communityPost,e.user,t.payload.postId);a.communityPosts=(0,B.Rg)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},s),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(r.comment.id,H(r));let l=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:a}),b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{comments:l}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,H(r))}),b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,H(r)),users:r.user?(0,B.Rg)(e.users,r.userId,r.user):e.users}),b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof g.kp){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,B.Rg)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null,userStatus:null})),users:t.user?(0,B.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,b((0,B.Rg)(f,Z,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a)||!(null===(m=a.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a)||!(null===(p=a.comment)||void 0===p?void 0:p.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,o._)({},a.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!G(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,B.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,i._)((0,o._)({},a.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function L(e,t,n){var r,a;let l;return(t&&t.photo_url&&(l=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(l=m()([...l,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:l,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:l,comment_count:1+(null!==(a=e.comment_count)&&void 0!==a?a:0)}):e}function D(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function X(e,t){var n,r,a;return(0,i._)((0,o._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(a=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==a?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function T(e,t,n){let r=V(t),a=e.inbox.threads.get(r),l=(null==a?void 0:a.type)==="direct-message"?a:null,s=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,B.Rg)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},l),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},s),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(s)})})}function z(e,t,n){var r,a;let l=e.reaction,s=(0,o._)({},e.reactions);return s[t]=(null!==(r=s[t])&&void 0!==r?r:0)+(n?1:-1),n&&l&&(s[l]=(null!==(a=s[l])&&void 0!==a?a:0)-1),(0,i._)((0,o._)({},e),{reactions:s,reaction:n?t:null})}function O(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(e)})})}function U(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:J(q(e,t),q(e,n))).map(e=>e.id)}function q(e,t){var n,o,i,r;return"chat"===t.type?null!==(i=t.communityPostId&&(null===(o=e.communityPosts.get(t.communityPostId))||void 0===o?void 0:o.communityPost.created_at))&&void 0!==i?i:t.timestamp:null!==(r=null===(n=(0,x._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function W(e,t,n){let r=e.conversations.get(t),a=null==r?void 0:r.thread;if(!r||!a)throw Error("Tried to update a conversation that does not exist.");let l=e.user;if(!l)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,B.Rg)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},a),{members:a.members.map(e=>e.user_id===l.id?(0,o._)({},e,n):e)})}))})}function j(e){return"chat-".concat(e)}function V(e){return"direct-message-".concat(e)}function H(e){var t,n,r,a;return(0,i._)((0,o._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(a=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==a?a:void 0})}function K(e){return!0!==e.isNew}function G(e){return!0!==e.isNew}function J(e,t){return e===t?0:!t||e&&e>t?-1:1}function Y(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),a=r.get(t);if(!a){r.set(t,e);continue}i(e)>=i(a)&&r.set(t,(0,o._)({},a,e))}return r}function Q(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!==(o=n.timestamp)&&void 0!==o?o:t;return i<e?i:e},t)}let $=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,C.U)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,p.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:a}=e;if("deleted"===a.status){t({type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}});return}t({type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null,userStatus:null}}})},et=e=>async t=>{var n,r;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null,userStatus:null}}})}},15503:function(e,t,n){n.d(t,{CD:()=>f,Eg:()=>c,Gv:()=>C,Kr:()=>w,MJ:()=>b,a2:()=>m,iI:()=>h,qG:()=>y,rw:()=>u,zi:()=>d});var o=n(7409),i=n(99282),r=n(41609),a=n.n(r),l=n(42375),s=n(68833);function d(e,t){var n;let{extraEventProps:o={},tabId:i,primaryItem:r,isLoggedIn:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l="trackingParameters"in e&&"item_entity_key"in e.trackingParameters?null===(n=e.trackingParameters)||void 0===n?void 0:n.item_entity_key:null;l&&a&&fetch("/api/v1/reader/feed/".concat(l,"/seen"),{method:"POST"}),v("seen",e,t,{extraEventProps:o,tabId:i,primaryItem:r})}function c(e,t,n){let{extraEventProps:r={},tabId:a,primaryItem:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};v("seen_for_duration",e,t,{extraEventProps:(0,i._)((0,o._)({},r),{timeVisible:n}),tabId:a,primaryItem:l})}function u(e,t,n){let{extraEventProps:r={},tabId:a,primaryItem:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};v("clicked",e,t,{extraEventProps:(0,i._)((0,o._)({clicked_element:n},r),{tabId:a,primaryItem:l})})}function m(e,t){let{extraEventProps:n={},tabId:r,primaryItem:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};v("swiped",e,t,{extraEventProps:(0,i._)((0,o._)({},n),{tabId:r,primaryItem:a})})}function p(e){var t,n,o,i,r,a,l,s,d,c,u,m,p,_,h;let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{primaryItem:v}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{item_primary_entity_key:v&&"entity_key"in v?v.entity_key:"entity_key"in e?e.entity_key:"",item_entity_key:"entity_key"in e?e.entity_key:"",item_type:e.type,item_content_user_id:"comment"in e?e.comment&&e.comment.user_id?e.comment.user_id:0:"post"in e?null!==(p=null===(n=e.post.publishedBylines)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.id)&&void 0!==p?p:e.publication.author_id:0,item_content_timestamp:"comment"in e&&(null===(o=e.comment)||void 0===o?void 0:o.date)?new Date(e.comment.date).toISOString():"post"in e&&(null===(i=e.post)||void 0===i?void 0:i.post_date)?new Date(e.post.post_date).toISOString():"community_post"in e&&(null===(r=e.community_post)||void 0===r?void 0:r.created_at)?new Date(e.community_post.created_at).toISOString():null,item_context_type:"context"in e?e.context.type:"",item_context_type_bucket:"context"in e&&null!==(_=e.context.typeBucket)&&void 0!==_?_:"",item_context_timestamp:new Date("context"in e?e.context.timestamp:new Date).toISOString(),item_context_user_id:"context"in e?null===(a=e.context.users[0])||void 0===a?void 0:a.id:void 0,item_context_user_ids:"context"in e&&(null!==(h=null===(l=e.context.users)||void 0===l?void 0:l.length)&&void 0!==h?h:0)>0?e.context.users.map(e=>{let{id:t}=e;return t}):[],item_publication_id:"publication"in e?null===(s=e.publication)||void 0===s?void 0:s.id:void 0,item_post_id:null===(d=e.post)||void 0===d?void 0:d.id,item_comment_id:null===(c=e.comment)||void 0===c?void 0:c.id,item_can_reply:!("canReply"in e)||e.canReply,item_source:"frontend",item_model_rank:null,item_model_score:null,tab_id:null!=g?g:void 0,item_module_id:"id"in e?e.id:void 0,followed_user_count:0,subscribed_publication_count:0,is_following:!1,is_explicitly_subscribed:!1,trending_topic_id:"trendingTopic"in e?null===(u=e.trendingTopic)||void 0===u?void 0:u.id:void 0,trending_topic_query:"trendingTopic"in e?null===(m=e.trendingTopic)||void 0===m?void 0:m.query:void 0}}function _(e,t){let{primaryItem:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"comment"===e.type||"post"===e.type||"featuredCollection"===e.type||"featuredPublication"===e.type?a()(e.trackingParameters)?p(e,t,{primaryItem:n}):e.trackingParameters:p(e,t,{primaryItem:n})}function h(e){let{primaryItem:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i._)((0,o._)({},e),{trackingParameters:p(e,null,{primaryItem:t})})}n(31406),n(84864);let g=new Map([["featuredCollection","featured_collection"],["featuredPublication","featured_publication"]]);function v(e,t,n){let{extraEventProps:i={},tabId:r,primaryItem:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=_(t,null!=r?r:null,{primaryItem:a}),d=g.get(t.type);(0,s.j)("seen"===e?s.FP.FEED_ITEM_SEEN:"seen_for_duration"===e?s.FP.FEED_ITEM_SEEN_FOR_DURATION:"swiped"===e?s.FP.FEED_ITEM_SWIPED:s.FP.FEED_ITEM_CLICKED,(0,o._)({surface:n,tabId:r,module:d},l,i))}function y(e,t,n){let{extraEventProps:i={},tabId:r,primaryItem:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=_(t,null!=r?r:null,{primaryItem:a}),d=g.get(t.type);(0,s.j)("seen"===e?s.FP.FEED_MODULE_ITEM_SEEN:s.FP.FEED_MODULE_ITEM_CLICKED,(0,o._)({surface:n,tabId:r,module:d},l,i))}function b(e,t){let{extraEventProps:n={}}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Z("seen",e,t,{extraEventProps:n})}function f(e,t,n){let{extraEventProps:i={}}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Z("clicked",e,t,{extraEventProps:(0,o._)({clicked_element:n},i)})}function Z(e,t,n){var i,r,a;let{extraEventProps:l={}}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,s.j)("seen"===e?s.FP.FEED_USER_SUGGESTION_SEEN:s.FP.FEED_USER_SUGGESTION_CLICKED,(0,o._)({suggested_user_id:t.user.id,suggested_publication_id:null!==(r=null===(i=t.publication)||void 0===i?void 0:i.id)&&void 0!==r?r:null,suggestion_source:null!==(a=t.source)&&void 0!==a?a:null,surface:n},t.trackingParameters,l))}function w(e,t){let{tabId:n,noteId:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,s.j)(s.FP.FEED_HIDDEN_ATTACHMENT_SHOWN,{attachmentId:e,reason:t,tabId:n,noteId:o})}function C(e){let{props:t,isModuleItem:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,l.rI)(),r=n?y:v;return n=>{r("clicked",e,i,{extraEventProps:(0,o._)({clicked_element:n},t)})}}},20521:function(e,t,n){n.d(t,{x:()=>r});var o=n(98012);function i(e){var t;let n=[e.is_primary,(null===(t=e.publication)||void 0===t?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(n,"-").concat((0,o.Z)(e.created_at).valueOf())}function r(e){return e.slice(0).sort((e,t)=>i(e)>i(t)?1:-1)}}}]);