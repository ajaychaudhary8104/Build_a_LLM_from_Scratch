"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8538"],{85527:function(t,e,n){n.d(e,{F:()=>i,q:()=>a});var r=n(98661),o=n(30396);let a=(0,r.createContext)(void 0);function i(){return(0,o.qp)(a)}},6246:function(t,e,n){n.d(e,{T:()=>i,u:()=>o});let r=Intl.NumberFormat(void 0,{maximumSignificantDigits:4});function o(t){return r.format(t)}let a=new Intl.NumberFormat(void 0,{maximumSignificantDigits:3,notation:"compact"});function i(t){return a.format(t)}},15562:function(t,e,n){n.d(e,{W:()=>a});var r=n(16584),o=n(6490);let a=t=>{let{isOpen:e=!1,title:n,description:a,icon:i,onClose:c,primaryButton:l,secondaryButton:s}=t;return(0,r.BX)(o.u_,{isOpen:e,onClose:c,children:[n&&(0,r.tZ)(o.xB,{title:n,description:a,showClose:!1,icon:i}),(0,r.tZ)(o.ex,{}),(0,r.tZ)(o.mz,{primaryButton:l,secondaryButton:s})]})}},1669:function(t,e,n){n.d(e,{o:()=>i});var r=n(16584),o=n(98914),a=n(1844);function i(t){let{error:e}=t,n=(0,o.HM)(e);return(null==n?void 0:n.html)?(0,r.tZ)(a.y,{dangerouslySetInnerHTML:{__html:n.html}}):(0,r.tZ)(a.y,{children:(null==n?void 0:n.msg)||"Something went wrong"})}},76566:function(t,e,n){n.d(e,{S:()=>d});var r=n(27412),o=n(16584),a=n(20042),i=n(98661),c=n(20888),l=n(9682),s=n(19081),u=n(58175);class d extends i.Component{static getDerivedStateFromError(t){return{error:t}}componentDidMount(){Promise.all([n.e("7152"),n.e("6993")]).then(n.bind(n,91985)).then(t=>{this.Sentry=t.Sentry})}componentDidCatch(t){console.error(t),this.Sentry&&this.Sentry.captureException(t)}render(){let{error:t}=this.state;return(0,o.tZ)(m,{onReset:()=>this.setState({error:null}),error:t,children:t?(0,o.tZ)(p,{}):this.props.children})}constructor(t){super(t),(0,r._)(this,"Sentry",null),this.state={error:null}}}function m(t){let{onReset:e,error:n,children:r}=t,c=(0,i.useRef)((0,a.getCurrentUrl)());return(0,l.js)(t=>{n&&c.current!==t&&e(),c.current=t},[]),n?(0,o.tZ)(p,{}):r}function p(){return(0,o.BX)(s.tu,{flex:"grow",justifyContent:"center",alignItems:"center",gap:32,padding:20,children:[(0,o.tZ)(c.e,{src:"/img/reader/toad.png",maxWidth:200}),(0,o.BX)(s.tu,{gap:8,children:[(0,o.tZ)(u.xv.H3,{weight:"semibold",align:"center",children:"Oh noâ€”this page croaked."}),(0,o.tZ)(u.xv.B3,{color:"secondary",align:"center",children:"Try again, or hop to another page."})]})]})}},50312:function(t,e,n){n.d(e,{F:()=>p,r:()=>m});var r=n(7409),o=n(99282),a=n(98848),i=n(16584),c=n(98661),l=n(20042),s=n(21811),u=n(93252),d=n(71068);let m=(0,c.forwardRef)((t,e)=>{var{href:n,onClick:c,campaign:l,replace:s,state:u,showBack:m}=t,f=(0,a._)(t,["href","onClick","campaign","replace","state","showBack"]);let h=p({href:n,onClick:c,campaign:l,replace:s,state:u=m?(0,o._)((0,r._)({},u),{showBack:!0}):u});return(0,i.tZ)(d.xu,(0,r._)((0,o._)((0,r._)({as:"a"},f),{ref:e}),h))});function p(t){let{onClick:e,href:n,campaign:o,replace:a,state:i}=t;if(n&&!(0,u.P)()){let t;try{t=new URL(n)}catch(e){try{t=new URL("".concat(document.location.origin).concat(n))}catch(t){}}if(t){if(t.origin!==document.location.origin||o){if(t.origin!==document.location.origin&&o){for(let[e,n]of Object.entries(o)){let r="name"===e?"campaign":e;t.searchParams.set("utm_".concat(r),n)}n=t.toString()}}else{let e=new URLSearchParams,r={};for(let[n,o]of t.searchParams)n.startsWith("utm_")?"utm_campaign"===n?r.name=o:r[n.replace(/^utm_/,"")]=o:e.append(n,o);o=r,n="".concat(t.pathname,"?").concat(e)}}}return{href:n,onClick:t=>{if(null==e||e(t),!t.ctrlKey&&!t.shiftKey&&!t.metaKey&&n&&!(0,u.P)()){if(t.defaultPrevented){t.stopPropagation();return}(0,s.j)((0,r._)({},o)),t.preventDefault(),t.stopPropagation(),(0,l.route)(n,a),i&&history.replaceState(i,"")}}}}},41233:function(t,e,n){n.d(e,{LZ:()=>_,et:()=>S,fA:()=>y});var r=n(7409),o=n(99282),a=n(16584),i=n(95441),c=n(52099),l=n(80026),s=n(6490),u=n(65523),d=n(4354),m=n(65942),p=n(23276),f=n(9003),h=n(24142),g=n(91400);function y(t){let{onCancel:e,onSuccess:n,onSignup:r,onUserCreated:o,noCloseButton:i,noExit:l,isOpen:u,redirectOverride:m,overrideTitle:p}=t,f=(0,g.XA)();return(0,a.tZ)(s.u_,{onClose:e,isOpen:u,children:(0,a.BX)(d.t,{children:[(0,a.tZ)(v,{onCancel:e,onSuccess:n,onSignup:r,onUserCreated:o,noCloseButton:i,noExit:l,redirectOverride:m,overrideTitle:p}),f&&(0,a.tZ)(c.o$,{})]})})}function v(t){let{onCancel:e,onSuccess:n,onSignup:i,onUserCreated:c,noCloseButton:l,noExit:s,redirectOverride:u,overrideTitle:g}=t,{mode:y}=(0,d.I)(),v={overrideTitle:g,noCloseButton:l||s,onCancel:e,onSignup:i};return(0,a.BX)(a.HY,{children:["magic-link"===y&&(0,a.tZ)(m.v,(0,o._)((0,r._)({},v),{onSuccess:n})),"email"===y&&(0,a.tZ)(p.j,(0,o._)((0,r._)({},v),{onUserCreated:c,redirectOverride:u})),"password"===y&&(0,a.tZ)(h.L,(0,o._)((0,r._)({},v),{onSuccess:n})),"mfa"===y&&(0,a.tZ)(f.n,{onSuccess:n})]})}let _=t=>{let{overrideTitle:e,noCloseButton:n,onCancel:r,onSignup:o}=t,{iString:c}=(0,i.M1)();return(0,a.tZ)(u.xB,{title:e||c("Sign in to Substack"),description:o?(0,a.BX)(a.HY,{children:[c("First time here? "),(0,a.tZ)(l.hh,{color:"substack",decoration:"hover-underline",onClick:o,cursor:"pointer",children:c("Create account")})]}):void 0,showClose:!n,onClose:r,icon:(0,a.tZ)(u.ZN,{}),alignItems:"center"})},S=t=>{let{children:e}=t;return(0,a.tZ)(l.sg,{padding:16,borderTop:"detail",children:(0,a.tZ)(l.xv.B4,{as:"span",color:"secondary",align:"center",children:e})})}},16913:function(t,e,n){n.d(e,{E:()=>d});var r=n(16584),o=n(95441),a=n(80026),i=n(98012);let c=new Intl.DateTimeFormat(void 0,{timeStyle:"short"}),l=new Intl.DateTimeFormat(void 0,{weekday:"long"}),s=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),u=new Intl.DateTimeFormat(void 0,{dateStyle:"long"});function d(t){let{timestamp:e,conjunction:n=!1}=t,{iString:d,language:m}=(0,o.M1)(),p=new Date(e),f=(0,i.Z)(),h=m.startsWith("en"),g=f.isSame(p,"day")?d("Today"):f.subtract(1,"day").isSame(p,"day")?d("Yesterday"):f.isSame(p,"week")?l.format(p):f.isSame(p,"year")?s.format(p):u.format(p);return(0,r.tZ)(a.X2,{alignItems:"center",justifyContent:"center",children:(0,r.BX)(a.xv.B4,{color:"secondary",children:[g,n&&h?" at ":" ",c.format(p)]})})}},11308:function(t,e,n){n.d(e,{o:()=>l});var r=n(7409),o=n(99282),a=n(79094),i=n(48980),c=n(97842);function l(t){let{entityType:e,publication:n}=t,i=(0,a.T7)(),l=(0,c.I0)();return(t,a)=>{i({onSubmit:n=>l("communityPost"===e?s((0,o._)((0,r._)({},n),{id:t})):u((0,o._)((0,r._)({},n),{id:t}))),canReportToAdmins:!!(n&&a&&n.moderation_enabled),pub:null!=n?n:void 0})}}let s=t=>{let{id:e,details:n,reportCategory:r,reportedToSubstack:o}=t;return async t=>{t({type:"posts-flag_post",payload:{id:e}});let a=await d({id:e,details:n,reportCategory:r,reportedToSubstack:o});a instanceof Error&&console.warn("error flagging post",a)}},u=t=>{let{id:e,details:n,reportCategory:r,reportedToSubstack:o}=t;return async t=>{t({type:"comments-flag_comment",payload:{id:e}});let a=await m({id:e,details:n,reportCategory:r,reportedToSubstack:o});a instanceof Error&&console.warn("error flagging comment",a)}};async function d(t){let{id:e,details:n,reportCategory:r,reportedToSubstack:o}=t;try{return await (0,i.rd)("/api/v1/community/posts/".concat(e,"/reports"),{method:"POST",json:{postId:e,details:n,reportCategory:r,reportedToSubstack:o}})}catch(t){return t}}async function m(t){let{id:e,details:n,reportCategory:r,reportedToSubstack:o}=t;try{return await (0,i.rd)("/api/v1/community/comments/".concat(e,"/reports"),{method:"POST",json:{commentId:e,details:n,reportCategory:r,reportedToSubstack:o}})}catch(t){return t}}},65958:function(t,e,n){n.d(e,{s:()=>g});var r=n(7409),o=n(99282),a=n(16584),i=n(60807),c=n(48980),l=n(80878),s=n(7882),u=n(70379),d=n(97842),m=n(81043),p=n(95551),f=n(62515),h=n(36186);function g(t){let{source:e}=t,n=function(t){let{source:e}=t,n=(0,d.I0)(),a=(0,s.ib)({pathname:"/api/v1/messages/dm/start",method:"POST"}),i=async t=>{let r=await a.refetch({json:{user_ids:t,source:e}});return r instanceof Error||n({type:"conversation-load_more",payload:{edge:"before",cursor:null,page:r}}),r};return(0,o._)((0,r._)({},a),{handleStart:i})}({source:e}),g=(0,p.d)(),y=(0,u.pm)(),v=(0,i.aF)(),{onboardingModalRef:_,requireLogin:S}=(0,m.SJ)(),w=async t=>{var e;if(!v)return S?S():_.current?_.current.open():g(Error("Onboarding modal not found"),"Could not start conversation."),!1;let i=await n.handleStart(t);return i instanceof Error?(i instanceof c.kp&&(null===(e=i.body)||void 0===e?void 0:e.type)==="profile_not_set_up"?y.popToast(t=>(0,a.tZ)(u.FN,(0,o._)((0,r._)({},t),{text:"Please set up your profile before sending a message.",cta:"Set up profile",href:(0,h.Nh)({utm_source:"substack",utm_campaign:"chat_dm_button",redirect:window.location}),localNavigation:!1}))):g(i,"Could not start conversation."),!1):((0,l._)((0,f.Rm)(i.thread.id)),!0)};return(0,o._)((0,r._)({},n),{handleStart:w})}},32189:function(t,e,n){n.d(e,{x:()=>c});var r=n(30396),o=n(60807),a=n(68833),i=n(81043);function c(t){let{surface:e,zIndex:n=null}=t,c=(0,o.aF)(),{onboardingModalRef:l}=(0,i.SJ)();return(0,r.d4)(()=>{l.current&&null!==n&&(l.current.props.zIndex=n)},[l,n]),(t,n)=>r=>{if(!t){console.warn("No publication provided to usePubOnboardingHandler handler");return}if(!c){var o,i;if(!l.current)return;r.preventDefault(),n?null===(o=l.current)||void 0===o||o.openForPub(t,n):null===(i=l.current)||void 0===i||i.openToPubSignup(t);return}(0,a.x6)(t,e)}}}}]);