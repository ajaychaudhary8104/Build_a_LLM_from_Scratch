"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["6400"],{22233:function(e,t,i){i.d(t,{Z:()=>n});let n=2787!=i.j?{icon:"icon-JCPlCw",toggleSetting:"toggleSetting-UDN_Qn",transcriptionPlayer:"transcriptionPlayer-eiECcl",hidePlayer:"hidePlayer-TfzId9",nonActiveText:"nonActiveText-JfTKb8",transcriptionChunk:"transcriptionChunk-bCQeJ2",editableChunk:"editableChunk-k4Fatu",startTime:"startTime-tjpyBE",text:"text-Ou5QC2",activeStartTime:"activeStartTime-ozZC_j",chunkWithSpeaker:"chunkWithSpeaker-iYPDkU",speaker:"speaker-GFTaOB",transcription:"transcription-hfRyWl",popover:"popover-tZdxdX",divider:"divider-ah0vWs",resultsValue:"resultsValue-uYlTxH",searchResult:"searchResult-_1_8Y9",isFocused:"isFocused-CIwNEb",searchForm:"searchForm-gEUJ79"}:null},15080:function(e,t,i){i.d(t,{Z:()=>n});let n=/^(3154|6909)$/.test(i.j)?{hasModal:"hasModal-bDnxNx",modalViewer:"modalViewer-xO_gxg",active:"active-uB0ZZs",logo:"logo-DQBU5j",back:"back-nF7MN5"}:null},42909:function(e,t,i){i.d(t,{S$:()=>y,Su:()=>_,_e:()=>f});var n=i(16584),r=i(6400),o=i(30396),a=i(53836),s=i.n(a),l=i(97742),c=i(57391),d=i(95441),u=i(68833);i(62981);var p=i(98914);i(94874),i(15771),i(19081),i(58175);var h=i(66611),m=i(60308);if(/^(3154|6909)$/.test(i.j))var v=i(26111);if(i(63651),/^(3154|6909)$/.test(i.j))var g=i(81821);if(/^(3154|6909)$/.test(i.j))var b=i(47929);let Z=(0,r.createContext)({hidden:!1});function _(){let{setHidden:e}=(0,o.qp)(Z);return()=>null==e?void 0:e(!0)}function f(e){let{children:t}=e,[i,r]=(0,o.eJ)(!1);return(0,n.tZ)(Z.Provider,{value:{hidden:i,setHidden:r},children:t})}function y(e){let{post:t,subdomain:i,readerInstalled:r,isContributor:a}=e,l=(0,g.s)()?"ios":(0,g.Dt)()?"android":null,{iString:h}=(0,d.M1)(),{hidden:_}=(0,o.qp)(Z),{exposeExperiment:f,getExperimentVariant:y}=(0,c.jc)(),P=_||!l;if((0,o.d4)(()=>{P||!r||a||t.is_draft||(0,v.x)("triedRedirect")||(0,p.AE)()?P||f("app_install_prompts"):(0,p.uX)((0,m.K8_)(i,t.slug,{params:{utm_medium:b.lP.web,utm_campaign:b.VX.postsOpenInApp,utm_source:b.b3.postBanner}}))},[]),P)return null;let k=y("app_install_prompts")||"none";if(!["our_banner","native_banner_if_supported"].includes(k))return null;let N=h("Read in the Substack app");"podcast"==t.type?N=h("Listen in the Substack app"):"video"==t.type&&(N=h("Watch in the Substack app"));let I=(0,m.K8_)(i,t.slug,{redirect:"app-store",source:b.b3.postBanner});return(0,g.IT)()&&"native_banner_if_supported"===k?(0,n.BX)(n.HY,{children:[(0,n.tZ)(s(),{meta:[{name:"apple-itunes-app",content:"app-id=1581650857, app-argument=".concat(I)}]}),(0,n.tZ)(w,{surface:"post",bannerType:"safari-native-app-banner"})]}):(0,n.BX)(S,{className:"app-banner-post",children:[(0,n.tZ)(w,{surface:"post"}),(0,n.tZ)(C,{}),(0,n.tZ)(x,{children:(0,n.tZ)("div",{children:N})}),(0,n.tZ)("a",{className:"app-banner-cta",href:I,onClick:()=>{(0,u.j)(u.FP.APP_BANNER_TAPPED,{surface:"post",type:"header"})},children:h("Open app")})]})}function w(e){let{surface:t,bannerType:i}=e;return(0,o.d4)(()=>{(0,u.j)(u.FP.APP_BANNER_VIEWED,{surface:t,bannerType:i})},[]),null}let S=(0,h.L)("app-banner"),x=(0,h.L)("app-banner-text");function C(){return(0,n.tZ)("div",{className:"app-banner-icon",children:(0,n.tZ)(l.Z,{height:16})})}},72508:function(e,t,i){i.d(t,{ZP:()=>M,ml:()=>H,sZ:()=>V});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),s=i(94184),l=i.n(s),c=i(74691),d=i.n(c),u=i(18029),p=i.n(u),h=i(44908),m=i.n(h),v=i(17015),g=i(82914),b=i(76439),Z=i(60201),_=i(80569),f=i.n(_),y=i(61649),w=i(29032),S=i(93678),x=i(44881),C=i(95441),P=i(57952),k=i(96904),N=i(53030),I=i(68833),T=i(33224),B=i(71068),E=i(19081),R=i(58175),X=i(17564),O=i(74571),D=i(61468),A=i(84864),L=i(93370),j=i(24271),U=i(63523);function M(e){var t,i;let{disableSelection:s,player:l,postId:c,renderTranscriptionChunk:u,transcription:p,onUpdateActiveRowIndex:h}=e,{iString:v}=(0,C.M1)(),{onStartClipping:g}=(0,y.Sr)(),b=(0,a.sO)(null),{selection:Z,clearSelection:_,selectEndRef:w,selectStartRef:S}=(0,O.LW)({containerRef:b,disable:null!=s&&s,playerRef:l}),[B,X]=(0,a.eJ)(!0),[A,L]=(0,a.eJ)(),[j,M]=(0,a.eJ)(["nick","mills"]),[H,V]=(0,a.eJ)({}),[Y,$]=(0,a.eJ)(!1),[G,q]=(0,a.eJ)(!1),[J,K]=(0,a.eJ)(),{currentTime:Q,isPlaying:ee}=(0,N.FI)(l),et=H?Object.values(H).filter(e=>e):[],ei=!!((null==j?void 0:j.length)&&et.length),{setItems:en}=(0,P.pH)(),er=null==A?void 0:A.findIndex(e=>e.start<=Q&&e.end>Q);if((0,a.d4)(()=>{h&&void 0!==er&&-1!==er&&h(er)},[er,h]),(0,a.d4)(()=>{X(!0),p.cdn_url&&f().get(p.cdn_url).then(e=>{if(!e.text)return;let t=JSON.parse(e.text),i=(0,D.Ap)({rows:t});L(i),en(i);let n=m()(i.map(e=>{var t;return null!==(t=e.speaker)&&void 0!==t?t:""})).filter(e=>e).sort();n.length&&M(n)}).finally(()=>{X(!1)}),p.speaker_map&&Object.values(p.speaker_map).length&&V(p.speaker_map)},[null==A?void 0:A.length,en,p.cdn_url,p.cdn_unaligned_url,p.speaker_map]),B)return(0,o.tZ)(F,{});if(!(null==A?void 0:A.length))return(0,o.tZ)("div",{className:U.Z.transcriptionStatus,children:(0,o.tZ)(R.xv.Meta,{children:v((null==p?void 0:p.status)==="in_progress"?"Transcription in progress...":"No transcript...")})});let eo=(null==l?void 0:null===(i=l.current)||void 0===i?void 0:null===(t=i.player)||void 0===t?void 0:t.tagName)==="VIDEO",ea=eo?"videogram":"audiogram";return(0,o.BX)(E.tu,{ref:b,children:[Z&&(0,o.tZ)(z,{isVideo:eo,selection:Z,onSelect:eo?()=>{if(!Z||!A||!S.current||!w.current)return;let e=S.current,t=w.current;(e.rowIndex>t.rowIndex||e.rowIndex===t.rowIndex&&e.offset>t.offset)&&([e,t]=[t,e]);let i=(0,T.xm)({startRow:A[e.rowIndex],endRow:A[t.rowIndex],startOffset:e.offset,endOffset:t.offset,startNodeText:e.text,endNodeText:t.text});_(),g((0,r._)((0,n._)({},i),{source:"transcription",title:null}))}:function(){if(Z&&w.current&&S.current&&A){let e=(0,n._)({},S.current),t=(0,n._)({},w.current),[i,r]=(0,T.lF)({selectStart:e,selectEnd:t,alignedRows:A});i>r&&([i,r]=[r,i]),$(!0),f().post("/api/v1/audiogram").send({post_id:c,start_idx:i,end_idx:r,use_draft:!1}).then(e=>{var t,i;(null===(t=e.body)||void 0===t?void 0:t.data)&&(K(e.body.data),_(),(null==l?void 0:null===(i=l.current)||void 0===i?void 0:i.player)&&l.current.player.pause())}).finally(()=>$(!1))}}}),u&&A.map((e,t)=>{var i;return u({isPlaying:ee,row:e,rowIndex:t,words:e.words,showSpeaker:(0===t?void 0:null===(i=A[t-1])||void 0===i?void 0:i.speaker)!==e.speaker,speakerName:ei&&e.speaker?H[e.speaker]:void 0,onPause:()=>{var e;(null==l?void 0:null===(e=l.current)||void 0===e?void 0:e.player)&&l.current.player.pause()},onPlay:()=>{var t;(null==l?void 0:null===(t=l.current)||void 0===t?void 0:t.player)&&(l.current.player.currentTime=e.start+1e-4,l.current.player.play())}})}),!u&&A.map((e,t)=>(0,o.tZ)(W,{idx:t,row:e,rows:A,speakerName:ei&&e.speaker?H[e.speaker]:void 0,onReassign:()=>q(!0),currentTime:Q,isPlaying:ee,isSelected:!!(Z&&w.current&&S.current&&t===d()(t,Math.min(S.current.rowIndex,w.current.rowIndex),Math.max(S.current.rowIndex,w.current.rowIndex))),onClick:()=>{_()},onPause:()=>{var e;(null==l?void 0:null===(e=l.current)||void 0===e?void 0:e.player)&&l.current.player.pause()},onPlay:()=>{var t;(null==l?void 0:null===(t=l.current)||void 0===t?void 0:t.player)&&(l.current.player.currentTime=e.start+1e-4,l.current.player.play())}},t)),(0,o.tZ)(k.G,{isOpen:!!(Y||J),onClose:()=>K(void 0),isGenerating:Y,finishedGram:J,noun:ea,postId:c,onDownload:function(e){return(0,I.j)(I.FP.AUDIOGRAM_DOWNLOAD_CLICKED,{post_id:c,audiogram_id:null==J?void 0:J.id,media_upload_id:p.media_upload_id}),fetch(e,{method:"GET"}).then(e=>e.blob()).then(e=>{var t;let i=null==J?void 0:null===(t=J.video_url)||void 0===t?void 0:t.split("/").pop(),n=null==i?void 0:i.match(/^([^-]+-[^_]+)_/),r=(null==n?void 0:n[1])||"",o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download="substack-".concat(ea,"-").concat(c,"-").concat(r,".mp4"),document.body.appendChild(a),a.click(),URL.revokeObjectURL(o),a.remove()})}}),(0,o.tZ)(x.O,{isOpen:j&&!!j.length&&!!G,onClose:()=>q(!1),speakers:j,speakerMap:H,onChangeSpeakerMap:V,postId:c})]})}function z(e){var t,i;let{isVideo:n,selection:r,onSelect:a}=e,{iString:s}=(0,C.M1)(),c=null===(i=r.anchorNode)||void 0===i?void 0:null===(t=i.parentElement)||void 0===t?void 0:t.getBoundingClientRect();return c?(0,o.tZ)(w.C,{children:(0,o.tZ)(E.tu,{style:{top:(0,A.isTouchDevice)()?Math.max(c.y,0)+c.height+12:Math.max(c.bottom,0)+12,left:c.x+c.width/2,transform:"translateX(-50%)",pointerEvents:"auto",maxWidth:240},justifyContent:"center",outline:"detail",shadow:"md",radius:"md",className:l()(j.Z.popover,j.Z.mounted),padding:4,gap:4,children:n?(0,o.BX)(S.O7,{onClick:a,children:[(0,o.tZ)(v.Z,{stroke:"var(--color-utility-white)",size:20}),(0,o.tZ)(R.xv.B4,{color:"white",weight:"medium",children:s("Create clip")})]}):(0,o.BX)(S.O7,{onClick:a,children:[(0,o.tZ)(g.Z,{stroke:"var(--color-utility-white)",size:20}),(0,o.tZ)(R.xv.B4,{color:"white",weight:"medium",children:s("Make audiogram")})]})})}):null}function F(){return(0,o.BX)(o.HY,{children:[(0,o.tZ)(X.S,{width:"80%",height:"24px",className:U.Z.loadingSilhouette}),(0,o.tZ)(X.S,{width:"34%",height:"24px",className:U.Z.loadingSilhouette}),(0,o.tZ)(X.S,{width:"75%",height:"24px",className:U.Z.loadingSilhouette}),(0,o.tZ)(X.S,{width:"100%",height:"24px",className:U.Z.loadingSilhouette}),(0,o.tZ)(X.S,{width:"68%",height:"24px",className:U.Z.loadingSilhouette})]})}function H(e){if(!e)return"Unknown Speaker";let t=e.split("_"),i=parseInt(t[1]);return"".concat(p()(t[0])," ").concat(i+1)}function W(e){let{row:t,currentTime:i,onPlay:s,isPlaying:c,onPause:d,isSelected:u,onClick:p,idx:h,rows:m,onReassign:v,speakerName:g}=e,[_,f]=(0,a.eJ)(!1),y=(0,a.sO)(null),w=t.start<=i&&t.end>=i,S=t.words.map(e=>e.start<=i&&e.end>=i?(0,o.BX)(o.HY,{children:[(0,o.tZ)("span",{className:U.Z.activeWord,children:e.word})," "]}):"".concat(e.word," "));S.length||(S=t.text.split(" ").map(e=>(0,o.BX)("span",{children:[e," "]})));let x=null;if(t.speaker&&g){var C;let e=0===h?void 0:null===(C=m[h-1])||void 0===C?void 0:C.speaker;t.speaker!==e&&(x=(0,o.tZ)("div",{className:U.Z.speakerText,onClick:v,children:g}))}return(0,o.BX)("div",{ref:y,onClick:p,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),style:{display:"flex",width:"100%",alignItems:"center"},children:[c&&(!_||w)?(0,o.tZ)(Z.Z,{onClick:d,size:24,className:U.Z.playCircle,style:(0,r._)((0,n._)({},_&&{color:"var(--color-accent-themed)"}),{visibility:w||_?"visible":"hidden"})}):(0,o.tZ)(b.Z,{onClick:s,size:24,className:U.Z.playCircle,style:(0,r._)((0,n._)({},_&&{color:"var(--color-accent-themed)"}),{visibility:w||_?"visible":"hidden"})}),(0,o.BX)("div",{className:l()(U.Z.transcriptionChunk,{[U.Z.activeRow]:w||u,[U.Z.hoverChunk]:_}),"data-chunk-index":h,children:[(0,o.tZ)("div",{className:l()(U.Z.rowIndicator,{[U.Z.hoverRow]:_})}),(0,o.BX)("div",{style:{display:"flex",flexDirection:"column",flex:1,padding:"5px 0"},children:[x,(0,o.tZ)("div",{className:U.Z.rowText,"data-chunk-index":h,children:S})]})]})]})}let V=e=>{let{isActiveRow:t,isPlaying:i,row:n,rowIndex:r,onPause:a,onPlay:s,postId:c,children:d,className:u,activeClassName:p,editable:h}=e,m=t&&i;return(0,o.tZ)(B.xu,{id:"transcription-".concat(r),paddingRight:16,className:l()(u,{[null!=p?p:""]:m}),onClick:()=>{var e;(null===(e=window.getSelection())||void 0===e||!e.toString())&&!h&&((0,I.j)(I.FP.TRANSCRIPTION_TIMESTAMP_CLICKED,{post_id:c,timestamp:(0,L.DL)(n.start)}),m?a():s())},children:d})}},2689:function(e,t,i){if(i.d(t,{Z:()=>l}),/^(3154|6909)$/.test(i.j))var n=i(7409);if(/^(3154|6909)$/.test(i.j))var r=i(99282);if(/^(3154|6909)$/.test(i.j))var o=i(98848);var a=i(16584),s=i(64515);let l=/^(3154|6909)$/.test(i.j)?e=>{var{size:t=20,fill:i="var(--color-fg-primary)"}=e,l=(0,o._)(e,["size","fill"]);return(0,a.tZ)(s.l,(0,r._)((0,n._)({},l),{name:"PauseIconFilled",svgParams:{viewBox:"0 0 20 20"},width:t,height:t,fill:i,children:(0,a.tZ)("path",{stroke:"none",d:"M5.29883 17.9082H7.52539C8.375 17.9082 8.82422 17.459 8.82422 16.5996V3.29883C8.82422 2.41016 8.375 2 7.52539 2H5.29883C4.44922 2 4 2.44922 4 3.29883V16.5996C4 17.459 4.44922 17.9082 5.29883 17.9082ZM12.3984 17.9082H14.6152C15.4746 17.9082 15.9141 17.459 15.9141 16.5996V3.29883C15.9141 2.41016 15.4746 2 14.6152 2H12.3984C11.5391 2 11.0898 2.44922 11.0898 3.29883V16.5996C11.0898 17.459 11.5391 17.9082 12.3984 17.9082Z"})}))}:null},56219:function(e,t,i){i.d(t,{Rs:()=>eq,SO:()=>eH,_q:()=>eY,a7:()=>eK,eu:()=>eM,lO:()=>eU,mV:()=>e$,nM:()=>eV,sY:()=>eQ,xw:()=>ez});var n=i(27412),r=i(7409),o=i(99282),a=i(58865),s=i(16584),l=i(6400),c=i(30396),d=i(94184),u=i.n(d),p=i(22448),h=i(80569),m=i.n(h),v=i(7464),g=i(84844),b=i(84892),Z=i(9573),_=i(89074),f=i(59708),y=i(92828),w=i(75021),S=i(18787),x=i(90311),C=i(17350),P=i(16944),k=i(94442),N=i(3862),I=i(21316),T=i(85685),B=i(11712),E=i(94594),R=i(9721),X=i(33665),O=i(90156),D=i(72392),A=i(12980),L=i(16506),j=i(85721),U=i(89276),M=i(25956),z=i(79160),F=i(58319),H=i(57391),W=i(37168),V=i(95441),Y=i(30372),$=i(56629),G=i(68833),q=i(55229),J=i(48980),K=i(49762),Q=i(27036),ee=i(98914),et=i(29927),ei=i(94874),en=i(15771),er=i(61254),eo=i(19081),ea=i(1844),es=i(58175),el=i(70379),ec=i(23776),ed=i(57641),eu=i(33555),ep=i(40894),eh=i(24791),em=i(6070),ev=i(67914),eg=i(60308),eb=i(26111),eZ=i(63651),e_=i(81821),ef=i(84864),ey=i(47929),ew=i(59961);function eS(){let e=(0,a._)(["The full video is for subscribers in the "," plan"]);return eS=function(){return e},e}function ex(){let e=(0,a._)(["The full video is for subscribers in the Founding Member plan"]);return ex=function(){return e},e}function eC(){let e=(0,a._)(["The full video is for paid subscribers"]);return eC=function(){return e},e}function eP(){let e=(0,a._)(["This email is for subscribers in the "," plan"]);return eP=function(){return e},e}function ek(){let e=(0,a._)(["This email is for subscribers in the Founding Member plan"]);return ek=function(){return e},e}function eN(){let e=(0,a._)(["This email is for paid subscribers"]);return eN=function(){return e},e}function eI(){let e=(0,a._)(["Continue reading this post for free, courtesy of ","."]);return eI=function(){return e},e}function eT(){let e=(0,a._)(["This post is for subscribers in the "," plan"]);return eT=function(){return e},e}function eB(){let e=(0,a._)(["This post is for subscribers in the Founding Member plan"]);return eB=function(){return e},e}function eE(){let e=(0,a._)(["This post is for paid subscribers"]);return eE=function(){return e},e}function eR(){let e=(0,a._)(["Subscribe to "," to continue reading"]);return eR=function(){return e},e}function eX(){let e=(0,a._)(["Visit the author’s Substack to subscribe and read more."]);return eX=function(){return e},e}function eO(){let e=(0,a._)(["Visit ",""]);return eO=function(){return e},e}function eD(){let e=(0,a._)(["Support ",""]);return eD=function(){return e},e}function eA(){let e=(0,a._)(["Subscribe to ",""]);return eA=function(){return e},e}function eL(){let e=(0,a._)(["By ",""]);return eL=function(){return e},e}function ej(){let e=(0,a._)(["Subscribe to ",""]);return ej=function(){return e},e}let eU="focus-comment-input",eM=(e,t)=>!!e&&!e.invite_only&&!!t&&t.has_publication&&!t.is_admin&&!t.is_contributor&&!t.is_public_admin&&(0,Q.P)(t,e),ez=(e,t,i,n)=>"enabled"===e.payments_state?!(null==t?void 0:t.is_subscribed):(null==t?void 0:t.is_free_subscribed)&&"disabled"===e.payments_state&&!e.invite_only?!n&&i&&!(null==t?void 0:t.is_pledged):!(null==t?void 0:t.is_free_subscribed);class eF extends l.Component{async loadReactors(){let e=await m().get("/api/v1/post/".concat(this.props.post.id,"/facepile"));this.setState({reactors:e.body.reactors,restackers:e.body.restackers})}async componentDidMount(){var e,t,i;if(this.props.paywall&&!this.props.postPreview&&((0,G.j)(G.FP.POST_PAYWALL_SHOWN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type,user:this.props.user}),(0,em.HD)({pub:this.props.pub}))){let e=null===(i=window)||void 0===i?void 0:null===(t=i._analyticsConfig)||void 0===t?void 0:t.anonymousId;(0,q.Hx)("paywall_shown",(0,r._)({post_id:this.props.post.id},this.props.user?{user_id:this.props.user.id,user_email:this.props.user.email,membership_type:this.props.user.is_subscribed?"paid":this.props.user.is_free_subscribed?"free":"none"}:e?{anonymousId:e}:{}))}this._triggerShare=()=>this.triggerShare(),null===(e=this.containerRef.current)||void 0===e||e.addEventListener("share-post",this._triggerShare),this.props.post&&this.loadReactors(),.001>Math.random()&&(0,G.K8)({post:this.props.post});let n=(0,eb.x)("subscribe_prompt");n&&("paid"===n?this.props.popToast(e=>(0,s.tZ)(el.FN,(0,o._)((0,r._)({},e),{text:"Subscription purchased for ".concat(this.props.pub.name)}))):this.props.popToast(e=>(0,s.tZ)(el.FN,(0,o._)((0,r._)({},e),{text:"Subscribed to ".concat(this.props.pub.name)}))));let a=null;0x9f7afc3===this.props.post.id&&alert("userAgent: ".concat(navigator.userAgent)),(0,e_.tq)({checkFirst4:!0})&&(/Instagram/i.test(navigator.userAgent)?a="instagram":/(Messenger|FBAN|FBAV|FB_IAB)/i.test(navigator.userAgent)?a="facebook":/LinkedIn/i.test(navigator.userAgent)&&(a="linkedin")),a?this.setWebviewModalState(a):this.setPostPromptState()}componentWillUnmount(){if(this._triggerShare){var e;null===(e=this.containerRef.current)||void 0===e||e.removeEventListener("share-post",this._triggerShare)}this.props.stopInterval&&this.props.stopInterval()}isGiftPostEligible(){var e,t;let{getSettingFor:i,post:n,pub:r,referringUser:o,user:a}=this.props;return i("paywall_unlock_tokens")&&"only_paid"===n.audience&&n.teaser_post_eligible&&(!a||!a.is_subscribed)&&(0,e_.tq)({checkFirst4:!0})&&(null==o?void 0:null===(t=o.subscriptions)||void 0===t?void 0:null===(e=t.find(e=>e.publication_id===r.id))||void 0===e?void 0:e.membership_state)==="subscribed"}async setWebviewModalState(e){this.setState({showWebViewModal:{action:"facebook"===e?"read":"follow",platform:e}})}async setPostPromptState(){var e;let{post:t,disableSubscribePrompt:i,readerIsSearchCrawler:n,pub:r,user:o,readerInstalledAt:a,referringUser:s,forceFollowPrompt:l}=this.props,c="newsletter"===t.type&&!0===this.props.getSettingFor("enable_post_page_conversion")&&!i&&!(0,ee.AE)()&&!n,d=!1;if(null===(e=document)||void 0===e?void 0:e.referrer)try{let e=new URL(document.referrer);d=!!e.hostname.match(/(^|\.)substack\.com$/)||e.hostname===window.location.hostname}catch(e){}let u=!1,p=this.props.skipFollowPrompt;this.isGiftPostEligible()&&["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(u=!0,p=!0);let h=!1;if(l)h=!0;else if(!ef.PUB_IDS_TO_NOT_SHOW_FOLLOW_PROMPT_ON.includes(r.id)&&!p&&c&&s&&s.name&&s.id!==(null==o?void 0:o.id)&&r.author_id!==s.id&&r.contributors.every(e=>e.user_id!==s.id)){let e=[];if(o)try{e=await (0,J.rd)("/api/v1/feed/following")}catch(e){console.warn("Failed to fetch following state",e)}h=!e.includes(s.id)}let m=c&&!u&&!h&&!this.props.paywall&&!this.props.freeSignup&&!o,v=!u&&!["video","podcast"].includes(t.type)&&!n&&(0,e_.tq)({checkFirst4:!0})&&!a&&!d,g=!1;v&&!m&&(this.context.exposeExperiment("app_install_prompts"),"drawer"===this.context.getExperimentVariant("app_install_prompts")&&(g=!0,h=!1)),this.setState({shouldShowGiftPostPrompt:u,shouldShowFollowPrompt:h,shouldShowSubscribePrompt:m,appUpsellEligible:v,mountAppUpsellFooter:g})}triggerShare(){let{fromEmail:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({shareModalOpen:!0,shareModalMedium:e?"email":"web"})}onBottomReached(e){this.state.bottomReached||this.props.postPreview||(this.setState({bottomReached:!0}),(0,G.xG)({post:this.props.post,hasPaywall:e,surface:"publication",trackerUuid:this.props.getCurrentUuid()}))}shouldShowUFI(){let{fromPostPage:e,user:t,pub:i,getSettingFor:n}=this.props,{canShowSubscribeFooterAfterPost:r}=this.state;return!!e&&!!r&&ez(i,t,!!n("payment_pledges_enabled"),this.shouldShowRecommendCta)}shouldTrackPaywallPostSeen(){if("undefined"==typeof window)return!1;let e=document.createElement("div"),t=this.props.post.body_html;e.innerHTML=t;let i=this.props.pub.post_preview_limit||ef.DEFAULT_PREVIEW_LIMIT,n="",r=!1;for(let t=e.childNodes.length-1;t>=0;t--){let o=e.childNodes[t];if(o&&(n+=o.textContent).length>i){r=!0;break}}return r}render(e,t){var i,n,a,l,c,d,h,m;let g,{user:Z,pub:P,post:N,freeSignup:I,freeSignupEmail:T,isServingFreePodcastUrl:X,isShowsPost:M,isTheFreePressTheme:H,reaction_token:W,invisible:V,paywall:Y,onChange:$,hideTitle:q,noTitleLink:J,showComments:Q,fromPostPage:ee,freeTrialCoupon:et,showRestackModal:ei,stripe_publishable_key:er,crossPostInfo:ea,iString:es,iTemplate:ed,themeVariables:eu,referringUser:ep,renderComments:ev,renderContent:eg,getSettingFor:eb,startInterval:ef,forceFollowPrompt:ey}=e,{showTranscription:eR,truncated:eX,autoPlayVoiceOver:eO,reactors:eD,restackers:eA,shouldShowFollowPrompt:eL,shouldShowSubscribePrompt:ej,shouldShowGiftPostPrompt:eU,appUpsellEligible:eM,mountAppUpsellFooter:ez,showWebViewModal:eF}=t;if(N.is_geoblocked)return(0,s.tZ)(e0,{});let eH=(0,em.HD)({pub:P}),eY=!!this.context.getConfigFor("like_posts_enabled"),eq=(0,f.N1)(null!==(l=eX||N.body_html)&&void 0!==l?l:"",eH?"h1, h2, h3":"h1, h2, h3, h4"),eQ=!Y||Y&&this.shouldTrackPaywallPostSeen();ef&&eQ&&ef({postId:this.props.post.id,containerElementRef:this.containerRef,elementIsStatic:!0});let e1="video"===N.type&&!Y&&(null===(i=N.videoUpload)||void 0===i?void 0:i.transcription),e4=this.shouldShowUFI()&&!(0,em.HD)({pub:P}),e9=eK(N),e8=!!eD&&eD.length>0,e2=!!(eb("paywall_unlock_tokens")&&"only_paid"===N.audience&&N.teaser_post_eligible),e6=e2&&!(null==Z?void 0:Z.is_subscribed)&&((null==Z?void 0:Z.is_free_subscribed)||I)&&!(null==Z?void 0:Z.has_redeemed_post_unlock_token),e5=(0,e_.tq)({checkFirst4:!0});e2&&this.isGiftPostEligible()&&(this.context.exposeExperiment("gift_post_unlocks_recipient_2"),["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(e6=!0,g=this.context.getExperimentVariant("gift_post_unlocks_recipient_2")));let e3="";e3="video"===N.type?"founding"===N.audience&&(0,eh.H$)(P)?ed(eS(),null!==(c=(0,eh.H$)(P))&&void 0!==c?c:""):ed("founding"===N.audience?ex():eC()):"adhoc_email"===N.type?"founding"===N.audience&&(0,eh.H$)(P)?ed(eP(),null!==(d=(0,eh.H$)(P))&&void 0!==d?d:""):ed("founding"===N.audience?ek():eN()):e6?e5?es("Continue reading this post for free in the Substack app"):ed(eI(),P.author_name||P.name):"founding"===N.audience&&(0,eh.H$)(P)?ed(eT(),null!==(h=(0,eh.H$)(P))&&void 0!==h?h:""):ed("founding"===N.audience?eB():eE());let e7=(0,s.BX)(U.j,{disabled:!H,post:N,isShowsPost:M,children:[(0,s.tZ)("div",{className:"available-content",children:eR?(0,s.tZ)("div",{className:"container tw-py-12",children:(0,s.tZ)(ec.Z,{post:N,pub:P,user:Z,playerRef:this.videoPlayer})}):(0,s.tZ)(B.Z,{html:eX||N.body_html||null,pub:P,trackSelection:!0,post:N,themeVariables:eu,canRestackImage:this.context.getConfigFor("restack_with_image"),user:Z,freeSignup:I,freeSignupEmail:T,paywall:Y,showing_behind_paywall:!!N.post_paywall_content_for_google})}),N.post_paywall_content_for_google&&(0,s.tZ)("div",{className:"paywall-content",children:(0,s.tZ)(B.Z,{html:N.post_paywall_content_for_google,pub:P,trackSelection:!1,post:N,user:Z,freeSignup:I,freeSignupEmail:T,paywall:Y})}),!V&&eQ&&(0,s.tZ)(F.Z,{onVisible:()=>this.onBottomReached(!!Y)})]}),te=(0,em.kb)({pub:P}),tt=this.context.getConfigFor("thefp_show_fixed_footer_paywall"),ti=eH?(0,s.tZ)(L.Z,{post:N,user:Z,pub:P,freeSignupEmail:T}):(0,s.tZ)(S.f1,(0,r._)({user:Z,freeSignupEmail:T,freeSignup:I,publication:P,post:N,coupon:!0===this.props.paywall&&this.props.pub.paywall_free_trial_enabled?et:null,showPostUnlockPrompt:!!e6,magicToken:W,giftingUser:ep,treatmentVariantForGiftPostPaywall:g,onPostUnlockError:()=>this.props.popToast(e=>(0,s.tZ)(el.FN,(0,o._)((0,r._)({},e),{text:es("Teaser posts are not currently available for this content")})))},Object.assign({title:e3,reauthenticationTitle:es("To read this, please re-authenticate.")},Y)));return(0,s.BX)("article",{className:u()("typography ".concat(N.type,"-post post"),{"tw-p-0":"podcast"===N.type,"shows-post":M,"full-width-image-header":(null===(n=N.postTheme)||void 0===n?void 0:n.header_variant)==="full-width-image",[null!==(m=ew.Z.bottomWithTos)&&void 0!==m?m:"undefined"]:P.has_custom_tos}),ref:this.containerRef,children:[(null==Z?void 0:Z.is_contributor)&&(null==N?void 0:N.id)&&(null==N?void 0:N.type)==="page"&&(0,s.tZ)(en.zx,{priority:"secondary",href:(0,eZ.ANx)(P,N.id,{params:{back:document.location.href}}),localNavigation:!1,leading:(0,s.tZ)(p.Z,{size:20}),children:es("Edit")}),(0,s.tZ)(eJ,{post:N,user:Z,onChange:$}),(0,s.tZ)(R.V,{isOpen:!!this.state.shareModalOpen,onClose:()=>this.setState({shareModalOpen:!1,shareModalMedium:void 0}),user:Z,pub:P,post:N,reaction_token:W,medium:this.state.shareModalMedium||"web"}),eU&&(0,s.tZ)(w.f,{user:Z,post:N,pub:P,referringUser:ep,freeSignupEmail:T,variant:this.context.getExperimentVariant("gift_post_unlocks_recipient_2")}),eL&&(0,s.tZ)(y.yi,{pub:P,post:N,referringUser:ep,freeSignupEmail:T,forceFollowPrompt:ey,surface:"post-follow-referrer-prompt"}),ej&&(0,s.tZ)(O.H,{pub:P,post:N,stripe_publishable_key:er,sharer:ep,appUpsellEligible:!!eM}),ez&&(0,s.tZ)(v.m,{pub:P,slug:N.slug}),eF&&(0,s.tZ)(v.p,{pub:P,slug:N.slug,action:eF.action,platform:eF.platform}),eg?(0,s.BX)(s.HY,{children:[!V&&(0,s.tZ)(F.Z,{onVisible:()=>{this.onTopReached(!!Y)}}),eg({comments:ev?ev():null,crossPostInfo:ea,postContent:(0,s.BX)(s.HY,{children:[e7,!!(Y&&!N.post_paywall_content_for_google&&!X)&&ti]})})]}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(e$,{user:null!=Z?Z:null,pub:P,post:N,isOnPostPage:!0,reaction_token:W,allowEdit:!0,showShare:!0,showSubtitle:!0,showPhoto:!0,showCommentRestack:!P.hide_post_restacks,hideTitle:!!q,noTitleLink:!!J,onChange:$,hideDate:"page"===N.type,hideAudience:"page"===N.type,showReactions:eY,showComments:!!Q,showLabel:!0,showUpdatedIcons:!0,fromPostPage:!!ee,onClickCommentButton:this.onCommentButtonClicked,reactors:eD,showRestackModal:!!ei,showTranscriptionButton:!!e1,onTranscriptionClick:this.onTranscriptionClick,autoPlayVoiceOver:eO}),!V&&eQ&&(0,s.tZ)(F.Z,{onVisible:()=>this.onTopReached(!!Y)}),(N.has_voiceover||!!N.voiceoverUpload)&&!H&&(0,s.tZ)(b.KH,{pub:P,post:N,mediaUploadId:N.voiceover_upload_id,duration:null===(a=N.voiceoverUpload)||void 0===a?void 0:a.duration,autoPlay:eO,href:N.canonical_url,isPaywalled:!N.voiceover_upload_id}),!N.voiceoverUpload&&eO&&e9&&(0,s.tZ)(z.r,{postId:N.id,onClose:()=>{(0,G.j)(G.FP.LISTEN_TO_THIS_POST_MODAL_DISMISSED,{post_id:N.id}),this.setState({autoPlayVoiceOver:!1})}}),ea?(0,s.tZ)(_.F,{postType:N.type,crossPostInfo:ea}):null,(0,s.BX)("div",{children:[eq&&eH&&(0,s.tZ)(j.T,{toc:eq,title:N.title,commentCount:N.comment_count,wordCount:N.wordcount}),eq&&!eH&&(0,s.tZ)(D.o,{toc:eq,position:"fixed"}),e7,Y&&!N.post_paywall_content_for_google?(0,s.BX)(s.HY,{children:[ti,(0,s.tZ)(C.i,{post:N})]}):eX?(0,s.tZ)("p",{children:(0,s.BX)(en.zx,{className:"expander",onClick:()=>this.setState({truncated:null}),children:["+ ",es("show full post")]})}):!["page"].includes(null==N?void 0:N.type)&&(0,s.BX)(s.HY,{children:[e4&&(0,s.tZ)(eV,{pub:P,post:N,user:Z,freeSignup:!!I,freeSignupEmail:T}),!e4&&this.shouldShowRecommendCta&&(0,s.tZ)(E.o,{pub:P}),ea&&("only_paid"===N.audience||"founding"===N.audience)&&(0,s.tZ)(eW,{pub:P}),(0,K.ZP)("like_posts_enabled")&&P.community_enabled&&e8&&!H&&(0,s.tZ)(eo.X2,{borderTop:"detail-themed",paddingY:16,children:(0,s.tZ)(x.fB,{post:N,pub:P,user:Z,reactors:eD,secondaryFaces:eA})}),!H&&(0,s.tZ)("div",{className:"post-footer",children:(0,s.tZ)(k.Mp,{post:N,pub:P,user:Z,onChange:$,postReactionToken:W})}),(0,s.tZ)(C.i,{post:N})]}),N.show_guest_bios&&"podcast"!==N.type&&!eH&&!te&&(0,s.tZ)(eG,{user:Z,post:N})]})]}),eH&&Y&&!(null==Z?void 0:Z.is_subscribed)&&tt&&(0,s.tZ)(A.w,{pub:P})]})}constructor(e,t){var i,r;super(e,t),(0,n._)(this,"containerRef",void 0),(0,n._)(this,"podcastCommentInput",void 0),(0,n._)(this,"podcastPlayer",void 0),(0,n._)(this,"videoPlayer",void 0),(0,n._)(this,"shouldShowRecommendCta",void 0),(0,n._)(this,"_triggerShare",void 0),(0,n._)(this,"onTopReached",e=>{this.state.topReached||this.props.postPreview||(this.setState({topReached:!0}),(0,G.jJ)({post:this.props.post,hasPaywall:e,surface:"publication",markRead:!!this.props.user&&!this.props.noPageView,user:this.props.user,trackerUuid:this.props.getCurrentUuid()}))}),(0,n._)(this,"onTranscriptionClick",()=>{this.setState(e=>({showTranscription:!e.showTranscription}))}),(0,n._)(this,"onCommentButtonClicked",e=>{this.props.showComments&&!this.props.post.comment_count&&(e.stopPropagation(),e.preventDefault(),document.dispatchEvent(new CustomEvent(eU)))});let o={showTranscription:!1,autoPlay:!1,autoPlayVoiceOver:!1,commentSort:null!==(r=e.post.default_comment_sort)&&void 0!==r?r:"best_first",loadedWithHeaderLink:"undefined"!=typeof window&&(null===(i=window.location.hash)||void 0===i?void 0:i.startsWith("#".concat(encodeURIComponent("\xa7")))),reactors:null,feedUrl:null,shouldShowSubscribePrompt:!1,shouldShowFollowPrompt:!1};e.paywall||e.post.hidden||!e.post.body_html||(o.canShowSubscribeFooterAfterPost=eq(e.post.body_html),o.truncated=e.truncateAt?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("undefined"==typeof window)return null;let n=document.createElement("div");if(n.innerHTML=e,null===n.textContent||n.textContent.length<t||n.childNodes.length<=1)return null;do n.removeChild(n.lastChild);while(n.childNodes.length>1&&n.textContent.length>i);return n.innerHTML}(e.post.body_html,e.truncateAt,e.truncateTo):null),"undefined"!=typeof window&&window.history.replaceState&&("true"===(0,eb.x)("autoPlay")&&(window.history.replaceState({},document.title,(0,eg.rhs)({autoPlay:null})),o.autoPlay=!0),"true"===(0,eb.x)("play_audio")&&(window.history.replaceState({},document.title,(0,eg.rhs)({play_audio:null})),o.autoPlayVoiceOver=!0)),this.state=o,this.containerRef=(0,l.createRef)(),this.podcastCommentInput=(0,l.createRef)(),this.podcastPlayer=(0,l.createRef)(),this.videoPlayer=(0,l.createRef)(),this.shouldShowRecommendCta=eM(e.pub,e.user)}}(0,n._)(eF,"contextType",W.WH),(0,n._)(eF,"displayName","Post");let eH=(0,el.dd)((0,H.f9)((0,$.us)((0,V.fz)((0,Y.aG)(eF))))),eW=e=>{let{pub:t}=e,{iTemplate:i}=(0,V.M1)();return(0,s.BX)(s.HY,{children:[(0,s.tZ)(er.iz,{paddingTop:16}),(0,s.BX)(eo.sg,{gap:16,paddingY:32,alignItems:"center",children:[(0,s.BX)(eo.sg,{gap:8,paddingBottom:8,children:[(0,s.tZ)(es.xv.H4,{flex:"grow",align:"center",children:i(eR(),t.name)}),(0,s.tZ)(es.xv.B3,{flex:"grow",align:"center",color:"secondary",children:i(eX())})]}),(0,s.tZ)(en.zx,{priority:"primary",onClick:()=>{(0,G.j)(G.FP.POST_END_CTA_CLICKED,{type:"cross-post"}),(0,ee.uX)((0,eZ.W1P)(t,{params:{utm_source:ey.b3.postEndCta,addBase:!0}}),{local_navigation:!1})},children:i(eO(),t.name)})]})]})},eV=e=>{let{pub:t,post:i,user:n,freeSignup:r,freeSignupEmail:o,overridePledgesEnabled:a}=e,{iString:l,iTemplate:d}=(0,V.M1)(),{getSettingFor:u}=(0,$.So)(),[p,h]=(0,c.eJ)(null),m=(0,eb.x)("just_subscribed"),v="disabled"===t.payments_state&&!t.invite_only&&(u("payment_pledges_enabled")||a),g="enabled"===t.payments_state&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_subscribed)?"paid_upsell":v&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_pledged)?"pledge_upsell":"free_upsell",b=v&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_pledged);(0,c.d4)(()=>{(0,G.j)(G.FP.POST_END_CTA_RENDERED,{pub_id:t.id,post_id:i.id,type:g})},[t.id,i.id,g,b,null==n?void 0:n.is_free_subscribed]);let Z=(0,ef.getByLine)(t);return(0,s.BX)(s.HY,{children:[(0,s.tZ)(er.iz,{paddingTop:16}),(0,s.tZ)(F.Z,{onVisible:()=>{(0,G.j)(G.FP.POST_END_CTA_SEEN,{pub_id:t.id,post_id:i.id,type:g})}}),(0,s.BX)(eo.sg,{gap:16,paddingY:32,children:[(0,s.BX)(eo.sg,{gap:8,paddingBottom:8,children:[(0,s.tZ)(es.xv.H4,{flex:"grow",align:"center",children:d(v&&(null==n?void 0:n.is_free_subscribed)?eD():eA(),t.name)}),(0,s.BX)(es.xv.B3,{flex:"grow",align:"center",color:"secondary",children:[Z?d(eL(),Z):null,Z&&t.rankingDetail?" \xb7 ":null,t.rankingDetail]}),t.hero_text&&(0,s.tZ)(es.xv.B3,{color:"primary",flex:"grow",align:"center",children:t.hero_text})]}),(0,s.tZ)(eo.sg,{alignItems:"center",gap:16,children:b?(0,s.tZ)(en.zx,{priority:"primary",onClick:()=>{(0,G.j)(G.FP.POST_END_CTA_CLICKED,{type:"pledge"}),(0,ee.uX)((0,eZ.W1P)(t,{params:{utm_source:ey.b3.postEndCta}}),{local_navigation:!1})},children:l("Pledge your support")}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(X.Z,{pub:t,post:i,user:n,freeSignup:r,freeSignupEmail:o,isStatic:!1,onPrepareData:()=>{h(null)},source:"post-end-cta",className:ew.Z.subscribeWidget}),p&&(0,s.tZ)(ea.y,{align:"center",children:p}),!(null==n?void 0:n.is_free_subscribed)&&!m&&(0,s.tZ)(eo.sg,{maxWidth:400,children:(0,s.tZ)(ed.O,{includeCheckbox:!1,addSubscribePreamble:!0,color:"secondary",textAlign:"center"})})]})})]})]})},eY=e=>{let{pub:t}=e;return(0,s.BX)("div",{className:"post-silhouette",children:[(0,s.tZ)("div",{className:"post-silhouette-title"}),(0,s.tZ)("div",{className:"post-silhouette-meta ".concat(t&&t.bylines_enabled&&t.byline_images_enabled?"with-byline-image":"")}),(0,s.tZ)("div",{className:"post-silhouette-body"})]})},e$=e=>{var t,i,n,r;let o,{allowEdit:a,allowSendEmail:l,allowTruncate:c,base_url:d,children:p,className:h,hideAudience:m,hideDate:v,hideTitle:b,hidePinning:_,noTitleLink:f,isStatic:y,isFreePreview:w,is_draft:S,onChange:C,post:T,pub:B,reaction_token:E,showComments:R,showDatetime:X,showEmailSent:O,showReactions:D,showShare:A,showAppUpsell:L,showSubtitle:j,showPhoto:U,showLabel:z,showRestack:F,showCommentRestack:H,hideAuthor:W,user:Y,utm_source:$,showUpdatedIcons:G,fromPostPage:q,onClickCommentButton:J,reactors:K,inThreadHead:Q,publishedPost:ee,compEndsSoon:et,compEndedRecently:ei,siteConfigValues:en={},eligibleForTTS:er,showRestackModal:ea,showIcon:el,isOnPostPage:ec,showTranscriptionButton:ed,onTranscriptionClick:eu,isAppMode:eh=!1,republishingPost:eg,autoPlayVoiceOver:eb=!1,readInAppText:eS}=e,{iString:ex}=(0,V.M1)(),eC=(0,e_.tq)({checkFirst4:!0}),eP=eg||T,ek="number"==typeof c?c:45,eN=T.title&&T.title.length>ek,eI=S?T.draft_title:T.title,eT=[(el||"thread"===T.type)&&(0,s.tZ)(I.m,{postType:T.type,isStatic:y,height:15,className:T.type}),eN&&c?(0,ef.truncateWords)(eI,ek):eI],eB=S?T.draft_subtitle:T.subtitle;T.section_id&&B.sections&&B.sections.length&&(T.section=B.sections.find(e=>e.id===T.section_id));let eE=(0,ev.B9)({pub:B,subscriptionType:null==Y?void 0:Y.subscription_type}),eR=!["page"].includes(null==T?void 0:T.type),eX=eR&&y&&et&&!eE&&(null==en?void 0:en.continue_support_cta_in_newsletter_emails),eO=eK(T)||er||T.voiceoverUpload,eD=(null==T?void 0:T.type)==="adhoc_email",eA=eR&&y&&!eD&&!eh,eL=(0,em.HD)({pub:B})&&(!!T.postTheme||["video","podcast"].includes(T.type)&&Q);o=T.post_url_override?T.post_url_override:y&&eh?ep.W.POST_TITLE_APP_MODE_URL:y?ep.W.POST_TITLE_URL:"".concat((0,eZ.uRy)(B,T)).concat($?"?utm_source=".concat($):"");let ej="".concat(B.base_url+(eP.section?(0,eZ.Ucy)(B,{section:eP.section}):""),"/?utm_source=").concat(ey.b3.substack,"&utm_medium=").concat(ey.lP.menu);return eL?(0,s.tZ)(M.I,{post:T,postTheme:T.postTheme,title:eI,subtitle:eB,pub:B,inThreadHead:!!Q,autoPlayVoiceOver:eb}):(0,s.BX)("div",{className:u()("post-header",h),role:"region","aria-label":ex("Post header"),children:[(0,em.kb)({pub:B})&&(null!==(r=null===(t=T.postTags)||void 0===t?void 0:t.length)&&void 0!==r?r:0)>0&&(0,s.tZ)(eo.X2,{alignItems:"center",gap:4,paddingBottom:8,children:null===(i=T.postTags)||void 0===i?void 0:i.map((e,t)=>(0,s.BX)(s.HY,{children:[0!==t&&(0,s.tZ)(es.xv.Meta,{children:"—"}),(0,s.tZ)(es.xv.Meta,{as:"a",size:14,href:(0,eZ.Mk9)(B,e),children:e.name})]}))}),z&&T.section&&(0,s.tZ)(eo.X2,{className:"post-label",children:(0,s.tZ)(es.xv.Meta,{as:"a",size:14,href:ej,children:null===(n=eP.section)||void 0===n?void 0:n.name})}),eX&&(0,s.tZ)(Z.v,{post:T,compAlreadyExpired:ei}),!b&&(0,s.tZ)("h1",{className:u()("post-title",T.is_published?"published":"restack"!==T.type||eg?"adhoc_email"===T.type?"adhoc":"unpublished":"email-only-cross-post",{"post-title--the-pillar":(0,em.kb)({pub:B})},ew.Z.title),dir:"auto",children:f?eT:(0,s.tZ)("a",{href:o,children:eT})}),j&&eB&&(0,s.tZ)("h3",{className:u()("subtitle",{"subtitle--the-pillar":(0,em.kb)({pub:B})},ew.Z.subtitle),dir:"auto",children:eB}),"page"===T.type?(0,s.tZ)("div",{style:{height:32}}):ec&&!y?(0,s.BX)(eo.sg,{paddingBottom:16,"aria-label":ex("Post UFI"),role:"region",children:[(0,s.tZ)(eo.sg,{paddingY:16,children:(0,s.tZ)(N.E,{post:T,pub:B})}),(0,s.tZ)(g.j,{user:Y,isMobile:eC,post:T}),eC?q&&(0,s.tZ)(k.mt,{post:T,pub:B,user:Y,isStatic:!!y,postReactionToken:E,onChange:C,allowEdit:a,hidePinning:_,showEmailSent:O,allowSendEmail:l,hideComments:!R,onCommentsClick:J,showRestackModal:ea}):(0,s.tZ)(k.Mp,{post:T,pub:B,user:Y,onChange:C,showRestackModal:ea,showTranscriptionButton:ed,onTranscriptionClick:eu,showClipping:"video"===T.type,postReactionToken:E})]}):(0,s.BX)(s.HY,{children:[!eR||y||ee||Q?eR&&!y&&ee?(0,s.tZ)(k._2,{post:T,pub:B,user:Y,style:"compressed",labelStyle:"counts-or-none",postReactionToken:E,showEmailSent:O,hideShare:!A||"restack"===T.type,hideComments:"restack"===T.type,hideSavePost:"restack"===T.type,hideReactions:"restack"===T.type,showPreamble:!0,onChange:void 0,allowEdit:a,allowSendEmail:l,editButtonIsLast:!0,preambleConfig:{showAudience:!m,showDate:!v,showDatetime:X,showAuthor:!W},isStatic:y,position:"publisher-post-list"}):Q&&!y?(0,s.tZ)(k._2,{post:T,pub:B,user:Y,style:"compressed",labelStyle:"counts-or-none",postReactionToken:E,hideSavePost:!0,showPreamble:!0,allowEdit:a,allowSendEmail:l,editButtonIsLast:!0,onChange:C,preambleConfig:{showAudience:!m,showDate:!v,showDatetime:X,showAuthor:!W},hideShare:!A,position:"publisher-post-list",isStatic:y}):eR?(0,s.tZ)(x.SP,{user:Y,pub:B,post:T,showDate:!v,showDatetime:X,showEmailSent:O,showAudience:!m,showReactions:!eA&&D,showComments:!eA&&R,showShare:!eA&&A,showRestack:!eA&&F,reaction_token:E,onChange:C,isStatic:y,isFreePreview:w,sharedShareDialog:!0,base_url:d,allowSendEmail:l,allowEdit:a,showAuthor:!W,showPhoto:U,hidePinning:_,showUpdatedIcons:G,inThreadHead:Q,fromPostPage:q,onClickCommentButton:J,reactors:K,isAppMode:eh}):(0,s.tZ)("div",{className:"spacer",style:{height:24}}):(0,s.tZ)(P.a,{className:"meta-subheader",pub:B,post:T,user:Y,showDate:!v,showDatetime:!!X,isStatic:!!y,postReactionToken:E,onChange:C,allowEdit:a,hidePinning:_,showEmailSent:O,allowSendEmail:l,allowMobileFooter:q,onCommentsClick:J,showRestackModal:ea}),eR&&eA&&(0,s.tZ)(k.yT,{readInAppText:eS,customization:{showShare:A,showComments:R,showReactions:D,showListen:!F&&!w&&!!eO,showSave:!F,showRestack:F,showCommentRestack:H,showAppUpsell:L}}),eD&&(0,s.tZ)("div",{className:"email-ufi-2-empty"})]}),p]})},eG=e=>{let{user:t,post:i}=e,{iString:n,iTemplate:r}=(0,V.M1)(),o=(0,ef.getBylineUsers)(i).filter(e=>e.is_guest);return 0===o.length?null:(0,s.BX)("div",{className:"post-contributor-footer",children:[(0,s.tZ)("div",{className:"container-border"}),o.map(e=>{let i=(0,ef.guessFirstName)(e.name),o=e.primaryPublicationSubscribeUrl;o&&(null==t?void 0:t.email)&&(o=(0,eg.rhs)(o,{email:t.email,autoSubmit:!0,utm_source:ey.b3.substack,utm_campaign:ey.VX.guestPostBio,utm_medium:ey.lP.web}));let a=(0,eg.rhs)((0,eZ.NNq)(e),{utm_campaign:ey.VX.guestPostBio,utm_medium:ey.lP.web}),l=!!e.photo_url;return(0,s.tZ)("div",{className:u()("post-contributor-bio",{"post-contributor-bio-no-text":!e.bio}),"data-user-id":e.id,children:(0,s.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-table",children:(0,s.BX)("tr",{className:"post-contributor-bio-table-row",children:[l&&(0,s.tZ)("td",{className:"post-contributor-bio-userhead-cell post-contributor-bio-userhead-cell-web",children:(0,s.tZ)(ei.xV,{size:52,user:e,utmSource:"byline"})}),(0,s.tZ)("td",{className:"post-contributor-bio-body-cell post-contributor-bio-body-cell-web",children:(0,s.BX)("div",{className:"post-contributor-bio-body",children:[e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-preamble",children:n("A guest post by")}),(0,s.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-body-table",children:(0,s.BX)("tr",{className:"post-contributor-bio-body-table-row",children:[(0,s.BX)("td",{className:"post-contributor-bio-copy-cell",children:[!e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-preamble",children:n("A guest post by")}),(0,s.BX)(eo.X2,{gap:4,alignItems:"center",paddingBottom:4,children:[(0,s.tZ)(T.ProfileHoverCard,{subject:e,utmSource:"byline",children:(0,s.tZ)("a",{className:"post-contributor-bio-title no-margin",href:a,native:!0,children:e.name})}),(0,s.tZ)(eu.UserBadge,{size:"sm",tier:e.bestseller_tier,userId:e.id})]}),e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-text",children:e.bio})]}),(0,s.tZ)("td",{className:"post-contributor-bio-controls-cell post-contributor-bio-controls-cell-web",children:(0,s.tZ)("div",{className:"post-contributor-bio-controls",children:o&&(0,s.tZ)("a",{className:"post-contributor-bio-subscribe-button button primary",href:o,native:!0,children:(0,s.tZ)("span",{className:"post-contributor-bio-subscribe-button-label",children:r(ej(),i)})})})})]})})]})})]})})})})]})};function eq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if("undefined"==typeof window)return!1;let i=document.createElement("div");i.innerHTML=e;let n="",r=!1;for(let e=i.childNodes.length-1;e>=0;e--){let o=i.childNodes[e];if(o){if((0,ee.pv)(o,"button-wrapper")||(0,ee.pv)(o,"subscription-widget-wrap")||(0,ee.pv)(o,"subscribe-widget")){r=!0;break}if((n+=o.textContent).length>t)break}}return!r}function eJ(e){let{post:t,user:i,onChange:n}=e,[a,l]=(0,c.eJ)(!1),{getExperimentVariant:d}=(0,H.jc)(),u="treatment"===d("video_email_watch_later_experiment"),{onSave:p}=(0,k.vk)({post:t,isSaved:!1});return((0,c.d4)(()=>{if("save"===new URL(location).searchParams.get("action")&&(history.replaceState({},"",(0,eg.rhs)({action:null})),i)){let e=p();n({post:(0,o._)((0,r._)({},t),{is_saved:e})}),e&&u&&l(!0)}},[]),a)?(0,s.tZ)(et.X,{onClose:()=>l(!1)}):null}function eK(e){var t;return!!(null===(t=e.audio_items)||void 0===t?void 0:t.some(e=>"tts"===e.type))}function eQ(e){var t;return!!(null===(t=e.audio_items)||void 0===t?void 0:t.some(e=>"tts"===e.type&&"paywalled"===e.status))}let e0=()=>(0,s.tZ)("article",{className:u()("typography post",{"shows-post":!1}),children:(0,s.tZ)("div",{className:"container tw-p-12",children:(0,s.tZ)("p",{align:"center",children:(0,s.tZ)(es.xv,{translated:!0,as:"span",children:"This content has been withheld in your country in response to a legal requirement."})})})})},8845:function(e,t,i){i.d(t,{C:()=>c,T:()=>l});var n=i(16584),r=i(6400),o=i(30396),a=i(6070);let s=(0,r.createContext)({theme:null,setTheme:()=>void 0}),l=()=>(0,o.qp)(s),c=e=>{var t;let{pub:i,post:r,children:l}=e,[c,d]=(0,o.eJ)(null!==(t=null==r?void 0:r.postTheme)&&void 0!==t?t:null);return(0,a.HD)({pub:i})?(0,n.tZ)(s.Provider,{value:{theme:c,setTheme:d},children:l}):(0,n.tZ)(n.HY,{children:l})}},96904:function(e,t,i){i.d(t,{G:()=>h});var n=i(58865),r=i(16584),o=i(13025),a=i(95441),s=i(68833),l=i(15771),c=i(6490),d=i(98248);function u(){let e=(0,n._)(["Generating ","..."]);return u=function(){return e},e}function p(){let e=(0,n._)(["Shareable ",""]);return p=function(){return e},e}function h(e){let{isOpen:t,onClose:i,isGenerating:n,finishedGram:h,noun:m,postId:v,onDownload:g}=e,{iString:b,iTemplate:Z}=(0,a.M1)();return(0,r.BX)(c.u_,{isOpen:t,onClose:i,children:[(0,r.tZ)(c.xB,{title:Z(n?u():p(),m),showClose:!0,showDivider:!0,onClose:i}),(0,r.tZ)(c.fe,{children:h?(0,r.tZ)("video",{src:h.cdn_url,style:{borderRadius:12},controls:!0,download:!0,width:400}):(0,r.tZ)(d.$j,{alignItems:"center",justifyContent:"center",minHeight:220})}),h&&(0,r.tZ)(c.mz,{direction:"column",primaryButton:(0,r.tZ)(l.zx,{priority:"primary",leading:(0,r.tZ)(o.Z,{size:20}),onClick:()=>{(0,s.j)(s.FP.AUDIOGRAM_DOWNLOAD_CLICKED,{post_id:v,audiogram_id:null==h?void 0:h.id,media_upload_id:null==h?void 0:h.media_upload_id}),g(h.cdn_url)},children:b("Download")})})]})}},78118:function(e,t,i){i.r(t),i.d(t,{ReaderOnboardingModal:()=>N,ReaderOnboardingModalWithUserContext:()=>I});var n=i(27412),r=i(7409),o=i(99282),a=i(98848),s=i(16584),l=i(98661),c=i(93666),d=i(57391),u=i(60807),p=i(68833),h=i(341),m=i(57601),v=i(64799),g=i(14861),b=i(4564),Z=i(45930),_=i(76971),f=i(48146),y=i(48450),w=i(7759),S=i(29191),x=i(76560),C=i(60308),P=i(63651),k=i(81821);class N extends c.p{componentDidMount(){super.componentDidMount(),(0,k.tq)()&&(this.context.exposeExperiment("reader_onboarding_app_first"),this.inAppExperimentTreatment())}componentWillReceiveProps(e){this.setState({skipRedirectOnExit:e.skipRedirectOnExit,zIndex:e.zIndex,entry:e.entry,onBeforeClose:e.onBeforeClose})}getDefaultStep(){return this.state.appOnboardingTreatment?x.c.APP_UPSELL:x.c.CATEGORIES}inAppExperimentTreatment(){if(this.state.appOnboardingTreatment)return this.state.appOnboardingTreatment;let e=(0,k.tq)()&&["treatment","treatment_no_skip"].includes(this.context.getExperimentVariant("reader_onboarding_app_first"));return e&&this.setState({step:x.c.APP_UPSELL,appOnboardingTreatment:!0}),e}openForPub(e,t){this.setState({pub:e,profile:t,step:t?this.props.user?x.c.CATEGORIES:x.c.PUB_SIGNUP:x.c.PUB_LANDING}),this.open()}openToPubSignup(e){this.setState({pub:e,step:x.c.PUB_SIGNUP,profile:null}),this.open()}setStep(e){if(e===x.c.APP_UPSELL&&this.state.appOnboardingTreatment&&this.state.previousStepData[x.c.APP_UPSELL]&&(e=x.c.WELCOME),(0,p.j)(p.FP.READER_ONBOARDING_STEP_CHANGED,{from_step:this.state.step,to_step:e,modal:!0}),e===x.c.EXIT){if(this.state.skipRedirectOnExit)this.close();else{var t;let e=null!==(t=this.redirect)&&void 0!==t?t:this.state.pub&&"reader2"===this.state.entry?(0,C.SVA)(this.state.pub):(0,P.E2n)();document.location.href=e}}else setTimeout(()=>this.setState({step:e}),0)}setPreviousStepData(e,t){this.setState({previousStepData:(0,o._)((0,r._)({},this.state.previousStepData),{[e]:t})})}getClassName(){return"reader-onboarding-modal wide"}onClose(){(0,p.j)(p.FP.READER_ONBOARDING_MODAL_CLOSED,{entry:this.props.entry,step:this.state.step}),this.setStep(this.getDefaultStep())}onOpen(){var e;(0,p.j)(p.FP.READER_ONBOARDING_MODAL_OPENED,{entry:this.props.entry,step:this.state.step,for_pub_id:null===(e=this.state.pub)||void 0===e?void 0:e.id})}handleError(e){let{ignore:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{step:i}=this.state;console.error("Error in reader onboarding ".concat(i," step: ").concat(e)),(0,p.j)(p.FP.READER_ONBOARDING_ERROR,{step:i,entry:this.props.entry,ignore:t}),t||this.setStep(x.c.ERROR)}renderStep(){let e=this.props,{ref:t}=e,i=(0,a._)(e,["ref"]),{step:n,open:l,pub:c,profile:d,previousStepData:u,appOnboardingTreatment:p}=this.state,C={setStep:this.setStep,handleError:this.handleError,close:this.close,setPreviousStepData:this.setPreviousStepData,appOnboardingTreatment:p};if(!l)return null;switch(n){case x.c.SIGNUP:return(0,s.tZ)(y.Z,(0,o._)((0,r._)({},i,C),{previousStepData:u}));case x.c.PUB_LANDING:return(0,s.tZ)(_.Z,(0,o._)((0,r._)({},i,C),{pub:c}));case x.c.PUB_SIGNUP:return(0,s.tZ)(f.Z,(0,o._)((0,r._)({},i,C),{pub:c,profile:null!=d?d:null}));case x.c.CATEGORIES:return(0,s.tZ)(b.r,(0,o._)((0,r._)({},i,C),{pub:c}));case x.c.PROFILE:return(0,s.tZ)(Z.Z,(0,r._)({},i,C));case x.c.START_WRITING:return(0,s.tZ)(w.Z,(0,r._)({},i,C));case x.c.CREATE_PUBLICATION:return(0,s.tZ)(m.Z,(0,r._)({},i,C));case x.c.CREATE_PUBLICATION_SUCCESS:return(0,s.tZ)(v.Z,(0,o._)((0,r._)({},i,C),{previousStepData:u}));case x.c.ERROR:return(0,s.tZ)(g.Z,(0,r._)({},i,C));case x.c.APP_UPSELL:return(0,s.tZ)(h.Z,{onComplete:()=>{this.setPreviousStepData(x.c.APP_UPSELL,!0),p?this.setStep(x.c.CATEGORIES):this.setStep(x.c.WELCOME)}});case x.c.WELCOME:default:return(0,s.tZ)(S.Z,(0,o._)((0,r._)({},i,C),{pub:c,profile:null!=d?d:null}))}}renderChildren(){return(0,s.tZ)("div",{className:"reader-onboarding-modal-container",children:this.renderStep()})}constructor(e,t){var i;super(e,t),(0,n._)(this,"redirect",void 0),this.setStep=this.setStep.bind(this),this.state.pub=e.pub||null,this.handleError=this.handleError.bind(this),this.state.previousStepData={},this.setPreviousStepData=this.setPreviousStepData.bind(this),this.state.skipRedirectOnExit=null!==(i=e.skipRedirectOnExit)&&void 0!==i&&i,this.redirect=e.redirect&&"/"!==e.redirect?e.redirect:null,this.state.appOnboardingTreatment=!1,this.state.step=e.step||this.getDefaultStep()}}(0,n._)(N,"contextType",d.kx);let I=(0,l.forwardRef)((e,t)=>{let i=(0,u.SE)(),n=e.onBeforeClose,a=n?()=>n(i.user):void 0,l=(0,o._)((0,r._)({},e),{onBeforeClose:a,user:i.user});return(0,s.tZ)(N,(0,o._)((0,r._)({},l),{ref:t}))})},90565:function(e,t,i){i(16584),i(30396),i(94184),i(95441),i(9682),i(80026),i(69891),i(58175),i(74949),i(83010),i(50312),i(60308)},547:function(e,t,i){i(16584),i(6400),i(30396),i(94184),i(39693),i(83034),i(20160),i(30356),i(4473),i(94442),i(57391),i(35543),i(95441),i(40647),i(60807),i(6246),i(69181),i(68833),i(98750),i(98914),i(94874),i(24547),i(71068),i(15771),i(17352),i(61254),i(19081),i(84370),i(10510),i(58175),i(91021),i(45783),i(3573),i(7882),i(81043),i(65575),i(17106),i(91400),i(33555),i(63651)},80602:function(e,t,i){i(16584),i(83034),i(95441),i(68833),i(15771),i(19081)},3573:function(e,t,i){i(16584),i(30396),i(94184),i(78718),i(98585),i(9682),i(80026),i(91400),i(60308)},19801:function(e,t,i){i.d(t,{JP:()=>et,Zg:()=>eu,hB:()=>ei,nK:()=>F});var n=i(7409);if(/^(3154|6909)$/.test(i.j))var r=i(99282);var o=i(98848),a=i(16584),s=i(98661),l=i(30396),c=i(94184),d=i.n(c);if(/^(3154|6909)$/.test(i.j))var u=i(57420);if(/^(3154|6909)$/.test(i.j))var p=i(20816);if(/^(3154|6909)$/.test(i.j))var h=i(2032);if(/^(3154|6909)$/.test(i.j))var m=i(56841);if(/^(3154|6909)$/.test(i.j))var v=i(71787);var g=i(1548),b=i(41069),Z=i(29176),_=i(31548),f=i(13774);i(4168);var y=i(94442),w=i(60807),S=i(81914),x=i(68833),C=i(11792),P=i(98750),k=i(98914),N=i(10656),I=i(15771),T=i(19081),B=i(10510),E=i(58175),R=i(65575),X=i(26960),O=i(31541),D=i(91400),A=i(64172),L=i(33555);if(/^(3154|6909)$/.test(i.j))var j=i(93903);var U=i(60308),M=i(84864),z=i(81352);function F(e){var t,{post:i,pub:s,openInPostViewer:l,canonicalUrl:c}=e,d=(0,o._)(e,["post","pub","openInPostViewer","canonicalUrl"]);let u=!!(0,w.aF)(),{subscription:p}=(0,A.p6)(s.id);return(0,a.tZ)(H,(0,r._)((0,n._)({},d),{post:i,postId:i.id,title:i.title,description:(0,j.Z)(i.description),bylines:i.publishedBylines,consumptionTime:et(i),coverImage:i.cover_image,type:(0,N.z_)(i),Icon:"podcast"===(t=(0,N.z_)(i))?Z.f:"video"===t?f.O:"thread"===t?_.o:null,canonicalUrl:null!=c?c:(0,U.uRy)(s,i,{signedIn:u}),noNewTab:l,timestamp:i.post_date,pub:s,audienceBadge:["only_paid","founding"].includes(i.audience)?(null==p?void 0:p.membership_state)==="free_signup"&&i.should_send_free_preview?"preview":"founding"===i.audience?"founding":"paid":void 0}))}function H(e){var{post:t,bylines:i,consumptionTime:s,Icon:l,audienceBadge:c,showBestsellerBadge:d,highlights:u,excerpt:p,noNewTab:h,showLoginPrompt:m}=e,v=(0,o._)(e,["post","bylines","consumptionTime","Icon","audienceBadge","showBestsellerBadge","highlights","excerpt","noNewTab","showLoginPrompt"]);return(0,a.BX)(W,(0,r._)((0,n._)({},v),{highlights:u,noNewTab:h,children:[m&&(0,a.tZ)(S._Q,{version:"login"}),(0,a.tZ)(J,{post:t,bylines:i,consumptionTime:s,Icon:l,audienceBadge:c,showBestsellerBadge:d,highlights:u,excerpt:p})]}))}function W(e){let{children:t,pub:i,publisherName:n,logoUrl:r,timestamp:o,isViewed:s,isArchived:c,isSelected:u,isLiked:p,isSaved:h,onLike:m,onClick:v,canonicalUrl:g,postId:b,defaultSaved:Z,onSave:_,onArchive:f,onMouseEnter:y,onVisible:S,utmSource:x,highlights:C,noNewTab:N}=e,I=(0,w.aF)(),[B,E]=(0,O.r8)(!s),R=(0,k.K1)(),X=(0,l.sO)();return(0,P.UM)(X,()=>S&&S(),{threshold:.2}),(0,a.BX)(Y,{ref:X,href:g,onClick:e=>{E(),v&&v(e)},className:"reader2-post-container",utmSource:x,isSelected:u,onMouseMove:()=>{null==y||y(b)},noNewTab:N,children:[(0,a.tZ)($,{pub:i,publisherName:n,logoUrl:r,highlights:C,children:(0,a.BX)(T.X2,{gap:12,alignItems:"center",className:d()("reader2-post-info",I&&"hasUser"),children:[(0,a.tZ)(G,{className:"inbox-item-timestamp",value:o}),(0,a.tZ)(V,{isMobile:R,postId:b,defaultSaved:Z,isSaved:h,isArchived:c,onSave:_,user:I,onArchive:f,isLiked:p,onLike:m,canonicalUrl:g,communityEnabled:null==i?void 0:i.community_enabled}),B]})}),t]})}function V(e){let{isMobile:t,postId:i,defaultSaved:n,isLiked:r,onLike:o,isSaved:s,onSave:l,user:c,isArchived:u,onArchive:p,canonicalUrl:h,communityEnabled:m}=e,{isSaved:v,onSave:g}=(0,y.nA)({postId:i,defaultSaved:n}),b=()=>{null==p||p()},Z=(0,C.g)();return t?null:(0,a.BX)(T.hs,{padding:4,gap:4,position:"absolute",className:d()("inbox-item-actions-menu",z.Z.actionMenu),onClick:e=>{e.stopPropagation(),e.preventDefault()},radius:"md",border:"detail",bg:"primary",children:[o&&m&&(0,a.tZ)(I.zx,{size:"sm",priority:"tertiary",onClick:()=>o(i),children:(0,a.tZ)(ea,{isActive:r})}),(0,a.tZ)(I.zx,{size:"sm",priority:"tertiary",onClick:()=>Z(h),children:(0,a.tZ)(ed,{})}),c&&(0,a.tZ)(I.zx,{size:"sm",priority:"tertiary",onClick:()=>{l?l(i,!v):g()},children:(0,a.tZ)(es,{isActive:null!=s?s:v})}),p&&(u?(0,a.tZ)(I.zx,{size:"sm",priority:"tertiary",onClick:b,children:(0,a.tZ)(ec,{})}):(0,a.tZ)(I.zx,{size:"sm",priority:"tertiary",onClick:b,children:(0,a.tZ)(el,{})}))]})}let Y=(0,s.forwardRef)((e,t)=>{var{noNewTab:i}=e,r=(0,o._)(e,["noNewTab"]);return(0,a.tZ)(R.Uj,(0,n._)({ref:t,linkClassName:d()("reader2-inbox-post",null==r.isSelected&&"hover-action-menu",z.Z.inboxItem),native:!0,isPadded:!1,newTab:!i},r))});function $(e){let{pub:t,logoUrl:i,publisherName:n,children:r,highlights:o={}}=e;return(0,a.BX)("div",{className:"reader2-post-head reader2-text-meta",children:[(t||i)&&(0,a.tZ)(B.wk,{pub:t,logoUrl:i,publicationName:n,size:20,radius:"xs"}),(0,a.tZ)("div",{className:"pub-name",children:n||t&&(0,a.tZ)(R.zr,{href:t.base_url,onClick:e=>e.stopPropagation(),children:(0,X.L)(t.name,o["publication.name"])})}),r]})}function G(e){let{value:t,className:i}=e;return(0,a.tZ)(E.xv.Meta,{className:i,nowrap:!0,children:(0,k.Po)(t)})}function q(e){let{post:t,image:i,metaText:n,highlights:r={},excerpt:o}=e;return(0,a.BX)("div",{className:"reader2-post-body",onClick:()=>{var e;let i=(null===(e=window)||void 0===e?void 0:e.location)&&new URL(window.location.href);i&&(0,x.j)(x.FP.POST_SEARCH_RESULT_CLICKED,{post_id:t.id,query:decodeURIComponent(i.pathname.replace(/\/search\//g,""))})},children:[(0,a.BX)(R.tu,{minWidth:0,gap:8,children:[(0,a.tZ)("div",{className:"reader2-post-title reader2-clamp-lines",children:(0,X.L)(t.title,r.title||r["posts.title"],"heavy")}),t.description&&(0,a.tZ)(R.nv,{variant:"secondary",isConstrained:!o,children:o?(0,a.BX)(E.xv,{as:"span",fontStyle:"italic",children:["“...",(0,X.L)(o,r.body_text,"heavy"),"”"]}):(0,X.L)((0,j.Z)(t.description),r.subtitle||r["posts.subtitle"],"heavy")}),n]}),i]})}function J(e){let{bylines:t,consumptionTime:i,Icon:n,audienceBadge:r,showBestsellerBadge:o,post:s,highlights:l,excerpt:c}=e;return(0,a.tZ)(q,{post:s,metaText:(0,a.tZ)(K,{bylines:t,consumptionTime:i,Icon:n,audienceBadge:r,showBestsellerBadge:o,highlights:l}),image:s.cover_image&&(0,a.tZ)(eo,{post:s}),highlights:l,excerpt:c})}function K(e){let{bylines:t,consumptionTime:i,Icon:n,audienceBadge:r,showBestsellerBadge:o,highlights:s={}}=e;return(0,a.BX)(R.SC,{children:[r&&(0,a.BX)(a.HY,{children:[(0,a.tZ)("span",{className:"meta-audience-badge",children:r}),(0,a.tZ)(ee,{})]}),t.length>0?(0,a.BX)(a.HY,{children:[(0,a.tZ)(g.M,{array:t,limit:3,formatter:e=>o?(0,a.tZ)(Q,{name:e.name||"",tier:e.bestseller_tier,userId:e.id}):(0,X.L)(e.name||"",s["publication.author_name"])}),i&&(0,a.tZ)(ee,{})]}):null,n&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(n,{className:"meta-icon"})," "]}),i]})}let Q=e=>{let{name:t,tier:i,userId:n}=e;return i?(0,a.BX)(R.gq,{inline:!0,gap:4,alignItems:"center",children:[t," ",(0,a.tZ)(L.UserBadge,{userId:n,tier:i,size:"sm"})]}):(0,a.tZ)(a.HY,{children:t})},ee=()=>(0,a.tZ)("span",{className:"meta-bullet",children:"∙"});function et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"md",{minutes:i,action:n}=en(e);if(null===n)return"";let r=er(i,t);return"".concat(r," ").concat(n)}function ei(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"md",{minutes:n,action:r}=en(e);if(null===r)return"";let o=er(Math.max(Math.round(n*(1-t)),1),i);return"".concat(o," left")}function en(e){let t;let{comment_count:i,podcast_duration:n,wordcount:r,videoUpload:o}=e,a=null,s=(0,N.z_)(e);if(o&&o.duration&&o.duration>0)t=o.duration/60,a="watch";else if("podcast"===s)t=n/60,a="listen";else{if("thread"===s)return{minutes:0,action:i>0?"".concat(i.toLocaleString()," replies"):"Thread"};if(null==r||!(r>0))return{minutes:0,action:null};t=r/M.READ_WORDS_PER_MINUTE,a="read"}return{minutes:Math.max(Math.round(t),1),action:a}}function er(e,t){if(0===e||!e)return"";let i=Math.floor(e/60),n=e%60;switch(t){case"lg":return i>0?"".concat(i.toLocaleString()," hours ").concat(n>0?"".concat(n.toLocaleString()," minutes"):""):"".concat(n.toLocaleString()," minutes");case"sm":return i>0?"".concat(i.toLocaleString(),"h ").concat(n>0?"".concat(n.toLocaleString(),"m"):""):"".concat(n.toLocaleString(),"m");default:return i>0?"".concat(i.toLocaleString()," hr ").concat(n>0?"".concat(n.toLocaleString()," min"):""):"".concat(n.toLocaleString()," min")}}function eo(e){let{post:t,size:i=132,square:n,className:r}=e,o=t.cover_image,s=(0,N.z_)(t),c="podcast"===s||n?i:200,[u,p]=(0,l.eJ)(null);return u?null:(0,a.BX)("div",{className:d()("reader2-post-picture-container",r),children:[(0,a.tZ)(R.t5,{className:d()("reader2-post-picture",s),src:o,width:c,height:i,loading:"lazy",noStyle:!n,onError:e=>p(e)}),("podcast"===s||"video"===s)&&(0,a.tZ)("div",{className:"reader2-picture-overlay",children:(0,a.tZ)(b.x,{className:"picture-play"})})]})}function ea(e){let{isActive:t}=e;return(0,a.tZ)(u.Z,{className:t?z.Z.activeLike:"",size:20})}function es(e){let{isActive:t}=e;return(0,a.tZ)(p.Z,{className:t?z.Z.activeSave:"",size:20})}function el(){return(0,a.tZ)(h.Z,{size:20})}function ec(){return(0,a.tZ)(m.Z,{size:20})}function ed(){return(0,a.tZ)(v.Z,{size:20})}function eu(){return(0,a.tZ)(a.HY,{children:Array(6).fill(0).map((e,t)=>(0,a.tZ)(ep,{},t))})}function ep(){let e=(0,D.XA)();return(0,a.tZ)(R.Uj,{isPadded:!1,children:(0,a.BX)(R.tu,{flex:"grow",gap:12,padding:e?8:12,children:[(0,a.BX)(T.X2,{gap:12,justifyContent:"space-between",alignItems:"center",children:[(0,a.BX)(T.X2,{gap:12,alignItems:"center",flex:"grow",children:[(0,a.tZ)(R.Vm,{size:24,style:{borderRadius:6}}),(0,a.tZ)(R.Vm,{type:"bar",maxWidth:120,flex:"grow"})]}),(0,a.tZ)(R.Vm,{type:"bar",maxWidth:80,flex:"grow"})]}),(0,a.BX)("div",{className:"reader2-post-body",children:[(0,a.BX)(R.tu,{minWidth:0,gap:4,children:[(0,a.tZ)(R.Vm,{type:"bar",width:"70%"}),(0,a.tZ)(R.Vm,{type:"bar",width:"80%"}),(0,a.tZ)(R.Vm,{type:"bar",width:"50%"})]}),(0,a.tZ)(R.Vm,{width:e?64:160,height:e?64:120,style:{borderRadius:6}})]})]})})}},5623:function(e,t,i){i.d(t,{R5:()=>eN});var n=i(7409),r=i(99282),o=i(98848);if(/^(3154|6909)$/.test(i.j))var a=i(58865);var s=i(16584),l=i(98661),c=i(30396),d=i(94184),u=i.n(d);if(/^(3154|6909)$/.test(i.j))var p=i(9589);if(/^(3154|6909)$/.test(i.j))var h=i(84979);if(/^(3154|6909)$/.test(i.j))var m=i(8971);if(/^(3154|6909)$/.test(i.j))var v=i(41352);if(/^(3154|6909)$/.test(i.j))var g=i(57420);if(/^(3154|6909)$/.test(i.j))var b=i(5097);if(/^(3154|6909)$/.test(i.j))var Z=i(25256);if(/^(3154|6909)$/.test(i.j))var _=i(20816);if(/^(3154|6909)$/.test(i.j))var f=i(9404);if(/^(3154|6909)$/.test(i.j))var y=i(71787);if(/^(3154|6909)$/.test(i.j))var w=i(12795);if(/^(3154|6909)$/.test(i.j))var S=i(56179);if(/^(3154|6909)$/.test(i.j))var x=i(49482);if(/^(3154|6909)$/.test(i.j))var C=i(23203);if(/^(3154|6909)$/.test(i.j))var P=i(56841);if(/^(3154|6909)$/.test(i.j))var k=i(2032);if(/^(3154|6909)$/.test(i.j))var N=i(22448);if(/^(3154|6909)$/.test(i.j))var I=i(73510);var T=i(61649),B=i(59708),E=i(51455),R=i(50137),X=i(2689),O=i(9970),D=i(26582),A=i(51534),L=i(56219),j=i(94442),U=i(67203),M=i(10878),z=i(75697),F=i(9721),H=i(72392),W=i(95441),V=i(93155),Y=i(40647),$=i(60807),G=i(6246),q=i(68833),J=i(48980),K=i(7882),Q=i(21599);i(9682);var ee=i(32129),et=i(94874),ei=i(15771),en=i(19081),er=i(84370),eo=i(99916),ea=i(98248),es=i(10510),el=i(58175),ec=i(70379),ed=i(87077),eu=i(40949),ep=i(74312),eh=i(81043),em=i(65575),ev=i(44312),eg=i(32189),eb=i(39493),eZ=i(61412),e_=i(91400),ef=i(64172),ey=i(60308),ew=i(63651),eS=i(84864);if(/^(3154|6909)$/.test(i.j))var ex=i(47929);var eC=i(78691);function eP(){let e=(0,a._)(["You subscribed to "," by "," because it was recommended by ","."]);return eP=function(){return e},e}function ek(){let e=(0,a._)(["You subscribed to "," because it was recommended by ","."]);return ek=function(){return e},e}function eN(e){var t;let i=(0,eh.SJ)();return(0,c.d4)(()=>()=>{var e;null===(e=i.setDrawer)||void 0===e||e.call(i,null)},[]),i.setDrawer&&null!==(t=i.setDrawer((0,s.tZ)(eT,(0,n._)({},e))))&&void 0!==t?t:null}function eI(e){var t,i,o,a,l,d,g,b,Z,_,f,y,w;let S,{postId:x,post:C,publication:P,videoPlayerRef:k,onClose:N,onPrevious:I,onNext:T,onSave:E,onArchive:R,onLike:j,onLoad:U,isArchived:F,publicationSettings:V,referringRecommendation:Y,referringPub:G}=e,[ee,eo]=(0,c.eJ)(!1),[ep,eb]=(0,c.eJ)(!1),eZ=(0,ef.Th)(),ey=(0,eg.x)({surface:"post-viewer"}),eN=(0,$.aF)(),eI=(0,e_.XA)(),eT=(0,ec.pm)(),{iString:eE,iTemplate:eO}=(0,W.M1)(),eL=(0,c.sO)(null);(0,c.d4)(()=>{(0,q.j)(q.FP.POST_VIEWER_VIEWED,{post_id:x})},[x]);let ej=(0,eu.y)(),eU=(0,c.I4)(()=>{(0,q.j)(q.FP.POST_VIEWER_CLOSED,{post_id:x}),N()},[N,x]),eM=R&&(e=>{(0,q.j)(q.FP.POST_ARCHIVED,{post_id:e,surface:"post viewer"}),R(e)});C&&P&&V&&(S={post:C,publication:P,publicationSettings:V,referringRecommendation:Y,referringPub:G});let ez=new URLSearchParams(document.location.search),{result:eF,isLoading:eH}=(0,K.ib)({pathname:"/api/v1/posts/by-id/".concat(x),query:{preview:null!==(g=ez.get("postPreview"))&&void 0!==g?g:void 0},deps:[x],auto:!S,initialResult:S});(0,c.d4)(()=>{eF&&eZ.updatePublication(eF.publication.id,eF)},[eF]);let eW=(0,Q.S2)(null,{ignoreSafari:!0});(0,c.d4)(()=>{U&&eF&&U(eF)},[eF]),(0,c.d4)(()=>{eF&&eW.postSelection&&eW.highlightSelection()},[eF,eW.postSelection]);let eV=null!==(b=null==eF?void 0:eF.publication)&&void 0!==b?b:P,eY=null!==(Z=null==eF?void 0:eF.publicationSettings)&&void 0!==Z?Z:{},e$=(null==eV?void 0:eV.payments_state)==="enabled",{subscription:eG,publicationUser:eq,isFreeSubscribed:eJ,isPaid:eK,isAuthor:eQ,isPledged:e0}=(0,ef.Y0)(null!==(_=null==eF?void 0:null===(t=eF.post)||void 0===t?void 0:t.publication_id)&&void 0!==_?_:0),e1=!(e$?eK:eK||eJ),[e4,e9]=(0,c.eJ)(!1),e8=(0,c.sO)(0),{setIsReading:e2}=(0,eh.SJ)(),e6=async e=>{let{reportCategory:t,details:i}=e;await (0,J.rd)("/api/v1/publications/".concat(null==eV?void 0:eV.id,"/posts/").concat(x,"/report"),{method:"POST",json:{details:i,reportCategory:t}}),eo(!1),eT.popToast(e=>(0,s.tZ)(ec.FN,(0,r._)((0,n._)({},e),{text:eE("We received your report"),Icon:p.Z})))},e5=eF&&(y=eF.post,w=C,(0,n._)({},y,Object.fromEntries(Object.entries(null!=w?w:{}).filter(e=>{let[t,i]=e;return null!=i})))),e3=(0,B.N1)(null!==(f=null==eF?void 0:null===(i=eF.post)||void 0===i?void 0:i.body_html)&&void 0!==f?f:""),e7=eF&&(null===(o=eF.publication)||void 0===o?void 0:o.id)?null===(a=eZ.result)||void 0===a?void 0:a.publicationUserMap.get(eF.publication.id):void 0,te=eF&&e7&&["admin","contributor"].includes(e7.role)?()=>{(0,q.j)(q.FP.READER_EDIT_POST_BUTTON_CLICKED,{publication_id:eF.publication.id,post_id:eF.post.id}),location.href=(0,ew.ANx)(eF.publication,eF.post.id,{addBase:!0})}:void 0,{activePost:tt,isPlaying:ti,onToggle:tn,onPlay:tr}=(0,ev.G)(),to=!!(ti&&tt&&tt.id===(null==eF?void 0:eF.post.id)),ta=(null==eF?void 0:eF.post)&&(0,L.sY)(eF.post);return(0,s.BX)(en.hs,{id:"post-viewer",className:eC.Z.viewerContainer,padding:12*!eI,minWidth:0,children:[(0,s.tZ)(M.u,{isOpen:ee,onSubmit:e6,onClose:()=>eo(!1)}),(0,s.BX)(en.tu,(0,r._)((0,n._)({className:u()(eC.Z.viewer,e4&&eC.Z.isReading),bg:"primary",flex:"grow",position:"relative",minWidth:0},eI?null:{border:"detail",radius:"md"}),{children:[(0,s.BX)(en.tu,{className:eC.Z.viewerOffset,flex:"grow",children:[(0,s.BX)(en.hs,{className:eC.Z.nav,justifyContent:"space-between",paddingY:16,alignItems:"center",children:[(0,s.tZ)(en.hs,{className:eC.Z.logoContainer,justifyContent:"center",zIndex:-1,children:eH?(0,s.tZ)(em.Vm,{size:40}):eV&&(0,s.tZ)(en.hs,{as:"a",href:(0,ew.SVA)(eV),children:(0,s.tZ)(es.wk,{pub:eV,size:40,shadow:"sm",radius:"sm"})})}),(0,s.tZ)(en.hs,{gap:8,children:(0,s.tZ)(eA,{onClick:eU})}),(0,s.BX)(en.hs,{gap:8,children:[!eI&&!eQ&&eV&&(0,s.tZ)(ei.zx,{priority:e1?"primary":"secondary",rounded:!0,newTab:!0,href:(0,ew.W1P)(eV,{user:eN,addBase:!0,params:{utm_source:ex.b3.substack,utm_medium:ex.lP.web,utm_campaign:ex.VX.postViewer}}),onClick:e=>{if(!eN&&eV){ey(eV)(e);return}setTimeout(()=>{eZ.refetchPublication(eV.id)},5e3)},children:(0,s.tZ)(en.gq,{alignItems:"center",gap:8,children:e1?(0,eS.getSubscribeText)(eV,{isFreeSubscribed:eJ}):"Subscribed"})}),(null==eF?void 0:eF.post)&&(0,L.a7)(eF.post)&&(0,s.tZ)(ed.u,{leading:ta?(0,s.tZ)(A.Z,{size:12}):void 0,text:ta?"Paid subscribers only":"Play audio",preferPlacement:"bottom-center",hoverOptions:{delayEnter:0,delayLeave:0},children:(0,s.tZ)(ei.hU,{onClick:()=>{!ta&&(to?tn():tr({post:eF.post,publication:eF.publication}))},disabled:ta,children:ta?(0,s.tZ)(D.Z,{size:20,fill:"var(--color-fg-secondary)"}):to?(0,s.tZ)(X.Z,{size:20}):(0,s.tZ)(O.Z,{size:20})})}),eH?(0,s.tZ)(em.Vm,{radius:"sm",size:40}):eF&&(0,s.tZ)(eD,{post:eF.post,publication:eV,onArchive:eM,onSavePost:E,onCopyLink:()=>{ej((0,z.O1)(null,{post:C,pub:eV,user:eN,useCustomDomainOverOpen:!0}))},onReport:()=>eo(!0),onEditPost:te,isArchived:F})]})]}),(0,s.BX)(en.tu,{className:eC.Z.content,flex:"grow",children:[(T||I)&&(0,s.BX)(en.tu,{gap:8,className:eC.Z.navArrows,children:[(0,s.tZ)(ed.u,{text:"Previous post",trailing:(0,s.tZ)(er.T,{children:"K"}),preferPlacement:"right-center",children:(0,s.tZ)(ei.hU,{onClick:null!=I?I:void 0,disabled:!I,tabIndex:2,className:eC.Z.navArrow,children:(0,s.tZ)(h.Z,{size:20})})}),(0,s.tZ)(ed.u,{text:"Next post",trailing:(0,s.tZ)(er.T,{children:"J"}),preferPlacement:"right-center",children:(0,s.tZ)(ei.hU,{onClick:null!=T?T:void 0,disabled:!T,tabIndex:1,className:eC.Z.navArrow,children:(0,s.tZ)(m.Z,{size:20})})})]}),(0,s.tZ)(en.tu,{className:eC.Z.post,flex:"grow",onScroll:e=>{let t=e.currentTarget,i=t.scrollTop;i>t.scrollHeight-t.offsetHeight-100?(e9(!1),null==e2||e2(!1)):i>e8.current?(e9(!0),null==e2||e2(!0)):(e9(!1),null==e2||e2(!1)),e8.current=i},ref:eL,children:eH?(0,s.tZ)(en.tu,{flex:"grow",alignItems:"center",justifyContent:"center",children:(0,s.tZ)(ea.$j,{})}):eF&&eF.post.id===x&&(0,s.BX)(s.HY,{children:[!ep&&!!eF.referringPub&&(0,s.BX)(en.hs,{position:"relative",className:u()(!eI&&"container",eC.Z.referringPubContainer),radius:"md",shadow:"sm",border:"detail",gap:16,padding:16,children:[(0,s.tZ)(en.hs,{className:eC.Z.close,position:"absolute",cursor:"pointer",onClick:async()=>{await (0,J.rd)("/api/v1/publication_user_settings/user",{method:"PUT",json:{publication_id:eF.publication.id,type:"hide_referring_recommendation",value:!0}}),eb(!0)},children:(0,s.tZ)(v.Z,{size:16,strokeWidth:1})}),!eI&&(0,s.tZ)(et.qE,{user:{id:eF.referringPub.author_id,name:eF.referringPub.author_name},photoUrl:eF.referringPub.author_photo_url,size:56}),(0,s.tZ)(en.tu,{alignItems:"start",gap:16,className:eC.Z.referringPubTextContainer,children:(0,s.BX)(en.tu,{gap:4,paddingRight:24,children:[(0,s.BX)(el.xv.B3,{fontWeight:"semibold",children:[eF.publication.author_name?eO(eP(),eF.publication.name,eF.publication.author_name,eF.referringPub.author_name||eF.referringPub.name):eO(ek(),eF.publication.name,eF.referringPub.author_name||eF.referringPub.name)," ",(0,s.BX)(el.xv.B3,{as:"span",translated:!0,children:["Manage your subscription"," ",(0,s.tZ)(el.xv.B3,{as:"a",href:(0,ew.zRj)(eF.publication),decoration:"underline",children:"here"}),"."]})]}),(null===(l=eF.referringRecommendation)||void 0===l?void 0:l.description)&&(0,s.BX)(el.xv.B4,{color:"secondary",children:["“",null===(d=eF.referringRecommendation)||void 0===d?void 0:d.description,"”"," ","–"," ",eF.referringPub.author_name||eF.referringPub.name]})]})})]}),(0,s.tZ)(eB,{post:e5,publication:eF.publication,publicationUser:eq,subscription:eG,publicationSettings:eY,isPledged:e0,postContainerRef:eL,videoPlayerRef:k})]})})]}),(0,s.tZ)(en.hs,{className:eC.Z.bottomNav,justifyContent:"center",borderTop:"detail",children:(0,s.tZ)(en.hs,{className:eC.Z.ufi,justifyContent:"space-between",alignItems:"center",gap:32,children:eH?(0,s.tZ)(eX,{}):eF&&e5&&(0,s.tZ)(eR,{publication:eF.publication,post:e5,user:eN,onLike:j})})})]}),e3&&(0,s.tZ)(H.o,{toc:e3,position:"absolute"})]}))]})}let eT=e=>{let t=(0,c.sO)(null);return(0,s.tZ)(T.BY,{postId:e.postId,videoPlayerRef:t,children:(0,s.tZ)(eI,(0,r._)((0,n._)({},e),{videoPlayerRef:t}))})};function eB(e){let{post:t,publication:o,publicationUser:a,subscription:l,publicationSettings:c,isPledged:d,postContainerRef:u,videoPlayerRef:p}=e,h=(0,Y.xR)(),m=(0,$.aF)(),v=m?(0,r._)((0,n._)({},m),{is_contributor:(null==a?void 0:a.role)==="contributor",is_admin:(null==a?void 0:a.role)==="admin",is_public_admin:!!(null==a?void 0:a.public),is_subscribed:(null==l?void 0:l.membership_state)==="subscribed",is_free_subscribed:(null==l?void 0:l.membership_state)==="free_signup",is_pledged:d}):null;return(0,s.BX)($.dr,{defaultValue:v,children:[(0,s.tZ)(ee.PostMetaTags,{post:t,publication:o,siteConfigs:h.allConfigs}),(0,s.tZ)(ep.cr,{module:"@/frontend/reader2/PostRenderer",onRequest:()=>i.e("2926").then(i.bind(i,81033)),resolve:e=>e.ReaderPost,post:t,pub:o,user:v,publicationSettings:c,postContainerRef:u,videoPlayerRef:p})]})}let eE=(0,l.forwardRef)((e,t)=>{var{count:i,children:a,tooltipText:l,tooltipTrailing:c,disabled:d}=e,u=(0,o._)(e,["count","children","tooltipText","tooltipTrailing","disabled"]);return(0,s.tZ)(en.hs,{justifyContent:"center",alignItems:"center",ref:t,children:(0,s.tZ)(ed.u,{preferPlacement:"top-center",text:null!=l?l:"",trailing:c,disabled:d,children:(0,s.BX)(ei.hU,(0,r._)((0,n._)({priority:"tertiary",disabled:d},u),{children:[a,null!=i&&i>0&&(0,s.tZ)(el.xv.B4,{weight:"bold",color:d?"tertiary":"primary",children:null!=i?(0,G.T)(i):"0"})]}))})})});function eR(e){var t;let{publication:i,post:n,user:r,onLike:o}=e,[a,l]=(0,c.eJ)(!1),d=!!n.reaction,p=null!==(t=n.reactions["❤"])&&void 0!==t?t:0,h=!r||!i.community_enabled,m=(0,eS.showCommentsOnPost)({publication:i,post:n});return(0,eZ.B)({name:"share",action:()=>{l(!0)}}),(0,s.BX)(s.HY,{children:[(0,s.tZ)(eE,{className:u()(eC.Z.ufiButton,eC.Z.likeButton,d&&eC.Z.isLiked),onClick:o?()=>o(n.id,!d):void 0,count:p,disabled:h,tooltipText:"Like",tooltipTrailing:(0,s.tZ)(er.T,{children:"L"}),children:(0,s.tZ)(g.Z,{size:20})}),(0,s.tZ)(eE,{href:"profile"===i.homepage_type?(0,ew.mx9)(i,n):(0,ey.uRy)(i,n,{comments:!0,urlParams:{utm_source:ex.b3.substack,utm_medium:ex.lP.web,utm_campaign:ex.VX.postViewer}}),count:n.comment_count,newTab:"profile"!==i.homepage_type,disabled:h||!m,className:u()(eC.Z.ufiButton,eC.Z.commentButton),tooltipText:"Comment",children:(0,s.tZ)(b.Z,{size:20})}),(0,s.tZ)(eO,{pub:i,post:n}),(0,s.tZ)(U.sp,{post:n,user:r||void 0,pub:i,showClipping:!!n.videoUpload,trigger:(0,s.tZ)(eE,{className:u()(eC.Z.ufiButton,eC.Z.shareButton),tooltipText:"Share",children:(0,s.tZ)(Z.Z,{height:20,strokeWidth:2})})}),(0,s.tZ)(F.V,{isOpen:a,onClose:()=>l(!1),medium:"post viewer",user:r,post:n,pub:i})]})}function eX(){return(0,s.BX)(s.HY,{children:[(0,s.tZ)(eE,{disabled:!0,children:(0,s.tZ)(g.Z,{size:20})}),(0,s.tZ)(eE,{disabled:!0,children:(0,s.tZ)(b.Z,{size:20})}),(0,s.tZ)(eE,{disabled:!0,children:(0,s.tZ)(_.Z,{size:20})}),(0,s.tZ)(eE,{disabled:!0,children:(0,s.tZ)(Z.Z,{height:20,strokeWidth:2})})]})}function eO(e){let{pub:t,post:i}=e,o=!(0,$.aF)()||!t.community_enabled,[a,l]=(0,c.eJ)(!!i.restacked),[d,p]=(0,c.eJ)(Number(i.restacks)),{canRestack:h,menuItems:m,nuxModal:v}=(0,eb.K)({pub:t,post:(0,r._)((0,n._)({},i),{restacked:a,restacks:d}),onRestack:e=>{a!==e&&p(d+(e?1:-1)),l(e)}});return h?(0,s.BX)(s.HY,{children:[v,(0,s.tZ)(eo.v2,{trigger:(0,s.tZ)(eE,{className:u()(eC.Z.restackButton,eC.Z.ufiButton,a&&eC.Z.isRestacked),count:d,disabled:o,tooltipText:"Restack","aria-label":"menu",children:(0,s.tZ)(R.Z,{className:eC.Z.actionIcon})}),children:m})]}):null}function eD(e){let{post:t,publication:i,onArchive:n,onSavePost:r,onCopyLink:o,onReport:a,onEditPost:l,isArchived:c}=e,{isSaved:d,onSave:u}=(0,j.vk)({post:t}),{iString:p}=(0,W.M1)(),{openModal:h,closeModal:m}=(0,V.dd)(),{activePost:v,isPlaying:g,onToggle:b,onPlay:Z}=(0,ev.G)(),T=!!(g&&v&&v.id===t.id);return(0,s.BX)(eo.v2,{trigger:(0,s.tZ)(ei.hU,{"aria-label":"View more",priority:"secondary",children:(0,s.tZ)(f.Z,{size:20})}),children:[(0,s.tZ)(eo.sN,{onClick:o,leading:(0,s.tZ)(y.Z,{}),children:p("Copy link")}),(0,s.tZ)(eo.sN,{leading:(0,s.tZ)(w.Z,{}),onClick:()=>{h({children:(0,s.tZ)(E.I,{post:t,pub:i,onClose:m}),width:540})},children:p("Embed")}),(0,s.BX)(eo.xw,{children:[(0,L.a7)(t)&&!(0,L.sY)(t)&&(0,s.tZ)(eo.sN,{onClick:()=>{T?b():Z({post:t,publication:i})},leading:T?(0,s.tZ)(S.Z,{}):(0,s.tZ)(x.Z,{}),trailing:(0,s.tZ)(er.T,{children:"P"}),children:p(T?"Pause audio":"Play audio")}),r&&(0,s.tZ)(eo.sN,{onClick:()=>r({post:t,isSaved:u()}),target:"_blank",leading:d?(0,s.tZ)(C.Z,{}):(0,s.tZ)(_.Z,{}),trailing:(0,s.tZ)(er.T,{children:"S"}),children:p(d?"Unsave":"Save")}),n&&(c?(0,s.tZ)(eo.sN,{onClick:()=>n(t.id),leading:(0,s.tZ)(P.Z,{}),trailing:(0,s.tZ)(er.T,{children:"E"}),children:p("Unarchive")}):(0,s.tZ)(eo.sN,{onClick:()=>n(t.id),leading:(0,s.tZ)(k.Z,{}),trailing:(0,s.tZ)(er.T,{children:"E"}),children:p("Archive")})),l&&(0,s.tZ)(eo.xw,{children:(0,s.tZ)(eo.sN,{onClick:l,leading:(0,s.tZ)(N.Z,{}),children:p("Edit post")})})]}),(0,s.tZ)(eo.xw,{children:a&&(0,s.tZ)(eo.sN,{priority:"destructive",onClick:a,leading:(0,s.tZ)(I.Z,{}),children:p("Report")})})]})}function eA(e){let{onClick:t}=e;return(0,s.tZ)(ed.u,{text:"Close",trailing:(0,s.tZ)(er.T,{children:"ESC"}),preferPlacement:"right-center",children:(0,s.tZ)(ei.hU,{onClick:t,priority:"secondary","aria-label":"Close",children:(0,s.tZ)(v.Z,{size:20,"aria-hidden":!0})})})}},17106:function(e,t,i){var n=i(7409),r=i(99282),o=i(16584),a=i(98661),s=i(30396),l=i(94184),c=i.n(l),d=i(11607),u=i(13742),p=i(20816),h=i(9589),m=i(9404),v=i(71787),g=i(56179),b=i(49482),Z=i(89038),_=i(2032),f=i(73510),y=i(51833),w=i(1055),S=i(19911),x=i(84251),C=i(56219),P=i(94442),k=i(67203);i(79094);var N=i(10878),I=i(20888),T=i(75697),B=i(95441),E=i(60807),R=i(13748),X=i(6246),O=i(69181),D=i(68833),A=i(3411),L=i(48980),j=i(11792);i(54400),i(63018);var U=i(98750),M=i(98914),z=i(93029),F=i(71068),H=i(15771),W=i(19081);i(17172);var V=i(99916),Y=i(98248),$=i(10510),G=i(63474),q=i(58175),J=i(70379);i(45783),i(27744),i(65575);var K=i(44312),Q=i(19801);i(91400);var ee=i(98012),et=i(22838),ei=i(60308),en=i(60836),er=i(63651),eo=i(47929),ea=i(55749);function es(e){let{radius:t}=e;return(0,o.tZ)(F.xu,{position:"absolute",className:ea.Z.highlight,radius:t||"md"})}function el(e){let{radius:t}=e;return(0,o.tZ)(F.xu,{position:"absolute",className:ea.Z.border,radius:t||"md"})}function ec(){return(0,o.tZ)(W.hs,{position:"absolute",inset:0,justifyContent:"center",alignItems:"center",className:ea.Z.playButtonContainer,children:(0,o.tZ)(H.GI,{size:"lg",rounded:!0,className:ea.Z.playButton,children:(0,o.tZ)(w.Z,{height:20,style:{stroke:"none",fill:"white"}})})})}function ed(e){var t;let{post:i,inboxItem:a,liveStream:s,isArchived:l,containerRef:d,palette:u,cardTop:p,onArchive:h,author:m,title:v,cardFooter:g}=e;return(0,o.tZ)(W.hs,{className:c()(ea.Z.cardWrapper,l?ea.Z.archived:ea.Z.smallCardWrapper),sizing:"border-box",ref:d,children:(0,o.tZ)(eu,(0,r._)((0,n._)({},{post:i,inboxItem:a,liveStream:s}),{children:(0,o.BX)(eS,{style:(0,r._)((0,n._)({},(0,A.mX)({palette:null!=u?u:null})),{"--glow-color":(0,A.zn)(null==u?void 0:null===(t=u.LightVibrant)||void 0===t?void 0:t.rgb,.5)}),direction:"row",small:!0,children:[(0,o.tZ)(eP,{className:c()(ea.Z.cardTop,ea.Z.smallCardTop),children:p}),(0,o.BX)(W.tu,{className:ea.Z.smallCardRight,padding:8,flex:"fill",justifyContent:"space-between",gap:2,children:[(0,o.BX)(W.gq,{children:[(0,o.tZ)(eC,{small:!0,children:m}),h&&(0,o.tZ)(H.hU,{size:"sm",priority:"tertiary",position:"absolute",className:c()(ea.Z.newIconButton,ea.Z.closeButton),onClick:e=>{e.preventDefault(),e.stopPropagation(),h()},children:(0,o.tZ)(S.Z,{className:c()(ea.Z.closeIcon)})})]}),(0,o.tZ)(ex,{small:!0,children:v}),(0,o.tZ)(W.gq,{justifyContent:"space-between",alignItems:"center",gap:4,children:g})]})]})}))})}function eu(e){let{children:t,post:i,liveStream:r,inboxItem:a}=e,s=i?ek(i):"live_stream",l=(0,M.K1)(),c=r?l?(0,er.bHR)({liveStreamId:r.liveStream.id,params:{source:"queue"}}):(0,er.UDR)({liveStreamId:r.liveStream.id,noBase:!0,params:{source:"queue"}}):(0,er.rcW)(i.id,{noBase:!0,urlParams:{source:"queue",autoPlay:"video"===s||"podcast"===s?"true":void 0}}),d=r?{live_stream_id:r.liveStream.id,clicked_element:"live_stream"}:(0,n._)({post_id:null==i?void 0:i.id,clicked_element:"post"},null==a?void 0:a.tracking_parameters);return(0,o.tZ)(G.A0,{className:ea.Z.link,href:c,onClick:()=>{(0,D.j)(D.FP.READING_QUEUE_ITEM_CLICKED,(0,n._)({},d))},children:t})}function ep(e){var t;let{post:i,publication:n,inboxItem:r,containerRef:a,imageAspectRatio:s,plainLogo:l}=e,{cover_image:c,videoUpload:d}=i,u=["podcast","voiceover"].includes(null!==(t=r.audio_type)&&void 0!==t?t:""),p=!!(0,ei.W$Z)({post:i,height:420}),h=!!c,m=!!n.logo_url,v=l?"sm":m?"sm":"full";return(0,o.BX)(o.HY,{children:[d&&p?(0,o.tZ)(z.Z,{containerRef:a,post:i,aspectRatio:s,size:"small",alwaysShow:!0,className:ea.Z.gifPreview}):h?(0,o.tZ)(I.e,{src:c,useRetinaSizing:!0,maxWidth:256,imageIsFixedWidth:!0,imageProps:{smartCrop:!0,aspect:"".concat(s)},objectFit:"cover",className:ea.Z.coverImage}):u?(0,o.tZ)(eZ,{publication:n,radius:v}):(0,o.tZ)(eh,{publication:n,radius:v,plain:l}),u&&(0,o.tZ)(ec,{})]})}function eh(e){let{publication:t,radius:i,plain:n}=e;return(0,o.BX)(W.hs,{radius:i,position:"relative",className:n?void 0:ea.Z.logoContainerShadow,children:[(0,o.tZ)($.wk,{pub:t,size:88,radius:i}),n?null:(0,o.BX)(o.HY,{children:[(0,o.tZ)(es,{radius:i}),(0,o.tZ)(el,{radius:i})]})]})}(0,a.memo)(e=>{let{inboxItem:t,position:i,imageAspectRatio:r}=e,{post:a,publication:l,referringPub:c}=t,{handleArchive:d}=(0,P.zX)(),{palette:u}=function(e){var t,i;let{post:n,publication:r,useCover:o}=e;if(o&&n.cover_image)return{bgImage:n.cover_image,palette:null!==(t=n.coverImagePalette)&&void 0!==t?t:null};if(r.logo_url)return{bgImage:r.logo_url,palette:r.logoPalette};let a=n.publishedBylines[0];return(null==a?void 0:a.photo_url)?{bgImage:a.photo_url,palette:null!==(i=a.photo_palette)&&void 0!==i?i:null}:{bgImage:null,palette:null}}({post:a,publication:l,useCover:!0}),p=(0,s.sO)(null);return(0,U.UM)(p,()=>{(0,D.j)(D.FP.READING_QUEUE_ITEM_SEEN,(0,n._)({post_id:a.id,reading_queue_position:i,post_type:t.postType,inbox_item_is_saved:t.is_saved,referring_pub_id:null==c?void 0:c.id},t.tracking_parameters))}),(0,o.tZ)(ed,{author:l.name,title:a.title,post:a,inboxItem:t,isArchived:!!t.archived_at,containerRef:p,palette:u,cardTop:(0,o.tZ)(ep,{post:a,publication:l,inboxItem:t,containerRef:p,imageAspectRatio:r,plainLogo:!0}),cardFooter:(0,o.BX)(o.HY,{children:[(0,o.tZ)(ef,{inboxItem:t,post:a,color:"vibrance"}),(0,o.tZ)(ey,{post:a,publication:l,inboxItem:t})]}),onArchive:()=>{d(t.content_key),(0,D.j)(D.FP.READING_QUEUE_ITEM_CLICKED,(0,n._)({post_id:a.id,clicked_element:"archive"},t.tracking_parameters))}})}),(0,a.memo)(e=>{var t,i;let{liveStream:n,position:r}=e,a=(0,s.sO)(null);return(0,U.UM)(a,()=>{(0,D.j)(D.FP.READING_QUEUE_ITEM_SEEN,{live_stream_id:n.liveStream.id,reading_queue_position:r,post_type:"live_stream",inbox_item_is_saved:!1})}),(0,o.tZ)(ed,{author:[null===(i=(t=n).user)||void 0===i?void 0:i.name,...t.liveStreamGuests.map(e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.name})].filter(Boolean).join(", "),title:n.liveStream.title,liveStream:n,cardTop:(0,o.BX)(o.HY,{children:[(0,o.tZ)(em,{liveStream:n}),n.liveStreamInformation.isExplicit?(0,o.BX)(o.HY,{children:[(0,o.tZ)(eg,{}),(0,o.tZ)(eb,{})]}):(0,o.tZ)(ev,{})]}),cardFooter:(0,o.BX)(o.HY,{children:[(0,o.tZ)(O.Qn,{}),(0,o.tZ)(x.Z,{height:16}),(0,o.tZ)(q.xv.B5,{ellipsis:!0,className:ea.Z.vibranceSecondaryText,children:(0,X.T)(n.liveStreamInformation.currentViewerCount)}),(0,o.tZ)(ew,{liveStream:n})]})})});let em=e=>{let{liveStream:t}=e;return(0,o.tZ)(F.xu,{position:"absolute",inset:0,zIndex:-1,className:ea.Z.livePreview,style:(0,n._)({backgroundImage:"url(".concat(t.liveStreamInformation.thumbnailGifUrl,")")},t.liveStreamGuests.length>0?{backgroundPosition:"top"}:{})})},ev=()=>(0,o.tZ)(W.tu,{position:"relative",alignItems:"center",justifyContent:"center",className:ea.Z.cardTop}),eg=()=>(0,o.tZ)(F.xu,{className:ea.Z.blur,position:"absolute",inset:0,zIndex:-1}),eb=()=>(0,o.BX)(eP,{children:[(0,o.tZ)(d.Z,{stroke:"var(--vibrance-primary)",size:20,className:ea.Z.explicitIcon}),(0,o.tZ)(q.xv.B4,{color:"vibrance-secondary",textAlign:"center",children:"May contain sensitive content"})]});function eZ(e){let{publication:t,radius:i}=e;return(0,o.BX)(W.hs,{alignItems:"center",justifyContent:"center",className:ea.Z.audioLogoContainer,children:[(0,o.tZ)(e_,{}),(0,o.tZ)(eh,{publication:t,radius:i})]})}function e_(){let e=(0,s.Ye)(()=>{let e=[],t=.5;for(let i=0;i<40;i++){let n;let r=Math.max(.1,Math.min(1,.5*Math.sin(.5*i)+.5+(t<=.1+.2?.5*Math.random():t>=.8?-(.5*Math.random()):Math.random()-.5))),o=4+44*r;e.push(o),t=r}return e},[]),t=(0,s.Ye)(()=>e.map((e,t)=>(0,o.tZ)(F.xu,{flex:"auto",style:{width:"2.5px",height:"".concat(e,"px")},bg:"white",radius:"full"},t)),[e]);return(0,o.tZ)(W.hs,{alignItems:"center",justifyContent:"center",position:"absolute",inset:0,className:ea.Z.audioWaveform,style:{gap:"5px"},children:t})}function ef(e){let{inboxItem:t,post:i,color:n}=e,r=function(e){let{inboxItem:t,post:i}=e,n=function(e){let{inboxItem:t}=e;switch(ek(t.post)){case"podcast":return t.audio_progress;case"video":return t.video_progress;case"newsletter":return t.read_progress;default:return 0}}({inboxItem:t});if(n>=et.P9)return{status:"done"};if(i.is_saved)return{status:"saved",consumptionTime:(0,Q.JP)(i,"sm")};if(n>0&&n<et.P9)return{status:"in_progress",progress:n,consumptionTime:(0,Q.hB)(i,n,"sm")};let r=ek(i);return{status:"unread",isNew:!t.seen_at&&(0,ee.Z)().subtract(3,"days").isBefore(t.inbox_date),type:r,consumptionTime:(0,Q.JP)(i,"sm")}}({inboxItem:t,post:i});if("done"===r.status)return(0,o.BX)(W.hs,{gap:4,alignItems:"center",children:[(0,o.tZ)(u.Z,{stroke:"white",size:14,className:"vibrance"===n?ea.Z.vibranceSecondaryStroke:void 0}),(0,o.tZ)(q.xv.B5,{color:"white",children:"Done"})]});if("saved"===r.status)return(0,o.BX)(W.hs,{gap:4,alignItems:"center",className:"vibrance"===n?ea.Z.vibranceSecondaryText:void 0,children:[(0,o.tZ)(p.Z,{size:14,fill:i.is_saved?"white":"none"}),(0,o.tZ)(q.xv.B5,{color:"white",children:"Saved"}),(0,o.tZ)(q.xv.B5,{nowrap:!0,ellipsis:!0,children:r.consumptionTime})]});if("in_progress"===r.status)return(0,o.BX)(W.hs,{gap:8,alignItems:"center",children:[(0,o.tZ)(Y.uk,{percent:r.progress,theme:"media",minWidth:48,width:48,height:6}),(0,o.tZ)(q.xv.B5,{weight:"regular",className:"vibrance"===n?ea.Z.vibranceSecondaryText:void 0,nowrap:!0,ellipsis:!0,children:r.consumptionTime})]});let a=(()=>{switch(r.type){case"video":return(0,o.tZ)(w.Z,{height:10,style:{stroke:"none",fill:"var(--color-accent-fg-orange)",paddingRight:4}});case"podcast":return(0,o.tZ)(y.Z,{height:14,style:{stroke:"none",fill:"white",paddingRight:4}});default:return null}})();return(0,o.BX)(W.hs,{gap:8,alignItems:"center",className:"vibrance"===n?ea.Z.vibranceSecondaryText:void 0,children:[r.isNew&&(0,o.tZ)(eN,{}),a,(0,o.tZ)(q.xv.B5,{nowrap:!0,ellipsis:!0,children:r.consumptionTime})]})}function ey(e){let{post:t,publication:i,onCopy:a,inboxItem:l}=e,c=(0,j.g)(),d=(0,R.v)(t),{handleArchive:u}=(0,P.zX)(),y=(0,E.aF)(),{iString:w}=(0,B.M1)(),S=(0,J.pm)(),[x,I]=(0,s.eJ)(!1),{activePost:X,isPlaying:O,onToggle:A,onPlay:U}=(0,K.G)(),M=!!(O&&X&&X.id===t.id),z=async e=>{let{reportCategory:a,details:s}=e;await (0,L.rd)("/api/v1/publications/".concat(null==i?void 0:i.id,"/posts/").concat(t.id,"/report"),{method:"POST",json:{details:s,reportCategory:a}}),I(!1),S.popToast(e=>(0,o.tZ)(J.FN,(0,r._)((0,n._)({},e),{text:w("We received your report"),Icon:h.Z})))};return(0,o.BX)(o.HY,{children:[(0,o.tZ)(N.u,{isOpen:x,onSubmit:z,onClose:()=>I(!1)}),(0,o.tZ)(W.hs,{gap:8,children:(0,o.BX)(V.v2,{trigger:(0,o.tZ)(H.hU,{className:ea.Z.newIconButton,"aria-label":"more",size:"sm",priority:"tertiary",onClick:e=>{e.stopPropagation()},children:(0,o.tZ)(m.Z,{size:18,className:ea.Z.vibranceTertiaryIcon})}),children:[(0,o.tZ)(V.sN,{leading:(0,o.tZ)(v.Z,{}),onClick:()=>{c((0,en.uR)(i,t,{urlParams:{utm_source:eo.b3.substack,utm_content:eo.fZ.feedRecommendedCopyLink}})),null==a||a()},children:"Copy link"}),(0,o.tZ)(k.O0,{url:(0,T.O1)(null,{post:t,pub:i,user:y,useCustomDomainOverOpen:!0}),onShare:()=>{(0,D.j)(D.FP.SHARE_LINK_CLICKED,{name:"direct_message",post_id:t.id})}}),(0,o.BX)(V.xw,{children:[(0,C.a7)(t)&&!(0,C.sY)(t)&&(0,o.tZ)(V.sN,{onClick:()=>{M?A():U({post:t,publication:i})},leading:M?(0,o.tZ)(g.Z,{}):(0,o.tZ)(b.Z,{}),children:M?w("Pause audio"):w("Play audio")}),(0,o.tZ)(V.sN,{leading:t.is_saved?(0,o.tZ)(Z.Z,{}):(0,o.tZ)(p.Z,{}),onClick:()=>{d()},children:t.is_saved?"Unsave":"Save"}),(0,o.tZ)(V.sN,{leading:(0,o.tZ)(_.Z,{}),onClick:()=>{(0,D.j)(D.FP.READING_QUEUE_ITEM_CLICKED,(0,n._)({post_id:t.id,clicked_element:"archive"},l.tracking_parameters)),u(l.content_key)},children:"Archive"})]}),(0,o.tZ)(V.xw,{children:(0,o.tZ)(V.sN,{priority:"destructive",onClick:()=>I(!0),leading:(0,o.tZ)(f.Z,{}),children:"Report"})})]})})]})}function ew(e){let{liveStream:t}=e,{iString:i}=(0,B.M1)(),a=(0,J.pm)(),[l,c]=(0,s.eJ)(!1),d=async e=>{let{reportCategory:s,details:l}=e;await (0,L.rd)("/api/v1/live_stream/".concat(t.liveStream.id,"/report"),{method:"POST",json:{details:l,reportCategory:s,timestamp:new Date().toISOString()}}),c(!1),a.popToast(e=>(0,o.tZ)(J.FN,(0,r._)((0,n._)({},e),{text:i("We received your report"),Icon:h.Z})))};return(0,o.BX)(W.hs,{alignItems:"center",gap:8,children:[(0,o.tZ)(N.u,{isOpen:l,onSubmit:d,onClose:()=>c(!1)}),(0,o.tZ)(W.hs,{gap:8,children:(0,o.BX)(V.v2,{trigger:(0,o.tZ)(H.hU,{className:ea.Z.newIconButton,"aria-label":"more",size:"sm",priority:"tertiary",onClick:e=>{e.stopPropagation()},children:(0,o.tZ)(m.Z,{size:18,className:ea.Z.vibranceTertiaryIcon})}),children:[(0,o.tZ)(V.sN,{leading:(0,o.tZ)(v.Z,{}),onClick:()=>{let e=(0,er.bHR)({liveStreamId:t.liveStream.id,utm_source:eo.b3.substack});(0,T.Ui)({shareUrl:e,skipToast:!0,trackParams:{live_stream_id:t.liveStream.id}}),a.popToast(e=>(0,o.tZ)(J.FN,(0,r._)((0,n._)({},e),{text:i("Copied link to clipboard")})))},children:"Copy link"}),(0,o.tZ)(V.xw,{children:(0,o.tZ)(V.sN,{priority:"destructive",onClick:()=>c(!0),leading:(0,o.tZ)(f.Z,{}),children:"Report"})})]})})]})}let eS=e=>{let{children:t,style:i,direction:n="column",small:r}=e;return(0,o.tZ)(W.hs,{justifyContent:"space-between",flex:"grow",minWidth:0,className:c()(ea.Z.card,r?ea.Z.smallCard:void 0),overflow:"hidden",radius:"md",tabIndex:0,showFocus:!0,animate:!0,style:i,direction:n,children:t})},ex=e=>{let{children:t,small:i}=e,n=i?q.xv.B4:q.xv.B3;return(0,o.tZ)(W.tu,{minWidth:0,className:i?void 0:ea.Z.titleContainerMinHeight,children:(0,o.tZ)(n,{color:"white",weight:"semibold",clamp:2,minWidth:0,className:ea.Z.title,children:t})})},eC=e=>{let{children:t,small:i}=e;return(0,o.tZ)(W.hs,{minWidth:0,className:i?ea.Z.smallCardAuthor:void 0,children:(0,o.tZ)(q.xv.B4,{weight:"regular",className:ea.Z.vibranceSecondaryText,ellipsis:!0,flex:"grow",color:"inherit",children:t})})},eP=(0,F.zo)({display:"flex",direction:"column",gap:8,justifyContent:"center",alignItems:"center",className:ea.Z.cardTop});(0,F.zo)({display:"flex",direction:"column",padding:12,paddingTop:20,gap:20,flex:"grow",className:ea.Z.cardBottom}),(0,F.zo)({display:"flex",direction:"column",gap:2,flex:"grow"}),(0,F.zo)({display:"flex",alignItems:"center",gap:8}),(0,F.zo)({display:"flex",gap:4,minWidth:0,flex:"grow",alignItems:"center"});let ek=e=>e.videoUpload&&e.videoUpload.duration&&e.videoUpload.duration>0?"video":e.podcast_url&&e.podcast_duration>0?"podcast":"thread"===e.type?"thread":"newsletter";function eN(){return(0,o.tZ)("svg",{height:6,width:6,children:(0,o.tZ)("circle",{cx:3,cy:3,r:3,fill:"white"})})}},93630:function(e,t,i){i.d(t,{l6:()=>P});var n=i(7409),r=i(99282),o=i(16584),a=i(6400),s=i(30396),l=i(13742),c=i(31012),d=i(60807),u=i(98750),p=i(94874),h=i(15771),m=i(19081),v=i(10510),g=i(58175),b=i(65575),Z=i(32189),_=i(64172),f=i(33555),y=i(22419),w=i(67914),S=i(60308),x=i(63651),C=i(47929);function P(e){let{items:t,surface:i,page_num:s=0,focusedPubId:l,onClickItem:c,onItemFirstVisible:d}=e,u=(0,_.Th)(),p=s*y.lq,h=new Map(t.map(e=>{var t,i;let{publication:n}=e;return[n.id,null===(i=u.result)||void 0===i?void 0:null===(t=i.subscriptions)||void 0===t?void 0:t.some(e=>e.publication_id===n.id&&e.membership_state&&(0,w.hl)(e.membership_state))]}));return(0,o.tZ)(b.tu,{gap:8,children:t.map((e,t)=>{var o;return(0,a.createElement)(k,(0,r._)((0,n._)({},e),{key:e.publication.id,isSubscribed:null!==(o=h.get(e.publication.id))&&void 0!==o&&o,rank:t+p+1,surface:i,isFocused:l===e.publication.id,onClick:c,onFirstVisible:d}))})})}function k(e){let{user:t,publication:i,rank:n,isSubscribed:r,surface:a,isFocused:l,onClick:c,onFirstVisible:h,trackingParameters:Z}=e,_=(0,d.aF)(),y=(0,s.sO)(null),w=!!_&&_.id===(null==t?void 0:t.id);return(0,u.UM)(y,()=>{null==h||h({publication:i,rank:n,trackingParameters:Z})}),(0,o.tZ)(b.fG,{id:i.id.toString(),bg:w||l?"accent-orange":void 0,href:t?(0,x.NNq)(t):(0,S.SVA)(i),onClick:()=>c({publication:i,rank:n,trackingParameters:Z}),children:(0,o.BX)(m.hs,{justifyContent:"space-between",flex:"grow",alignItems:"center",paddingX:12,ref:y,children:[(0,o.BX)(m.hs,{gap:16,alignItems:"center",children:[(0,o.tZ)(g.xv.Digit,{minWidth:16,children:n}),t&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(p.qE,{user:t,size:40}),(0,o.BX)(b.tu,{children:[(0,o.BX)(m.hs,{alignItems:"center",gap:4,children:[(0,o.tZ)(g.xv.B3,{weight:"semibold",children:t.name}),t.bestseller_tier?(0,o.tZ)(f.UserBadge,{tier:t.bestseller_tier,userId:t.id,size:"sm"}):null]}),(0,o.tZ)(g.xv.B4,{color:"secondary",children:i.name})]})]}),!t&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(v.wk,{radius:"full",pub:i,size:32}),(0,o.tZ)(b.tu,{children:(0,o.tZ)(g.xv.B3,{weight:"bold",children:i.name})})]})]}),!w&&(0,o.tZ)(N,{pub:i,user:t,surface:a,isSubscribed:r,currentUser:_})]})})}function N(e){let{pub:t,user:i,surface:n,isSubscribed:r,currentUser:a}=e,s=(0,_.Th)(),d=(0,Z.x)({surface:n})(t);return r?(0,o.tZ)(m.hs,{alignItems:"center",justifyContent:"center",padding:8,children:(0,o.tZ)(l.Z,{size:16,stroke:"var(--color-fg-tertiary)"})}):(0,o.tZ)(h.hU,{priority:"secondary",size:"sm",newTab:!0,href:(0,S.W1P)(t,{addBase:!0,user:a,utm_source:C.b3.substack,utm_medium:C.lP.web,utm_campaign:C.VX.reader2}),onClick:e=>{if(e.stopPropagation(),i){let e="visibilitychange",i=()=>{"visible"===document.visibilityState&&(document.removeEventListener(e,i),s.refetchPublication(t.id))};document.addEventListener(e,i)}d(e)},children:(0,o.tZ)(c.Z,{size:20})})}},52321:function(e,t,i){i(16584);var n=i(63474);i(88603),i(24641);var r=i(97501);(0,n.zo)({display:"flex",flex:"auto",className:r.Z.container}),(0,n.zo)({display:"flex",className:r.Z.nav,zIndex:1,gap:20,paddingX:20,sizing:"border-box",alignItems:"center",flex:"grow",justifyContent:"end",borderBottom:"detail"})},31702:function(e,t,i){i(16584),i(98585),i(36518),i(85095),i(60807);var n=i(71068);i(15771),i(19081),i(22029),i(88603),i(7779),i(24641),i(58175),i(63718);var r=i(97501);(0,n.zo)({display:"flex",alignItems:"center",justifyContent:"start",gap:20,flex:"grow"}),(0,n.zo)({display:"flex",alignItems:"center",justifyContent:"end",gap:12,flex:"grow"}),(0,n.zo)({display:"flex",flex:"auto",className:r.Z.container}),(0,n.zo)({display:"flex",className:r.Z.nav,zIndex:1,gap:20,paddingX:20,sizing:"border-box",alignItems:"center",flex:"grow",justifyContent:"space-between"})},22029:function(e,t,i){i(16584),i(9682),i(15771),i(91400),i(33884)},88603:function(e,t,i){i(16584),i(95441),i(15771),i(63651)},7779:function(e,t,i){i.d(t,{J:()=>l});var n=i(16584),r=i(4473),o=i(15771),a=i(80026),s=i(33884);function l(){return(0,n.tZ)(o.kG,{href:s.Ds,"aria-label":"Home",resetCss:!0,display:"flex",direction:"column",radius:"md",bg:"primary",showFocus:!0,animate:!0,hover:!0,children:(0,n.tZ)(a.M5,{width:48,height:48,position:"relative",children:(0,n.tZ)(r.Z,{fill:"var(--color-accent)",size:28})})})}},3:function(e,t,i){i.d(t,{r:()=>z});var n=i(16584),r=i(30396);if(/^(3154|6909)$/.test(i.j))var o=i(6775);var a=i(40369),s=i(37625),l=i(46386),c=i(52218),d=i(8626),u=i(72257),p=i(89606),h=i(46388),m=i(66013),v=i(4687),g=i(1395),b=i(56451),Z=i(98585),_=i(95441),f=i(99259),y=i(36518),w=i(85095),S=i(60807),x=i(68833),C=i(9682),P=i(98914),k=i(80026),N=i(72260),I=i(66318),T=i(19434),B=i(81043),E=i(7779),R=i(27504),X=i(3357),O=i(75419),D=i(98012),A=i(60308),L=i(33884),j=i(63651);if(/^(3154|6909)$/.test(i.j))var U=i(47929);var M=i(23024);function z(e){var t,i;let{requireLogin:M,setDrawer:z,drawer:V,native:Y}=e,$=(0,S.aF)(),{iString:G}=(0,_.M1)(),{viewerProfile:q}=(0,w.Un)(),{isExpanded:J}=(0,B.SJ)(),[K]=(0,C.tv)(),{activityUnreadCount:Q}=(0,y.lR)(),ee=(0,f.M$)().isOnDestination,[et,ei]=(0,r.eJ)(null),en={urlParams:{utm_content:U.fZ.islandDesktopNavSidebar}},er=ee?L.Ds:(0,j.n1t)((0,j.SVA)(),{utm_content:U.fZ.islandDesktopNavSidebar}),eo=ee?null:(0,j.ze_)(en),ea=(null==$?void 0:$.profile_set_up_at)?(0,j.NNq)($,{noBase:ee,utm_source:U.b3.menu,utm_content:ee?void 0:U.fZ.islandDesktopNavSidebar}):$?(0,j.Nhr)({utm_source:U.b3.menu,utm_content:ee?void 0:U.fZ.islandDesktopNavSidebar}):void 0;(0,r.d4)(()=>{if("undefined"!=typeof window){let e=window.localStorage.getItem("chatLastClicked");e&&ei((0,D.Z)(e))}},[]);let es=(null==q?void 0:null===(t=q.publicationUsers)||void 0===t?void 0:t.find(e=>"admin"===e.role||"contributor"===e.role))||{publication:null==$?void 0:null===(i=$.dashboard_pubs)||void 0===i?void 0:i[0]},el=(0,O.i3)(),{open:ec,isOpen:ed}=(0,Z.Dr)(),{chatUnreadCount:eu,useChatBadge:ep}=(0,N.L)({chatLastClicked:et}),eh=!!V,em=eh||ed,ev=K.path.includes(j.xJk),eg=K.path.startsWith(j.Don),eb=K.path.startsWith(j.hT),eZ=V||eg||!ee;return(0,n.tZ)(k.sg,{position:"relative",children:(0,n.BX)(F,{border:eZ?"detail":void 0,position:"fixed",children:[(0,n.tZ)(H,{alignItems:J?"start":"center",children:(0,n.tZ)(E.J,{})}),(0,n.BX)(W,{children:[(0,n.tZ)(X.u,{href:er,icon:(0,n.tZ)(h.Z,{}),activeIcon:(0,n.tZ)(p.Z,{}),text:G("Home"),native:!!Y,isActive:!em&&void 0}),(0,n.tZ)(X.u,{href:ee?j.Gfh:(0,j.ozY)(en),icon:(0,n.tZ)(v.Z,{}),activeIcon:(0,n.tZ)(m.Z,{}),requireLogin:M,text:G("Subscriptions"),native:!!Y,isActive:!em&&void 0}),(0,n.tZ)(X.u,{href:ee?j.Don:(0,j.Cnj)(en),icon:(0,n.tZ)(c.Z,{}),activeIcon:(0,n.tZ)(l.Z,{}),requireLogin:M,badge:eu,dot:!!ep,native:!!Y,text:G("Chat"),onClick:$?()=>{z&&z(null),ei((0,D.Z)()),window.localStorage.setItem("chatLastClicked",(0,D.Z)().toISOString())}:void 0,isActive:!em&&void 0}),(0,n.tZ)(X.u,{onClick:$?()=>{z?z("activity"===V?null:"activity"):eo&&(0,P.uX)(eo)}:void 0,isActive:eh||eb,icon:(0,n.tZ)(s.Z,{}),activeIcon:(0,n.tZ)(a.Z,{}),requireLogin:M,badge:Q,text:G("Activity")}),(0,n.tZ)(X.u,{onClick:()=>{ee?ec():(0,P.uX)((0,j.k7R)(en))},icon:(0,n.tZ)(b.Z,{}),activeIcon:(0,n.tZ)(g.Z,{}),text:G("Search"),isActive:!eh&&(ed||ev)}),!!(null==$?void 0:$.subdomain)&&(0,n.tZ)(X.u,{icon:(0,n.tZ)(u.Z,{}),activeIcon:(0,n.tZ)(d.Z,{}),text:G("Dashboard"),onClick:()=>{(null==$?void 0:$.subdomain)&&((0,x.j)(x.FP.HOMEPAGE_DASHBOARD_LINK_CLICKED),(0,P.uX)((0,A.c0Q)($.subdomain,{params:{utm_source:U.b3.menu}}),{local_navigation:!1,newTab:!0}))}}),(0,n.tZ)(X.u,{href:ea||void 0,icon:$?(0,n.tZ)(I.g,{user:$}):(0,n.tZ)(o.Z,{}),activeIcon:$?(0,n.tZ)(I.g,{user:$,isActive:!0}):(0,n.tZ)(o.Z,{}),requireLogin:M,text:G("Profile"),native:!!Y,isActive:!em&&void 0}),(0,n.tZ)(T.z,{onNoteClick:()=>{z&&z(null),el.open({onCompose:()=>{(0,L.Z2)(K.path)?((0,P.uX)("/inbox",{replace:!0}),setTimeout(()=>{(0,P.uX)(L.Ds,{replace:!0})},0)):(0,P.uX)(er)}})},profile:q,publicationUser:es,requireLogin:M})]}),$&&(0,n.tZ)(H,{children:(0,n.tZ)(R.s,{})})]})})}function F(e){let{children:t,border:i,position:r}=e;return(0,n.tZ)(k.sg,{position:r,padding:8,borderRight:i,sizing:"border-box",role:"navigation","aria-label":"Main navigation","aria-orientation":"vertical",className:M.Z.sidebar,children:t})}function H(e){let{alignItems:t,children:i}=e;return(0,n.tZ)(k.sg,{padding:8,height:64,flex:"auto",sizing:"border-box",alignItems:t,children:i})}function W(e){let{children:t}=e;return(0,n.tZ)(k.sg,{padding:8,gap:8,flex:"grow",justifyContent:"start",children:t})}},24641:function(e,t,i){i(16584),i(95441),i(15771),i(91400)},76404:function(e,t,i){i.d(t,{I:()=>w});var n=i(16584),r=i(94184),o=i.n(r);if(/^(3154|6909)$/.test(i.j))var a=i(68835);var s=i(46386),l=i(52218),c=i(89606),d=i(46388),u=i(66013),p=i(4687),h=i(99259),m=i(49762),v=i(19081),g=i(72260),b=i(13434),Z=i(33884),_=i(63651);if(/^(3154|6909)$/.test(i.j))var f=i(47929);var y=i(87740);function w(e){let{requireLogin:t}=e,i=(0,h.M$)().isOnDestination,{chatUnreadCount:r}=(0,g.L)({}),w={noBase:!1,urlParams:{utm_content:f.fZ.islandDesktopNavSidebar}},S=i?Z.Ds:(0,_.n1t)((0,_.SVA)(),{utm_content:f.fZ.islandDesktopNavSidebar});return(0,n.tZ)(v.hs,{className:o()(y.Z.container,!i&&y.Z.publicationNav),children:(0,n.BX)(v.hs,{className:y.Z.tabs,flex:"grow",alignItems:"center",justifyContent:"space-between",borderTop:"detail",paddingX:64,children:[(0,n.tZ)(b.P,{href:S,icon:(0,n.tZ)(d.Z,{}),activeIcon:(0,n.tZ)(c.Z,{}),requireLogin:t,native:!i}),(0,n.tZ)(b.P,{href:i?_.Gfh:(0,_.ozY)(w),icon:(0,n.tZ)(p.Z,{}),activeIcon:(0,n.tZ)(u.Z,{}),requireLogin:t,native:!i}),(0,n.tZ)(m.kR,{configKey:"web_reader_podcasts_tab",children:(0,n.tZ)(b.P,{href:"/podcasts-player",icon:(0,n.tZ)(a.Z,{}),activeIcon:(0,n.tZ)(a.Z,{}),requireLogin:t})}),(0,n.tZ)(b.P,{href:i?(0,_.Cnj)():(0,_.Cnj)(w),icon:(0,n.tZ)(l.Z,{}),activeIcon:(0,n.tZ)(s.Z,{}),requireLogin:t,badge:r,native:!i})]})})}},15850:function(e,t,i){i(16584);var n=i(98661);i(30396);var r=i(23493),o=i.n(r);(0,n.createContext)({listeningProgress:{},onUpdateListeningProgress:()=>void 0});let a=e=>{let{user:t}=e;return"podcasts:listening_progress:".concat(t.id)};o()(e=>{let{allProgress:t,user:i}=e,n=a({user:i});localStorage.setItem(n,JSON.stringify(t))},1e3)},30322:function(e,t,i){i(16584),i(30396),i(94184),i(86657),i(56219),i(19081),i(81043),i(14293),i(2689),i(9970),i(20888),i(95441),i(80878);var n=i(71068);i(15771),i(99916),i(10510),i(63474),i(58175),i(2009),i(5623),i(60308),i(63651),i(84864),(0,n.zo)({display:"flex",direction:"row",flex:"grow",alignItems:"center",justifyContent:"space-between",paddingX:8,gap:16}),i(44312)},44312:function(e,t,i){i.d(t,{G:()=>a}),i(16584);var n=i(98661),r=i(30396);i(59854),i(15850);let o=(0,n.createContext)({activePodcast:null,activePost:null,activePublication:null,lastActivePost:null,lastActivePodcast:null,lastActivePublication:null,audioPlayerRef:{current:null},currentTime:0,duration:null,isPlaying:!1,listeningProgress:{},onClear:()=>void 0,onPlay:()=>void 0,onToggle:()=>void 0}),a=()=>(0,r.qp)(o)},98905:function(e,t,i){i.d(t,{K:()=>p});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),s=i(98661),l=i(94184),c=i.n(l),d=i(19081),u=i(37381);let p=(0,s.forwardRef)((e,t)=>{var{className:i,error:s=!1,type:l="text",width:p,background:h,font:m,leftIcon:v,rightIcon:g}=e,b=(0,o._)(e,["className","error","type","width","background","font","leftIcon","rightIcon"]);let Z=(0,a.tZ)("input",(0,r._)((0,n._)({},b),{className:c()(i,u.Z.inputWithIcons,{[u.Z.error]:s},m&&u.Z["font-".concat(m)]),style:{width:p,background:h},type:l,ref:t}));return(0,a.BX)(d.gq,{paddingX:12,className:c()(i,u.Z.inputWrapper,{[u.Z.error]:s}),style:{width:p,background:h},children:[v&&(0,a.tZ)("span",{children:v}),Z,g&&(0,a.tZ)("span",{children:g})]})})}}]);