"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["9106"],{37869:function(e,t,n){n.d(t,{Z:()=>i});let i={container:"container-IpPqBD",form:"form-M5sC90",sideBySideWrap:"sideBySideWrap-vGXrwP",emailInput:"emailInput-OkIMeB",emailInputOnAccentBackground:"emailInputOnAccentBackground-TfaCGr",emailInputExpectTruncation:"emailInputExpectTruncation-VNj17x",emailInputOnWelcomePage:"emailInputOnWelcomePage-nqc9VK",emailInputWrapper:"emailInputWrapper-QlA86j",emailInputWrapperExpectTruncation:"emailInputWrapperExpectTruncation-w6Fd5V",button:"button-VFSdkv",buttonOnAccentBackground:"buttonOnAccentBackground-vmEt94",disabled:"disabled-AfIHDS",links:"links-EJFIL2"}},88362:function(e,t,n){n.d(t,{Z:()=>i});let i={img:"img-OACg1c","object-fit-cover":"object-fit-cover-u4ReeV",objectFitCover:"object-fit-cover-u4ReeV"}},44430:function(e,t,n){n.d(t,{Z:()=>i});let i={divider:"divider-Ti4OTa",vertical:"vertical-jkeHTs"}},40484:function(e,t,n){n.d(t,{Z:()=>i});let i={modal:"modal-O8Dx6X",renderOverReactLaagPortal:"renderOverReactLaagPortal-suGnvT",modalBody:"modalBody-qocErY",header:"header-eb1Nyn",title:"title-JUq5uE",description:"description-bku4qR",buttonLeft:"buttonLeft-kZKPjW"}},68742:function(e,t,n){n.d(t,{Z:()=>i});let i={panel:"panel-ulWfet","position-full":"position-full-roTcOT",positionFull:"position-full-roTcOT","position-bottom":"position-bottom-iMkmCS",positionBottom:"position-bottom-iMkmCS","position-default":"position-default-ybuNjD",positionDefault:"position-default-ybuNjD",fullscreenMobile:"fullscreenMobile-uSmZ_w",fullscreenMobileHeight:"fullscreenMobileHeight-ugjrAs",maxFullscreenMobile:"maxFullscreenMobile-xWTeST",panelEnter:"panelEnter-yiVhfS",panelEnterFrom:"panelEnterFrom-zcc_zQ",panelEnterTo:"panelEnterTo-wmKOeP",panelLeave:"panelLeave-W7aUj9",panelLeaveFrom:"panelLeaveFrom-cGPG4g",panelLeaveTo:"panelLeaveTo-xVIwDl"}},12620:function(e,t,n){n.d(t,{Z:()=>N});var i=n(27412),a=n(7409),r=n(99282),o=n(58865),l=n(16584),s=n(6400),c=n(94184),u=n.n(c),d=n(20253),p=n(95441),m=n(35702),h=n(68833),f=n(65205),g=n(98914),v=n(15771),b=n(58175),_=n(51776),y=n(74312),Z=n(31406),k=n(60308),E=n(26111),w=n(6911),x=n(84864),C=n(47929),S=n(37869);function I(){let e=(0,o._)(["Confirmation required: we sent an email to ",". Click the link there to finish subscribing."]);return I=function(){return e},e}class N extends s.Component{getSavedEmail(){return this.props.user&&this.props.user.email||null}getPrefilledEmail(){return this.props.email||this.props.freeSignupEmail||this.getSavedEmail()}async componentDidMount(){let{autoFocus:e,disabled:t}=this.props;if(this.getPrefilledEmail())this.emailInput.value=this.getPrefilledEmail();else if(e&&!(this.getPrefilledEmail()||t)&&!(0,g.K1)()){var i;null===(i=this.emailInput)||void 0===i||i.focus()}Promise.all([n.e("8427"),n.e("3134")]).then(n.bind(n,24794)).then(e=>{this.setState({fetchSuggestion:e.fetchSuggestion})})}onLoadingState(e){this.setState({loading:e,requires_confirmation:!1})}onError(e){var t;(null===(t=e.response)||void 0===t?void 0:t.status)===425&&this.setState({requires_confirmation:!0}),this.props.onError&&this.props.onError(e)}render(e,t){var i,r,o,s,c,p;let{children:m,className:h,disabled:I,allowEmptyInput:N,expectTruncation:L,isWelcomePageColor:T,loginRedirect:P,next:A,onAccentBackground:B,pub:F,referralCode:R,showLogin:M,showTerms:W,source:j,submitButtonText:O,useSubscribeLink:q,useGenericEndpoint:X,additionalPubIds:U,user:$,utm_campaign:G,onPrepareData:z,promptClassName:D,inputWrapperClassName:H,inputClassName:V,subscribeButtonClassName:J,subscribeToSpecificSectionIds:K,endpointOverride:Y,separateInputAndSubmitButton:Q,placeholder:ee}=e,{loading:et,requires_confirmation:en,currentEmail:ei}=t,ea="treatment_bold_fade"===j,er=(null===(o=(0,E.x)("referring_pub_ids"))||void 0===o?void 0:null===(r=o.split)||void 0===r?void 0:null===(i=r.call(o,","))||void 0===i?void 0:i[0])||void 0,eo=(null===(p=(0,E.x)("referring_pub_ids"))||void 0===p?void 0:null===(c=p.split)||void 0===c?void 0:null===(s=c.call(p,","))||void 0===s?void 0:s.slice(1))||void 0,el=this.getPrefilledEmail(),{iString:es,language:ec}=this.context;if(K&&(U||X))throw Error("Specific section subscriptions only supported on /api/v1/free");let eu=!Y&&!U;return(0,l.BX)("div",{className:u()(h,S.Z.container),children:[(0,l.tZ)(Z.lf.Consumer,{children:e=>{var t,n,i,r,o,s,c;let{getSessionAttribution:p}=e;return(0,l.BX)(d.ZP,{ref:this.assignForm,className:S.Z.form,noInlineErrors:!0,action:Y||(U?(0,k.n1t)("/api/v1/bulk_signup"):X?(0,k.n1t)("/api/v1/reader/signup/pub"):(0,k.n1t)("/api/v1/free")),noJsAction:Y||(U?(0,k.n1t)("/api/v1/bulk_signup",{nojs:!0}):X?(0,k.n1t)("/api/v1/reader/signup/pub",{nojs:!0}):(0,k.n1t)("/api/v1/free",{nojs:!0})),prepareData:async e=>{if(en&&(e.resend_confirmation=!0),"string"==typeof e.publications&&(e.publications=JSON.parse(e.publications)),"undefined"!=typeof window&&eu){let t=await p();e=(0,a._)({},t,e)}return z&&await z(e),e},onChangeLoadingState:this.onLoadingState.bind(this),onError:e=>this.onError(e),onSuccess:e=>this.onSuccess(e),typoFound:e=>this.setState({emailSuggestion:e}),disableSubmit:q,analyticsName:"Free Email Form",children:[(0,l.tZ)("input",{type:"hidden",name:"first_url",value:f.xY}),(0,l.tZ)("input",{type:"hidden",name:"first_referrer",value:f.ip}),(0,l.tZ)("input",{type:"hidden",name:"current_url",value:f.UE}),(0,l.tZ)("input",{type:"hidden",name:"current_referrer",value:f.xU}),(0,l.tZ)("input",{type:"hidden",name:"first_session_url",value:f.ac}),(0,l.tZ)("input",{type:"hidden",name:"first_session_referrer",value:f.qR}),(0,l.tZ)("input",{type:"hidden",name:"referral_code",value:R}),(0,l.tZ)("input",{type:"hidden",name:"source",value:j}),(0,l.tZ)("input",{type:"hidden",name:"referring_pub_id",value:er}),(0,l.tZ)("input",{type:"hidden",name:"additional_referring_pub_ids",value:null==eo?void 0:eo.join(",")}),A&&(0,l.tZ)("input",{type:"hidden",name:"redirect",value:A}),K&&(0,l.tZ)("input",{type:"hidden",name:"specific_section_ids",value:K}),K&&(0,l.tZ)("input",{type:"hidden",name:"section_and_root",value:"true"}),!U&&X&&(0,l.tZ)("input",{type:"hidden",name:"publication_id",value:F.id}),U&&(0,l.tZ)("input",{type:"hidden",name:"publications",value:JSON.stringify(U.concat(F.id))}),(0,l.BX)("div",{className:u()(D,{[S.Z.sideBySideWrap]:!Q}),children:[!!el&&(0,g.e5)(),(0,l.tZ)("div",{className:u()(H,S.Z.emailInputWrapper,{[null!==(i=S.Z.emailInputWrapperExpectTruncation)&&void 0!==i?i:"undefined"]:L}),children:(0,l.tZ)(_.oi,{className:u()(V,"pencraft",S.Z.emailInput,{[null!==(r=S.Z.emailInputOnAccentBackground)&&void 0!==r?r:"undefined"]:B,[null!==(o=S.Z.emailInputExpectTruncation)&&void 0!==o?o:"undefined"]:L,[null!==(s=S.Z.emailInputOnWelcomePage)&&void 0!==s?s:"undefined"]:T}),onChange:this.handleEmailChange,onInput:this.handleEmailChange,ref:this.assignEmailInput,type:"email",name:ea?"email-pop":"email",readOnly:!!(this.getSavedEmail()||et||I),disabled:!!(et||I),placeholder:null!=ee?ee:es("Type your email..."),value:ei||el||null})}),(0,l.tZ)(v.kG,{resetCss:!0,className:u()(J,"rightButton primary subscribe-btn",S.Z.button,{pop:ea,[null!==(c=S.Z.buttonOnAccentBackground)&&void 0!==c?c:"undefined"]:B}),type:"submit",disabled:!!(et||I||!N&&!(null===(n=this.emailInput)||void 0===n?void 0:null===(t=n.value)||void 0===t?void 0:t.trim())),onClick:()=>{q&&(location.href=(0,k.W1P)(F,(0,a._)({addBase:!0,user:$,utm_source:C.b3.substack,utm_medium:C.lP.web,utm_campaign:G,next:A},(ei||el)&&{email:ei||el})))},children:(0,l.tZ)("span",{className:"button-text ".concat(ea?"pop":""),children:O||(0,x.getSubscribeText)(F,{language:ec})})})]}),en?(0,l.tZ)("div",{children:(0,l.BX)(b.xv,{translated:!0,className:"error other-error",children:["This email address is not confirmed yet.",(0,l.tZ)("br",{}),(0,l.tZ)("a",{href:"javascript:void(0)",onClick:()=>{if(this.form)return this.form.handleSubmit()},children:"Click here"})," ","to resend the confirmation email."]})}):(0,l.tZ)("div",{id:"error-container"}),M||W||m?(0,l.BX)("div",{className:u()("subtle-help-text below-input",S.Z.links),children:[M&&(this.getSavedEmail()?(0,l.tZ)("a",{className:"login-button",href:(0,k.ZPN)({for_pub:F.subdomain}),native:!0,children:es("Not you?")}):(0,l.tZ)("a",{className:"login-button",href:(0,k.uXE)({for_pub:F.subdomain,redirect:P}),native:!0,children:es("Login")})),W&&[(0,l.tZ)("a",{className:"legal",href:(0,w.RF)({pub:F}),target:"_blank",native:!0,children:es("Privacy")}),(0,l.tZ)("a",{className:"legal",href:(0,w.P8)({pub:F}),target:"_blank",native:!0,children:es("Terms")}),(0,l.tZ)("a",{className:"legal",href:(0,w.WF)(),target:"_blank",native:!0,children:es("Information collection notice")})],m]}):null]})}}),(0,l.tZ)(y.cr,{onRequest:()=>n.e("3894").then(n.bind(n,19523)),resolve:e=>e.EmailTypoHandler,module:"@/frontend/login/typo_handler/EmailTypoHandler",emailSuggestions:this.state.emailSuggestions,currentEmail:this.state.currentEmail,onAccept:this.onAcceptSuggestion})]})}constructor(e){super(e),(0,i._)(this,"emailInput",void 0),(0,i._)(this,"form",void 0),(0,i._)(this,"assignEmailInput",e=>{this.emailInput=e}),(0,i._)(this,"assignForm",e=>{this.form=e}),(0,i._)(this,"handleEmailChange",()=>{var e,t,n;let i=null===(e=this.emailInput)||void 0===e?void 0:e.value;if(i){if(this.setState({currentEmail:i}),this.state.emailSuggestions&&this.state.emailSuggestions.hasOwnProperty(i))return;null===(t=(n=this.state).fetchSuggestion)||void 0===t||t.call(n,i).then(e=>{let[t,n]=e;this.setState({emailSuggestions:(0,r._)((0,a._)({},this.state.emailSuggestions),{[null!=t?t:"undefined"]:null!=n?n:""})})})}}),(0,i._)(this,"_onSuccess",async e=>{let{iTemplate:t}=this.context;(!0===e.body.is_new_subscriber||!1===e.body.prompt_to_login&&!0===e.body.didSignup)&&h.IU(),(Array.isArray(e.body)&&e.body.every(e=>e.requires_confirmation)||e.body.requires_confirmation)&&(this.props.onConfirmationRequired?await this.props.onConfirmationRequired(e):alert(t(I(),e.body.email))),this.props.freeSignupEmail&&this.props.freeSignupEmail!==e.body.email&&(0,m.a)({freeSignupEmail:e.body.email}),this.props.onSuccess&&await this.props.onSuccess(e)}),(0,i._)(this,"onSuccess",async e=>{"undefined"!=typeof window&&window.campaign&&(0,E.x)("referralCode")?window.campaign.identify({email:e.body.email},()=>this._onSuccess(e)):await this._onSuccess(e)}),(0,i._)(this,"onAcceptSuggestion",e=>{this.emailInput&&(this.emailInput.value=null!=e?e:"",this.form.handleSubmit(null,!0))}),this.state={emailSuggestions:{}}}}(0,i._)(N,"contextType",p.wj)},27576:function(e,t,n){n.d(t,{A:()=>o});var i=n(16584),a=n(64515),r=n(91313);function o(e){let{className:t,type:n,accentColor:o}=e;return(0,i.BX)(a.l,{name:"ReaderBadgeIcon",className:t,svgParams:{width:22,height:22,viewBox:"0 0 22 22"},fill:"none",stroke:"none",strokeWidth:1,children:[(0,i.tZ)("circle",{cx:"11",cy:"11",r:"11",fill:"var(--color-bg-primary)"}),(0,i.tZ)("circle",{cx:"11",cy:"11",r:"9",fill:o||r.H}),"subscribed"===n?(0,i.BX)(i.HY,{children:[(0,i.tZ)("ellipse",{rx:"2.72196",ry:"2.68806",transform:"matrix(0.707101 -0.707113 0.707101 0.707113 12.926 12.9255)",stroke:"white"}),(0,i.tZ)("ellipse",{rx:"2.72196",ry:"2.68806",transform:"matrix(0.707101 -0.707113 0.707101 0.707113 9.07543 9.07503)",stroke:"white"}),(0,i.tZ)("ellipse",{rx:"2.68806",ry:"2.72196",transform:"matrix(-0.707101 -0.707113 -0.707101 0.707113 9.05152 12.9494)",stroke:"white"}),(0,i.tZ)("ellipse",{rx:"2.68806",ry:"2.72196",transform:"matrix(-0.707101 -0.707113 -0.707101 0.707113 12.95 9.05009)",stroke:"white"})]}):(0,i.BX)(i.HY,{children:[(0,i.tZ)("path",{d:"M11.9018 10.3229C11.9018 12.2029 10.3777 13.7269 8.49775 13.7269C6.61777 13.7269 5.09375 12.2029 5.09375 10.3229C5.09375 8.44296 6.61777 6.91894 8.49775 6.91894C10.3777 6.91894 11.9018 8.44296 11.9018 10.3229Z",stroke:"white"}),(0,i.tZ)("path",{d:"M12.8178 13.4959C12.8178 15.3759 11.2938 16.8999 9.41377 16.8999C7.5338 16.8999 6.00977 15.3759 6.00977 13.4959C6.00977 11.6159 7.5338 10.0919 9.41377 10.0919C11.2938 10.0919 12.8178 11.6159 12.8178 13.4959Z",stroke:"white"}),(0,i.tZ)("path",{d:"M15.9564 13.503C15.9564 15.383 14.4324 16.907 12.5524 16.907C10.6725 16.907 9.14844 15.383 9.14844 13.503C9.14844 11.623 10.6725 10.099 12.5524 10.099C14.4324 10.099 15.9564 11.623 15.9564 13.503Z",stroke:"white"}),(0,i.tZ)("path",{d:"M14.4047 8.49824C14.4047 10.3782 12.8807 11.9022 11.0007 11.9022C9.1207 11.9022 7.59668 10.3782 7.59668 8.49824C7.59668 6.61826 9.1207 5.09424 11.0007 5.09424C12.8807 5.09424 14.4047 6.61826 14.4047 8.49824Z",stroke:"white"}),(0,i.tZ)("path",{d:"M16.9066 10.3229C16.9066 12.2029 15.3826 13.7269 13.5026 13.7269C11.6227 13.7269 10.0986 12.2029 10.0986 10.3229C10.0986 8.44296 11.6227 6.91894 13.5026 6.91894C15.3826 6.91894 16.9066 8.44296 16.9066 10.3229Z",stroke:"white"})]})]})}},95441:function(e,t,n){n.d(t,{M1:()=>m,_7:()=>h,fz:()=>f,wj:()=>p});var i=n(7409),a=n(99282),r=n(16584),o=n(36808),l=n.n(o),s=n(98661),c=n(68833),u=n(48884),d=n(31742);let p=(0,s.createContext)({language:"en",baseLanguage:"en",preferredLanguage:l().get(d.ky.PREFERRED_LANGUAGE),userLocale:void 0,iString:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e},iContext:(e,t)=>t,iPlural:(e,t,n)=>n>1?t:e,iTemplate:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return(0,u.u8)(e,...n)},iCombo:function(e,t,n,i){for(var a=arguments.length,r=Array(a>4?a-4:0),o=4;o<a;o++)r[o-4]=arguments[o];return t},setPreferredLanguage:e=>void 0,iMarker:e=>e});function m(){return(0,s.useContext)(p)}function h(e){let{children:t,language:n="en",locale:a,preferredLanguage:o}=e,[m,h]=(0,s.useState)(()=>o);(0,s.useEffect)(()=>{m?l().set(d.ky.PREFERRED_LANGUAGE,m):l().remove(d.ky.PREFERRED_LANGUAGE)},[m]);let f=(0,s.useMemo)(()=>{let e=a?"".concat(a.language,"-").concat(a.region):void 0;return(0,i._)({language:n,baseLanguage:n,preferredLanguage:m,userLocale:e,setPreferredLanguage:e=>{(0,c.j)(c.FP.PREFERRED_LANGUAGE_SET,{from:n,to:e,surface:"writer-signup"}),h(e)}},u.mb.i(n))},[n,m,a]);return(0,r.tZ)(p.Provider,{value:f,children:t})}function f(e){let t=(0,s.forwardRef)((t,n)=>{let o=m();return(0,r.tZ)(e,(0,a._)((0,i._)({},o,t),{ref:n}))});return t.displayName="withI18NContext(".concat(e.displayName||e.name||"Anonymous",")"),t}p.displayName="I18NContext"},21811:function(e,t,n){n.d(t,{j:()=>r,l:()=>o});var i=n(7409);let a={};function r(e){a=(0,i._)({},e)}function o(){return(0,i._)({},a)}},19081:function(e,t,n){n.d(t,{M5:()=>m,X2:()=>u,gq:()=>c,hs:()=>s,sg:()=>p,tu:()=>d});var i=n(7409),a=n(99282),r=n(16584),o=n(98661),l=n(71068);let s=(0,o.forwardRef)(function(e,t){return(0,r.tZ)(l.xu,(0,a._)((0,i._)({},e),{display:e.display||"flex",ref:t}))}),c=s,u=c,d=(0,o.forwardRef)(function(e,t){return(0,r.tZ)(l.xu,(0,a._)((0,i._)({},e),{display:e.display||"flex",direction:"column",ref:t}))}),p=d,m=(0,l.E7)({display:"flex",justifyContent:"center",alignItems:"center"})},63124:function(e,t,n){n.d(t,{sc:()=>s,_n:()=>l,Uv:()=>o});var i=n(16584),a=n(19425);n(98661);var r=n(71068);let o=e=>{let{children:t}=e;return(0,i.tZ)(r.xu,{className:"backdropContainer-cOZ3hh",children:t})},l=()=>(0,i.tZ)(r.xu,{className:"backdrop-IqiELY","aria-hidden":!0}),s=e=>{let{children:t}=e;return(0,i.tZ)(a.u.Child,{enter:"backdropEnter-ZpaQIK",enterFrom:"backdropEnterFrom-CKaxGg",enterTo:"backdropEnterTo-QxRXXs",leave:"backdropLeave-IagLtt",leaveFrom:"backdropLeaveFrom-dCf923",leaveTo:"backdropLeaveTo-Zn8qab",children:t})}},80058:function(e,t,n){n.d(t,{E:()=>l,X:()=>s});var i=n(58865),a=n(95441);function r(){let e=(0,i._)(["","'s avatar"]);return r=function(){return e},e}function o(){let e=(0,i._)(["View ","'s profile"]);return o=function(){return e},e}function l(e,t){let{iString:n,iTemplate:i}=(0,a.M1)();if(t)return t;let o=null!=e?e:n("User");return i(r(),o)}function s(e,t){let{iString:n,iTemplate:i}=(0,a.M1)();if(t)return t;let r=null!=e?e:n("User");return i(o(),r)}},63474:function(e,t,n){n.d(t,{A0:()=>a.A,M5:()=>i.M5,X2:()=>i.X2,oB:()=>r.oB,sg:()=>i.sg,zo:()=>r.zo});var i=n(31892),a=n(39276),r=n(71068)},36889:function(e,t,n){n.d(t,{V:()=>d});var i=n(7409),a=n(99282),r=n(98848),o=n(16584),l=n(94184),s=n.n(l),c=n(71068),u=n(26725);function d(e){var{className:t,style:n,type:l,width:d,height:p,size:m,maxWidth:h,elevated:f,radius:g="sm"}=e,v=(0,r._)(e,["className","style","type","width","height","size","maxWidth","elevated","radius"]);return null!=m&&(d=m,p=m),(0,o.tZ)(c.xu,(0,a._)((0,i._)({},v),{className:s()(u.Z.placeholder,t,f&&u.Z.elevated,"bar"===l&&u.Z.bar,"circle"===l&&u.Z.circle),radius:g,style:(0,a._)((0,i._)({},n),{width:d,height:p,maxWidth:h,minWidth:d})}))}},51699:function(e,t,n){n.d(t,{F:()=>i});function i(e){let{plan:t}=e;return!!t.metadata&&!!t.metadata.founding&&!t.metadata.fixed_price}},17043:function(e,t,n){n.d(t,{UH:()=>r,zF:()=>a,zJ:()=>o});var i=n(14773);function a(e,t){var n,a;let{quality:l="auto:good",format:s="auto",crop:c="limit",lossy:u=!1,attachment:d=!1,filename:p=null,gravity:m=null,height:h=null,aspect:f=null,backgroundColor:g,version:v=null,smartCrop:b=!1,portraitCrop:_=!1,skipDomainValidation:y=!1,leadingSegments:Z=[],trailingSegments:k=[],blurSigma:E=null,bgAuto:w=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return e;e.startsWith("/")&&!e.startsWith("//")&&(e=(0,i.ZJ)()+e),e=r(e);try{if(new URL(e).hostname.endsWith(".localhost"))return e}catch(e){}if("undefined"!=typeof window&&(null===(a=window)||void 0===a?void 0:null===(n=a.location)||void 0===n?void 0:n.hostname)&&["subwit.com","herokuapp.com"].reduce((e,t)=>e||window.location.hostname.endsWith(t),!1)&&(e=e.replace("//substack.com","//".concat(window.location.hostname))),e.startsWith("https://substackcdn.com")||e.startsWith(i.L4))return e;if(e.startsWith("https://d3b3sm9t19x0yd.cloudfront.net"))return e.replace(/^https:\/\/d3b3sm9t19x0yd\.cloudfront\.net/,i.L4);if(e.startsWith("https://res.cloudinary.com"))return e.replace(/^https:\/\/res\.cloudinary\.com\/[^/]+/,i.L4);if(!y&&!e.match(/^https?:\/\/(bucketeer[^/]*\.s3\.amazonaws\.com|(.*\.)?substack\.com|substack\.info|substack-post-media\.s3\.amazonaws\.com|substack-post-media-staging\.s3\.amazonaws\.com|substack-video\.s3\.amazonaws\.com|substack-video-staging\.s3\.amazonaws\.com|substack-staging-pr-\d+\.herokuapp\.com|.*\.ngrok\.io|.*\.subwit\.com|pbs\.twimg\.com|storage\.opensea\.io).*/))return e;if(b&&t&&h){let n=o(e);if(n){let e=t/h,i=n.width/n.height;(e<1&&i>=1||e>=1&&i<1||1===e&&i>=1||1===e&&i<=1)&&Math.abs(e-i)>=.5&&(c="fill",m=null!=m?m:"auto")}}if(b&&(c="fill",m=null!=m?m:"auto"),f&&t&&null==h&&"string"==typeof f&&f.match(/^(\d+\.?\d*:\d+\.?\d*|\d+\.?\d*)$/)){if(f.includes(":")){let[e,n]=f.split(":").map(e=>parseFloat(e));h=Math.round(t*n/e)}else h=Math.round(t/Number(f))}let x=e=>e.replace(/,/g,"%252C"),C=[t&&"w_".concat(t),h&&"h_".concat(h),c&&(t||h)&&"c_".concat(c),s&&"f_".concat(s),l&&"q_".concat(l),"fl_".concat(u?"lossy":"progressive:steep"),m&&"g_".concat(m),d&&"fl_attachment".concat(p?":".concat(x(p)):""),w&&"b_auto:".concat(w),g&&"b_rgb:".concat(g),E&&"e_blur:".concat(E)].filter(Boolean).join(","),S=[t&&"w_".concat(t),s&&"f_".concat(s),l&&"q_".concat(l),"fl_".concat(u?"lossy":"progressive:steep"),d&&"fl_attachment".concat(p?":".concat(x(p)):""),g&&"b_rgb:".concat(g)].filter(Boolean).join(","),I=[c&&(t||h)&&"c_".concat(c),m&&"g_".concat(m),f?"ar_".concat(f):"ar_1"].filter(Boolean).join(","),N=_?[S,"/if_ar_lt_1.0/",I,"/if_end"].join(""):[C].filter(Boolean).join(","),L=Z.concat([N]).concat(k).join("/"),T="$s_!".concat(function(e){let t=0x811c9dc5;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t^=255&i,t=Math.imul(t=Math.imul(t,0x1000193)^i>>8&255,0x1000193)}let n=t>>>0;return btoa(String.fromCharCode(n>>>24&255,n>>>16&255,n>>>8&255,255&n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"").slice(0,4)}(e),"!");return"".concat(i.L4,"/image/fetch/").concat(T,",").concat(L,"/").concat(encodeURIComponent(e+(v?"".concat(-1!==e.indexOf("?")?"&":"?","version=").concat(v):"")))}function r(e){if(!e)return e;for(let t of[/^https:\/\/substackcdn\.com\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i,/^https:\/\/substackcdn\.net\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i,/^https:\/\/cdn\.substack\.com\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i,/^https:\/\/cdn\.substack\.info\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i,/^https:\/\/d3b3sm9t19x0yd\.cloudfront\.net\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i,/^https:\/\/res\.cloudinary\.com\/hhsslviub\/image\/fetch\/(?:\$[^/]+\/)?[^/]+\/(.+)$/i]){let n=t.exec(e);if(n)return decodeURIComponent(n[1])}return e}function o(e){let t=e.match(/(\d+)x(\d+)(\.\w+)?$/);return t?{width:+t[1],height:+t[2]}:null}}}]);