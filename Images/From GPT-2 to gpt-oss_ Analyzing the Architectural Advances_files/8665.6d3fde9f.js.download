"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8665"],{89043:function(e,t,n){n.d(t,{Z:()=>o});let o={container:"container-PNh5cP",containerBulwark:"containerBulwark-Y0wz4B",noPodcasts:"noPodcasts-reia2s"}},2881:function(e,t,n){n.d(t,{m:()=>et});var o=n(16584),i=n(30396),r=n(80569),a=n.n(r),s=n(95441),l=n(15771),c=n(19081),d=n(6490),u=n(58175);let m=e=>{let{isOpen:t,onContinue:n}=e,{iString:r}=(0,s.M1)(),[a,m]=(0,i.eJ)(!1);return(0,o.BX)(d.u_,{isOpen:t,children:[(0,o.tZ)(d.xB,{title:r("Switch to Bitcoin"),showClose:!1}),(0,o.tZ)(d.fe,{children:(0,o.BX)(c.tu,{gap:24,children:[(0,o.BX)(c.tu,{gap:16,children:[(0,o.tZ)(u.xv.B4,{translated:!0,children:"Switching to Bitcoin will end your auto-renewing credit card payments."}),(0,o.BX)(u.xv.B4,{translated:!0,children:["Please note that Substack cannot process refunds or auto-renewals for Bitcoin payments. You will now be sent to"," ",(0,o.tZ)("a",{href:"https://opennode.com",target:"_blank",rel:"noopener",children:"OpenNode"})," ","to complete your checkout."]})]}),(0,o.tZ)(l.zx,{onClick:()=>{m(!0),n()},disabled:a,children:r("Continue")})]})})]})};var p=n(57407),_=n(61108),h=n(94184),g=n.n(h),v=n(51776);let y="themed-qm5g5y",b=e=>{let{placeholder:t,maxLength:n,value:i,symbol:r,themed:a=!1,onChange:s}=e;return(0,o.BX)(c.gq,{alignItems:"center",justifyContent:"start",className:g()("inputContainer-JJXl4U",{[y]:a}),children:[(0,o.tZ)(u.xv.B3,{as:"span",color:a?"pub-secondary-text":"secondary",weight:"semibold",className:"currencyInput-n4aG03",children:r}),(0,o.tZ)(v.oi,{name:"Confirm Founding Price","aria-label":"Confirm founding price",value:i,placeholder:t,maxLength:n,onChange:e=>s(e.currentTarget.value),onInput:e=>s(e.currentTarget.value),className:g()("inputField-ZlLLCs",{[y]:a})})]})};var f=n(68833),w=n(84864);let Z=e=>{let{currency:t,isValid:n,newUpgradeModal:r,planName:a,price:l,setValidationState:d}=e,[m,h]=(0,i.eJ)(""),g=parseInt(l);(0,i.d4)(()=>((0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_REQUIRED,{price:l,source:"upgrade modal"}),()=>{n||(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_DISMISSED,{price:l,source:"upgrade modal"})}),[]);let{iString:v}=(0,s.M1)(),y=(0,w.isZeroDecimalCurrency)(t)?1:100;return(0,o.BX)(c.tu,{font:r?"text":void 0,gap:8,paddingTop:8*!r,borderTop:r?void 0:"detail",alignItems:"start",justifyContent:"start",children:[(0,o.BX)(u.xv,{translated:!0,as:"p",size:r?14:17,color:"secondary",children:["Please confirm you want to pay"," ",(0,o.tZ)(u.xv,{as:"span",color:"primary",weight:"semibold",children:I18N.p(g?(0,w.centsToPriceString)(g*y,t):l)})," ","per year for a ",I18N.p(null!=a?a:v("Founding Member"))," subscription by typing the price below."]}),(0,o.BX)(c.gq,{alignItems:"center",justifyContent:"start",gap:8,style:{width:"100%"},children:[(0,o.tZ)(b,{placeholder:l,symbol:(0,w.currencySymbol)(t),maxLength:l.length,value:m,themed:!1,onChange:e=>{e===l?(d(!0),h(e)):e!==m&&(d(!1),h(e))}}),n?(0,o.tZ)(p.Z,{size:24,style:{color:"var(--color-accent-fg-green)"}}):(0,o.tZ)(_.Z,{size:24,style:{color:"var(--color-accent-fg-red)"}})]})]})};var C=n(89734),x=n.n(C),P=n(58865),I=n(7409),B=n(99282),S=n(64515);let N=e=>(0,o.tZ)(S.l,(0,B._)((0,I._)({},e),{name:"WarningIcon",svgParams:{viewBox:"-2 -2 18 18"},children:(0,o.tZ)("path",{d:"M8 0C3.582 0 0 3.582 0 8s3.582 8 8 8 8-3.582 8-8S12.418 0 8 0zM9 12H7v-2h2V12zM9 8H7V4h2V8z"})}));var k=n(87077),A=n(31582);let R={outlineWrapper:"outlineWrapper-MqmfKS",outlineWrapperWithWarning:"outlineWrapperWithWarning-x5ALXu",warningContainer:"warningContainer-lQlVcA",outlineWrapperSelected:"outlineWrapperSelected-KXkgz5",amountInput:"amountInput-pcn7kh",amountInputDeselected:"amountInputDeselected-W75Nrd"};function L(){let e=(0,P._)([" per ",""]);return L=function(){return e},e}function M(){let e=(0,P._)(["Amount must be greater than ",""]);return M=function(){return e},e}let X=e=>{var t;let{amount:n,currency:r,isSelected:a,outlineOnSelect:l,plan:c,usePer:d,showDuration:u=!0,disableInput:m=!1,className:p,disableWarning:_,onChangeAmount:h,truncateInterval:v=!1}=e,y=(0,i.sO)(null),[b,f]=(0,i.eJ)(!1),Z=(0,i.I4)(e=>{h(e.toString().replace(/[^\d.]/g,""))},[h]);r||(r=c.currency),(0,i.d4)(()=>{let e=(0,A.vq)(c,r);f(!!(!_&&e&&null!==n&&r&&parseFloat(Number((0,w.isZeroDecimalCurrency)(r)?n:100*Number(n)).toFixed(2))<e&&a))},[n,r,_,a,c]),(0,i.bt)(()=>{setTimeout(()=>{y.current&&(y.current.style.width="1px",y.current.style.width="".concat(y.current.scrollWidth,"px"),y.current.scrollLeft=0)},0)},[n,y]),(0,i.d4)(()=>{a&&(y.current.focus(),y.current.select())},[y,a]);let{iTemplate:C,iString:x}=(0,s.M1)(),P=v&&"year"===c.interval?"yr":v&&"month"===c.interval?"mo":c.interval;return(0,o.BX)("span",{className:g()(R.outlineWrapper,p,{[R.outlineWrapperSelected]:l&&a,[R.outlineWrapperWithWarning]:b}),children:[(0,w.centsToPriceString)(100,r).replace("1",""),(0,o.tZ)("input",{disabled:m,ref:y,className:g()(R.amountInput,{[R.amountInputDeselected]:!a}),id:"money-variable-amount",type:"text","aria-label":"founding member amount",autoComplete:"off",value:"string"==typeof n?n:c.amount/100,onKeyDown:e=>{"ArrowUp"===e.key?(Z(Number(n||c.amount/100)+5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0)):"ArrowDown"===e.key&&(!n||Number(n)>=5)&&(Z(Number(n||c.amount/100)-5),setTimeout(()=>{y.current.selectionStart=y.current.selectionEnd=y.current.value.length},0))},onInput:e=>{Z(e.target.value)}}),(0,o.tZ)("input",{name:"amount",type:"hidden",value:"string"==typeof n?100*(Number(n)||0):c.amount}),u&&"forever"!==c.interval&&(d?C(L(),x(P)):"/".concat(x(P))),b&&(0,o.tZ)("div",{className:R.warningContainer,children:(0,o.tZ)(k.u,{text:C(M(),(0,w.centsToPriceString)(null!==(t=(0,A.vq)(c,r))&&void 0!==t?t:0,r)),children:(0,o.tZ)(N,{stroke:"white",height:20,fill:"red",strokeWidth:1})})})]})};var F=n(43570);let E=e=>{let{currency:t,foundingAmount:n,foundingName:i,isSelected:r,isCurrent:a,plan:l,onChangeAmount:d}=e,{iString:m}=(0,s.M1)();return(0,o.BX)(c.X2,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,o.BX)(c.sg,{children:[(0,o.tZ)(u.xv,{children:i}),(0,o.tZ)(X,{amount:n?n.toString():"",currency:t,isSelected:r,plan:l,usePer:!0,onChangeAmount:e=>{d(Number(e))}})]})}),a&&(0,o.tZ)(F.Vp,{priority:"secondary",children:m("Current")})]})};var O=n(10656);let D=e=>{let{currency:t,plan:n,isCurrent:i,isSelected:r,language:a}=e,{iString:l}=(0,s.M1)();return(0,o.BX)(c.X2,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.tZ)(u.xv.B4,{weight:r?"semibold":"regular",children:(0,O.tS)(n,{currency:t,noTrial:!0,recurring:!0,language:a})}),i&&(0,o.tZ)(F.Vp,{priority:"secondary",children:l("Current")})]})};var z=n(17352),T=n(57640),U=n(51699);let q={selected:"selected-Rkwzkv"},V=e=>{let{currency:t,foundingAmount:n,foundingName:i,isCurrent:r,language:a,plan:s,isSelected:l,onChangePlan:c,onChangeFoundingAmount:d}=e;return(0,o.BX)(z.Z,{as:"label",direction:"row",alignItems:"center",gap:12,padding:16,radius:"sm",cursor:"pointer",pressable:"lg",outline:l?"accent":"detail",className:l&&q.selected,children:[(0,o.tZ)(T.Y,{checked:l,name:"plan",value:s.id,onClick:e=>{c({planId:e.target.value})}}),(0,U.F)({plan:s})?(0,o.tZ)(E,{currency:t,foundingAmount:n,foundingName:i,isCurrent:r,isSelected:l,plan:s,onChangeAmount:d}):(0,o.tZ)(D,{currency:t,plan:s,isCurrent:r,isSelected:l,language:a})]})},W=e=>{let{currency:t,foundingAmount:n,foundingName:i,getIsCurrentPlan:r,language:a,plans:s,selectedPlanId:l,onChangeFoundingAmount:d,onChangePlan:u}=e,m=x()(s,"amount").filter(e=>{var t;return!(null===(t=e.metadata)||void 0===t?void 0:t.bitcoin)}),p=null!=l?l:"";return(0,o.tZ)(c.sg,{gap:12,flex:{desktop:"grow",mobile:"auto"},children:m.map(e=>(0,o.tZ)(V,{currency:t,foundingAmount:n,foundingName:i,isCurrent:r(e),isSelected:e.id===p,language:a,plan:e,onChangePlan:u,onChangeFoundingAmount:d}))})};var j=n(61254),H=n(24791);let K=e=>{let{currency:t,foundingAmount:n,foundingAmountLessThanMinimum:i,foundingName:r,hasChanges:a,sub:l,isNewPlanClassicFounding:d,newPlan:m}=e,{iString:p,language:_}=(0,s.M1)(),h=(0,w.isZeroDecimalCurrency)(t)?1:100,g=a&&m&&(!d||!i),v=g?d?"".concat((0,w.centsToPriceString)((null!=n?n:0)*h,t)," ").concat(p("per year")):(0,O.tS)(m,{language:_,currency:t}):p("n/a");return(0,o.BX)(z.Z,{shadow:"none",gap:20,padding:16,children:[(0,o.tZ)(u.xv.B3,{weight:"semibold",children:p("Summary")}),(0,o.BX)("div",{className:"grid-NonZWA",children:[l.plan&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(u.xv.B4,{children:p("Current plan")}),(0,o.BX)(c.sg,{"data-testid":"upgrade-summary-current-plan",gap:4,children:[(0,o.tZ)(u.xv.B4,{align:"right",children:(0,H.sM)({sub:l})?r:G({plan:l.plan,language:_,currency:t})}),(0,H.sM)({sub:l})&&(0,o.tZ)(u.xv.B4,{color:"secondary",align:"right",children:(0,O.tS)(l.plan,{language:_,currency:t})})]})]}),(0,o.tZ)(u.xv.B4,{children:p("New plan")}),(0,o.tZ)(c.sg,{"data-testid":"upgrade-summary-new-plan",gap:4,children:(0,o.tZ)(u.xv.B4,{align:"right",weight:"regular",color:g?"primary":"secondary",children:v})}),(0,o.tZ)(j.iz,{className:"table-divider-O5XQ7c"}),(0,o.tZ)(u.xv.B4,{weight:"semibold",children:p("Total")}),(0,o.tZ)(u.xv.B4,{"data-testid":"upgrade-summary-total",align:"right",color:g?"primary":"secondary",weight:g?"semibold":"regular",children:v})]})]})},G=e=>{var t,n,o;let{plan:i,language:r,currency:a}=e;return(null===(t=i.metadata)||void 0===t?void 0:t.founding)==="yes"?null!==(o=null===(n=i.metadata)||void 0===n?void 0:n.short_description)&&void 0!==o?o:"Founding membership":(0,O.tS)(i,{language:r,currency:a})};var Y=n(98914),J=n(26111);let $=e=>{var t,n;let{pub:o,sub:i}=e,r=(0,H.MO)(o);if(!r)return 0;let a=(0,A.$e)(r,i.currency),s=i.is_founding&&i.plan&&(0,H.sM)({sub:i})&&r.interval===i.plan.interval?(0,A.$e)(i.plan,i.currency):null,l=(0,w.isZeroDecimalCurrency)(null!==(t=i.currency)&&void 0!==t?t:"usd")?1:100;return(null!==(n=null!=s?s:a)&&void 0!==n?n:0)/l},Q=e=>{let{pub:t,sub:n}=e,o=null==n?void 0:n.plan;if(!o)return null;if((0,H.sM)({sub:n})){let e=(0,H.MO)(t);if(e&&e.interval===o.interval)return e}return o},ee=e=>{var t,n;let{plan:o,sub:i}=e;return!!o&&!!i.plan&&(!!(o.id===i.plan.id||(0,H.sM)({sub:i})&&(0,U.F)({plan:o})&&o.interval===i.plan.interval)||o.amount===i.plan.amount&&o.interval===i.plan.interval&&o.currency===i.plan.currency&&(null===(t=o.metadata)||void 0===t?void 0:t.bitcoin)===(null===(n=i.plan.metadata)||void 0===n?void 0:n.bitcoin))},et=e=>{var t,n,r;let{isOpen:p,preselectedPlan:_,pub:h,sub:g,onClose:v}=e,{iString:y,language:b}=(0,s.M1)(),[C,x]=(0,i.eJ)(!1),[P,I]=(0,i.eJ)(Q({pub:h,sub:g})),[B,S]=(0,i.eJ)($({pub:h,sub:g})),[N,k]=(0,i.eJ)(!1),[A,R]=(0,i.eJ)(!1),[L,M]=(0,i.eJ)(null),X=(0,i.Ye)(()=>(h.plans||[]).filter(e=>{if(h.disable_annual_subscriptions){var t;return"year"!==e.interval||(null===(t=e.metadata)||void 0===t?void 0:t.founding)}return!h.disable_monthly_subscriptions||"month"!==e.interval}),[h.plans]),F=X.some(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.bitcoin}),E=null!==(t=(0,H.H$)(h))&&void 0!==t?t:"",O=null!==(n=g.currency)&&void 0!==n?n:"usd",D=(0,w.isZeroDecimalCurrency)(O),z=D?1:100,T=P&&!ee({plan:P,sub:g}),q=B!==$({pub:h,sub:g}),V=T||q,j=parseFloat((B*z).toFixed(2))<(null!==(r=(0,H.rm)({pub:h,currency:O}))&&void 0!==r?r:0),G=P&&(0,U.F)({plan:P}),et=G&&q&&(null!=B?B:0)>=(D?1e6:1e4),en=!!(C||!V||et&&!N||G&&j||L);(0,i.d4)(()=>{if(p&&_){if("yearly"===_){let e=X.find(e=>"year"===e.interval&&1===e.interval_count);e&&I(e)}else if("founding"===_){let e=(0,H.MO)(h);e&&I(e)}}},[p,X,_,h]);let eo=(0,i.I4)(()=>{I(Q({pub:h,sub:g})),S($({pub:h,sub:g}))},[h,g]),ei=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&eo(),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_DISMISSED,{plan:P}),v()},er=async function(){let{quantity:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!P)return;x(!0);let t=B&&G?B*z:void 0;if(et&&!N){x(!1);return}try{var n;let o=await a().post("/api/v1/subscription/change_plan").send({planId:P.id,foundingAmount:t,quantity:e,token:(0,J.x)(window._preloads.original_url,"token")});(null===(n=o.body)||void 0===n?void 0:n.opennodePaymentUrl)?setTimeout(()=>{window.location.href=o.body.opennodePaymentUrl},30):(x(!1),alert(y("Success! You've changed your plan")),(0,f.j)(f.FP.UPGRADE_PLAN_MODAL_SUBMITTED,{plan:P,amount:null!=t?t:null}),(0,J.x)("redirect")?(0,Y.uX)((0,J.x)("redirect"),{local_navigation:!1}):((0,Y.iO)("change_plan"),window.location.reload()))}catch(e){x(!1),M((0,Y.zx)(e))}},ea=e=>{k(e),e&&(0,f.j)(f.FP.FOUNDING_PRICE_CONFIRMATION_SUBMITTED,{price:B,source:"upgrade modal"})};return X.length?(0,o.BX)("div",{children:[F&&(0,o.tZ)(m,{isOpen:A,onContinue:()=>er()}),(0,o.BX)(d.u_,{isOpen:p,testId:"upgrade-plan-modal",width:700,onClose:C?()=>{}:v,fullscreenMobile:!0,children:[(0,o.tZ)(d.xB,{title:y("Change plan"),onClose:v,showDivider:!0,showClose:!0}),(0,o.tZ)(d.fe,{children:(0,o.BX)(c.hs,{direction:{desktop:"row",mobile:"column"},gap:20,children:[(0,o.tZ)(W,{currency:O,foundingAmount:B,foundingName:E,getIsCurrentPlan:e=>ee({plan:e,sub:g}),language:b,plans:X,selectedPlanId:null==P?void 0:P.id,onChangeFoundingAmount:e=>{S(e),M(null),k(!1)},onChangePlan:e=>{let{planId:t}=e,{plans:n}=h,o=null==n?void 0:n.find(e=>e.id===t);o&&((0,f.j)(f.FP.UPGRADE_PLAN_MODAL_PLAN_CHANGED,{oldPlan:P,newPlan:o}),I(o),M(null))}}),(0,o.BX)(c.sg,{gap:40,flex:"grow",children:[(0,o.tZ)(K,{currency:O,foundingAmount:B,foundingAmountLessThanMinimum:j,foundingName:E,hasChanges:V,isNewPlanClassicFounding:!!G,newPlan:P,sub:g}),et&&(0,o.tZ)(Z,{price:B?B.toString():"",isValid:N,planName:E,currency:O,setValidationState:e=>ea(e),newUpgradeModal:!0}),L&&(0,o.tZ)(u.xv,{color:"error",size:14,font:"text",children:L})]})]})}),(0,o.tZ)(d.mz,{showDivider:!0,primaryButton:(0,o.tZ)(l.zx,{priority:"primary",onClick:()=>{var e;(null==P?void 0:null===(e=P.metadata)||void 0===e?void 0:e.bitcoin)?(ei(!1),R(!0)):er()},loading:C,disabled:en,children:C?y("Loading..."):y("Change plan")}),secondaryButton:(0,o.tZ)(l.zx,{priority:"secondary",onClick:()=>ei(),loading:C,children:y("Cancel")})})]})]}):null}},95031:function(e,t,n){n.d(t,{_:()=>a});var o=n(16584),i=n(75744),r=n(58175);let a=e=>{let{hideTerms:t,pub:n,showIntrinioAttrib:a}=e,s=n.has_custom_tos||n.has_custom_privacy,l=(0,o.BX)("div",{className:"footer-copyright-blurb",children:["\xa9 ",new Date().getFullYear()," ",n&&n.copyright||"Substack Inc"]}),c=(0,o.BX)(o.HY,{children:[a&&(0,o.BX)(r.xv,{translated:!0,as:"div",className:"footer-copyright-blurb",children:["Market data by ",(0,o.tZ)("a",{href:"https://intrinio.com/",children:"Intrinio"})]}),!t&&(0,o.tZ)("div",{className:"footer-terms-blurb",children:(0,o.tZ)(i.nO,{publication:n})})]});return s?(0,o.BX)(o.HY,{children:[(0,o.BX)("div",{className:"footer-blurbs",children:[l,!t&&(0,o.tZ)("div",{className:"footer-terms-blurb",children:(0,o.tZ)(i.Ug,{pub:n})})]}),(0,o.BX)("div",{className:"footer-blurbs",children:[(0,o.tZ)("div",{className:"footer-copyright-blurb",children:"Substack"}),c]})]}):(0,o.BX)("div",{className:"footer-blurbs",children:[l,c]})}},10968:function(e,t,n){n.d(t,{Li:()=>b,kw:()=>P});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(94184),l=n.n(s),c=n(16864),d=n(24202),u=n(92291),m=n(71068),p=n(15771),_=n(19081),h=n(17172),g=n(45783),v=n(91400),y=n(54796);function b(e){let{className:t,assets:n,readOnly:s,isRestack:c,isPermalink:u,maxHeight:m=420,onClick:p,onSwipe:b,children:C,parent:P}=e,I=(0,d.dz)(n),B=(0,v.XA)(),S=c?12:u?0:B?64:48,N=c?12:16*!!B,k=S+N,A=(0,a.sO)(null),R=(0,d.yU)(A,k),L=Math.max(R-20-6,0),M=(0,a.sO)(!1),X=x(I,m,L),F=P&&""===P.body,[E,O]=(0,a.eJ)(null),D=(0,h.aZ)(A),z=(0,g.eK)(A,{inset:S,pageSizeAdjust:-.4*(R||0),initialState:{showLeft:!1,showRight:!0}}),{state:{showLeft:T,showRight:U},handleArrowClick:q}=B?{state:{showLeft:!1,showRight:!1},handleArrowClick:()=>()=>{}}:z;return(0,a.d4)(()=>{let e=A.current,t=()=>{!M.current&&(M.current=!0,b&&b())};return null==e||e.addEventListener("scroll",t),()=>null==e?void 0:e.removeEventListener("scroll",t)},[b]),(0,r.BX)(_.tu,{className:l()(y.Z.imageCarouselContainer,c&&y.Z.restack),position:"relative",draggable:!1,paddingTop:F?12:void 0,style:{"--carousel-inset-left":"-".concat(S,"px"),"--carousel-inset-right":"-".concat(N,"px")},children:[(0,r.BX)(_.hs,(0,i._)((0,o._)({},D.props),{ref:A,className:l()(y.Z.imageCarousel,c&&y.Z.restack,t),overflow:"auto",flex:"auto",style:{"--carousel-height":"".concat(X,"px"),"--carousel-gap":"".concat(6,"px")},children:[(0,r.tZ)(f,{width:S}),I.map((e,t)=>{let{src:n,explicit:o,width:i,height:a,id:l}=e;return(0,r.tZ)(w,{asset:n,explicit:o,readOnly:s,width:i,height:a,carouselHeight:X,onClick:s?void 0:e=>{e.preventDefault(),p&&p({attachmentId:l,attachmentType:"image"}),O({index:t})},children:C},n)}),(0,r.tZ)(d.$9,{assets:I,imageViewer:E,setImageViewer:O,readOnly:s})]})),!B&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(Z,{direction:"left",visible:T,onClick:q(-1)}),(0,r.tZ)(Z,{direction:"right",visible:U,onClick:q(1)})]})," "]})}function f(e){let{width:t}=e;return(0,r.tZ)(m.xu,{as:"span",className:y.Z.carouselSpacer,width:t})}function w(e){let{asset:t,explicit:n,onClick:o,readOnly:i,width:a,height:s,carouselHeight:l,children:c}=e,u=l*(a&&s?a/s:1);return(0,r.tZ)(d.Z4,{asset:t,explicit:n,onClick:o,readOnly:i,width:u,height:l,className:y.Z.carouselImage,maxWidth:u,children:c})}function Z(e){let{direction:t,visible:n,onClick:o}=e;return(0,r.tZ)(_.hs,{position:"absolute",className:l()(y.Z.arrowContainer,y.Z["".concat(t)]),alignItems:"center",justifyContent:"center",children:(0,r.tZ)(p.kG,{onClick:e=>{e.preventDefault(),e.stopPropagation(),null==o||o()},resetCss:!0,className:l()(y.Z.arrowButton,!n&&y.Z.hidden),display:"flex",alignItems:"center",justifyContent:"center","aria-label":"left"===t?"Previous":"Next",children:(0,r.tZ)(c.Z,{size:20,className:y.Z.arrowIcon})})})}function C(e){return e.filter(e=>"string"!=typeof e&&"number"==typeof e.width&&"number"==typeof e.height&&e.width>0&&e.height>0)}function x(e,t,n){let o=C(e);return 0===o.length?t:Math.min(n/Math.max(...o.map(e=>e.width/e.height)),t)}function P(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:420,o=e.map(u.kN),i=x(o,n,t);return C(o).reduce((e,t)=>e+i*(t.width&&t.height?t.width/t.height:1),0)+6*(o.length-1)}},57577:function(e,t,n){n.d(t,{Z:()=>ec});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(94184),l=n.n(s),c=n(14293),d=n.n(c),u=n(87764),m=n(80569),p=n.n(m),_=n(25256),h=n(71787),g=n(56953),v=n(48757),y=n(59154),b=n(79138),f=n(37632),w=n(4473),Z=n(39535),C=n(75697),x=n(58474),P=n(95441),I=n(68833),B=n(15771),S=n(99916),N=n(84747),k=n(63651),A=n(47929);function R(e){let{pub:t,user:n}=e,{iString:o}=(0,P.M1)(),[i,s]=(0,a.eJ)(!1),l=(0,k.SVA)(t),c={utm_source:A.b3.navbar,utm_medium:A.lP.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},d=(0,k.n1t)(l,c),u=async()=>{(0,I.j)(I.FP.PUBLICATION_SHARE_BUTTON_CLICKED)},m=(0,r.tZ)(B.hU,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,r.tZ)(_.Z,{size:20})});return(0,r.BX)(r.HY,{children:[(0,r.BX)(N.M,{trigger:m,onOpen:u,layerOptions:{placement:"bottom-end",preferX:"left"},className:"dropdownMenu-zWNckK",maxHeight:"fit-content",children:[(0,r.tZ)(N.u,{leading:(0,r.tZ)(h.Z,{}),onClick:()=>{(0,C.Ui)({shareUrl:d,pub:t,utm_campaign:A.VX.navbar})},children:o("Copy link")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(g.Z,{}),onClick:()=>{(0,C.WZ)({shareUrl:d,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:A.VX.navbar})},children:o("Send as email")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(v.Z,{}),onClick:()=>{(0,I.j)(I.FP.SHARE_PUBLICATION_MODAL_OPENED),s(!0)},children:o("Get shareable images")}),(0,r.BX)(S.xw,{children:[(0,r.tZ)(N.u,{leading:(0,r.tZ)(w.Z,{}),onClick:()=>{(0,C.BZ)({shareUrl:d,pub:t,utm_campaign:A.VX.navbar})},children:o("Share to Notes")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(b.Z,{}),onClick:()=>{(0,C.Po)({shareUrl:d,pub:t,utm_campaign:A.VX.navbar})},children:o("Share to Facebook")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(f.Z,{}),onClick:()=>{(0,C.lc)({shareUrl:d,pub:t,utm_campaign:A.VX.navbar})},children:o("Share to Linkedin")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(y.Z,{}),onClick:()=>{(0,C.bI)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:A.VX.navbar})},children:o("Share to Bluesky")}),(0,r.tZ)(N.u,{leading:(0,r.tZ)(Z.Z,{}),onClick:()=>{(0,C.Wn)({shareUrl:d,shareName:t.name,pub:t,utm_campaign:A.VX.navbar})},children:o("Share to X")})]})]}),(0,r.tZ)(x.iL,{pub:t,isOpen:i,setOpen:s,item:{type:"pub_shareable_image"},width:718})]})}var L=n(63718),M=n(57391),X=n(36848),F=n(39648),E=n(56629),O=n(40647),D=n(65205),z=n(34552),T=n(98914),U=n(98422),q=n(80026),V=n(19081),W=n(10510),j=n(78096),H=n(70379),K=n(87077),G=n(91684),Y=n(74583),J=n(31406),$=n(98012),Q=n(24791),ee=n(6070),et=n(67914),en=n(60308),eo=n(26111),ei=n(84864);let er=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,U.v9)(),{iString:i}=(0,P.M1)();return(0,r.tZ)(j.gd,{priority:"secondary",size:o?"sm":"md",menuItems:n.map(e=>{let{logo_url:n,name:o,subdomain:i}=e;return(0,r.tZ)(N.u,{href:(0,en.c0Q)(i,{params:{utm_source:A.b3.substack,utm_content:A.fZ.dashboardPubSwitcher}}),leading:(0,r.tZ)(W.wk,{size:24,radius:"xs",logoUrl:n}),priority:t.subdomain===i?"selected":"primary",children:o})}),href:(0,k.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:i("Dashboard")})};function ea(){let{iString:e}=(0,P.M1)(),t=(0,F.O4)();return(0,r.tZ)(K.u,{text:e("Search"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:K.$$},children:(0,r.tZ)(q.hU,{priority:"tertiary",onClick:()=>t.open(),children:(0,r.tZ)(u.Z,{size:20})})})}let es=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,P.M1)(),{isMobile:i}=(0,U.v9)();return t.length>1?(0,r.tZ)(er,{pub:n,dashboardPubs:t}):(0,r.tZ)(q.zx,{size:i?"sm":"md",priority:"secondary",href:(0,k.QK7)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})};function el(e){var t,n,i,a,s,l,c,u,m,_,h;let{user:g,pub:v,freeSignup:y,freeSignupEmail:b,hide_subscribe_cta:f,isMeetingsActive:w,hasViralGiftsCount:Z,siteConfigContext:C,getSettingFor:x,experimentApi:{exposeExperiment:P,getExperimentVariant:B},renewing:S,renewed:N,setToRenew:R,language:L,isMobile:M}=e,{iString:X,iPlural:F}=I18N.i(L);v.invite_only&&!((null==g?void 0:g.subscription_id)||(null==g?void 0:g.is_free_subscribed))&&(f=!0);let E=(0,J.gs)(),O=null==g?void 0:g.is_contributor,z=(null==g?void 0:g.is_subscribed)||O,U=(null==g?void 0:g.is_free_subscribed)||y,V=Q.oH(v)&&z&&["gift","comp"].includes(null!==(a=g.subscription_type)&&void 0!==a?a:"")&&!(0,et.B9)({pub:v,subscriptionType:null==g?void 0:g.subscription_type})&&(0,$.Z)(g.subscription_expiry).subtract(30,"days").isBeforeNow(),W=Q.oH(v)&&g&&Q.po(g)&&g.comp_expired_recently,j=(null==g?void 0:g.is_free_subscribed)&&(null==g?void 0:g.is_paused),H=(null==g?void 0:g.subscription_type)==="ios_app";if(O){let e=(null==g?void 0:g.dashboard_pubs)||[];return(0,r.tZ)(es,{dashboardPubs:e,pub:v})}if(j)return(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,T.uX)((0,en.BhD)(v,{addBase:!0}),{local_navigation:!1})},children:X("Unpause my subscription")});if(V||W){if(!f)return(0,r.BX)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{var e;(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,T.uX)((0,en.W1P)(v,{utm_source:A.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0,selectedPlanId:V&&(null==g?void 0:g.is_founding)&&v.plans?null===(e=v.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:X("Subscribe")}),(0,r.tZ)("span",{className:"desktop-only",children:X("Continue your support")})]})}else if(Q.oH(v)&&U&&!z&&!["thebulwark"].includes(v.subdomain)){if(!f)return(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,T.uX)((0,en.W1P)(v,{utm_source:A.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,ei.getSubscribeText)(v,{isFreeSubscribed:!0,isMobile:(0,T.K1)(),language:L})})}else if(Q.oH(v)?z:U||z){if(v.invite_only&&z&&!d()(g.invites)&&g.invites<v.subscriber_invites)return(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,T.uX)((0,en.UzE)(v),{local_navigation:!1})},children:(0,r.tZ)("span",{children:F("1 invite left","%1 invites left",v.subscriber_invites-g.invites)})});if(Q.oH(v)&&w&&C&&!C.getConfigFor("hide_book_a_meeting_button"))return(0,r.BX)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,T.uX)((0,k.szv)(v,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:X("Book meeting")}),(0,r.tZ)("span",{className:"desktop-only",children:X("Book a meeting")})]});else if(Q.oH(v)&&g&&g.is_subscribed&&!H&&g.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(s=g.subscription_type)&&void 0!==s?s:""))return(0,r.BX)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),R()},disabled:S||N,style:{visibility:N?"hidden":"visible"},children:[(0,r.tZ)("span",{className:"mobile-only",children:X("Renew")}),(0,r.tZ)("span",{className:"desktop-only",children:X("Renew subscription")})]})}else if(!f){let e=null===(u=(0,eo.x)("referring_pub_ids"))||void 0===u?void 0:null===(c=u.split)||void 0===c?void 0:null===(l=c.call(u,","))||void 0===l?void 0:l[0],t=null===(h=(0,eo.x)("referring_pub_ids"))||void 0===h?void 0:null===(_=h.split)||void 0===_?void 0:null===(m=_.call(h,","))||void 0===m?void 0:m.slice(1);return(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:async()=>{let n=g&&!g.is_magic&&g.email||b;if((0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:v.homepage_type}),n){let i;try{i=(await p().post("/api/v1/free").send((0,o._)({source:"menu",email:n,first_url:D.xY,first_referrer:D.ip,current_url:D.UE,current_referrer:D.xU,first_session_url:D.ac,first_session_referrer:D.qR,referring_pub_id:e,additional_referring_pub_ids:t},E))).body.referral_token,(0,I.IU)()}catch(e){(0,I.j)(I.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,en.W1P)(v,{utm_source:A.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:i})}else window.location.href=(0,en.W1P)(v,{utm_source:A.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eo.x)("referring_pub_ids"),addBase:!0})},children:(0,ei.getSubscribeText)(v,{isFreeSubscribed:U,isMobile:(0,T.K1)(),language:L})})}if(Q.oH(v)&&g&&g.is_subscribed&&Z){let e=(0,k.xdn)({pub:v,params:{utm_source:A.b3.menu}}),t=B("viral_gift_nav_bar_cta");if(P("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let n="treatment_send"===t?X(Z>1?"Send free gifts":"Send free gift"):F("1 gift left","%1 gifts left",Z);return(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,T.uX)(e,{local_navigation:!1})},children:n})}}if(Q.oH(v)&&g&&!g.is_founding&&!H&&(0,$.Z)(g.subscription_first_payment_at).isBefore((0,$.Z)().subtract(48,"hours"))&&((0,ee.VL)({pub:v})||"pinespayments"===v.subdomain||(null==v?void 0:null===(i=v.plans)||void 0===i?void 0:null===(n=i.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===n?void 0:null===(t=n.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,k.yRy)({pub:v,user:g,params:{utm_source:A.b3.menu,next:document.location.href}});return(0,r.BX)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,T.uX)(e,{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:X("Upgrade")}),(0,r.tZ)("span",{className:"desktop-only",children:X("Upgrade to founding")})]})}return"disabled"===v.payments_state&&!v.invite_only&&x("payment_pledges_enabled")&&U&&!(null==g?void 0:g.is_pledged)?(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,T.uX)((0,en.W1P)(v,{utm_source:A.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:X("Pledge your support")}):Q.oH(v)&&!v.invite_only?(0,r.BX)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,T.uX)((0,ee.HD)({pub:v})&&g&&(null==C?void 0:C.getConfigFor("enable_founding_gifts"))?(0,ee.Iv)({user:g}):(0,en.W1P)(v,{utm_source:A.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:X("Give gift")}),(0,r.tZ)("span",{className:"desktop-only",children:X("Gift a subscription")})]}):!v.is_on_substack||(null==g?void 0:g.has_publication)?null:(0,r.tZ)(q.zx,{"data-testid":"noncontributor-cta-button",size:M?"sm":"md",onClick:()=>{(0,I.j)(I.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,T.uX)((0,en._HV)({utm_source:A.b3.menu}),{local_navigation:!1})},children:X("Start publishing")})}let ec=e=>{let{className:t,fixedTooltip:n=!0,freeSignup:s,freeSignupEmail:c,hideCta:d,hideNotifications:u,hideChat:m,hideSearch:_,hideShare:h,hideUserIndicator:g,hide_subscribe_cta:v,isMeetingsActive:y,hasViralGiftsCount:b,pub:f,showCustomerSupportModeModal:w,user:Z}=e,{iString:C,language:x}=(0,P.M1)(),{isMobile:I}=(0,U.v9)(),{getSettingFor:B}=(0,E.So)(),S=(0,M.jc)(),[N,k]=(0,a.eJ)(!1),[A,F]=(0,a.eJ)(!1),D=(0,H.pm)(),{enableCustomerServiceMode:q,disableCustomerServiceMode:W,modalElement:j}=(0,z.Vc)({showCustomerSupportModeModal:w}),K=async()=>{k(!0);try{await p().post("/api/v1/subscription/reactivate").send({}),F(!0),D.popToast(e=>(0,r.tZ)(H.FN,(0,i._)((0,o._)({},e),{text:C("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,T.zx)(e))}finally{k(!1)}};return(0,r.BX)(V.gq,{alignItems:"center",gap:I?4:8,className:l()("navbar-buttons",t),justifyContent:"end",children:[(0,r.tZ)(O.QA.Consumer,{children:e=>(0,r.tZ)(X.RD.Consumer,{children:t=>(0,r.BX)(r.HY,{children:[!I&&!Z&&(0,r.BX)(V.gq,{gap:4,children:[!_&&(0,r.tZ)(ea,{}),!h&&(0,r.tZ)(R,{pub:f,user:null!=Z?Z:void 0})]}),!I&&Z&&(0,r.BX)(V.gq,{gap:4,children:[!_&&(0,r.tZ)(ea,{}),m?!h&&(0,r.tZ)(R,{pub:f,user:Z}):(0,r.tZ)(G.b,{}),!u&&(0,r.tZ)(Y.f,{canShowAlerts:!f})]}),!d&&(0,r.tZ)(el,{pub:f,user:Z,freeSignup:s,freeSignupEmail:c,hide_subscribe_cta:v,viralGiftsConfig:f.viralGiftsConfig,localeContext:t,siteConfigContext:e,isMeetingsActive:y,hasViralGiftsCount:b,getSettingFor:B,experimentApi:S,renewing:N,renewed:A,setToRenew:K,language:x,isMobile:I}),!g&&(0,r.tZ)(L.Co,{pub:f,user:Z,enableCustomerServiceMode:q,disableCustomerServiceMode:W,fixedTooltip:n})]})})}),j]})}},34288:function(e,t,n){n.d(t,{$:()=>y});var o=n(16584),i=n(98661);n(30396);var r=n(94184),a=n.n(r),s=n(95031),l=n(55438);n(97742);var c=n(58319),d=n(95441),u=n(45261),m=n(68833),p=n(58175),_=n(60308);n(6911);var h=n(81821),g=n(47929),v=n(8525);let y=(0,i.memo)(e=>{let{publication:t,user:n,path:i,hideTerms:r,showIntrinioAttrib:y}=e,{iString:b}=(0,d.M1)();void 0===r&&(r=!1);let f=(0,u.Tf)(),w=(0,h.tq)(),Z=(0,h.s)(),C=(0,h.Dt)(),x=n&&!n.reader_installed_at,P=w&&(Z||C)&&x;return(0,o.BX)("div",{className:"footer-wrap publication-footer",children:[(0,o.tZ)(c.Z,{onVisible:()=>{var e;(0,m.j)(m.FP.PUBLICATION_FOOTER_SEEN,{publication_id:null==t?void 0:t.id,user_id:null==n?void 0:n.id,source:(e=i)?"/"===e?"pub-homepage":e.startsWith("/p")?"pub-post":e:"unknown"})}}),(0,o.tZ)("div",{className:a()("footer",{"themed-background":f}),children:(0,o.BX)("div",{className:"container",children:[(0,o.tZ)(s._,{hideTerms:r,pub:t,showIntrinioAttrib:null!=y&&y}),(0,o.BX)("div",{className:"footer-buttons",children:[(0,o.BX)("a",{className:a()("footer-substack-cta","start-publishing",P&&"app-upsell"),native:!0,href:(null==n?void 0:n.has_publication)?"".concat((0,_.SVA)({subdomain:"your"}),"/publish"):"".concat((0,_.ZJn)(),"/signup?").concat((0,_.Y$Q)({utm_source:g.b3.substack,utm_medium:g.lP.web,utm_content:g.fZ.footer})),children:[(0,o.tZ)(l.Z,{})," ",b("Start writing")]}),!P&&(0,o.tZ)("a",{className:"footer-substack-cta get-the-app no-icon",native:!0,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton}),children:b("Get the app")}),P&&Z&&(0,o.tZ)("a",{className:v.Z.appBadge,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton,force:"ios"}),children:(0,o.tZ)("img",{className:"app-upsell",src:(0,_.zF4)("/img/app_page/app-store.png",320)})}),P&&C&&(0,o.tZ)("a",{className:v.Z.appBadge,href:(0,_.D4e)({utm_campaign:g.VX.appMarketing,utm_content:g.fZ.webFooterButton,force:"android"}),children:(0,o.tZ)("img",{className:"app-upsell",src:(0,_.zF4)("/img/app_page/google-play.png",320)})})]}),(0,o.BX)(p.xv,{translated:!0,as:"div",className:"footer-slogan-blurb",children:[(0,o.tZ)("a",{href:"".concat((0,_.ZJn)()),native:!0,children:"Substack"})," ","is the home for great culture"]})]})})]})})},61665:function(e,t,n){n.d(t,{Y:()=>o});let o=(0,n(6400).createContext)(!1)},59480:function(e,t,n){n.d(t,{Uu:()=>l});var o=n(68833);let i=["sort"],r=["sort","selection"],a=[];function s(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?r:i).includes(e)||n.searchParams.delete(e);return n.toString()}function l(e){setTimeout(()=>(function(e){var t,n;let{previous:i,url:r}=e;if("undefined"==typeof window)return;let l=s(r,!1),c=s(r,!0),{head:d}=document;null===(t=d.querySelector("link[rel=canonical]"))||void 0===t||t.setAttribute("href",l),null===(n=d.querySelector('meta[property="og:url"]'))||void 0===n||n.setAttribute("content",c),a.push(r),setTimeout(()=>{(0,o.jA)({previous:i,url:r})},100)})(e),0)}},34552:function(e,t,n){n.d(t,{Vc:()=>p});var o=n(16584),i=n(98661),r=n(31356),a=n(14952),s=n(60807),l=n(48980),c=n(98914),d=n(6490),u=n(60308),m=n(26111);function p(){var e;let{showCustomerSupportModeModal:t,allowAllDay:n,allowClose:p}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=(0,a.Ij)(),h=(0,s.aF)(),{canTurnOnCustomerSupportMode:g,isInCustomerSupportMode:v}={canTurnOnCustomerSupportMode:!!(null==(e=(0,s.aF)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},[y,b]=(0,i.useState)(!!(t&&g)),f=async()=>{try{await (0,l.rd)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,c.zx)(e))}},w=async()=>{if(null==_?void 0:_.custom_domain){let e=window.location.pathname;(0,c.uX)((0,u.Q6L)(e,_),{local_navigation:!1})}else b(!0)},Z=g&&(0,o.tZ)(d.u_,{isOpen:y,onClose:p?()=>b(!1):void 0,children:(0,o.tZ)(r.Z,{redirect:(0,m.x)("redirect")||"/publish/home",onClose:()=>b(!1),requiresMfa:null==h?void 0:h.requires_global_admin_mfa_challenge,allowAllDay:n,allowClose:p})});return{enableCustomerServiceMode:g?w:void 0,disableCustomerServiceMode:v?f:void 0,modalElement:Z}}},71e3:function(e,t,n){n.d(t,{A:()=>M});var o=n(16584),i=n(94184),r=n.n(i),a=n(30998),s=n.n(a),l=n(89734),c=n.n(l),d=n(82701),u=n(20888),m=n(95441),p=n(68833),_=n(98422),h=n(71068),g=n(15771),v=n(19081),y=n(58175),b=n(63651);let f={containerVertical:"containerVertical-L_u6LQ",logoVertical:"logoVertical-p9LsNy",listenLink:"listenLink-UqdzU4"},w=e=>{var t;let{label:n,openInNewTab:i,podcastSettings:a,section:s,sectionUrl:l,setupUrl:c,subscribeUrl:w,trackingSource:Z,user:x}=e,{iString:P}=(0,m.M1)(),{isMobile:I}=(0,_.v9)(),B=I?80:160,S=(0,h.oB)({radius:"md",width:B}),N=(null==x?void 0:x.is_subscribed)&&null!==(t=a.paidEpisodeArtUrl)&&void 0!==t?t:a.artUrl;return(0,o.BX)(v.gq,{direction:I?"column":"row",gap:I?12:24,children:[N&&(0,o.tZ)(u.e,{className:r()(S),src:(0,b.zF4)(N,2*B),maxWidth:B,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,o.BX)(v.tu,{gap:8,children:[(0,o.BX)(v.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,o.tZ)(y.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",weight:"bold",href:l,rel:"noopener noreferrer",target:"_blank",children:a.title}),c&&(0,o.tZ)(g.zx,{priority:"secondary",size:"sm",href:c,newTab:i,onClick:()=>{(0,p.j)(p.FP.SET_UP_FEED_CLICKED,{section_id:s.id,source:Z})},children:P("Set up")})]}),n&&(0,o.BX)(v.gq,{gap:8,alignItems:"center",children:[(0,o.tZ)(C,{label:n}),"free-with-ads"===n&&w&&(0,o.tZ)(y.xv,{className:f.listenLink,color:"accent",font:"text",size:12,onClick:()=>{(0,p.j)(p.FP.LISTEN_AD_FREE_CLICKED,{section_id:s.id,source:Z}),i?window.open(w,"_blank","noopener,noreferrer"):window.location.href=w},children:"Listen ad-free"})]}),(0,o.tZ)(y.xv.B3,{color:"pub-secondary-text",font:"text",children:a.description}),(0,o.tZ)("div",{children:(0,o.BX)(y.xv,{alignItems:"center",color:"accent",display:"inline-flex",font:"text",size:14,weight:"medium",gap:8,onClick:()=>{(0,p.j)(p.FP.SEE_ALL_EPISODES_CLICKED,{section_id:s.id,source:Z}),i?window.open(l,"_blank","noopener,noreferrer"):window.location.href=l},children:[(0,o.tZ)("span",{children:P("See all episodes")}),(0,o.tZ)(d.Z,{size:14})]})})]})]})},Z=e=>{let{label:t,openInNewTab:n,podcastSettings:i,section:a,sectionUrl:s,trackingSource:l}=e,{iString:c}=(0,m.M1)(),_=(0,h.oB)({radius:"md"});return(0,o.BX)(v.tu,{className:f.containerVertical,border:"detail-themed",padding:20,radius:"md",gap:20,children:[(0,o.tZ)(v.gq,{justifyContent:"center",children:i.artUrl&&(0,o.tZ)(u.e,{className:r()(_,f.logoVertical),src:(0,b.zF4)(i.artUrl,440),maxWidth:164,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,o.BX)(v.tu,{gap:12,children:[(0,o.BX)(v.tu,{gap:8,children:[(0,o.tZ)(y.xv.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",href:s,rel:"noopener noreferrer",target:"_blank",weight:"bold",children:i.title}),t&&(0,o.tZ)(v.gq,{children:(0,o.tZ)(C,{label:t})}),(0,o.tZ)(y.xv.B3,{color:"pub-secondary-text",font:"text",children:i.description})]}),(0,o.tZ)("div",{children:(0,o.BX)(y.xv,{display:"inline-flex",alignItems:"center",gap:8,color:"accent",font:"text",size:14,weight:"medium",onClick:()=>{(0,p.j)(p.FP.SEE_ALL_EPISODES_CLICKED,{section_id:a.id,source:l}),n?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s},children:[(0,o.tZ)("span",{children:c("See all episodes")}),(0,o.tZ)(d.Z,{size:14})]})})]})]})},C=e=>{let{label:t}=e;return(0,o.tZ)(v.gq,{bg:"secondary",display:"inline-block",paddingX:6,radius:"sm",children:(0,o.tZ)(y.xv,{color:"pub-secondary-text",font:"text",size:12,weight:"semibold",lineHeight:20,children:"member-only"===t?"+ Member-only":"free-with-ads"===t?"Free with ads":"Free"})})};var x=n(46234),P=n(30733),I=n(24791),B=n(6070),S=n(17054),N=n(60308),k=n(26111),A=n(47929);let R={twoColumnGrid:"twoColumnGrid-pq1MC7",mainColumn:"mainColumn-cft5kf",sideColumn:"sideColumn-FFh4jo"},L=A.b3.podcastsPage,M=e=>{let{idToMagicLink:t,pub:n,user:i}=e,{isMobile:a}=(0,_.v9)(),l=c()((0,I.hK)(n),e=>{var t;return null!==(t=s()(n.navigationBarItems,t=>t.section_id===e.id))&&void 0!==t?t:999}),d=!!(null==i?void 0:i.is_subscribed),u=!d&&!a,m=l.filter(e=>d||!(0,B.QI)({sectionId:e.id})),p=d?[]:l.filter(e=>(0,B.QI)({sectionId:e.id})),h=null==t?void 0:t[n.id];return h||(h=(0,N.tS3)(n,{section:null,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:L}})),(0,o.tZ)(P.N,{columns:u?3:2,paddingTop:a?8:void 0,children:(0,o.BX)(v.hs,{className:r()({[R.twoColumnGrid]:u}),direction:u?"row":"column",gap:u?void 0:40,children:[!d&&(0,o.BX)(v.tu,{alignItems:a?"stretch":"start",className:R.sideColumn,gap:24,paddingLeft:u?32:void 0,children:[(0,o.BX)(v.tu,{gap:a?12:16,children:[(0,o.tZ)(y.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:"Member-only Shows"}),(0,o.tZ)(x.B,{firehoseFeedUrl:h,pub:n,trackingSource:L,variant:"member-only"})]}),(0,o.tZ)(v.tu,{gap:a?16:24,children:p.map((e,r)=>{let s=(0,S.d_)({pub:n,section:e}),l=(null==t?void 0:t[e.id])||(0,N.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:L}}),c=(0,b.Ucy)(n,{section:e,addBase:!0}),u=(0,B.hx)({sectionId:e.id})?"member-only":"free";return(0,o.BX)(o.HY,{children:[(0,o.tZ)(a?w:Z,{label:u,openInNewTab:!0,podcastSettings:s,section:e,sectionUrl:c,setupUrl:d?l:null,trackingSource:L,user:null!=i?i:null}),r!==p.length-1&&a&&(0,o.tZ)(v.gq,{borderBottom:"detail-themed"})]})})})]}),(0,o.BX)(v.tu,{className:R.mainColumn,gap:24,paddingRight:u?32:void 0,children:[(0,o.BX)(v.tu,{gap:a?12:16,children:[(0,o.BX)(y.xv.H2,{color:"pub-primary-text",font:"pub-headings",children:[n.name," Shows"]}),d&&(0,o.tZ)(x.B,{pub:n,firehoseFeedUrl:h,trackingSource:L})]}),(0,o.tZ)(v.tu,{gap:a?16:24,children:m.map((e,r)=>{let a=(0,S.d_)({pub:n,section:e}),s=(null==t?void 0:t[e.id])||(0,N.tS3)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:L}}),l=(0,b.Ucy)(n,{section:e,addBase:!0}),c=(0,B.hx)({sectionId:e.id})?d?"member-only":"free-with-ads":"free";return(0,o.BX)(o.HY,{children:[(0,o.tZ)(w,{label:c,openInNewTab:!0,podcastSettings:a,section:e,sectionUrl:l,setupUrl:d?s:null,subscribeUrl:(0,N.W1P)(n,{utm_source:L,simple:!0,next:document.location.href,referring_pub_ids:(0,k.x)("referring_pub_ids"),addBase:!0}),trackingSource:L,user:null!=i?i:null}),r!==m.length-1&&(0,o.tZ)(v.gq,{borderBottom:"detail-themed"})]})})})]})]})})}},12844:function(e,t,n){n.d(t,{k:()=>p,w:()=>u});var o=n(16584),i=n(95441),r=n(15771),a=n(17352),s=n(19081),l=n(10510),c=n(58175),d=n(60308);let u=(e,t)=>{var n;return{logoUrl:e.podcast_art_url||e.logo_url||(0,d.cse)(),mainClickUrl:(0,d.UVC)({pub:e,section:null,addBase:!0}),buttonClickUrl:t,name:e.podcast_title||e.name,description:null!==(n=e.podcast_description||e.hero_text)&&void 0!==n?n:void 0}},m=e=>{let{logoUrl:t,mainClickUrl:n,buttonClickUrl:d,name:u,description:m,showButton:p}=e,{iString:_}=(0,i.M1)();return(0,o.BX)(a.Z,{gap:12,direction:"row",alignItems:"center",padding:12,children:[t&&(0,o.tZ)(l.wk,{size:48,logoUrl:t}),(0,o.BX)(s.sg,{gap:2,flex:"grow",children:[(0,o.tZ)(c.xv.B3,{weight:"semibold",children:(0,o.tZ)(c.hh,{href:n,children:u})}),(0,o.tZ)(c.xv.B4,{color:"secondary",children:m})]}),p&&(0,o.tZ)(r.zx,{priority:"primary",href:d,newTab:!0,children:_("Set up")})]})},p=e=>{let{showButton:t,items:n}=e;return(0,o.tZ)(s.sg,{gap:12,children:n.map(e=>(0,o.tZ)(m,{logoUrl:e.logoUrl,mainClickUrl:e.mainClickUrl,buttonClickUrl:e.buttonClickUrl,name:e.name,description:e.description,showButton:t}))})}},87077:function(e,t,n){n.d(t,{$$:()=>x,u:()=>P});var o=n(92002),i=n(73580),r=n(7409),a=n(99282),s=n(98848),l=n(16584),c=n(19425),d=n(94184),u=n.n(d),m=n(98661),p=n(62372),_=n(29032),h=n(20160),g=n(20888),v=n(71068),y=n(58076),b=n(19081),f=n(58175),w=n(165);let Z=["top-start","top-center","top-end","bottom-start","bottom-center","bottom-end"],C=["left-start","left-center","left-end","right-start","right-center","right-end"],x=500,P=e=>{var{children:t,text:n,title:o,imageUrl:i,as:c="span",leading:d,trailing:_,preferPlacement:h="top-center",layerOptions:g,disabled:v,hoverOptions:b={},toggleOptions:f}=e,x=(0,s._)(e,["children","text","title","imageUrl","as","leading","trailing","preferPlacement","layerOptions","disabled","hoverOptions","toggleOptions"]);let{layerProps:P,triggerProps:B,hoverProps:S,transitionProps:N,renderLayer:k,shouldShow:A}=function(){var e;let{hoverOptions:t,layerOptions:n,toggleOptions:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,a]=(0,m.useState)(!1),[s,l]=(0,p.XI)((0,r._)({},t)),c=o?o.show:s,{triggerProps:d,layerProps:_,renderLayer:h}=(0,p.sJ)((0,r._)({isOpen:c,auto:!0,triggerOffset:8},n)),g=null!==(e=null==n?void 0:n.placement)&&void 0!==e?e:"top-center",v="",y="";switch(g){case"top-start":case"top-center":case"top-end":default:v=u()(w.Z.hide,w.Z.fromBelow),y=u()(w.Z.hide,w.Z.fromBelow);break;case"bottom-start":case"bottom-center":case"bottom-end":v=u()(w.Z.hide,w.Z.fromAbove),y=u()(w.Z.hide,w.Z.fromAbove);break;case"left-start":case"left-center":case"left-end":v=u()(w.Z.hide,w.Z.fromRight),y=u()(w.Z.hide,w.Z.fromRight);break;case"right-start":case"right-center":case"right-end":v=u()(w.Z.hide,w.Z.fromLeft),y=u()(w.Z.hide,w.Z.fromLeft)}return{layerProps:_,triggerProps:d,hoverProps:l,transitionProps:{show:c,beforeEnter:()=>a(!0),afterLeave:()=>a(!1),enterFrom:v,leaveTo:y},renderLayer:h,shouldShow:c||i}}({layerOptions:(0,r._)({placement:h,possiblePlacements:C.includes(h)?C:Z},g),hoverOptions:(0,r._)({delayLeave:50},b),toggleOptions:f}),{style:R}=P,L=(0,s._)(P,["style"]);return v?(0,l.tZ)(l.HY,{children:t}):(0,l.BX)(l.HY,{children:[(0,l.tZ)(c,(0,a._)((0,r._)({},B,S,x),{children:t})),A&&k((0,l.tZ)(I,{transitionProps:N,tooltipProps:(0,a._)((0,r._)({},L,S),{style:(0,a._)((0,r._)({},R),{maxWidth:320,zIndex:y.PU})}),text:n,title:o,imageUrl:i,leading:d,trailing:_}))]})};function I(e){var{transitionProps:t,tooltipProps:n}=e,o=(0,s._)(e,["transitionProps","tooltipProps"]);return(0,l.tZ)("div",(0,a._)((0,r._)({},n),{children:(0,l.tZ)(X,(0,a._)((0,r._)({},t),{children:(0,l.tZ)(B,(0,r._)({},o))}))}))}function B(e){var t=(0,o._)({},(0,i._)(e));return(0,l.tZ)(_.C,{children:(0,l.tZ)(h.W,{children:(0,l.tZ)(M,{children:(0,l.tZ)(S,(0,r._)({},t))})})})}function S(e){let{leading:t,trailing:n,text:o,title:i,imageUrl:r,children:a}=e,s=o&&!i&&!r;return(0,l.BX)(L,{textOnly:!!s,children:[r&&(0,l.tZ)(R,{children:(0,l.tZ)(g.e,{src:r,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,l.BX)(A,{hasTitle:!!i,children:[t&&(0,l.tZ)(k,{children:t}),(0,l.BX)(N,{children:[i&&(0,l.tZ)(f.xv.B4,{weight:"medium",color:"primary",className:w.Z.title,children:i}),(0,l.tZ)(f.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof o?o.split("\n").map((e,t)=>(0,l.BX)(m.Fragment,{children:[t>0&&(0,l.tZ)("br",{}),e]},t)):o}),a]}),n&&(0,l.tZ)(k,{children:n})]})]})}let N=(0,v.zo)({display:"flex",direction:"column",gap:2});function k(e){let{children:t}=e;return(0,l.tZ)(b.X2,{alignItems:"center",justifyContent:"center",className:w.Z.endcapContainer,flex:"auto",gap:8,children:t})}function A(e){let{hasTitle:t,children:n}=e;return(0,l.tZ)(b.X2,{alignItems:t?"start":"center",gap:8,children:n})}function R(e){let{children:t}=e;return(0,l.tZ)(b.sg,{border:"detail",radius:"sm",className:w.Z.imageContainer,overflow:"hidden",children:t})}function L(e){let{textOnly:t,children:n}=e;return(0,l.tZ)(b.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,children:n})}let M=(0,v.zo)({radius:"sm",shadow:"md",border:"detail",bg:"primary"});function X(e){return(0,l.tZ)(c.u,(0,r._)({appear:!0,unmount:!1,className:w.Z.animate,enterTo:w.Z.show,leaveFrom:w.Z.show},e))}},45783:function(e,t,n){n.d(t,{R3:()=>g,eK:()=>p,rQ:()=>_});var o=n(7409),i=n(99282),r=n(16584),a=n(94184),s=n.n(a),l=n(98814),c=n(64998),d=n(98661),u=n(80026),m=n(68857);let p=function(e){let{inset:t=0,pageSizeAdjust:n=0,initialState:r,scrollFullPage:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[s,l]=(0,d.useState)(r||{showLeft:!1,showRight:!1});return(0,d.useEffect)(()=>{let{current:n}=e;if(n){let e=()=>{l(e=>{let r=e;!r.showLeft&&n.scrollLeft>t?r=(0,i._)((0,o._)({},e),{showLeft:!0}):r.showLeft&&n.scrollLeft<=t&&(r=(0,i._)((0,o._)({},e),{showLeft:!1}));let a=n.scrollWidth-n.offsetWidth-4-t;return!r.showRight&&n.scrollLeft<a?r=(0,i._)((0,o._)({},e),{showRight:!0}):r.showRight&&n.scrollLeft>=a&&(r=(0,i._)((0,o._)({},e),{showRight:!1})),r})};return n.addEventListener("scroll",e),setTimeout(()=>{e()},50),()=>{n.removeEventListener("scroll",e)}}},[]),{state:s,handleArrowClick:t=>()=>{let{current:o}=e;o&&o.scrollBy({left:t*(a?o.offsetWidth:o.offsetWidth/2-n),behavior:"smooth"})}}};function _(e){let{direction:t,isVisible:n=!0,onClick:o}=e;return(0,r.tZ)(u.hs,{alignItems:"center",justifyContent:"center",position:"absolute",className:s()(m.Z.arrowButtonContainer,m.Z.arrowButtonOffsetContainer,n&&m.Z.visible,m.Z[t]),children:(0,r.tZ)(h,{direction:t,isVisible:n,onClick:o})})}function h(e){let{direction:t,isVisible:n=!0,onClick:o,className:i}=e;return(0,r.tZ)(u.hU,{size:"sm",priority:"quaternary",disabled:!n,className:i,onClick:o,"aria-hidden":!n,"aria-label":n?"left"===t?"Previous":"Next":void 0,children:"left"===t?(0,r.tZ)(l.Z,{}):(0,r.tZ)(c.Z,{})})}function g(e){let{direction:t,isVisible:n=!0,children:o,bg:i="primary"}=e;return(0,r.BX)(u.hs,{alignItems:"center",className:s()(m.Z.arrowButtonContainer,m.Z.arrowButtonOverlaidContainer,n&&m.Z.visible,m.Z[t]),children:[(0,r.tZ)("div",{className:s()(m.Z.overlay,m.Z[i])}),o]})}},74583:function(e,t,n){n.d(t,{$:()=>x,f:()=>C});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(94184),l=n.n(s),c=n(76789),d=n(23970),u=n(95441),m=n(36518),p=n(68833),_=n(7882),h=n(15771),g=n(19081),v=n(84747),y=n(87077),b=n(83010),f=n(74312),w=n(57693),Z=n(21694);function C(e){let{canShowAlerts:t=!1}=e,s=(0,m.lR)(),l=(0,_.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,a.d4)(()=>{s.activityUnreadCount>0&&(0,p.j)(p.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:s.activityUnreadCount})},[s.activityUnreadCount]);let Z=()=>Promise.all([n.e("9669"),n.e("236"),n.e("7833"),n.e("5990")]).then(n.bind(n,79075)),{iString:C}=(0,u.M1)();return(0,r.BX)(b.H,{trackingProps:{surface:"dropdown"},children:[(0,r.tZ)(v.M,{trigger:e=>(0,r.tZ)(y.u,{text:C("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:y.$$},children:(0,r.BX)(h.hU,(0,i._)((0,o._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:Z,position:"relative",children:[(0,r.tZ)(c.Z,{"aria-hidden":!0,size:20}),s.activityUnreadCount>0&&(0,r.tZ)(x,{count:s.activityUnreadCount})]}))}),onOpen:()=>l.refetch(),maxHeight:"fit-content",padding:0,Theme:d.m,children:(0,r.tZ)(f.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:Z,resource:l,bellCount:s.activityUnreadCount,whileLoading:(0,r.tZ)(g.hs,{width:400})})}),t&&(0,r.tZ)(w.l,{})]})}function x(e){let{count:t}=e;return(0,r.tZ)(g.hs,{className:l()(Z.Z.badge,t<10&&Z.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},91684:function(e,t,n){n.d(t,{b:()=>v});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(5097),l=n(23970),c=n(95441),d=n(68833),u=n(80026),m=n(84747),p=n(87077),_=n(97842),h=n(74312),g=n(74583);function v(){var e,t;let{iString:n}=(0,c.M1)(),v=null!==(t=null===(e=(0,_.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,a.d4)(()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:v})},[v]),(0,r.tZ)(m.M,{trigger:e=>(0,r.tZ)(p.u,{text:n("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:p.$$},children:(0,r.BX)(u.hU,(0,i._)((0,o._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:y,position:"relative",children:[(0,r.tZ)(s.Z,{size:20}),v>0&&(0,r.tZ)(g.$,{count:v})]}))}),onClose:()=>{(0,d.j)(d.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:l.m,children:(0,r.tZ)(h.cr,{module:"./MiniInbox",onRequest:y,resolve:e=>e.MiniChatInbox,whileLoading:(0,r.tZ)(u.xu,{width:360})})})}let y=()=>Promise.all([n.e("1697"),n.e("5758"),n.e("8041"),n.e("1484"),n.e("9669"),n.e("2736"),n.e("8336"),n.e("236"),n.e("9294"),n.e("7833"),n.e("2250"),n.e("6400"),n.e("7424"),n.e("2277")]).then(n.bind(n,41358))},8113:function(e,t,n){n.d(t,{aM:()=>k});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(39693),l=n.n(s),c=n(44908),d=n.n(c),u=n(45578),m=n.n(u),p=n(69241),_=n(60807),h=n(12765),g=n(48980),v=n(9682),y=n(98914),b=n(8828),f=n(78308),w=n(97842),Z=n(54584),C=n(86190),x=n(46603),P=n(16889),I=n(91400),B=n(92039),S=n(98012),N=n(17440);function k(e){let{children:t,surface:n}=e,{user:s,userSettings:l}=(0,_.SE)(),c=l.newest_seen_chat_item_published_at,[{path:d}]=(0,v.tv)(),u=(0,I.XA)(),m=(0,B.rG)(),p=(0,B.m)(),[g,y]=(0,h.L)(X,(0,i._)((0,o._)({},w.UX),{user:s,users:new Map(s?[[s.id,s]]:[])}));(0,w.WG)({auto:!!s},{onSuccess:e=>{y({type:"inbox-unread_count",payload:e})}});let f=(0,a.sO)(0);return(0,a.d4)(()=>{if(m&&s)return m.listen({["user:".concat(s.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?y(Q(e)):"chat:updated-post"===e.type?y(ee(e)):"chat:new-post"===e.type&&y(et(e))}}})},[m]),(0,a.d4)(()=>{"open"===p&&s&&y((0,b.oH)())},[p]),(0,a.d4)(()=>{if("open"!==p){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;s&&e-f.current>5e3&&"hidden"!==t&&(f.current=e,y((0,b.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},o=(0,P.n)(t);return d.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[c,d,u,y,p]),(0,r.tZ)(Z.o.Provider,{value:n,children:(0,r.tZ)(w.ge.Provider,{value:y,children:(0,r.tZ)(w.ky.Provider,{value:g,children:t})})})}let A={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},R={isLoading:!1,hasMore:!1,error:null},L={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},M={before:R,after:(0,i._)((0,o._)({},R),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function X(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,a=null!==(n=e.chats.get(r.id))&&void 0!==n?n:A;return(0,i._)((0,o._)({},e),{chats:(0,N.Rg)(e.chats,r.id,(0,i._)((0,o._)({},a),{publication:r})),publications:(0,N.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:c,mostRecentChatTimestamp:d}=t.payload,u=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...l()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,userStatus:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...l()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:a}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(a)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...l()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:A;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...l()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},L,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,a,s,l,c,d,u,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!==(d=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==d?d:null,muteStatus:null!==(u=t.muteStatus)&&void 0!==u?u:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(s=e.user)||void 0===s?void 0:null===(a=s.primary_publication)||void 0===a?void 0:a.id)||(null===(l=e.inbox.threads.get(t.id))||void 0===l?void 0:l.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(c=t.recentMessage)||void 0===c?void 0:c.id)&&void 0!==m?m:null,isPrimary:!1})}),p=$(m),_=(0,N.zg)(e.inbox.threads,m,e=>e.id),h=$([..._.values()]),{filter:g}=e.inbox,v=(0,f.A)(g);return T((0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[v]:{hasMore:r&&p===h,isLoading:!1}}),threads:_,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:c,mostRecentChatTimestamp:d})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return T((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,f.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return T((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.FN)(e.inbox.threads,W(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return T((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.FN)(e.inbox.threads,W(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=W(n.id);return(0,i._)((0,o._)({},e),{chats:(0,N.i4)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.i4)(e.inbox.threads,W(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;W(n.id);let r=(0,N.Rg)(e.inbox.threads,W(n.id),{id:W(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},T((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,N.FN)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,N.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,n,(0,o._)({},r,L))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=j(n);return(0,i._)((0,o._)({},e),{conversations:(0,N.i4)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:a,error:s}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[a].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,n,(0,i._)((0,o._)({},l),{[a]:{isLoading:!1,cursor:r,error:s}}))})}case"conversation-load_more":{let r;let{edge:a,cursor:s,page:{thread:c,replies:d,publications:u,comments:m,pastCursor:p,futureCursor:_,profile:h,subscriberContext:g}}=t.payload,v=d.map(e=>e.comment.id),y=new Set(v),b=e.conversations.get(c.id);if(!b)return console.error("Attempting to load messages for missing conversation"),e;if(b[a].cursor!==s)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let f=b.replyIds.filter(e=>!y.has(e));f="before"===a?v.concat(f):f.concat(v),r=s?{[a]:{isLoading:!1,cursor:"before"===a?p:_,error:null}}:{before:{isLoading:!1,cursor:p,error:null},after:{isLoading:!1,cursor:_,error:null}};let w=(0,i._)((0,o._)({},b,r),{thread:c,replyIds:f}),Z=h&&(null===(n=c.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),C=(0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,c.id,w),communityComments:J(e.communityComments,d.flatMap(e=>l()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.created_at),users:(0,N.zg)(e.users,d.flatMap(e=>{var t;return l()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,N.Rg)(e.profiles,h.id,(0,i._)((0,o._)({},Z,h),{subscriberContext:g})):e.profiles,publications:u?(0,N.zg)(e.publications,u,e=>e.id):e.publications,notes:m?(0,N.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===a||!s)return D(C,c.id,null);return C}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:s}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let c={comment:(0,i._)((0,o._)({},O(e,t.payload)),{quote_id:null!==(r=l.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,y.Fo)(a)}:void 0,quote:s,quoteId:null==s?void 0:s.comment.id},d=(0,i._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,c.comment.id]});return D((0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,c.comment.id,c),conversations:(0,N.Rg)(e.conversations,n,d)}),n,c.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:a,publications:s,comments:l}=t.payload;n=null!=n?n:a.client_id;let c=e.conversations.get(r);if(!c)throw Error("Attempted to post message to missing conversation");let d=n&&e.communityComments.get(n),u=new Map(e.communityComments),m=H(a);u.set(a.comment.id,d?(0,i._)((0,o._)({},m),{clientId:d.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:d.comment.media_uploads})}):m),a.quote&&u.set(a.quote.comment.id,H(a.quote));let p=c.replyIds,_=a.comment.id;return n&&(p=p.map(e=>e===n?_:e)),p.includes(_)||(p=[...p,_]),p=[...new Set(p)],D((0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,r,(0,i._)((0,o._)({},c),{replyIds:p})),communityComments:u,publications:s?(0,N.zg)(e.publications,s,e=>e.id):e.publications,notes:l?(0,N.zg)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,n,(0,i._)((0,o._)({},a),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return V(e,n,{unmute_at:o?(0,S.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=r!==a.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,s)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,a,s,l,c;let{publication_id:u}=t.payload,m=null!==(n=e.chats.get(u))&&void 0!==n?n:A;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),s=J(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=W(u),c=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},p=(0,i._)((0,o._)({},e),{users:(0,N.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:s,chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m,c),{posts:d()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return Y(null===(n=s.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(o=s.get(t))||void 0===o?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.FN)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!==(t=null==a?void 0:a.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,i._)((0,o._)({},p),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(p)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.F5)(e.inbox.threads,W(u),{lastViewedAt:new Date().toISOString()})}),chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),s={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(a=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==a?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0,userStatus:null};return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,s.communityPost.id,s),chats:(0,N.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{posts:[s.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:a}=t.payload,s=new Map(e.communityPosts);s.set(a,n);let l=Array.from(new Set([a,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.F5)(e.inbox.threads,W(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,N.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:s,chats:(0,N.Rg)(e.chats,r,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:a}=t.payload,s=new Map(e.communityPosts);s.delete(n),s.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.F5)(e.inbox.threads,W(a),{communityPostId:r.communityPost.id})}),communityPosts:s,chats:(0,N.Rg)(e.chats,a,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(s=a.communityPost)||void 0===s?void 0:s.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:z(a.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a)||!(null===(l=a.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:z(a.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{E(t,s);let n=e.replies.get(t);n&&n.comments.forEach(e=>{E(e,s)})});let d=null===(c=e.chats.get(r))||void 0===c?void 0:c.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i?void 0:null===(o=i.communityPost)||void 0===o?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null===(o=e.communityPosts.get(t))||void 0===o?void 0:o.communityPost,a=null===(i=e.communityPosts.get(n))||void 0===i?void 0:i.communityPost;return Y(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],u=(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:s,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.FN)(e.inbox.threads,W(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=d?d:null}):e)})});return(0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},u.inbox),{threadList:U(u)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!K(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:a}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,N.Rg)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,a=e.communityPosts.get(n);if(!a||!K(a))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,o._)({},a.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,a,s,c,u,m,p,_;let h,v=null,y=null;"parentCommentId"in(_=t).payload&&_.payload.parentCommentId?y=t.payload.parentCommentId:"postId"in t.payload&&(v=t.payload.postId);let b=e=>y?{replies:e}:{comments:e};h=y?null!==(n=e.replies.get(y))&&void 0!==n?n:M:v&&null!==(r=e.comments.get(v))&&void 0!==r?r:M;let f=y?e.replies:e.comments,w=null!=y?y:v;switch(t.type){case"replies-clear":case"comments-clear":return w?(0,o._)({},e,b((0,N.Rg)(f,w,M))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,s=(0,i._)((0,o._)({},R),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{before:"desc"===n?s:R,after:"asc"===n?s:R,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!==(a=null==h?void 0:h.isLoaded)&&void 0!==a&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:a,replies:s,more:c,moreAfter:u,moreBefore:m,lastViewedAt:p}}=t.payload,_=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||A;n.muteStatus||(_=(0,N.Rg)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let g=s.map(e=>e.comment.id),v=J(e.communityComments,s.flatMap(e=>l()([e,e.quote]).map(H)),e=>e.comment.id,e=>e.comment.updated_at);if(a)v.set(a.comment.id,(0,i._)((0,o._)({},a),{userId:a.user.id}));let y=(0,N.zg)(e.users,l()([null==r?void 0:r.communityPost.user,null==a?void 0:a.user]),e=>e.id),Z=w?f.get(w):null,C=(null==Z?void 0:Z.isLoaded)?{[n]:{isLoading:!1,hasMore:c,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:u,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,N.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:v}),_?{chats:_}:{}),{users:new Map([...y,...s.map(e=>[e.user.id,e.user])])}),b((0,N.Rg)(f,w,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:d()([...h.comments,...g]).sort((e,t)=>{var n,o;return Y(null===(n=v.get(e))||void 0===n?void 0:n.comment.created_at,null===(o=v.get(t))||void 0===o?void 0:o.comment.created_at)}).filter(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||c?h.order:"desc",isLoaded:!0,lastViewedAt:p}))))}case"replies-target":case"comments-target":return w?(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,N.FN)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,N.FN)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return w?(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return w?(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},O(e,n)),{quote_id:null!==(u=null===(s=n.quoteReply)||void 0===s?void 0:s.comment.id)&&void 0!==u?u:null,post_id:n.postId,parent_id:y}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(c=n.quoteReply)||void 0===c?void 0:c.comment.id,pub_roles:n.pubRoles},a=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,r.comment.id,r)}),b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(y){let n=e.communityComments.get(y);if(n&&G(n)){let r=F(n.comment,e.user,t.payload.postId);a.communityComments.set(y,(0,i._)((0,o._)({},n),{comment:r}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&K(l)){let n=F(l.communityPost,e.user,t.payload.postId);a.communityPosts=(0,N.Rg)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},l),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(r.comment.id,H(r));let s=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:a}),b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{comments:s}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,H(r))}),b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,H(r)),users:r.user?(0,N.Rg)(e.users,r.userId,r.user):e.users}),b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof g.kp){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,N.Rg)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null,userStatus:null})),users:t.user?(0,N.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,b((0,N.Rg)(f,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a)||!(null===(m=a.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a)||!(null===(p=a.comment)||void 0===p?void 0:p.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:z(a.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,o._)({},a.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!G(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityComments.get(n);if(!a||!G(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,N.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,i._)((0,o._)({},a.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function F(e,t,n){var r,a;let s;return(t&&t.photo_url&&(s=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(s=m()([...s,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:s,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:s,comment_count:1+(null!==(a=e.comment_count)&&void 0!==a?a:0)}):e}function E(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function O(e,t){var n,r,a;return(0,i._)((0,o._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(a=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==a?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function D(e,t,n){let r=j(t),a=e.inbox.threads.get(r),s=(null==a?void 0:a.type)==="direct-message"?a:null,l=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,N.Rg)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},s),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},l),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(l)})})}function z(e,t,n){var r,a;let s=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!==(r=l[t])&&void 0!==r?r:0)+(n?1:-1),n&&s&&(l[s]=(null!==(a=l[s])&&void 0!==a?a:0)-1),(0,i._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function T(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(e)})})}function U(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:Y(q(e,t),q(e,n))).map(e=>e.id)}function q(e,t){var n,o,i,r;return"chat"===t.type?null!==(i=t.communityPostId&&(null===(o=e.communityPosts.get(t.communityPostId))||void 0===o?void 0:o.communityPost.created_at))&&void 0!==i?i:t.timestamp:null!==(r=null===(n=(0,x._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function V(e,t,n){let r=e.conversations.get(t),a=null==r?void 0:r.thread;if(!r||!a)throw Error("Tried to update a conversation that does not exist.");let s=e.user;if(!s)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,N.Rg)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},a),{members:a.members.map(e=>e.user_id===s.id?(0,o._)({},e,n):e)})}))})}function W(e){return"chat-".concat(e)}function j(e){return"direct-message-".concat(e)}function H(e){var t,n,r,a;return(0,i._)((0,o._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(a=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==a?a:void 0})}function K(e){return!0!==e.isNew}function G(e){return!0!==e.isNew}function Y(e,t){return e===t?0:!t||e&&e>t?-1:1}function J(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),a=r.get(t);if(!a){r.set(t,e);continue}i(e)>=i(a)&&r.set(t,(0,o._)({},a,e))}return r}function $(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!==(o=n.timestamp)&&void 0!==o?o:t;return i<e?i:e},t)}let Q=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,C.U)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,p.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:a}=e;if("deleted"===a.status){t({type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}});return}t({type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null,userStatus:null}}})},et=e=>async t=>{var n,r;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null,userStatus:null}}})}},20521:function(e,t,n){n.d(t,{x:()=>r});var o=n(98012);function i(e){var t;let n=[e.is_primary,(null===(t=e.publication)||void 0===t?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(n,"-").concat((0,o.Z)(e.created_at).valueOf())}function r(e){return e.slice(0).sort((e,t)=>i(e)>i(t)?1:-1)}}}]);