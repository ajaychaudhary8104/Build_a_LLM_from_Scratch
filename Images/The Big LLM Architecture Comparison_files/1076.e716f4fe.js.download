"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1076"],{66824:function(e,t,i){i.d(t,{Z:()=>o});let o={container:"container-D8CZbL","videoContainer-clip":"videoContainer-clip-KcDC9v",videoContainerClip:"videoContainer-clip-KcDC9v",videoContainerWrapper:"videoContainerWrapper-VrqlAM",videoIcon:"videoIcon-JWfwBB",videoContainer:"videoContainer-S7toSI",video:"video-dep_Pc",fullScreenContainer:"fullScreenContainer-oPOI4W","playerContainer-vertical":"playerContainer-vertical-nqZGWC",playerContainerVertical:"playerContainer-vertical-nqZGWC","playerContainer-landscape":"playerContainer-landscape-R9mTfd",playerContainerLandscape:"playerContainer-landscape-R9mTfd","playerContainer-vertical_fit":"playerContainer-vertical_fit-j9atXq",playerContainerVerticalFit:"playerContainer-vertical_fit-j9atXq","videoContainer-vertical_fit":"videoContainer-vertical_fit-ku5xgX",videoContainerVerticalFit:"videoContainer-vertical_fit-ku5xgX","video-vertical_fit":"video-vertical_fit-aJ3XQJ",videoVerticalFit:"video-vertical_fit-aJ3XQJ","playerContainer-vertical_fill":"playerContainer-vertical_fill-As6E90",playerContainerVerticalFill:"playerContainer-vertical_fill-As6E90","videoContainer-vertical_fill":"videoContainer-vertical_fill-pCmPd2",videoContainerVerticalFill:"videoContainer-vertical_fill-pCmPd2","video-vertical_fill":"video-vertical_fill-UOGFke",videoVerticalFill:"video-vertical_fill-UOGFke",videoPlayer:"videoPlayer-ySwQUq",generateClips:"generateClips-qHOZUt",spinner:"spinner-FpLDBB",backDrop:"backDrop-EWGPYa",downloadModal:"downloadModal-SupuMR"}},96164:function(e,t,i){i.d(t,{fg:()=>n}),i(69572);let o={user:"recentUserQ",pub:"recentPubQ",importsReviewPageSize:"importsReviewPageSize",importsReviewColumns:"importsReviewColumns"},n=()=>{"undefined"!=typeof localStorage&&(localStorage.getItem(o.user)&&localStorage.setItem(o.user,"[]"),localStorage.getItem(o.pub)&&localStorage.setItem(o.pub,"[]"),localStorage.removeItem(o.importsReviewPageSize),localStorage.removeItem(o.importsReviewColumns))}},10797:function(e,t,i){i(16584),i(30396),i(23279),i(40827),i(80569),i(95441),i(71068),i(15771),i(86075),i(19081),i(6490),i(65523),i(98248);var o=i(63474);i(58175),i(51776),i(52684);var n=i(1747);(0,o.zo)({display:"flex",position:"absolute",gap:8,padding:8,paddingTop:32,alignItems:"center",justifyContent:"end",className:n.Z.footer})},33804:function(e,t,i){i.d(t,{w:()=>l});var o=i(16584),n=i(4615),a=i(5406);function l(e){let{children:t}=e;return(0,o.tZ)(n.f6,{theme:a.Z.pubAccentTheme,children:t})}},347:function(e,t,i){i.d(t,{h:()=>l});var o=i(16584);i(98661);var n=i(4615),a=i(4291);function l(e){let{children:t}=e;return(0,o.tZ)(n.f6,{theme:a.Z.pubTheme,children:t})}},1055:function(e,t,i){i.d(t,{Z:()=>r});var o=i(7409),n=i(99282),a=i(16584),l=i(64515);let r=e=>(0,a.tZ)(l.l,(0,n._)((0,o._)({},e),{name:"PlayIconRounded",svgParams:{height:16,width:16},stroke:"none",children:(0,a.tZ)("path",{d:"M3.35866 16C2.58101 16 2 15.4101 2 14.4447V1.55531C2 0.598883 2.58101 0 3.35866 0C3.75196 0 4.10056 0.134078 4.54749 0.393296L15.1575 6.54302C15.9531 7.00782 16.3106 7.39218 16.3106 8C16.3106 8.61676 15.9531 9.00112 15.1575 9.45698L4.54749 15.6067C4.10056 15.8659 3.75196 16 3.35866 16Z"})}))},81924:function(e,t,i){i.d(t,{w:()=>f});var o=i(16584),n=i(30396),a=i(55679),l=i(70109),r=i(94184),d=i.n(r);i(23279);var s=i(77705);i(95441);var c=i(5780);i(68833);var p=i(98914);i(15771);var u=i(19081);i(38023),i(6490);var h=i(58175),v=i(81355),m=i(60520);let f=e=>{let{node:t,id:i}=e,[r,f]=(0,n.eJ)(t.attrs.persistentExpression);return(0,n.d4)(()=>{f(t.attrs.persistentExpression)},[t]),(0,n.d4)(()=>{let e=e=>{let{detail:i}=e;i.node.attrs.id===t.attrs.id&&f(i.persistentExpression)};return(0,c.oj)().addEventListener("close",e),()=>{(0,c.oj)().removeEventListener("close",e)}},[]),(0,o.tZ)(a.T5,{"data-drag-handle":"",children:(0,o.tZ)(v.e,{children:(0,o.tZ)("div",{className:"latex-block",id:i,children:(0,o.tZ)(u.tu,{className:d()(m.Z.latexWrapper,t.attrs.persistentExpression||(0,p.K1)()?m.Z.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:r,id:t.attrs.id}),onClick:()=>{r!==t.attrs.persistentExpression&&f(t.attrs.persistentExpression),(0,c.oj)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,o.BX)(u.gq,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[r||t.attrs.persistentExpression?(0,o.tZ)(u.tu,{alignItems:"center",justifyContent:"center",children:(0,o.tZ)(l.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(r||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,o.tZ)(u.tu,{alignSelf:"center",children:(0,o.tZ)(h.xv.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,o.tZ)(u.tu,{children:(0,o.tZ)("button",{className:m.Z.latexEdit,children:(0,o.tZ)(s.Z,{width:20,height:20})})})]})})})})})}},1148:function(e,t,i){i.d(t,{H:()=>n});var o=i(16584);let n=e=>(0,o.tZ)("div",{className:"file-embed-wrapper-editor",children:(0,o.tZ)("div",{className:"file-embed-aligner",children:(0,o.tZ)("div",{className:"file-embed-container placeholder",children:(0,o.tZ)(a,{})})})}),a=()=>(0,o.BX)("div",{className:"embed-loader-container",children:[(0,o.tZ)("div",{className:"embed-loader"}),(0,o.tZ)("div",{className:"embed-loader-text",children:"Loading..."})]})},43148:function(e,t,i){i.d(t,{H:()=>p,o:()=>c});var o=i(16584),n=i(98661),a=i(30396),l=i(15771),r=i(19081),d=i(58175),s=i(12811);let c=(0,n.forwardRef)((e,t)=>{let{onClick:i,children:n,disabled:a=!1,size:r="md"}=e;return(0,o.tZ)(l.GI,{ref:t,rounded:!0,onClick:i,disabled:a,size:r,children:n})}),p=e=>{let{label:t,children:i}=e,[n,l]=(0,a.eJ)(!1);return(0,o.BX)(r.gq,{gap:8,justifyContent:"center",alignItems:"center",children:[t&&(0,o.tZ)(r.gq,{bg:"glass-inverted-medium",justifyContent:"center",alignItems:"center",radius:"sm",paddingY:6,paddingX:8,className:s.Z.verticalMenuLabel,style:{opacity:+!!n},children:(0,o.tZ)(d.xv.B4,{color:"white",children:t})}),(0,o.tZ)("div",{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:i})]})}},42684:function(e,t,i){i(27412),i(7409),i(99282),i(16584),i(84892),i(86657),i(64819),i(24763);var o=i(21903);i(24791),i(60308),o.ZP},28771:function(e,t,i){i.d(t,{M$:()=>l}),i(16584);var o=i(6400),n=i(30396);i(94184),i(1852),i(71068),i(70379),i(7149);let a=(0,o.createContext)({initialTab:"settings",isDrawerOpen:()=>!1,openDrawerId:null,setInitialTab:()=>void 0,setIsDrawerOpen:()=>void 0,setPreventChange:()=>void 0});function l(){return(0,n.qp)(a)}},19908:function(e,t,i){i.d(t,{M:()=>n});var o=i(83857);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let n=e=>(t,i,n)=>{if(i){var a,l,r;(0,o.d)(e.marks.link,{scrollParent:".editor-scroll",language:"undefined"!=typeof window?null===(r=window)||void 0===r?void 0:null===(l=r._preloads)||void 0===l?void 0:null===(a=l.publication)||void 0===a?void 0:a.language:null}).spec.run(t,i,n)}return!0}},21903:function(e,t,i){i.d(t,{QM:()=>b,ZP:()=>U,hJ:()=>_});var o=i(27412),n=i(7409),a=i(58865),l=i(6400),r=i(14293),d=i.n(r),s=i(81763),c=i.n(s),p=i(80569),u=i.n(p),h=i(88452),v=i(40647),m=i(68833),f=i(98914),g=i(10656),y=i(98012),E=i(84864);function x(){let e=(0,a._)(["This will remove your audio. Are you sure?"]);return x=function(){return e},e}function T(){let e=(0,a._)(["This will remove your video. Are you sure?"]);return T=function(){return e},e}function C(){let e=(0,a._)(["File too large. Your file is ","; the maximum is ",".  Try encoding at a lower bitrate."]);return C=function(){return e},e}function w(){let e=(0,a._)(["It looks like your file is empty (0 bytes). Please check that the file you are trying to upload is not corrupted."]);return w=function(){return e},e}let _="video/*";class U extends l.Component{componentDidMount(){this.syncUploads()}componentWillUnmount(){this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime()}componentDidUpdate(e,t){e.mediaUploadId!==this.props.mediaUploadId&&null===this.props.mediaUploadId&&(this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime(),this.setState({mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null})),this.checkTranscodeStates(t),this.checkForNewUploads(e)}getMediaUploadId(){return this.state.mediaUploadId}stopUpdatingTranscodingTime(){clearTimeout(this.updateTranscodingTimeout),this.updateTranscodingTimeout=null}getEstimatedTranscodingTime(){let e=1,t=0,i=new Date().getTime(),{mediaUpload:o}=this.state;if((null==o?void 0:o.state)==="uploaded"&&o.uploaded_at&&o.duration&&o.duration>0){let n="video"===this.props.mediaType?.7:.03,a=1e3*Math.max("video"===this.props.mediaType?60:5,o.duration*n),l=Math.max(0,a-Math.max(0,Date.now()-new Date(o.uploaded_at).getTime()));e=Math.max(0,1-l/a),this.state.timeLeft&&this.state.timeLeft<l&&this.state.estimatedTimeLeftAt-Date.now()<5e3?(t=this.state.timeLeft,i=this.state.estimatedTimeLeftAt):t=l}return{estimatedTimeLeftAt:i,percentComplete:e,timeLeft:t}}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){var i;super(e,t),i=this,(0,o._)(this,"updateTranscodingTimeout",void 0),(0,o._)(this,"syncMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractPreviewMediaUploadTimeout",void 0),(0,o._)(this,"optionsDropdown",void 0),(0,o._)(this,"syncingMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractPreviewMediaUpload",void 0),(0,o._)(this,"i18n",void 0),(0,o._)(this,"updateTranscodingTime",()=>{var e;this.updateTranscodingTimeout||(this.setState(this.getEstimatedTranscodingTime()),(null===(e=this.state.mediaUpload)||void 0===e?void 0:e.state)==="uploaded"&&(this.updateTranscodingTimeout=window.setTimeout(()=>{this.updateTranscodingTimeout=null,this.updateTranscodingTime()},1e3)))}),(0,o._)(this,"onMediaUpload",e=>{var t;let{mediaUpload:i}=e;clearTimeout(null!==(t=this.syncMediaUploadTimeout)&&void 0!==t?t:void 0),this.setState({mediaUploadId:null==i?void 0:i.id,mediaUpload:i},()=>{var e,t;this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),null===(e=(t=this.props).onChange)||void 0===e||e.call(t,{mediaUpload:i})})}),(0,o._)(this,"onAudioExtractMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.setState({audioExtractMediaUploadId:null==t?void 0:t.id,audioExtractMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onAudioExtractPreviewMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.onAudioExtractPreviewMediaUpload),this.setState({audioExtractPreviewMediaUploadId:null==t?void 0:t.id,audioExtractPreviewMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractPreviewChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onMediaUploadUpdated",e=>{var t,i;null===(t=(i=this.props).onChange)||void 0===t||t.call(i,{mediaUpload:(0,n._)({},this.props.mediaUpload,e)})}),(0,o._)(this,"removeUpload",function(){var e;let{skipConfirm:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{iTemplate:o}=i.i18n,{mediaUploadId:n,mediaUpload:a}=i.state;if(n){if(!t&&!["cancelled","error"].includes(null==a?void 0:a.state)&&!confirm(o((null==a?void 0:a.media_type)==="audio"?x():T())))return;null===(e=i.optionsDropdown)||void 0===e||e.close(),i.clearSyncMediaUploadTimeouts(),i.setState({mediaUploadId:null,mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null},()=>{var e,t,o,n,a,l;null===(e=(t=i.props).onChange)||void 0===e||e.call(t,{mediaUpload:null}),null===(o=(n=i.props).onAudioExtractChange)||void 0===o||o.call(n,{mediaUpload:null}),null===(a=(l=i.props).onAudioExtractPreviewChange)||void 0===a||a.call(l,{mediaUpload:null})})}}),(0,o._)(this,"syncUploads",()=>{this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"})}),(0,o._)(this,"getTimeoutDuration",e=>(0,y.Z)(e).add(6e4,"milliseconds").isBeforeNow()?3e4:1e4),(0,o._)(this,"clearSyncMediaUploadTimeouts",()=>{this.syncMediaUploadTimeout&&clearTimeout(this.syncMediaUploadTimeout),this.syncAudioExtractMediaUploadTimeout&&clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.syncAudioExtractPreviewMediaUploadTimeout&&clearTimeout(this.syncAudioExtractPreviewMediaUploadTimeout)}),(0,o._)(this,"syncUpload",async e=>{var t,i;let{uploadIdKey:o,uploadKey:n,uploadTimeoutKey:a,uploadSyncingKey:l,endpoint:r}=e,d=this.state[o],s=this.state[n];if(!d){s&&this.setState({[n]:null});return}if((null==s?void 0:s.state)!=="transcoded"&&!this[l]){this[l]=!0;try{let e=await u().get(r.replace("{id}",d));this.setState({[n]:e.body},()=>{"uploaded"!==e.body.state?this.stopUpdatingTranscodingTime():this.updateTranscodingTime()})}catch(e){alert((0,f.zx)(e))}this.state[n]&&(null===(t=this.state[n])||void 0===t?void 0:t.state)!=="uploaded"||(this[a]=window.setTimeout(()=>this.syncUpload({uploadIdKey:o,uploadKey:n,uploadTimeoutKey:a,uploadSyncingKey:l,endpoint:r}),this.getTimeoutDuration(null===(i=this.state[n])||void 0===i?void 0:i.created_at))),this[l]=!1}}),(0,o._)(this,"checkTranscodeStates",e=>{var t,i,o,n,a,l,r,d,s,c,p,u,h,v,m,f;(null===(t=this.state.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"&&(null===(i=e.mediaUpload)||void 0===i?void 0:i.state)!==(null===(o=this.state.mediaUpload)||void 0===o?void 0:o.state)&&(null===(p=(u=this.props).onChange)||void 0===p||p.call(u,{mediaUpload:this.state.mediaUpload})),((null===(n=this.state.audioExtractMediaUpload)||void 0===n?void 0:n.state)==="transcoded"||(null===(a=this.state.audioExtractMediaUpload)||void 0===a?void 0:a.state)==="error")&&(null===(l=e.audioExtractMediaUpload)||void 0===l?void 0:l.state)!==(null===(r=this.state.audioExtractMediaUpload)||void 0===r?void 0:r.state)&&(null===(h=(v=this.props).onAudioExtractChange)||void 0===h||h.call(v,{mediaUpload:this.state.audioExtractMediaUpload})),(null===(d=this.state.audioExtractPreviewMediaUpload)||void 0===d?void 0:d.state)==="transcoded"&&(null===(s=e.audioExtractPreviewMediaUpload)||void 0===s?void 0:s.state)!==(null===(c=this.state.audioExtractPreviewMediaUpload)||void 0===c?void 0:c.state)&&(null===(m=(f=this.props).onAudioExtractPreviewChange)||void 0===m||m.call(f,{mediaUpload:this.state.audioExtractPreviewMediaUpload}))}),(0,o._)(this,"checkForNewUploads",e=>{var t,i,o,n,a,l;(e.mediaUpload!==this.props.mediaUpload||e.mediaUploadId!==this.props.mediaUploadId)&&this.setState({mediaUpload:null!==(t=this.props.mediaUpload)&&void 0!==t?t:null,mediaUploadId:null!==(i=this.props.mediaUploadId)&&void 0!==i?i:null}),(e.audioExtractMediaUpload!==this.props.audioExtractMediaUpload||e.audioExtractMediaUploadId!==this.props.audioExtractMediaUploadId)&&this.setState({audioExtractMediaUpload:null!==(o=this.props.audioExtractMediaUpload)&&void 0!==o?o:null,audioExtractMediaUploadId:null!==(n=this.props.audioExtractMediaUploadId)&&void 0!==n?n:null}),(e.audioExtractPreviewMediaUpload!==this.props.audioExtractPreviewMediaUpload||e.audioExtractPreviewMediaUploadId!==this.props.audioExtractPreviewMediaUploadId)&&this.setState({audioExtractPreviewMediaUpload:null!==(a=this.props.audioExtractPreviewMediaUpload)&&void 0!==a?a:null,audioExtractPreviewMediaUploadId:null!==(l=this.props.audioExtractPreviewMediaUploadId)&&void 0!==l?l:null})}),this.state={mediaUploadId:e.mediaUploadId,mediaUpload:e.mediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1},this.updateTranscodingTimeout=null,this.syncMediaUploadTimeout=null,this.syncAudioExtractMediaUploadTimeout=null,this.syncAudioExtractPreviewMediaUploadTimeout=null,this.syncingMediaUpload=!1,this.syncingAudioExtractMediaUpload=!1,this.syncingAudioExtractPreviewMediaUpload=!1,this.i18n=I18N.i(e.language)}}U.contextType=v.QA;class b extends h.Z{componentDidUpdate(e){this.props.initialFile!==e.initialFile&&(this.onFileSelected(this.props.initialFile),e.initialFile&&this.cancelUpload())}trackUploadClicked(){}onError(){var e,t,i;let{upload_state:o="uploading",customMessage:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.j)(m.FP.MEDIA_UPLOAD_FAILED,{upload_state:o,media_upload_id:null===(e=this.state.mediaUpload)||void 0===e?void 0:e.id,post_id:this.props.postId,customMessage:n}),null===(t=(i=this.props).onUploadCanceled)||void 0===t||t.call(i),super.onError({upload_state:o},n)}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){if(super(e,t),(0,o._)(this,"accepts",void 0),(0,o._)(this,"chunkSize",void 0),(0,o._)(this,"input",null),(0,o._)(this,"i18n",void 0),(0,o._)(this,"onUploadClicked",async()=>{this.trackUploadClicked()}),(0,o._)(this,"uploadToS3",async e=>{var t,i,o,a,l,r,d,s,c,p;let h;if((null===(t=this.state)||void 0===t?void 0:t.preuploading)||(null===(i=this.state)||void 0===i?void 0:i.uploading))return;null===(o=(a=this.props).onUploadStarted)||void 0===o||o.call(a),this.setState({preuploading:!0});let{iTemplate:v}=this.i18n;if(e.size>E.MAX_MEDIA_FILE_SIZE){this.onError({upload_state:"preupload",customMessage:v(C(),(0,E.formatBytes)(e.size),(0,E.formatBytes)(E.MAX_MEDIA_FILE_SIZE))});return}if(0===e.size){this.onError({upload_state:"preupload",customMessage:v(w())});return}this.props.postId||(this.props.setPostId?await (null===(l=(r=this.props).setPostId)||void 0===l?void 0:l.call(r)):console.warn("missing postId and cannot set postId, likely a non post editor")),this.setState({durationPromise:(0,g.Iw)(e)});try{let t="video"===this.props.mediaType?"/api/v1/video/upload":"/api/v1/audio/upload";h=await u().post(t).query((0,n._)({filetype:e.type,fileSize:e.size,fileName:"".concat(null==e?void 0:e.name)},this.props.postId?{post_id:this.props.postId}:{})),(0,m.j)(m.FP.MEDIA_UPLOAD_CREATED,{media_type:this.props.mediaType,file_size:e.size,file_type:e.type,parts_size:(null!==(d=h.body.multipartUploadUrls)&&void 0!==d?d:[]).length,post_id:this.props.postId})}catch(e){console.error("Failed to create media upload:",e),this.onError({upload_state:"preupload",customMessage:(0,f.zx)(e)});return}let{mediaUpload:y,multipartUploadId:x,multipartUploadUrls:T}=h.body,_=(null!==(s=null==y?void 0:y.parts)&&void 0!==s?s:[]).map(e=>e.etag).filter(Boolean);"created"===y.state&&_.length===T.length?(this.setState({mediaUpload:y,mediaUploadId:y.id}),await this.initTranscode(y,_)):"uploaded"===y.state||"transcoded"===y.state?null===(c=(p=this.props).onUpload)||void 0===c||c.call(p,h.body):(this.setState({preuploading:!1,mediaUpload:y,multipartUploadId:x,existingEtags:_}),(0,m.j)(m.FP.MEDIA_UPLOAD_STARTED,{media_upload_id:y.id,media_type:this.props.mediaType,post_id:this.props.postId}),super.uploadFile(e,null,{urls:T,method:"PUT",withCredentials:!1,useFormData:!1,mediaUpload:y}))}),(0,o._)(this,"onFileSelected",async e=>{var t,i,o,n;if(this.setState({recording:!1}),e=e||(null===(i=this.input)||void 0===i?void 0:null===(t=i.files)||void 0===t?void 0:t[0]),this.input&&(this.input.value=""),e){if(!d()(this.props.maxVideoDurationSeconds))try{let t=await (0,g.Iw)(e);if("number"==typeof t&&t>this.props.maxVideoDurationSeconds){(0,m.j)(m.FP.VIDEO_UPLOAD_IN_NOTES_FAILED,{duration_seconds:t,reason:"too_long"}),null===(o=(n=this.props).onVideoTooLong)||void 0===o||o.call(n);return}}catch(e){console.warn("could not get video duration",e)}this.uploadToS3(e)}}),(0,o._)(this,"onComplete",async()=>{var e,t,i;let o=null===(e=this.state.uploading)||void 0===e?void 0:e.status;if(!o||o<200||o>=400){this.onError();return}(0,m.j)(m.FP.MEDIA_UPLOAD_COMPLETED,{media_upload_id:this.state.mediaUpload.id,post_id:this.props.postId});let n=[...null!==(i=this.state.existingEtags)&&void 0!==i?i:[],...null===(t=this.state.uploadingXhrs)||void 0===t?void 0:t.map(e=>e.getResponseHeader("Etag")).filter(Boolean)];await this.initTranscode(this.state.mediaUpload,n)}),(0,o._)(this,"initTranscode",async(e,t)=>{let i=null;try{if((i=await this.state.durationPromise)&&"object"==typeof i&&"is_error"in i)throw i}catch(e){console.error("Failed to fetch video duration:",e)}try{var o,n;let a=await u().post("/api/v1/".concat(this.props.mediaType,"/upload/").concat(e.id,"/transcode")).send({duration:c()(i)?i:null,multipart_upload_id:e.multipart_upload_id,multipart_upload_etags:t});this.setState({mediaUpload:null,audioExtractMediaUpload:null,multipartUploadId:null}),this.resetUpload(),null===(o=(n=this.props).onUpload)||void 0===o||o.call(n,a.body,"")}catch(e){throw alert((0,f.zx)(e)),this.onError({upload_state:"transcoding"}),e}}),!["video","audio"].includes(e.mediaType))throw Error("unsupported media type: ".concat(e.mediaType));this.accepts="video"===e.mediaType?_:"audio/mpeg,audio/mp3,audio/m4a,audio/x-m4a,audio/aac,audio/aiff,audio/x-aiff,audio/amr,audio/flac,audio/ogg,audio/wav,audio/x-wav",this.fudgeFactor=.9,this.chunkSize=E.MAX_MEDIA_UPLOAD_CHUNK_SIZE,this.i18n=I18N.i(e.language),e.initialFile&&this.onFileSelected(this.props.initialFile)}}b.contextType=v.QA},44369:function(e,t,i){i.d(t,{$4:()=>d,Sm:()=>h,cS:()=>m,nv:()=>u,om:()=>g,pA:()=>f,vM:()=>v});var o=i(27412),n=i(42249),a=i(68833),l=i(98914),r=i(60308);class d extends n.sN{static fromMenuItem(e,t){let{spec:i}=e;return new d(i,t)}constructor(e,t){super(e);let i=this.spec.run;this.spec.run=(e,o,n,l)=>((0,a.j)(a.FP.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),i.call(this,e,o,n,l))}}let s="ProseMirror-prompt",c="".concat(s,"-visible");class p{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,o._)(this,"options",void 0),this.options=e}}class u extends p{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class h extends u{constructor(e,t,i="en"){let{iString:o}=I18N.i(i);super({label:o("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,r.SVA)(),"/publish/post/"))&&alert(o("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return o("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){}return e.startsWith("http")?o("Invalid URL"):o("Invalid URL. Try using http://")}}})}}function v(e,t){let{from:i,$from:o,to:n,empty:a}=e.selection;return a?!!t.isInSet(e.storedMarks||o.marks()):e.doc.rangeHasMark(i,n,t)}function m(e){if(f(e))return;let{iString:t}=I18N.i(e.language||"en"),i="".concat(s,"-").concat(e.parentClass),o=e.root||document.body,n=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(o)||window,a=o.appendChild(document.createElement("div"));a.classList.add(s),e.className&&a.classList.add(e.className),a.id=i,(0,l.cn)(document.body,c);let r=e=>{a.contains(e.target)||u()},d=()=>{if(e.position)e.position(a,h);else{var t,i;let o=e.parentClass&&(null===(t=(i=document).querySelector)||void 0===t?void 0:t.call(i,".".concat(e.parentClass)));if(o){let t=o.getBoundingClientRect();a.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),a.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=a.getBoundingClientRect();a.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),a.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},p=t=>{var i;t&&t.preventDefault();let o=function(e,t){let i={},o=0;for(let n in e){let a=e[n],l=t[o++],r=a.read(l),d=a.validate(r);if(d)return function(e,t){let i=e.parentNode;if(!i)return;let o=i.appendChild(document.createElement("div"));o.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),o.style.top="".concat(e.offsetTop-5,"px"),o.className="ProseMirror-invalid",o.textContent=t,setTimeout(()=>i.removeChild(o),1500)}(l,d),null;i[n]=a.clean(r)}return i}(null!==(i=e.fields)&&void 0!==i?i:{},v);o&&u(o)},u=t=>{(0,l.IV)(document.body,c),window.removeEventListener("mousedown",r),window.removeEventListener("resize",d,!1),n.removeEventListener("scroll",d,!1),a.parentNode&&a.parentNode.removeChild(a),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",r),50),window.addEventListener("resize",d,!1),n.addEventListener("scroll",d,!1);let h=a.appendChild(document.createElement("span"));h.className="head";let v=[],m=0;for(let t in e.fields){m++;let i=e.fields[t].render();i.tabIndex=m,v.push(i)}let g=a.appendChild(document.createElement("form"));if(e.title&&(g.appendChild(document.createElement("h5")).textContent=e.title),v.forEach(e=>{g.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let i=document.createElement("button");i.type="submit",i.className="".concat(s,"-submit"),i.textContent=e.submitText||"OK",i.addEventListener("click",p);let o=document.createElement("button");o.type="button",o.className="".concat(s,"-cancel"),o.textContent=t("Cancel"),o.addEventListener("click",()=>u());let n=g.appendChild(document.createElement("div"));n.className="".concat(s,"-buttons"),n.appendChild(i),n.appendChild(document.createTextNode(" ")),n.appendChild(o)}if(e.footer&&g.appendChild(e.footer),e.openseaEmbedFooter&&g.appendChild(e.openseaEmbedFooter),d(),g.addEventListener("submit",p),e.onInput&&g.addEventListener("input",t=>{var i;null===(i=e.onInput)||void 0===i||i.call(e,t,a)}),g.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),u();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{a.contains(document.activeElement)||u()},500),v.length>1)){for(let t=0;t<v.length;t++)if(document.activeElement===v[t]){0===t&&e.shiftKey?(e.preventDefault(),v[v.length-1].focus()):t!==v.length-1||e.shiftKey||(e.preventDefault(),v[0].focus());break}}}else e.preventDefault(),p()}),g.elements.length>0){let e=g.elements[0];for(let t of Array.from(g.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function f(e){let t="".concat(s,"-").concat(e.parentClass),i=document.getElementById(t);if(i){let e;if(i.querySelector&&(e=i.querySelector(".".concat(s,"-cancel"))),e)e.click();else{var o;null===(o=i.parentNode)||void 0===o||o.removeChild(i),(0,l.IV)(document.body,c)}return!0}}function g(e,t){let i=e.selection.$from;for(let e=i.depth;e>=0;e--){let o=i.index(e);if(i.node(e).canReplaceWith(o,o,t))return!0}return!1}},66586:function(e,t,i){i(16584),i(30396);var o=i(23493),n=i.n(o);i(84892),i(95441),i(42684),i(47921),i(68833),i(15771),i(19081),i(58175),i(87077),n()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1})},89871:function(e,t,i){i.d(t,{z:()=>l}),i(16584);var o=i(98661),n=i(30396);i(89734),i(80569),i(40647),i(61381),i(63018);let a=(0,o.createContext)({existingClips:[],mediaClipsRequest:null,isTranscribing:!1,podcastUpload:null,setExistingClips:()=>void 0,setIsTranscribing:()=>void 0,setMediaClipsRequest:()=>void 0,setTranscription:()=>void 0,setUploadProgress:()=>void 0,syncClips:()=>Promise.resolve(),transcription:null,transcriptionGenerated:!1,uploadProgress:null,transcodeProgress:null,setTranscodeProgress:()=>void 0,nonStandardInputReasons:{},uploadState:"no-upload",videoUpload:null,onVideoTranscodeUpdate:()=>Promise.resolve(),postMediaComposition:null,setPostMediaComposition:()=>void 0,updatingActivePostMediaComposition:!1,setUpdatingActivePostMediaComposition:()=>void 0,fetchPostMediaComposition:()=>Promise.resolve()}),l=()=>(0,n.qp)(a)},47921:function(e,t,i){i(16584),i(33804),i(71068),i(15771),i(6400),i(98661),i(30396),i(94184),i(19081),i(58175)},66067:function(e,t,i){i(16584),i(30396);var o=i(23493),n=i.n(o);i(95441),i(28771),i(47921),i(82061),i(68833),i(93687),i(15771),i(19081),i(58175),i(87077),n()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1})},61381:function(e,t,i){i.d(t,{y:()=>r});var o=i(7409),n=i(99282),a=i(30396),l=i(28771);let r=()=>{let{initialTab:e,isDrawerOpen:t,setInitialTab:i,setIsDrawerOpen:r,setPreventChange:d}=(0,l.M$)(),s=(0,a.I4)(e=>{r((0,n._)((0,o._)({},e),{drawerId:"podcast",variant:"push"}))},[r]);return{initialTab:e,isPodcastDrawerOpen:t("podcast"),setInitialTab:i,setIsPodcastDrawerOpen:s,setPreventChange:e=>d({preventChange:e,preventChangeMessage:"Please wait until the upload is finished before closing the drawer"})}}},5780:function(e,t,i){i.d(t,{oj:()=>g});var o=i(7409),n=i(99282),a=i(98848),l=i(16584),r=i(98661),d=i(30396),s=i(94184);i(80569),i(10797),i(86374),i(66067);var c=i(15771);i(81924),i(347),i(95441),i(14952),i(56629),i(60807),i(80026),i(6490),i(39693),i(24350),i(57557),i(71171),i(98914),i(55014),i(19081),i(8594),i(68709),i(88e3),i(98248),i(58175),i(51776),i(70379),i(63651),i(7882),i(17688),i(40827),i(64515),i(69791);var p=i(71068);i(86075),i(65523),i(85930),i(52684),i(70293);var u=i(25871);(0,p.zo)({display:"flex",position:"absolute",gap:8,padding:8,paddingTop:32,alignItems:"center",animate:!0,className:u.Z.footer}),i(44369),i(66586);var h=i(68833);i(49762),i(61254),i(99916);var v=i(84747);i(73857),i(73943),i(6070),i(84864);let m=(e,t,i)=>{(0,h.j)(h.FP.EDITOR_MENU_ICON_CLICKED,{button:i}),t(e)};function f(e,t){return(0,d.I4)(i=>{e&&(t?m(i,e,t):e(i))},[e,t])}(0,r.forwardRef)((e,t)=>{var{trackedName:i,testId:r,priority:d="tertiary",onClick:s}=e,p=(0,a._)(e,["trackedName","testId","priority","onClick"]);let u=f(s,i);return(0,l.tZ)(c.hU,(0,n._)((0,o._)({},p),{size:"sm","data-testId":r,onClick:u,ref:t,priority:d}))}),(0,r.forwardRef)((e,t)=>{var{trackedName:i,testId:r,priority:d="tertiary",onClick:s}=e,p=(0,a._)(e,["trackedName","testId","priority","onClick"]);let u=f(s,i);return(0,l.tZ)(c.zx,(0,n._)((0,o._)({},p),{size:"sm","data-testId":r,onClick:u,ref:t,priority:d}))}),(0,r.forwardRef)((e,t)=>{var{trackedName:i,testId:r,onClick:d}=e,s=(0,a._)(e,["trackedName","testId","onClick"]);let c=f(d,i);return(0,l.tZ)(v.u,(0,n._)((0,o._)({},s),{"data-testId":r,onClick:c,ref:t}))});let g=()=>{if(window)return window.LatexModalEvent||(window.LatexModalEvent=new EventTarget),window.LatexModalEvent}},70232:function(e,t,i){i.d(t,{zF:()=>o}),i(98914);let o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAY4AAAB0BAMAAABgVMiEAAAAMFBMVEX////7+/vt7e3o6Ojm5ubn5+fu7u709PTs7Oz39/f19fX29vby8vLx8fHz8/Pw8PCxY+A8AAAAoklEQVR4AWJgVHYZ+sBIgEE0vXzog7JAhrZZq4Y+WJnB4A5o5w5oAAYBGAi6mcKpQgIaClhCBklz7+AM/Gjo5+Dg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgeO7g4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OD4Zse3dmVXfIST0/B1vh0UtMKbNF7rAAAAAElFTkSuQmCC"},82061:function(e,t,i){i.d(t,{nP:()=>S});var o=i(27412),n=i(7409),a=i(99282),l=i(58865),r=i(16584),d=i(98661),s=i(94184),c=i.n(s),p=i(66784),u=(i(95999),i(28142)),h=i(80569),v=i(13304),m=i(93666),f=(i(12281),i(95441)),g=i(41688),y=(i(31098),i(71825),i(21903)),E=(i(21680),i(40158),i(29719),i(68833)),x=(i(98914),i(88788)),T=i(69791),C=i(15771),w=i(19081),_=(i(84747),i(58175),i(74134),i(18618),i(84864)),U=i(96085);function b(){let e=(0,l._)([""," remaining"]);return b=function(){return e},e}function Z(e){let{children:t,className:i}=e,o=(0,d.useRef)(null);if(!o.current){let e=document.getElementById("video-portal");if(e)o.current=e;else{let e=document.createElement("div");e.setAttribute("id","video-portal"),e.className=i||"",document.body.appendChild(e),o.current=e}}return(0,d.createPortal)(t,o.current)}y.ZP;let I=e=>{let{onCancel:t,percentComplete:i,msLeft:o}=e,{iString:n,iTemplate:a}=(0,f.M1)(),l=(0,_.secondsToLargestUnit)(o/1e3,{long:!0,secondsCutoff:30});return(0,r.BX)("div",{className:"video-uploader-progress",children:[(0,r.BX)("div",{className:"video-uploader-progress-label",children:[n("Uploading video..."),o?a(b(),l):""]}),(0,r.BX)("div",{className:"video-uploader-progress-status",children:[(0,r.tZ)(C.hU,{size:"sm",priority:"quaternary",onClick:()=>{t()},children:(0,r.tZ)(v.Z,{})}),(0,r.tZ)("div",{className:"video-uploader-progress-bar",children:(0,r.tZ)("div",{className:"video-uploader-progress-bar-filled",style:"width: ".concat(100*i,"%;")})})]})]})};y.QM;class S extends y.QM{trackUploadClicked(){(0,E.j)(E.FP.UPLOAD_VIDEO_CLICKED,{source:"notes"})}render(e,t){return null}constructor(e,t){super(e,t),(0,o._)(this,"videoRecorderModal",null),this.state=(0,a._)((0,n._)({},this.state),{hideVideoInfoPanel:!1})}}class M extends m.p{getClassName(){return"video-recorder-modal"}componentWillUnmount(){super.componentWillUnmount(),this.recorder.stopCapture(),this.close()}onBeforeOpen(){this.startCapturePromise||(this.startCapturePromise=this.recorder.startCapture())}async onOpen(){var e,t;(0,E.j)(E.FP.VIDEO_RECORDER_SHOWN),null===(t=this.props)||void 0===t||null===(e=t.onOpen)||void 0===e||e.call(t);let i=this.startCapturePromise;if(this.startCapturePromise=null,!await i){this.close();return}if(this.recorder.stream instanceof Promise){console.error("onOpen called before stream was ready");return}this.videoElement&&"srcObject"in this.videoElement?this.videoElement.srcObject=this.recorder.stream:this.videoElement.src=URL.createObjectURL(this.recorder.stream)}onBeforeClose(){if(this.videoElement&&(this.videoElement.pause(),this.videoElement.srcObject=null,this.videoElement.src=null),this.recorder.state===x.Z.STATE.STARTED&&["embed","podcast"].includes(this.props.videoFeature))this.onButtonClick();else if(this.recorder.state===x.Z.STATE.STARTED);else if(this.recorder.state===x.Z.STATE.STARTING){let e=this.recorder;e.onStarted=()=>e.stop({dropRecording:!0})}else this.recorder.stopCapture()}onClose(){var e,t;(0,E.j)(E.FP.VIDEO_RECORDER_HIDDEN),null===(t=this.props)||void 0===t||null===(e=t.onClose)||void 0===e||e.call(t),this.setState({videoLoading:!0})}onButtonClick(){this.recorder.state===x.Z.STATE.STOPPED?(this.setState({countDown:3}),setTimeout(()=>this.setState({countDown:2}),700),setTimeout(()=>this.setState({countDown:1}),1400),this.recorder.start({startAt:Date.now()+2100})):this.recorder.state===x.Z.STATE.STARTED&&this.recorder.stop({stopCapture:!1})}renderChildren(e,t){let{children:i}=e,{videoLoading:o,recorderState:n,recorderDuration:a,recorderVolume:l,countDown:d}=t,{iString:s}=this.context;return(0,r.BX)("div",{className:"video-recorder-modal-wrap",children:[(0,r.tZ)("video",{ref:this.assignVideoElement,className:"video-recorder-preview",onLoadedMetadata:this.onVideoElementLoadedMetadata}),(0,r.tZ)("div",{className:"video-recorder-duration ".concat(n),children:n===x.Z.STATE.STOPPED?s(o?"Loading...":"Press to record"):n===x.Z.STATE.STARTING?"".concat(d||3):(0,_.secondsToHHMMSS)(a||0)}),(0,r.BX)("div",{className:"video-recorder-button ".concat(n),onClick:()=>this.onButtonClick(),children:[(0,r.tZ)("div",{className:"video-recorder-button-volume",style:"border-width:".concat(20*l,"px")}),(0,r.tZ)("div",{className:"video-recorder-button-inner"})]})]})}constructor(e,t){super(e,t),(0,o._)(this,"recorder",void 0),(0,o._)(this,"startCapturePromise",null),(0,o._)(this,"videoElement",null),(0,o._)(this,"recorderUpdateInterval",null),(0,o._)(this,"assignVideoElement",e=>{this.videoElement=e}),(0,o._)(this,"onVideoElementLoadedMetadata",()=>{if(!this.videoElement){console.error("onVideoElementLoadedMetadata called, videoElement not set");return}this.videoElement.volume=0,this.videoElement.play(),this.setState({videoLoading:!1})}),(0,o._)(this,"onRecorderStarting",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STARTING),this.onRecorderUpdated()}),(0,o._)(this,"onRecorderStarted",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STARTED),this.onRecorderUpdated(),this.recorderUpdateInterval=window.setInterval(()=>this.onRecorderUpdated(),100)}),(0,o._)(this,"onRecorderStopping",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STOPPING),this.recorderUpdateInterval&&clearInterval(this.recorderUpdateInterval),this.onRecorderUpdated()}),(0,o._)(this,"onRecorderStopped",e=>{if((0,E.j)(E.FP.VIDEO_RECORDER_STOPPED),this.onRecorderUpdated(),e){var t,i;(0,E.j)(E.FP.VIDEO_RECORDED,{videoType:e.type,videoSize:e.size}),null===(t=(i=this.props).onVideoRecorded)||void 0===t||t.call(i,e)}}),(0,o._)(this,"onRecorderUpdated",()=>{this.setState({recorderState:this.recorder.state,recorderDuration:this.recorder.duration,recorderVolume:this.recorder.volume})}),this.state.videoLoading=!0,this.recorder=new x.Z({aspectRatio:1920/1080,onStarting:this.onRecorderStarting,onStarted:this.onRecorderStarted,onStopping:this.onRecorderStopping,onStopped:this.onRecorderStopped,language:this.props.language}),this.onRecorderUpdated()}}(0,o._)(M,"contextType",f.wj)},70717:function(e,t,i){i.d(t,{w:()=>r});var o=i(16584),n=i(19081),a=i(58175),l=i(84864);let r=e=>{let{duration:t,icon:i,position:r="bottom-left",previewDuration:d}=e;return(0,o.BX)(n.gq,{alignItems:"center",bg:"glass-inverted-medium",gap:6,paddingX:8,paddingY:2,position:"absolute",radius:"sm",style:"bottom-left"===r?{left:8,bottom:8}:{right:8,bottom:8},children:[i,(0,o.tZ)(a.xv.Meta,{color:"white",lineHeight:20,children:d?"".concat((0,l.secondsToHHMMSS)(d)," / ").concat((0,l.secondsToHHMMSS)(null!=t?t:0)):(0,l.secondsToHHMMSS)(null!=t?t:0)})]})}},69791:function(e,t,i){i.d(t,{b:()=>u});var o=i(16584),n=i(94184),a=i.n(n),l=i(41352),r=i(71068),d=i(15771),s=i(19081),c=i(58175),p=i(98866);let u=e=>{let{title:t,description:i,Icon:n,onDismiss:a,theme:l="default",priority:r="tertiary",showClose:d=!0,flex:s="grow"}=e;return(0,o.BX)(y,{theme:l,priority:r,flex:s,children:[n&&(0,o.tZ)(h,{Icon:n}),(0,o.BX)(E,{children:[t&&(0,o.tZ)(v,{children:t}),i&&(0,o.tZ)(m,{children:i})]}),d&&(0,o.tZ)(f,{onClose:a,priority:r})]})},h=e=>{let{Icon:t}=e;return(0,o.tZ)(g,{children:(0,o.tZ)(t,{size:18,className:p.Z.icon})})},v=e=>{let{children:t}=e;return(0,o.tZ)(c.xv.B4,{weight:"medium",color:"primary",className:p.Z.title,children:t})},m=e=>{let{children:t}=e;return(0,o.tZ)(c.xv.B4,{weight:"regular",color:"secondary",className:p.Z.description,children:t})},f=e=>{let{onClose:t,priority:i}=e;return(0,o.tZ)(g,{children:(0,o.tZ)(d.hU,{priority:"quaternary",onClick:t,size:"xs",children:(0,o.tZ)(l.Z,{size:18,className:a()(p.Z.dismissIcon,p.Z["priority_".concat(i)])})})})},g=(0,r.zo)({display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20}),y=e=>{let{theme:t,priority:i,children:n,flex:l}=e;return(0,o.tZ)(s.X2,{flex:l,gap:12,paddingX:16,paddingY:12,radius:"sm",className:a()(p.Z.alert,p.Z["theme_".concat(t)],p.Z["priority_".concat(i)]),children:n})},E=(0,r.zo)({display:"flex",direction:"column",flex:"grow",alignItems:"start"})},8594:function(e,t,i){i.d(t,{A:()=>h,L:()=>v});var o=i(7409),n=i(99282),a=i(98848),l=i(16584),r=i(94697),d=i(45587),s=i(24285),c=i(71068);let p={opacity:.5,zIndex:1e3},u=e=>"item-".concat(e);function h(e){let{children:t,items:i,onReorder:o}=e,n=(0,r.Dy)((0,r.VT)(r.we,{activationConstraint:{distance:2}}),(0,r.VT)(r.Lg,{coordinateGetter:d.is}));return(0,l.tZ)(r.LB,{sensors:n,collisionDetection:r.pE,onDragEnd:e=>{let{active:t,over:n}=e;if(!n||t.id===n.id)return;let a=i.findIndex(e=>u(e)===t.id),l=i.findIndex(e=>u(e)===n.id);o((0,d.Rp)(i,a,l))},autoScroll:!1,children:(0,l.tZ)(d.Fo,{items:i.map(e=>u(e)),strategy:d.U2,children:t})})}function v(e){var{item:t}=e,i=(0,a._)(e,["item"]);return(0,l.tZ)(m,(0,o._)({id:u(t)},i))}let m=e=>{let{children:t,id:i,useDragHandle:a=!1}=e,{listeners:r,setNodeRef:u,transform:h,transition:v,isDragging:m}=(0,d.nB)({id:i});return(0,l.tZ)(c.xu,(0,n._)((0,o._)({ref:e=>u(e),style:(0,o._)({transform:s.ux.Translate.toString(h),transition:v},m?p:{})},a?{}:(0,o._)({},r)),{children:"function"==typeof t?t({listeners:r}):t}))}},61527:function(e,t,i){i.d(t,{Vo:()=>C,ql:()=>_,to:()=>w});var o=i(16584),n=i(30396),a=i(61649),l=i(68833),r=i(98422),d=i(19081),s=i(28797),c=i(49233),p=i(90630),u=i(63587),h=i(32782),v=i(84945),m=i(76671),f=i(68260),g=i(30730),y=i(27420),E=i(91189),x=i(6511),T=i(73798);let C=e=>{var t,i,C,w;let{autoPlayMuted:_,forLiveStream:U=!1,disableSharing:b=!1,disableShortcuts:Z=!1,disableTooltips:I=!1,disableCaptions:S=!1,duration:M,handle:A,hasPaywall:D=!1,hasTranscript:P=!1,hideNextVideoButton:k=!1,hidePip:O=!1,hideCaptions:N=!1,hideSettings:R=!1,isActive:B,isAudio:L=!1,isFocused:F,mediaRef:z,mediaUpload:X,podcastUpload:q,post:j,pub:V,showPaywall:K,showTranscript:H,size:W="md",onShareMenuClose:Y,onShareMenuOpen:G,onToggleShowTranscript:J,onBlur:Q,hoverOptions:$}=e,{transition:ee=.5,transitionDelay:et=.1}=null!=$?$:{},{isClipping:ei}=(0,a.Sr)(),{isMobile:eo}=(0,r.v9)(),en=B&&!K,ea=(0,n.sO)(null),[el,er]=(0,n.eJ)(!1),[ed,es]=(0,n.eJ)(!1),[ec,ep]=(0,n.eJ)(null),eu=e=>{let{current:t}=z;t&&(t.isShowingCaptionsElsewhere=e),es(e)};(0,n.d4)(()=>{(ei||_)&&eh({showCaptions:!0,userInitiated:!1})},[ei,_]);let eh=e=>{let{showCaptions:t,userInitiated:i}=e;eu(t),t&&(null==ev?void 0:ev.length)&&ev[0]&&(ep(ev[0].language),i&&(0,l.j)(l.FP.VIDEO_CLOSED_CAPTIONS_BUTTON_CLICKED,{language:ev[0].language}))};(0,n.d4)(()=>{en||er(!1)},[en]);let ev=null!==(C=null==q?void 0:null===(t=q.transcription)||void 0===t?void 0:t.signed_captions)&&void 0!==C?C:[],em=!!(null==q?void 0:null===(i=q.transcription)||void 0===i?void 0:i.approved_at);return(0,o.BX)("div",{ref:ea,style:{zIndex:ei?10:+!!el},onBlur:Q,children:[(null==A?void 0:A.active)?(0,o.tZ)("div",{className:T.Z.topOverlaysContainer,style:{opacity:+!!en,transform:en||eo?"translateY(0)":"translateY(-20%)"},children:(0,o.BX)(d.gq,{justifyContent:"space-between",paddingBottom:32,children:[(0,o.tZ)(d.gq,{padding:16}),(0,o.tZ)(d.gq,{padding:16})]})}):null,(0,o.tZ)("div",{}),!U&&(0,o.tZ)("div",{className:T.Z.settingsControlsContainer,style:{opacity:el&&en?1:0,pointerEvents:el?"auto":"none"},children:(0,o.BX)(d.tu,{children:[(0,o.tZ)(d.gq,{className:T.Z.settingsControlsBox,children:(0,o.tZ)(g.Z,{hideSharePostAtCurrentTime:L,mediaRef:z,post:j,pub:V,podcastUpload:q,subtitles:ec,setSubtitles:e=>{ep(e),!e&&ed?eu(!1):e&&!ed&&eu(!0)},setIsSettingsOpen:er})}),(0,o.tZ)("div",{style:{height:"60px"}})]})}),(0,o.BX)("div",{className:T.Z.bottomControlsContainer,style:{transform:en||eo?"translateY(0)":"translateY(40px)",transition:"transform ".concat(ee,"s ease"),transitionDelay:"".concat(et,"s")},children:[(0,o.tZ)("div",{className:T.Z.backDrop,style:{opacity:+!!en}}),(0,o.BX)(d.tu,{flex:"grow",gap:8,paddingY:4,children:[z.current&&q&&!D&&A&&X&&!S&&(0,o.tZ)("div",{className:T.Z.captionsContainer,children:(0,o.tZ)(s.Z,{handle:A,mediaUpload:q,showCaptions:ed,size:W,subtitles:ec,videoEle:null!==(w=z.current.player)&&void 0!==w?w:null,withHighlight:ei})}),(0,o.tZ)("div",{className:T.Z.bottomInnerControlsContainer,style:{opacity:+!!en,transition:void 0!=ee?"opacity ".concat(ee,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(d.tu,{flex:"grow",children:[!U&&(0,o.tZ)(d.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:L||b,mediaRef:z,mediaUpload:X,post:j,pub:V,size:W,onShareMenuClose:Y,onShareMenuOpen:G})}),(0,o.BX)(d.gq,{paddingX:4,children:[(0,o.BX)(d.hs,{gap:8,alignItems:"center",children:[!U&&(0,o.tZ)(m.Z,{disableShortcuts:Z,disableTooltips:I,isFocused:F,mediaRef:z}),!k&&(null==X?void 0:X.post_id)&&(0,o.tZ)(u.Z,{disableShortcuts:Z,isFocused:F,postId:X.post_id,pub:V}),(0,o.tZ)(x.Z,{disableShortcuts:Z,disableTooltips:I,isFocused:F,mediaRef:z}),!U&&(0,o.tZ)(v.Z,{duration:L&&null!=M?M:null,mediaRef:z})]}),(0,o.tZ)(d.hs,{flex:"grow"}),(0,o.BX)(d.hs,{gap:8,alignItems:"center",children:[!L&&J&&!U&&(0,o.tZ)(E.Z,{disableShortcuts:Z,disableTooltips:I,disabled:D||!P,isFocused:F,showTranscript:null!=H&&H,onToggleShowTranscript:J}),!L&&!N&&!U&&(0,o.tZ)(c.Z,{disableShortcuts:Z,disableTooltips:I,disabled:!em||D,isFocused:F,setShowCaptions:eh,showCaptions:ed}),!L&&!O&&(0,o.tZ)(h.Z,{disableShortcuts:Z,disableTooltips:I,isFocused:F,mediaRef:z}),!L&&A&&(0,o.tZ)(p.Z,{disableShortcuts:Z,disableTooltips:I,handle:A,isFocused:F}),!U&&!R&&(0,o.tZ)(f.Z,{disableTooltips:I,isSettingsOpen:el,setIsSettingsOpen:er})]})]})]})})]})]})]})},w=e=>{var t,i,a,u,h,f;let{mediaRef:g,mediaUpload:E,handle:C,isActive:w,pub:_,size:U="sm",startTime:b,duration:Z,useCaptions:I=!1,captionsStyle:S,hoverOptions:M,onBlur:A}=e,{transition:D=.5,transitionDelay:P=.1}=null!=M?M:{},{isMobile:k}=(0,r.v9)(),O=(0,n.sO)(null),[N,R]=(0,n.eJ)(!1),[B,L]=(0,n.eJ)(null),F=null!==(h=null==E?void 0:null===(i=E.extractedAudio)||void 0===i?void 0:null===(t=i.transcription)||void 0===t?void 0:t.signed_captions)&&void 0!==h?h:[],z=!!(null==E?void 0:null===(u=E.extractedAudio)||void 0===u?void 0:null===(a=u.transcription)||void 0===a?void 0:a.approved_at);return(0,n.d4)(()=>{let e=()=>{var e;(null===(e=g.current)||void 0===e?void 0:e.player)&&!isNaN(g.current.player.duration)&&(g.current.player.currentTime=b)};if(g.current){var t;null===(t=g.current.player)||void 0===t||t.addEventListener("durationchange",e)}return()=>{if(g.current){var t;null===(t=g.current.player)||void 0===t||t.removeEventListener("durationchange",e)}}},[g]),(0,o.BX)("div",{ref:O,onBlur:A,children:[(null==C?void 0:C.active)?(0,o.tZ)("div",{className:T.Z.topOverlaysContainer,style:{opacity:+!!w,transform:w||k?"translateY(0)":"translateY(-20%)"},children:(0,o.BX)(d.gq,{justifyContent:"space-between",paddingBottom:32,children:[(0,o.tZ)(d.gq,{padding:16}),(0,o.tZ)(d.gq,{padding:16})]})}):null,g.current&&(null==E?void 0:E.extractedAudio)&&C&&I&&(0,o.tZ)("div",{className:T.Z.captionsContainer,style:{bottom:0},children:(0,o.tZ)(s.Z,{handle:C,mediaUpload:E.extractedAudio,showCaptions:N,size:U,subtitles:B,videoEle:null!==(f=g.current.player)&&void 0!==f?f:null,captionsStyle:S,withHighlight:!0})}),(0,o.BX)("div",{className:T.Z.bottomControlsContainer,style:{transform:w||k?"translateY(0)":"translateY(40px)",transition:void 0!=D?"transform ".concat(D,"s ease"):"transform 0.5s ease",transitionDelay:void 0!=P?"".concat(P,"s"):"0.1s"},children:[(0,o.tZ)("div",{className:T.Z.backDrop,style:{opacity:+!!w}}),(0,o.tZ)(d.tu,{flex:"grow",gap:8,paddingY:4,children:(0,o.tZ)("div",{className:T.Z.bottomInnerControlsContainer,style:{opacity:+!!w,transition:void 0!=D?"opacity ".concat(D,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(d.tu,{flex:"grow",children:[(0,o.tZ)(d.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:!0,mediaRef:g,mediaUpload:E,post:void 0,pub:_,size:"sm",startTime:b,endTime:Z?b+Z:void 0})}),(0,o.BX)(d.gq,{paddingX:4,children:[(0,o.BX)(d.hs,{gap:8,alignItems:"center",children:[(0,o.tZ)(m.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:g}),(0,o.tZ)(x.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:g}),(0,o.tZ)(v.L,{startTime:b,duration:null!=Z?Z:null,mediaRef:g})]}),(0,o.tZ)(d.hs,{flex:"grow"}),(0,o.tZ)(c.Z,{disableShortcuts:!0,disableTooltips:!0,disabled:!z,setShowCaptions:e=>{let{showCaptions:t,userInitiated:i}=e;R(t),t&&(null==F?void 0:F.length)&&F[0]&&(L(F[0].language),i&&(0,l.j)(l.FP.VIDEO_CLOSED_CAPTIONS_BUTTON_CLICKED,{language:F[0].language}))},showCaptions:N,isFocused:!1}),C&&(0,o.tZ)(p.Z,{disableShortcuts:!0,disableTooltips:!0,handle:C,isFocused:!1})]})]})})})]})]})},_=e=>{let{mediaRef:t,mediaUpload:i,isActive:a,pub:l,startTime:s,duration:c,hoverOptions:p,onBlur:u}=e,{transition:h=.5,transitionDelay:f=.1}=null!=p?p:{},{isMobile:g}=(0,r.v9)(),E=(0,n.sO)(null);return(0,n.d4)(()=>{let e=()=>{var e;(null===(e=t.current)||void 0===e?void 0:e.player)&&!isNaN(t.current.player.duration)&&(t.current.player.currentTime=s)};if(t.current){var i;null===(i=t.current.player)||void 0===i||i.addEventListener("durationchange",e)}return()=>{if(t.current){var i;null===(i=t.current.player)||void 0===i||i.removeEventListener("durationchange",e)}}},[t]),(0,o.tZ)("div",{ref:E,onBlur:u,children:(0,o.BX)("div",{className:T.Z.bottomControlsContainer,style:{transform:a||g?"translateY(0)":"translateY(40px)",transition:"transform ".concat(h,"s ease"),transitionDelay:"".concat(f,"s")},children:[(0,o.tZ)("div",{className:T.Z.backDrop,style:{opacity:+!!a}}),(0,o.tZ)(d.tu,{flex:"grow",gap:8,paddingY:4,children:(0,o.tZ)("div",{className:T.Z.bottomInnerControlsContainer,style:{opacity:+!!a,transition:void 0!=h?"opacity ".concat(h,"s ease"):"opacity 0.5s ease"},children:(0,o.BX)(d.tu,{flex:"grow",children:[(0,o.tZ)(d.gq,{flex:"grow",paddingBottom:4,children:(0,o.tZ)(y.T,{disableSharing:!0,mediaRef:t,mediaUpload:i,post:void 0,pub:l,size:"sm",startTime:s,endTime:c?s+c:void 0})}),(0,o.BX)(d.gq,{paddingX:4,children:[(0,o.BX)(d.hs,{gap:8,alignItems:"center",children:[(0,o.tZ)(m.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:t}),(0,o.tZ)(x.Z,{disableShortcuts:!0,disableTooltips:!0,isFocused:!1,mediaRef:t}),(0,o.tZ)(v.L,{startTime:s,duration:null!=c?c:null,mediaRef:t})]}),(0,o.tZ)(d.hs,{flex:"grow"})]})]})})})]})})}},12988:function(e,t,i){i.d(t,{Ws:()=>o}),i(75472);let o=(e,t)=>{let i;let{showLiveOverlay:o,subtitle:n,aspectRatio:a,pub:l,includeBumper:r,includeHeadlines:d,headlineText:s}=null!=t?t:{},c={skip_bumper:!r},p=!1,u=e.width&&e.height?e.width/e.height:1,h=!!e.live_stream_id,v=!(e.live_stream_id&&u>=1);if(e.liveStream){var m,f,g;p=(null!==(f=e.liveStream.joinedOrCompletedLiveStreamInvites)&&void 0!==f?f:[]).length>0,i=null!==(g=null===(m=e.liveStream.user)||void 0===m?void 0:m.handle)&&void 0!==g?g:void 0}return(null==l?void 0:l.author_handle)&&(i=l.author_handle),(h||o)&&(v||(c.legacy_watermark={type:"legacy_watermark",show:!1}),(u<1||["vertical_fill","vertical_fit"].includes(null!=a?a:""))&&(o&&(c.live_overlay={type:"live_overlay",position:p?"bottom":"center",subtitle:n||(i?"@".concat(i):void 0)}),c.captions={type:"captions",position:p?["center","center"]:["center",700]})),d&&s&&(c.headline={type:"headline",text:s,position:h&&p?["center","center"]:["center",142]},c.legacy_watermark={type:"legacy_watermark",show:!1},delete c.live_overlay),c}},54809:function(e,t,i){let o;i.d(t,{ER:()=>a,Lz:()=>d,Nf:()=>c,Xb:()=>s,Z$:()=>r,uM:()=>l});var n=i(84864);i.e("3889").then(i.t.bind(i,80983,19)).then(e=>{o=e.default});let a={"application/x-cbr":[[82,97,114,33,26,7,0],[82,97,114,33,26,7,1,0],[127,69,76,70]],"application/x-cbz":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},l={"application/vnd.amazon.kfx":[[75,70,88,32]],"application/vnd.amazon.kpf":[[80,75,3,4]],"application/epub+zip":[[80,75,3,4]],"application/x-mobipocket-ebook":[[77,79,66,73]]},r={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},d={"application/pdf":[[37,80,68,70]]};function s(e){let{mimeTypesToSignature:t,substackType:i,actionButtonAttr:o}=e;return[{tag:"div.file-embed-wrapper",getAttrs:e=>{let a={};try{var l,r,d;let[s,c,p]=e.children[0].children;if(!s)return!1;let[u,h]=s.children;if(!h||!u)return!1;let[v,m]=h.children;if(!m)return!1;a.title=null==v?void 0:v.textContent;let[f,g]=(null===(l=m.textContent)||void 0===l?void 0:l.split("∙"))||[];if(!f||!g)return!1;a.filesize=(0,n.formattedBytesToNumber)(f);let y=null===(d=g.split("File"))||void 0===d?void 0:null===(r=d[0])||void 0===r?void 0:r.trim().toLowerCase();if(!y)return!1;if(t[y]||i===y)a.filetype=y;else{if("file"!==i)return!1;a.filetype=y}return(null==u?void 0:u.classList.contains("file-embed-thumbnail-default"))||(a.thumbnail=u.getAttribute("src")||""),a.description=null==c?void 0:c.innerText,a[o]=null==p?void 0:p.getAttribute("href"),a}catch(e){return!1}}}]}function c(e){var t;let{attrs:i}=e;return"".concat((0,n.numberToHumanFileSize)(null!==(t=Number(i.filesize))&&void 0!==t?t:void 0)," ∙ ").concat(function(e){var t,i,n,a;let{filetype:l}=e;return o&&l?["application/vnd.amazon.kfx","application/vnd.amazon.kpf","application/vnd.amazon.ebook"].includes(l)?"Kindle":null!==(a=null===(i=o.extension(l)||(null===(n=l.split("/").pop())||void 0===n?void 0:n.split("-").pop()))||void 0===i?void 0:null===(t=i.toUpperCase)||void 0===t?void 0:t.call(i))&&void 0!==a?a:"":""}({filetype:i.filetype})," file")}},62092:function(e,t,i){function o(e){let{fragment:t}=e;return"content"in t?t.content:[]}function n(e){let{fragment:t,content:i}=e;t.content=i}function a(e){return"type"in e&&"object"==typeof e.type}function l(e){return"type"in e&&"string"==typeof e.type}i.d(t,{PH:()=>a,f5:()=>l,uR:()=>n,yX:()=>o})},68303:function(e,t,i){i.d(t,{$9:()=>V,$_:()=>X,C4:()=>W,Co:()=>M,DY:()=>x,Dg:()=>A,E5:()=>T,Hs:()=>H,N5:()=>y,PH:()=>f,S7:()=>P,Wi:()=>L,cb:()=>v.cb,do:()=>R,fX:()=>Z,fp:()=>E,gR:()=>O,je:()=>v.je,k:()=>D,lr:()=>I,o4:()=>K,qe:()=>k,qj:()=>m});var o=i(7409),n=i(99282),a=i(92007);i(39693);var l=i(14293),r=i.n(l),d=i(10691),s=i.n(d),c=i(19834),p=i(36186),u=i(84864),h=i(88956),v=i(22498);let m=[["list_item","listItem"],["bullet_list","bulletList"],["ordered_list","orderedList"],["hard_break","hardBreak"],["horizontal_rule","horizontalRule"],["code_block","codeBlock"]],f=[["em","italic"],["strong","bold"],["strikethrough","strike"]],g={image2:1,image:0,horizontal_rule:0,audio:0,video:0,youtube:0,youtube2:0,vimeo:0,opensea:0,twitter:0,twitter2:0,spotify:0,spotify2:0,soundcloud:0,bandcamp:0,kindle:0,tiktok:0,prediction_market:0,lichess:0,datawrapper:0,recipe:0,pinterest:0},y=function(e){let{maxLength:t=356,getAfterCutoff:i=!1,withEllipsis:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="",a=!1,l={},r=W(e),d=!1,s=(0,h.Y)(e,e=>{var o;if(a)return i;if("paywall"===e.type)return a=!0,!1;if(r)return!0;let s=null!==(o=e.type)&&void 0!==o?o:"undefined";if(l[s]=(l[s]||0)+1,e.type&&e.type in g&&l[s]>g[e.type])return a=!0,i;let c=t-n.length;if(c<=0&&!r||!(c>0))return i;if(i){if("text"===e.type&&e.text){if(!(t-(n+=e.text).length<=0))return!1;e.text=e.text.substring(e.text.length+t-n.length-1,e.text.length)}}else if("text"===e.type&&e.text){n+=e.text;let t=e.text;e.text=(0,u.truncateText)(t,c),d=t!==e.text}return!0});if(s&&o&&!d){let e=function(e){let t=[],i=[e];for(;i.length;){var o;let e=i.pop();if(!e)break;if(e.content&&(null===(o=e.content)||void 0===o?void 0:o.length)>0)for(let t=e.content.length-1;t>=0;t--){let o=e.content[t];o&&i.push(o)}else t.push(e)}return t}(s),t=null,i=null;for(let o=e.length-1;o>=0&&(!t||!i);o--){let n=e[o];null===t&&(null==n?void 0:n.type)==="text"&&(t=o),null===i&&(null==n?void 0:n.type)!=="text"&&(null==n?void 0:n.type)!=="paragraph"&&(i=o)}let o=null!==t?e[t]:null,n=o&&null!==i&&null!==t&&i>t;o&&!n&&(o.text=S(o.text))}return s},E=(e,t)=>{let i=[];if(e&&(t(e)&&i.push(e),e.content))for(let o of e.content)i=i.concat(E(o,t));return i},x=(e,t)=>{if(e){if(t(e))return e;if(e.content)for(let i of e.content){let e=x(i,t);if(e)return e}}return null},T=e=>{let t=[];return e.nodesBetween(0,e.content.size,e=>{var i;(null===(i=e.type)||void 0===i?void 0:i.name)==="cashtag"&&t.push(e.attrs.symbol)},0),t},C=new Set(["caption","footnote","captionedImage","image","image2"]),w=new Set(["bullet_list","bulletList","ordered_list","orderedList","blockquote"]),_="x_li_start_placeholder_x",U=(e,t)=>{var i,o,n,a;if((null===(i=e.type)||void 0===i?void 0:i.name)==="list_item"||(null===(o=e.type)||void 0===o?void 0:o.name)==="listItem")return{open:_,close:""};if((null===(n=e.type)||void 0===n?void 0:n.name)==="paragraph"||e.isBlock&&e.textContent.length>0&&!w.has(null===(a=e.type)||void 0===a?void 0:a.name)){let e="<p>";return(t.length>0?t[t.length-1]:null)===_&&(t.pop(),e+="* "),{open:e,close:"</p>"}}return null},b=e=>{var t,i,o;let{node:n,recursiveDepth:a,tokens:l}=e;if(a>100)return console.warn("Reached max recursive depth while converting document to HTML for podcast"),!1;let r=!0;if(C.has(null===(t=n.type)||void 0===t?void 0:t.name))r=!1;else if(n.isText){if(n.text&&n.text.length>0){let e=n.marks.find(e=>"link"===e.type.name&&e.attrs.href),t=n.marks.find(e=>"em"===e.type.name),i=n.marks.find(e=>"strong"===e.type.name),o=n.text;t&&(o="<em>".concat(o,"</em>")),i&&(o="<strong>".concat(o,"</strong>")),e&&(o='<a target="_blank" href="'.concat((0,c.Z)(e.attrs.href),'">').concat(o,"</a>")),l.push(o)}}else if(U(n,[])){let e=U(n,l);e&&l.push(e.open),n.descendants(e=>b({node:e,recursiveDepth:a+1,tokens:l})),e&&l.push(e.close),r=!1}else if((null===(i=n.type)||void 0===i?void 0:i.name)==="cashtag")l.push("".concat(n.attrs.symbol," "));else if((null===(o=n.type)||void 0===o?void 0:o.name)==="substack_mentions"){let e=n.marks.find(e=>"em"===e.type.name),t=n.marks.find(e=>"strong"===e.type.name),i=n.attrs.name;if(e&&(i="<em>".concat(i,"</em>")),t&&(i="<strong>".concat(i,"</strong>")),"user"===n.attrs.type){let e=(0,p.GR)(n.attrs.id,n.attrs.name);l.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}else if("pub"===n.attrs.type){let e=n.attrs.url;l.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}}return r},Z=e=>{let t=[];return e.descendants(e=>b({node:e,recursiveDepth:1,tokens:t})),t.filter(e=>e!==_).join("").trim()},I=function(e){let{withLinks:t=!0,withCaptionsAndFootnotes:i=!1,withQuotes:o=!0,forPodcast:n=!1,truncateAt:a=null,truncateTo:l=a,truncateEllipsis:d="…",truncateExtension:s=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p="",h="",v="",m=!0;return e.nodesBetween(0,e.content.size,e=>{var a,f,g,y,E,x,T;if(!i&&["caption","footnote"].includes(null===(a=e.type)||void 0===a?void 0:a.name)||!o&&((null===(f=e.type)||void 0===f?void 0:f.name)==="pullquote"||(null===(g=e.type)||void 0===g?void 0:g.name)==="blockquote"||(null===(y=e.type)||void 0===y?void 0:y.name)==="calloutBlock"))return!1;if(e.isText){if(e.text&&e.text.length>0){let i;m=!1,!r()(l)&&p.length<l&&p.length+e.text.length>=l&&(i=(0,u.truncateText)(e.text,l-p.length,{ellipsis:d,extension:s}));let o=e.marks.filter(e=>"link"===e.type.name&&e.attrs.href)[0],a=e.marks.filter(e=>"em"===e.type.name)[0],f=e.marks.filter(e=>"strong"===e.type.name)[0],g=e.text;p+=g,a&&n&&(i&&(i="<em>".concat(i,"</em>")),g="<em>".concat(g,"</em>")),f&&n&&(i&&(i="<strong>".concat(i,"</strong>")),g="<strong>".concat(g,"</strong>")),o&&t?n?(i&&(v="".concat(h,'<a target="_blank" href="').concat((0,c.Z)(o.attrs.href),'">').concat(i,"</a>")),h+='<a target="_blank" href="'.concat((0,c.Z)(o.attrs.href),'">').concat(g,"</a>")):(i&&(v="".concat(h).concat(i," [ ").concat(o.attrs.href," ]")),h+="".concat(g," [ ").concat(o.attrs.href," ]")):(i&&(v=h+i),h+=g)}}else!m&&["hard_break","hardBreak"].includes(null===(E=e.type)||void 0===E?void 0:E.name)?(m=!0,p+="\n",n?h+="<br/>":h+="\n"):!m&&e.isBlock?(m=!0,p+="\n",n?h+="<br/><br/>":h+="\n"):(null===(x=e.type)||void 0===x?void 0:x.name)==="cashtag"?h+="".concat(e.attrs.symbol," "):(null===(T=e.type)||void 0===T?void 0:T.name)==="substack_mentions"&&(h+="".concat(e.attrs.name," "))},0),!r()(a)&&p.length>a&&v&&(h=v),h=h.trim(),n&&(h=h.replace(/\s*(<br\/>)+$/,"").trim()),h},S=e=>"".concat(s()(e,"."),"..."),M=(e,t)=>(0,n._)((0,o._)({name:e},t),{addAttributes:()=>t.attrs||{},parseHTML:()=>t.parseDOM,renderHTML(i){let{node:o}=i;return t.toDOM?t.toDOM(o):(console.warn("trying to create TipTapNode, no toDOM found for node",e),["span"])}}),A=(e,t)=>{let i,o,n;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,a)=>{if(i||o)return!1;let l=e.marks.find(e=>e.type===t);l&&(i=e,o=l,n={from:a,to:a+e.nodeSize})}),i)return{node:i,mark:o,pos:n}},D=(e,t)=>{let i,o,n;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(a,l)=>{if(i||o||!(l<=e.selection.from)||!(e.selection.to<=l+a.nodeSize))return!1;{let e=a.marks.find(e=>e.type===t);e&&(i=a,o=e,n={from:l,to:l+a.nodeSize})}}),!i){if(e.selection.empty){let r=e.doc.resolve(e.selection.from),d=r.nodeBefore&&r.nodeBefore.marks.find(e=>e.type===t),s=r.nodeAfter&&r.nodeAfter.marks.find(e=>e.type===t);if(d||s){var a,l;i=s?r.nodeAfter:r.nodeBefore,o=s||d,n=s?{from:r.pos,to:r.pos+r.nodeAfter.nodeSize}:{from:r.pos-(null!==(l=null===(a=r.nodeBefore)||void 0===a?void 0:a.nodeSize)&&void 0!==l?l:0),to:r.pos}}}if(!i)return}return{node:i,mark:o,pos:n}},P=function(e){let{allowedMarks:t=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!e.selection.empty||k(e,e.selection.from,e.selection.to,{allowedMarks:t})},k=function(e,t,i){let{allowedMarks:o=[]}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=!0,a=!1;return e.doc.nodesBetween(t,i,t=>{if(!n)return!1;t.type!==e.schema.nodes.text?a?n=!1:a=!0:t.marks.find(e=>!o.includes(e.type))&&(n=!1)}),n},O=(e,t)=>{if(e.selection.empty)return!1;let i=Array.isArray(t)?t:[t];if("node"in e.selection){var o;let t=e.selection;return i.includes(null===(o=t.node)||void 0===o?void 0:o.type)}return N(e,e.selection.from,e.selection.to,i)},N=(e,t,i,o)=>{let n=null;return e.doc.nodesBetween(t,i,e=>{if(!(!1!==n&&o.includes(e.type)))return n=!1,!1;n=!0}),n||!1},R=e=>e.selection.empty?null:B(e,e.selection.from,e.selection.to),B=(e,t,i)=>{let o=null;return e.doc.nodesBetween(t,i,t=>!o&&(t.type===e.schema.nodes.image2?(o=t.attrs.href,!1):void(t.type===e.schema.nodes.image3&&(o=t.attrs.href)))),o||null},L=(e,t,i)=>{e.selection.empty||F(e,t,e.selection.from,e.selection.to,i)},F=(e,t,i,o,n)=>{e.doc.nodesBetween(i,o,(i,o)=>{(i.type===e.schema.nodes.image2||i.type===e.schema.nodes.image3)&&t.setNodeMarkup(o,i.type,Object.assign({},i.attrs,{href:n}),i.marks)})},z=e=>({top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}),X=(e,t,i,o)=>{let n=document.body,a=window.innerWidth<=481,l=q(e,t.from,t.to,t=>[e.state.schema.nodes.image,e.state.schema.nodes.image2].includes(t.type))?-44:8,r=z(e.coordsAtPos(t.from)),d=z(e.coordsAtPos(t.to));i.style.position="fixed";let s=d.bottom+(a?n.scrollTop:0),c=n.clientHeight-i.clientHeight-96-l;r.top<d.top?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(Math.min(r.left,d.left),"px")):n.clientWidth-r.left>i.clientWidth?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(r.left,"px")):(o&&(o.style.left="".concat(r.left-n.clientWidth+i.clientWidth,"px")),i.style.right="10px",i.style.left=""),a||s<c?(o&&(o.style.top="-9px",o.style.bottom="auto",o.style.transform=""),i.style.top="".concat(s+l,"px")):(o&&(o.style.top="auto",o.style.bottom="-9px",o.style.transform="rotate(180deg)"),i.style.top="".concat(c+l,"px"))},q=(e,t,i,o)=>{let n=!1;return e.state.doc.nodesBetween(t,i,e=>{if(n)return!1;n=o(e)}),n},j=e=>e.doc.resolve(e.selection.from).node(1),V=(e,t)=>{var i;return t.includes(null===(i=j(e))||void 0===i?void 0:i.type)},K=(e,t)=>{var i,o,n;let l=e.tr,r=l.selection instanceof a.Bs,d=r&&(null===(n=l.selection.$from)||void 0===n?void 0:null===(o=n.parent)||void 0===o?void 0:null===(i=o.content)||void 0===i?void 0:i.size)===0?e.selection.to-1:e.selection.to;if(Array.isArray(t))for(let e of t.slice().reverse())l.insert(d,e);else l.insert(d,t);return r||l.setSelection(a.qv.near(l.doc.resolve(d))),l},H=(e,t)=>{let i=e.tr;return i.replaceSelectionWith(t),i},W=e=>!!x(e,e=>"paywall"===e.type)},80870:function(e,t,i){function o(e,t){let i=1,o=1;e.doc.descendants((n,a)=>{if(n.type===t.nodes.footnote){if(n.attrs.number!==i){let o=t.nodes.footnote.create({number:i},n.content);e.replaceWith(a,a+n.nodeSize,o)}i+=1}else if(n.type===t.nodes.footnoteAnchor){if(n.attrs.number!==o){let i=t.nodes.footnoteAnchor.create({number:o});e.replaceWith(a,a+n.nodeSize,i)}o+=1}})}function n(e,t){let i=0;e.doc.nodesBetween(0,e.selection.from,e=>{e.type===t.nodes.footnoteAnchor&&(i+=1)});let o=[];return(e.doc.forEach((e,i)=>{e.type===t.nodes.footnote&&o.push(i)}),i<o.length)?o[i]:e.doc.resolve(0).end()}i.d(t,{A0:()=>o,dG:()=>n})}}]);