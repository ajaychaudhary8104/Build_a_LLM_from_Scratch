"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["6042"],{10120:function(e,t,n){n.d(t,{I:()=>l,r:()=>i});var r=n(98661),o=n(22007);function i(){var e=(0,r.useState)(!1),t=e[0],n=e[1],i=(0,r.useRef)(null);(0,r.useEffect)(function(){var e=function(){n(o.Z.fullscreenElement===i.current)};return o.Z.addEventListener("fullscreenchange",e),function(){return o.Z.removeEventListener("fullscreenchange",e)}},[]);var l=(0,r.useCallback)(function(){return o.Z.fullscreenElement?o.Z.exitFullscreen().then(function(){return o.Z.requestFullscreen(i.current)}):i.current?o.Z.requestFullscreen(i.current):void 0},[]),s=(0,r.useCallback)(function(){return o.Z.fullscreenElement===i.current?o.Z.exitFullscreen():Promise.resolve()},[]);return(0,r.useMemo)(function(){return{active:t,enter:l,exit:s,node:i}},[t,l,s])}var l=function(e){var t=e.handle,n=e.onChange,o=e.children,i=e.className,l=[];return i&&l.push(i),l.push("fullscreen"),t.active&&l.push("fullscreen-enabled"),(0,r.useEffect)(function(){n&&n(t.active,t)},[t.active]),r.default.createElement("div",{className:l.join(" "),ref:t.node,style:t.active?{height:"100%",width:"100%"}:void 0},o)}},40827:function(e,t,n){var r=n(98661);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){var r,o,i;r=e,o=t,i=n[t],o in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class s extends r.default.Component{constructor(e){let t;super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this),t=this.props.breakpointCols&&this.props.breakpointCols.default?this.props.breakpointCols.default:parseInt(this.props.breakpointCols)||2,this.state={columnCount:t}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){let e=window&&window.innerWidth||1/0,t=this.props.breakpointCols;"object"!=typeof t&&(t={default:parseInt(t)||2});let n=1/0,r=t.default||2;for(let o in t){let i=parseInt(o);i>0&&e<=i&&i<n&&(n=i,r=t[o])}r=Math.max(1,parseInt(r)||1),this.state.columnCount!==r&&this.setState({columnCount:r})}itemsInColumns(){let e=this.state.columnCount,t=Array(e),n=r.default.Children.toArray(this.props.children);for(let r=0;r<n.length;r++){let o=r%e;t[o]||(t[o]=[]),t[o].push(n[r])}return t}renderColumns(){let{column:e,columnAttrs:t={},columnClassName:n}=this.props,i=this.itemsInColumns(),s=`${100/i.length}%`,c=n;c&&"string"!=typeof c&&(this.logDeprecated('The property "columnClassName" requires a string'),void 0===c&&(c="my-masonry-grid_column"));let a=l(l(l({},e),t),{},{style:l(l({},t.style),{},{width:s}),className:c});return i.map((e,t)=>r.default.createElement("div",o({},a,{key:t}),e))}logDeprecated(e){console.error("[Masonry]",e)}render(){let e=this.props,{children:t,breakpointCols:n,columnClassName:i,columnAttrs:l,column:s,className:c}=e,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]),d=c;return"string"!=typeof c&&(this.logDeprecated('The property "className" requires a string'),void 0===c&&(d="my-masonry-grid")),r.default.createElement("div",o({},a,{className:d}),this.renderColumns())}}s.defaultProps={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0}},55679:function(e,t,n){n.d(t,{M_:()=>b,NM:()=>f,T5:()=>C,fW:()=>w,jE:()=>d,kg:()=>c,ms:()=>y});var r=n(36779),o=n(98661),i=n(88897);let l=({renderers:e})=>o.default.createElement(o.default.Fragment,null,Object.entries(e).map(([e,t])=>o.default.createPortal(t.reactElement,t.element,e)));class s extends o.default.Component{constructor(e){super(e),this.editorContentRef=o.default.createRef(),this.initialized=!1,this.state={renderers:{}}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){let{editor:e}=this.props;if(e&&e.options.element){if(e.contentComponent)return;let t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=this,e.createNodeViews(),this.initialized=!0}}maybeFlushSync(e){this.initialized?(0,o.flushSync)(e):e()}setRenderer(e,t){this.maybeFlushSync(()=>{this.setState(({renderers:n})=>({renderers:{...n,[e]:t}}))})}removeRenderer(e){this.maybeFlushSync(()=>{this.setState(({renderers:t})=>{let n={...t};return delete n[e],{renderers:n}})})}componentWillUnmount(){let{editor:e}=this.props;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild))return;let t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){let{editor:e,...t}=this.props;return o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{ref:this.editorContentRef,...t}),o.default.createElement(l,{renderers:this.state.renderers}))}}let c=o.default.memo(e=>{let t=o.default.useMemo(()=>Math.floor(0xffffffff*Math.random()).toString(),[e.editor]);return o.default.createElement(s,{key:t,...e})});class a extends i.ML{constructor(){super(...arguments),this.contentComponent=null}}let d=(e={},t=[])=>{let[n,r]=(0,o.useState)(null),i=function(){let[,e]=(0,o.useState)(0);return()=>e(e=>e+1)}(),{onBeforeCreate:l,onBlur:s,onCreate:c,onDestroy:d,onFocus:u,onSelectionUpdate:p,onTransaction:f,onUpdate:h}=e,m=(0,o.useRef)(l),y=(0,o.useRef)(s),C=(0,o.useRef)(c),b=(0,o.useRef)(d),v=(0,o.useRef)(u),w=(0,o.useRef)(p),g=(0,o.useRef)(f),k=(0,o.useRef)(h);return(0,o.useEffect)(()=>{n&&(l&&(n.off("beforeCreate",m.current),n.on("beforeCreate",l),m.current=l),s&&(n.off("blur",y.current),n.on("blur",s),y.current=s),c&&(n.off("create",C.current),n.on("create",c),C.current=c),d&&(n.off("destroy",b.current),n.on("destroy",d),b.current=d),u&&(n.off("focus",v.current),n.on("focus",u),v.current=u),p&&(n.off("selectionUpdate",w.current),n.on("selectionUpdate",p),w.current=p),f&&(n.off("transaction",g.current),n.on("transaction",f),g.current=f),h&&(n.off("update",k.current),n.on("update",h),k.current=h))},[l,s,c,d,u,p,f,h,n]),(0,o.useEffect)(()=>{let t=!0,n=new a(e);return r(n),n.on("transaction",()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t&&i()})})}),()=>{t=!1}},t),(0,o.useEffect)(()=>()=>{null==n||n.destroy()},[n]),n},u=(0,o.createContext)({editor:null});u.Consumer;let p=()=>(0,o.useContext)(u),f=e=>{let[t,n]=(0,o.useState)(null),{editor:i}=p();return(0,o.useEffect)(()=>{var n;if(!t||(null===(n=e.editor)||void 0===n?void 0:n.isDestroyed)||(null==i?void 0:i.isDestroyed))return;let{pluginKey:o="bubbleMenu",editor:l,tippyOptions:s={},updateDelay:c,shouldShow:a=null}=e,d=l||i;if(!d){console.warn("BubbleMenu component is not rendered inside of an editor component or does not have editor prop.");return}let u=(0,r.q3)({updateDelay:c,editor:d,element:t,pluginKey:o,shouldShow:a,tippyOptions:s});return d.registerPlugin(u),()=>d.unregisterPlugin(o)},[e.editor,i,t]),o.default.createElement("div",{ref:n,className:e.className,style:{visibility:"hidden"}},e.children)},h=(0,o.createContext)({onDragStart:void 0}),m=()=>(0,o.useContext)(h),y=e=>{let t=e.as||"div",{nodeViewContentRef:n}=m();return o.default.createElement(t,{...e,ref:n,"data-node-view-content":"",style:{whiteSpace:"pre-wrap",...e.style}})},C=o.default.forwardRef((e,t)=>{let{onDragStart:n}=m(),r=e.as||"div";return o.default.createElement(r,{...e,ref:t,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...e.style}})});class b{constructor(e,{editor:t,props:n={},as:r="div",className:o="",attrs:i}){this.ref=null,this.id=Math.floor(0xffffffff*Math.random()).toString(),this.component=e,this.editor=t,this.props=n,this.element=document.createElement(r),this.element.classList.add("react-renderer"),o&&this.element.classList.add(...o.split(" ")),i&&Object.keys(i).forEach(e=>{this.element.setAttribute(e,i[e])}),this.render()}render(){var e,t,n;let r=this.component,i=this.props;("function"==typeof r&&r.prototype&&r.prototype.isReactComponent||"object"==typeof r&&(null===(n=r.$$typeof)||void 0===n?void 0:n.toString())==="Symbol(react.forward_ref)")&&(i.ref=e=>{this.ref=e}),this.reactElement=o.default.createElement(r,{...i}),null===(t=null===(e=this.editor)||void 0===e?void 0:e.contentComponent)||void 0===t||t.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e,t;null===(t=null===(e=this.editor)||void 0===e?void 0:e.contentComponent)||void 0===t||t.removeRenderer(this.id)}}class v extends i.DK{mount(){let e={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(e={})=>this.updateAttributes(e),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){let e;this.component.displayName=(e=this.extension.name).charAt(0).toUpperCase()+e.substring(1)}let t=e=>{let t=this.component,n=this.onDragStart.bind(this);return o.default.createElement(o.default.Fragment,null,o.default.createElement(h.Provider,{value:{onDragStart:n,nodeViewContentRef:e=>{e&&this.contentDOMElement&&e.firstChild!==this.contentDOMElement&&e.appendChild(this.contentDOMElement)}}},o.default.createElement(t,{...e})))};t.displayName="ReactNodeView",this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let n=this.node.isInline?"span":"div";this.options.as&&(n=this.options.as);let{className:r=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new b(t,{editor:this.editor,props:e,as:n,className:`node-${this.node.type.name} ${r}`.trim(),attrs:this.options.attrs})}get dom(){var e;if(this.renderer.element.firstElementChild&&!(null===(e=this.renderer.element.firstElementChild)||void 0===e?void 0:e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){let{from:e,to:t}=this.editor.state.selection;e<=this.getPos()&&t>=this.getPos()+this.node.nodeSize?this.selectNode():this.deselectNode()}update(e,t){let n=e=>{this.renderer.updateProps(e)};if(e.type!==this.node.type)return!1;if("function"==typeof this.options.update){let r=this.node,o=this.decorations;return this.node=e,this.decorations=t,this.options.update({oldNode:r,oldDecorations:o,newNode:e,newDecorations:t,updateProps:()=>n({node:e,decorations:t})})}return e===this.node&&this.decorations===t||(this.node=e,this.decorations=t,n({node:e,decorations:t}),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function w(e,t){return n=>n.editor.contentComponent?new v(e,n,t):{}}},21834:function(e,t,n){n.d(t,{Ig:()=>m,MI:()=>h,N0:()=>k,NE:()=>l,QK:()=>C,U9:()=>I,X0:()=>g,Y_:()=>u,_M:()=>a,al:()=>s,mD:()=>w,nw:()=>O,o:()=>p,uJ:()=>M,uo:()=>v,xb:()=>y,ym:()=>E});var r=n(83311),o=n(76405),i=n(92007);let l=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0),s=(e,t,n)=>{let l=function(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("backward",e):!(n.parentOffset>0))?n:null}(e,n);if(!l)return!1;let s=d(l);if(!s){let n=l.blockRange(),o=n&&(0,r.k9)(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let a=s.nodeBefore;if(!a.type.spec.isolating&&x(e,s,t))return!0;if(0==l.parent.content.size&&(c(a,"end")||i.qv.isSelectable(a))){let n=(0,r.dR)(e.doc,l.before(),l.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(c(a,"end")?i.Y1.findFrom(r.doc.resolve(r.mapping.map(s.pos,-1)),-1):i.qv.create(r.doc,s.pos-a.nodeSize)),t(r.scrollIntoView())}return!0}}return!!a.isAtom&&s.depth==l.depth-1&&(t&&t(e.tr.delete(s.pos-a.nodeSize,s.pos).scrollIntoView()),!0)};function c(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)break}return!1}let a=(e,t,n)=>{let{$head:r,empty:o}=e.selection,l=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;l=d(r)}let s=l&&l.nodeBefore;return!!(s&&i.qv.isSelectable(s))&&(t&&t(e.tr.setSelection(i.qv.create(e.doc,l.pos-s.nodeSize)).scrollIntoView()),!0)};function d(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}let u=(e,t,n)=>{let l=function(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("forward",e):!(n.parentOffset<n.parent.content.size))?n:null}(e,n);if(!l)return!1;let s=f(l);if(!s)return!1;let a=s.nodeAfter;if(x(e,s,t))return!0;if(0==l.parent.content.size&&(c(a,"start")||i.qv.isSelectable(a))){let n=(0,r.dR)(e.doc,l.before(),l.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(c(a,"start")?i.Y1.findFrom(r.doc.resolve(r.mapping.map(s.pos)),1):i.qv.create(r.doc,r.mapping.map(s.pos))),t(r.scrollIntoView())}return!0}}return!!a.isAtom&&s.depth==l.depth-1&&(t&&t(e.tr.delete(s.pos,s.pos+a.nodeSize).scrollIntoView()),!0)},p=(e,t,n)=>{let{$head:r,empty:o}=e.selection,l=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;l=f(r)}let s=l&&l.nodeAfter;return!!(s&&i.qv.isSelectable(s))&&(t&&t(e.tr.setSelection(i.qv.create(e.doc,l.pos)).scrollIntoView()),!0)};function f(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}let h=(e,t)=>{let n=e.selection,o=n instanceof i.qv,l;if(o){if(n.node.isTextblock||!(0,r.Mn)(e.doc,n.from))return!1;l=n.from}else if(null==(l=(0,r.GJ)(e.doc,n.from,-1)))return!1;if(t){let n=e.tr.join(l);o&&n.setSelection(i.qv.create(n.doc,l-e.doc.resolve(l).nodeBefore.nodeSize)),t(n.scrollIntoView())}return!0},m=(e,t)=>{let n=e.selection,o;if(n instanceof i.qv){if(n.node.isTextblock||!(0,r.Mn)(e.doc,n.to))return!1;o=n.to}else if(null==(o=(0,r.GJ)(e.doc,n.to,1)))return!1;return t&&t(e.tr.join(o).scrollIntoView()),!0},y=(e,t)=>{let{$from:n,$to:o}=e.selection,i=n.blockRange(o),l=i&&(0,r.k9)(i);return null!=l&&(t&&t(e.tr.lift(i,l).scrollIntoView()),!0)},C=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!!(n.parent.type.spec.code&&n.sameParent(r))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function b(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}let v=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),l=n.indexAfter(-1),s=b(o.contentMatchAt(l));if(!s||!o.canReplaceWith(l,l,s))return!1;if(t){let r=n.after(),o=e.tr.replaceWith(r,r,s.createAndFill());o.setSelection(i.Y1.near(o.doc.resolve(r),1)),t(o.scrollIntoView())}return!0},w=(e,t)=>{let n=e.selection,{$from:r,$to:o}=n;if(n instanceof i.C1||r.parent.inlineContent||o.parent.inlineContent)return!1;let l=b(o.parent.contentMatchAt(o.indexAfter()));if(!l||!l.isTextblock)return!1;if(t){let n=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,s=e.tr.insert(n,l.createAndFill());s.setSelection(i.Bs.create(s.doc,n+1)),t(s.scrollIntoView())}return!0},g=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if((0,r.Ax)(e.doc,o))return t&&t(e.tr.split(o).scrollIntoView()),!0}let o=n.blockRange(),i=o&&(0,r.k9)(o);return null!=i&&(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)},k=(e,t)=>{let{$from:n,to:r}=e.selection,o,l=n.sharedDepth(r);return 0!=l&&(o=n.before(l),t&&t(e.tr.setSelection(i.qv.create(e.doc,o))),!0)};function x(e,t,n){let l,s,a,d=t.nodeBefore,u=t.nodeAfter,p,f;if(d.type.spec.isolating||u.type.spec.isolating)return!1;if(l=t.nodeBefore,s=t.nodeAfter,a=t.index(),l&&s&&l.type.compatibleContent(s.type)&&(!l.content.size&&t.parent.canReplace(a-1,a)?(n&&n(e.tr.delete(t.pos-l.nodeSize,t.pos).scrollIntoView()),!0):!!(t.parent.canReplace(a,a+1)&&(s.isTextblock||(0,r.Mn)(e.doc,t.pos)))&&(n&&n(e.tr.clearIncompatible(t.pos,l.type,l.contentMatchAt(l.childCount)).join(t.pos).scrollIntoView()),!0)))return!0;let h=t.parent.canReplace(t.index(),t.index()+1);if(h&&(p=(f=d.contentMatchAt(d.childCount)).findWrapping(u.type))&&f.matchType(p[0]||u.type).validEnd){if(n){let i=t.pos+u.nodeSize,l=o.HY.empty;for(let e=p.length-1;e>=0;e--)l=o.HY.from(p[e].create(null,l));l=o.HY.from(d.copy(l));let s=e.tr.step(new r.FC(t.pos-1,i,t.pos,i,new o.p2(l,1,0),p.length,!0)),c=i+2*p.length;(0,r.Mn)(s.doc,c)&&s.join(c),n(s.scrollIntoView())}return!0}let m=i.Y1.findFrom(t,1),y=m&&m.$from.blockRange(m.$to),C=y&&(0,r.k9)(y);if(null!=C&&C>=t.depth)return n&&n(e.tr.lift(y,C).scrollIntoView()),!0;if(h&&c(u,"start",!0)&&c(d,"end")){let i=d,l=[];for(;l.push(i),!i.isTextblock;)i=i.lastChild;let s=u,c=1;for(;!s.isTextblock;s=s.firstChild)c++;if(i.canReplace(i.childCount,i.childCount,s.content)){if(n){let i=o.HY.empty;for(let e=l.length-1;e>=0;e--)i=o.HY.from(l[e].copy(i));n(e.tr.step(new r.FC(t.pos-l.length,t.pos+u.nodeSize,t.pos+c,t.pos+u.nodeSize-c,new o.p2(i,l.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function S(e){return function(t,n){let r=t.selection,o=e<0?r.$from:r.$to,l=o.depth;for(;o.node(l).isInline;){if(!l)return!1;l--}return!!o.node(l).isTextblock&&(n&&n(t.tr.setSelection(i.Bs.create(t.doc,e<0?o.start(l):o.end(l)))),!0)}}let I=S(-1),O=S(1);function E(e,t=null){return function(n,o){let{$from:i,$to:l}=n.selection,s=i.blockRange(l),c=s&&(0,r.nd)(s,e,t);return!!c&&(o&&o(n.tr.wrap(s,c).scrollIntoView()),!0)}}function M(e,t=null){return function(n,r){let o=!1;for(let r=0;r<n.selection.ranges.length&&!o;r++){let{$from:{pos:i},$to:{pos:l}}=n.selection.ranges[r];n.doc.nodesBetween(i,l,(r,i)=>{if(o)return!1;if(!(!r.isTextblock||r.hasMarkup(e,t))){if(r.type==e)o=!0;else{let t=n.doc.resolve(i),r=t.index();o=t.parent.canReplaceWith(r,r+1,e)}}})}if(!o)return!1;if(r){let o=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:i},$to:{pos:l}}=n.selection.ranges[r];o.setBlockType(i,l,e,t)}r(o.scrollIntoView())}return!0}}function A(...e){return function(t,n,r){for(let o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}let D=A(l,s,a),R=A(l,u,p),P={Enter:A(C,w,g,(e,t)=>{let{$from:n,$to:o}=e.selection;if(e.selection instanceof i.qv&&e.selection.node.isBlock)return!!(n.parentOffset&&(0,r.Ax)(e.doc,n.pos))&&(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(t){let l=o.parentOffset==o.parent.content.size,s=e.tr;(e.selection instanceof i.Bs||e.selection instanceof i.C1)&&s.deleteSelection();let c=0==n.depth?null:b(n.node(-1).contentMatchAt(n.indexAfter(-1))),a,d=a?[a]:l&&c?[{type:c}]:void 0,u=(0,r.Ax)(s.doc,s.mapping.map(n.pos),1,d);if(!d&&!u&&(0,r.Ax)(s.doc,s.mapping.map(n.pos),1,c?[{type:c}]:void 0)&&(c&&(d=[{type:c}]),u=!0),u&&(s.split(s.mapping.map(n.pos),1,d),!l&&!n.parentOffset&&n.parent.type!=c)){let e=s.mapping.map(n.before()),t=s.doc.resolve(e);c&&n.node(-1).canReplaceWith(t.index(),t.index()+1,c)&&s.setNodeMarkup(s.mapping.map(n.before()),c)}t(s.scrollIntoView())}return!0}),"Mod-Enter":v,Backspace:D,"Mod-Backspace":D,"Shift-Backspace":D,Delete:R,"Mod-Delete":R,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new i.C1(e.doc))),!0)},V={"Ctrl-h":P.Backspace,"Alt-Backspace":P["Mod-Backspace"],"Ctrl-d":P.Delete,"Ctrl-Alt-Backspace":P["Mod-Delete"],"Alt-Delete":P["Mod-Delete"],"Alt-d":P["Mod-Delete"],"Ctrl-a":I,"Ctrl-e":O};for(let e in P)V[e]=P[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform()},18923:function(e,t,n){n.d(t,{IB:()=>l,KI:()=>i,bw:()=>s});var r=n(83311),o=n(76405);function i(e,t=null){return function(n,i){let{$from:l,$to:s}=n.selection,c=l.blockRange(s),a=!1,d=c;if(!c)return!1;if(c.depth>=2&&l.node(c.depth-1).type.compatibleContent(e)&&0==c.startIndex){if(0==l.index(c.depth-1))return!1;let e=n.doc.resolve(c.start-2);d=new o.Ts(e,e,c.depth),c.endIndex<c.parent.childCount&&(c=new o.Ts(l,n.doc.resolve(s.end(c.depth)),c.depth)),a=!0}let u=(0,r.nd)(d,e,t,c);return!!u&&(i&&i((function(e,t,n,i,l){let s=o.HY.empty;for(let e=n.length-1;e>=0;e--)s=o.HY.from(n[e].type.create(n[e].attrs,s));e.step(new r.FC(t.start-2*!!i,t.end,t.start,t.end,new o.p2(s,0,0),n.length,!0));let c=0;for(let e=0;e<n.length;e++)n[e].type==l&&(c=e+1);let a=n.length-c,d=t.start+n.length-2*!!i,u=t.parent;for(let n=t.startIndex,o=t.endIndex,i=!0;n<o;n++,i=!1)!i&&(0,r.Ax)(e.doc,d,a)&&(e.split(d,a),d+=2*a),d+=u.child(n).nodeSize;return e})(n.tr,c,u,a,e).scrollIntoView()),!0)}}function l(e){return function(t,n){let{$from:i,$to:l}=t.selection,s=i.blockRange(l,t=>t.childCount>0&&t.firstChild.type==e);return!!s&&(!n||(i.node(s.depth-1).type==e?function(e,t,n,i){let l=e.tr,s=i.end,c=i.$to.end(i.depth);s<c&&(l.step(new r.FC(s-1,c,s,c,new o.p2(o.HY.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new o.Ts(l.doc.resolve(i.$from.pos),l.doc.resolve(c),i.depth));let a=(0,r.k9)(i);if(null==a)return!1;l.lift(i,a);let d=l.mapping.map(s,-1)-1;return(0,r.Mn)(l.doc,d)&&l.join(d),t(l.scrollIntoView()),!0}(t,n,e,s):function(e,t,n){let i=e.tr,l=n.parent;for(let e=n.end,t=n.endIndex-1,r=n.startIndex;t>r;t--)e-=l.child(t).nodeSize,i.delete(e-1,e+1);let s=i.doc.resolve(n.start),c=s.nodeAfter;if(i.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,d=n.endIndex==l.childCount,u=s.node(-1),p=s.index(-1);if(!u.canReplace(p+ +!a,p+1,c.content.append(d?o.HY.empty:o.HY.from(l))))return!1;let f=s.pos,h=f+c.nodeSize;return i.step(new r.FC(f-+!!a,h+ +!!d,f+1,h-1,new o.p2((a?o.HY.empty:o.HY.from(l.copy(o.HY.empty))).append(d?o.HY.empty:o.HY.from(l.copy(o.HY.empty))),+!a,+!d),+!a)),t(i.scrollIntoView()),!0}(t,n,s)))}}function s(e){return function(t,n){let{$from:i,$to:l}=t.selection,s=i.blockRange(l,t=>t.childCount>0&&t.firstChild.type==e);if(!s)return!1;let c=s.startIndex;if(0==c)return!1;let a=s.parent,d=a.child(c-1);if(d.type!=e)return!1;if(n){let i=d.lastChild&&d.lastChild.type==a.type,l=o.HY.from(i?e.create():null),c=new o.p2(o.HY.from(e.create(null,o.HY.from(a.type.create(null,l)))),i?3:1,0),u=s.start,p=s.end;n(t.tr.step(new r.FC(u-(i?3:1),p,u,p,c,1,!0)).scrollIntoView())}return!0}}}}]);