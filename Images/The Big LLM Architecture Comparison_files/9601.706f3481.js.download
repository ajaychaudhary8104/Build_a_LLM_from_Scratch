"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["9601"],{2180:function(e,t,n){n.d(t,{Z:()=>i});let i={container:"container-u4XWUV",label:"label-gARrM9",input:"input-rLnHxk",selectedInput:"selectedInput-RGkQnW"}},60648:function(e,t,n){n.d(t,{Z:()=>i});let i={input:"input-qHk4bN",form:"form-CkZ7Kt"}},51455:function(e,t,n){n.d(t,{I:()=>w});var i=n(7409),o=n(99282),r=n(58865),l=n(16584),a=n(30396),s=n(76915),c=n(98661),d=n(20160),u=n(95441),h=n(98914),m=n(15771),p=n(19081),g=n(98248),f=n(51776),Z=n(70379),v=n(60836),b=n(63651),y=n(64473);function _(){let e=(0,r._)([""," by ",""]);return _=function(){return e},e}let C=e=>{let{width:t,height:n}=e,i="undefined"!=typeof window?window.innerHeight:1/0,o=1;return i<700?o=.7:i<800?o=.75:i<900&&(o=.8),{width:t*o,height:n*o,scaler:o}};function w(e){let{onClose:t,post:n,pub:r,comment:w}=e,{iString:k,iTemplate:x,language:B}=(0,u.M1)(),[S,N]=(0,a.eJ)({width:400,height:400}),[M,E]=(0,a.eJ)(!1),I=(0,a.sO)(null),{popToast:R}=(0,Z.pm)(),X=(e,t)=>'<div class="substack-post-embed"><p lang="'.concat(B,'">').concat(x(_(),t.title,e.author_name),"</p><p>").concat(t.subtitle,'</p><a data-post-link href="').concat((0,v.Mo)(e,t.slug),'">').concat(k("Read on Substack"),'</a></div><script async src="').concat((0,b.ZJn)(),'/embedjs/embed.js" charset="utf-8"><\/script>'),L=e=>'<div class="substack-post-embed"><p lang="'.concat(B,'">').concat("".concat(e.body||""),"</p>").concat(e.name?"<p> - ".concat(e.name,"</p>"):e.handle?"<p> - @".concat(e.handle,"</p>"):"",'<a data-comment-link href="').concat((0,b.Sgq)(e),'">').concat(k("Read on Substack"),'</a></div><script async src="').concat((0,b.ZJn)(),'/embedjs/embed.js" charset="utf-8"><\/script>');(0,c.useEffect)(()=>{if(!w&&!n)return;let e=e=>{e.data.iframeHeight&&(N({width:500,height:e.data.iframeHeight}),E(!0))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[w,n]);let{width:T,height:P,scaler:z}=C(S);return(0,l.tZ)(d.W,{children:(0,l.BX)(p.tu,{padding:20,gap:20,bg:"primary",children:[(0,l.tZ)("div",{style:{width:T,height:P,display:M?"block":"none",opacity:M?"visible":"hidden",alignSelf:"center"},children:(0,l.tZ)("iframe",{ref:I,style:{transform:"scale(".concat(z,")"),width:S.width,height:S.height},className:y.Z.iframe,src:w?(0,b.QXp)(w,{isPreview:!0}):r&&n?(0,v.Tg)(r,n.slug,{isPreview:!0}):"",onLoad:()=>{E(!0)}})}),!M&&(0,l.tZ)(p.gq,{flex:"grow",minHeight:220,bg:"secondary",radius:"md",justifyContent:"center",alignItems:"center",border:"detail",children:(0,l.tZ)(g.$j,{})}),(0,l.BX)(p.gq,{gap:12,flex:"grow",children:[(0,l.tZ)(f.oi,{className:y.Z.codeInput,style:{width:T},value:r&&n?X(r,n):w?L(w):"",disabled:!0}),(0,l.tZ)(m.zx,{priority:"primary",onClick:()=>{(0,h.vQ)(r&&n?X(r,n):w?L(w):""),t&&t(),R(e=>(0,l.tZ)(Z.FN,(0,o._)((0,i._)({},e),{text:k("Copied to clipboard"),Icon:s.Z})))},children:k("Copy code")})]})]})})}},43389:function(e,t,n){n.d(t,{Z:()=>s});var i=n(7409),o=n(99282),r=n(16584),l=n(62112),a=n(64515);let s=e=>(0,r.tZ)(a.l,(0,o._)((0,i._)({},e),{name:"LucideArrowUpRight",svgParams:{height:24,width:24},children:(0,r.tZ)(l.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},25265:function(e,t,n){n.d(t,{Z:()=>s});var i=n(7409),o=n(99282),r=n(16584),l=n(5097),a=n(64515);let s=e=>(0,r.tZ)(a.l,(0,o._)((0,i._)({},e),{name:"LucideComments",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,r.tZ)(l.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},666:function(e,t,n){n.d(t,{Z:()=>s});var i=n(7409),o=n(99282),r=n(16584),l=n(57420),a=n(64515);let s=e=>(0,r.tZ)(a.l,(0,o._)((0,i._)({},e),{name:"LucideHeart",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,r.tZ)(l.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},95398:function(e,t,n){n.d(t,{Z:()=>a});var i=n(7409),o=n(99282),r=n(16584),l=n(64515);let a=e=>(0,r.tZ)(l.l,(0,o._)((0,i._)({},e),{name:"LucideShare",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,r.tZ)("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.tZ)("path",{d:"M12.4376 15.6C4.77778 15.6 2 20.3999 2 20.3999C2 12.5999 5.88889 8.4 12.4376 8.4V3L22 11.9812L12.4376 21V15.6Z",strokeWidth:e.strokeWidth,fill:e.fill,className:"lucide",strokeLinecap:"round",strokeLinejoin:"round"})})}))},50137:function(e,t,n){n.d(t,{Z:()=>a});var i=n(7409),o=n(99282),r=n(16584),l=n(64515);let a=e=>(0,r.tZ)(l.l,(0,o._)((0,i._)({},e),{name:"NoteForwardIcon",svgParams:{height:24,width:24,stroke:e.stroke,strokeWidth:e.strokeWidth},children:(0,r.tZ)("path",{d:"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12",strokeLinecap:"round","stroke-linejoin":"round"})}))},93666:function(e,t,n){n.d(t,{Z:()=>m,p:()=>p});var i=n(27412),o=n(7409),r=n(99282),l=n(16584),a=n(6400),s=n(94184),c=n.n(s),d=n(41352),u=n(98914),h=n(15771);class m extends a.Component{componentDidMount(){document.addEventListener("keydown",this.onDocumentKeyDown),this.props.openByDefault&&this.openImmediately()}componentWillUnmount(){document.removeEventListener("keydown",this.onDocumentKeyDown),this._timeout&&clearTimeout(this._timeout)}openImmediately(e){e&&(this._callback=e);let t=document.getElementsByTagName("html")[0];t&&!(0,u.pv)(t,"modal-in")&&(0,u.cn)(t,"modal-in"),this.setState({display:!0,open:!0})}async open(e){e&&(this._callback=e);let t=document.getElementsByTagName("html")[0];t&&!(0,u.pv)(t,"modal-in")&&(0,u.cn)(t,"modal-in"),this.onBeforeOpen(),this.props.onBeforeOpen&&this.props.onBeforeOpen(),await new Promise(e=>{this.setState({display:!0},()=>{this._timeout&&clearTimeout(this._timeout);let t=setTimeout(()=>{this.setState({open:!0},()=>{this.onOpen(),this.props.onOpen&&this.props.onOpen(),e()})},50);this._timeout=t})})}async close(e){this.isOpen()&&!1!==this.onBeforeClose(e)&&(!this.props.onBeforeClose||!1!==this.props.onBeforeClose(e))&&((0,u.IV)(document.getElementsByTagName("html")[0],"modal-in"),await new Promise(t=>{this.setState({open:!1},()=>{let n=setTimeout(()=>{this.setState({display:!1},()=>{this.onClose(e),this.props.onClose&&this.props.onClose(e),this._callback&&this._callback(e),t()})},750);this._timeout=n})}))}isOpen(){return this.state.open}onClickOuter(e){var t,n;e.stopPropagation(),null===(t=(n=this.props).onClick)||void 0===t||t.call(n,e),!this.props.noExit&&!this.props.noExitOnClick&&this.popup&&(this.noFullscreen||window.innerWidth>540)&&e.target&&this.container&&this.close()}onClickInner(e){var t,n;e.stopPropagation(),null===(t=(n=this.props).onClick)||void 0===t||t.call(n,e)}render(e,t){let n=this.state.open?"in":"out",i=!1===this.state.display?"gone":"",a="structured"===this.props.variant,s=!this.state.open;return(0,l.tZ)("div",{className:c()("modal typography",n,i,this.props.className,this.getClassName(),{"has-close-pill":this.props.closePill,"structured-modal":a,popup:this.popup}),inert:s,onClick:e=>this.onClickOuter(e),"data-testid":this.props.testID,role:"dialog",style:this.props.zIndex?{zIndex:this.props.zIndex}:{},children:(0,l.tZ)("div",{className:"modal-table",children:(0,l.tZ)("div",{className:"modal-row",children:(0,l.tZ)("div",{ref:this.assignContent,className:c()("modal-cell modal-content",{"no-fullscreen":this.noFullscreen}),children:(0,l.BX)("div",(0,r._)((0,o._)({className:c()({container:!a}),ref:this.assignContainer,onClick:e=>this.onClickInner(e)},this.props.trackInputsID&&{"data-track-inputs":this.props.trackInputsID}),{children:[!this.props.noExit&&(!this.props.noCloseButton||(0,u.K1)())&&(a?(0,l.tZ)("div",{className:"structured-modal__close-button",children:(0,l.tZ)(h.hU,{"data-testid":"close-modal",priority:"tertiary",onClick:()=>this.close(),children:(0,l.tZ)(d.Z,{size:20,stroke:"secondary"})})}):(0,l.tZ)(h.hU,{"data-testid":"close-modal",priority:"tertiary",className:c()("modal-btn modal-exit-btn no-margin",{"button btn btn-secondary btn-pill icon-only":this.props.closePill}),onClick:()=>this.close(),children:(0,l.tZ)(d.Z,{size:20,stroke:"secondary"})})),a?(0,l.BX)("div",{className:"structured-modal__wrapper",children:[(0,l.tZ)("div",{className:"structured-modal__header",children:this.props.modalTitle?(0,l.tZ)("h3",{children:this.props.modalTitle}):(0,l.tZ)("h3",{children:"\xa0"})}),(0,l.tZ)("div",{className:"structured-modal__body",children:(0,l.tZ)("div",{className:"container",children:this.renderChildren(this.props,this.state)})}),this.props.modalFooter&&(0,l.tZ)("div",{className:"structured-modal__footer",children:this.props.modalFooter})]}):this.renderChildren(this.props,this.state)]}))})})})})}getClassName(){}onBeforeOpen(){}onOpen(e){}onBeforeClose(e){}onClose(e){}renderChildren(e,t){let{children:n}=e;return n}constructor(e,t){super(e,t),(0,i._)(this,"popup",void 0),(0,i._)(this,"_timeout",void 0),(0,i._)(this,"_callback",void 0),(0,i._)(this,"content",void 0),(0,i._)(this,"container",void 0),(0,i._)(this,"assignContent",e=>{this.content=e}),(0,i._)(this,"assignContainer",e=>{this.container=e}),(0,i._)(this,"noFullscreen",void 0),(0,i._)(this,"state",void 0),(0,i._)(this,"onDocumentKeyDown",e=>{"Escape"!==e.key||this.props.noExit||(0,u.$Z)(this.base)||this.close()}),this.open=this.open.bind(this),this.close=this.close.bind(this),this.popup=!1,this.state={open:!1,display:!1,callback:null}}}class p extends m{constructor(e,t){super(e,t),this.popup=!0}}},6498:function(e,t,n){n.d(t,{R:()=>c});var i=n(16584),o=n(347),r=n(7523),l=n(95441),a=n(83225),s=n(80026);let c=e=>{let{comments:t,post:n,commentId:a,notAllowedToFetchComments:c,handleSort:u,publication:h,sort:m,sortMenuUseMobileBottomSheet:p}=e,{iString:g}=(0,l.M1)();return(0,i.BX)(o.h,{children:[(0,i.BX)(s.gq,{alignItems:"baseline",flex:"grow",gap:8,position:"relative",children:[(0,i.tZ)(r.Z,{preset:"st4",children:g("Comments")}),(0,i.tZ)("div",{className:"mediumRule-B78a2B"}),(null==t?void 0:t.length)&&(null==t?void 0:t.length)>0?(0,i.tZ)(r.Z,{color:"accent",preset:"st4",children:n.comment_count}):null]}),(0,i.BX)(s.xu,{className:"sortOptionsContainer-bIIUcJ",children:[!c&&(0,i.tZ)(r.Z,{align:"left",as:"a",color:"tertiary",href:"/p/community-guidelines",preset:"detail-small",style:{textDecoration:"underline"},children:g("Community Guidelines")}),t&&(null==t?void 0:t.length)>1&&!c&&!a&&(0,i.tZ)(d,{comments:t,handleSort:u,publication:h,sort:m,useMobileBottomSheet:p})]})]})},d=e=>{let{publication:t,handleSort:n,sort:o,comments:r,useMobileBottomSheet:l}=e;return t&&n&&o?(0,i.tZ)(a.$,{currentSort:o,handleSort:n,isLoading:!r,pub:t,useMobileBottomSheet:l}):null}},57626:function(e,t,n){n.d(t,{C:()=>m});var i=n(16584),o=n(18787),r=n(74626),l=n(6498),a=n(7523),s=n(95441),c=n(71068),d=n(19081),u=n(60308),h=n(47929);let m=e=>{let{post:t,publication:n,user:m,freeSignupEmail:p=null,showHeader:g=!1}=e,{iString:f}=(0,s.M1)(),Z=m&&m.email||p||null,v=(0,u.Zs0)(n,{simple:!0,next:document.location.href,utm_source:h.b3.paywall,utm_medium:h.lP.web,utm_content:t?t.id:null,just_signed_up:!1}),b=async()=>{window.location.href=v};return(0,i.BX)(d.tu,{className:"container-u0f9W_",children:[g&&(0,i.tZ)(l.R,{notAllowedToFetchComments:!0,post:t,publication:n}),(0,i.tZ)(c.xu,{className:"commentsPaywall-ASd8iy",children:(0,i.BX)(d.tu,{alignItems:"center",gap:24,paddingX:24,paddingY:40,children:[(0,i.tZ)(a.Z,{color:"white",preset:"h4-sans-condensed",children:f("Join the conversation")}),(0,i.tZ)(a.Z,{color:"white",preset:"d3-serif",children:f("Share your thoughts and connect with other readers by becoming a paid subscriber!")}),(0,i.tZ)(r._,{variant:"inverse",onClick:b,children:f("Upgrade today")}),(0,i.BX)(a.Z,{as:"a",color:"white",href:(0,u.W1P)(n,{isSignInAttempt:!0}),native:!0,preset:"caption",children:[(0,o.qV)({post:t,publication:n})," ",(0,i.tZ)("u",{children:f(Z?"Switch accounts":"Sign in")})]})]})})]})}},49954:function(e,t,n){n.d(t,{H:()=>E,U:()=>I});var i=n(27412),o=n(58865),r=n(16584),l=n(6400),a=n(80569),s=n.n(a),c=n(56219),d=n(94442),u=n(11712),h=n(89276),m=n(74626),p=n(95441),g=n(19081);let f=e=>{let{post:t,ctaUrl:n,ctaText:i,hidden:o}=e,{iString:l}=(0,p.M1)(),a=i;return o||"podcast"!==t.type?o||"newsletter"!==t.type||(a=l("Back to article")):a=l("Back to episode"),(0,r.tZ)(g.tu,{alignItems:"start",paddingY:8,children:(0,r.tZ)(m._,{href:n,leadingIcon:"chevron-left",native:!0,size:"md",variant:"tertiary",children:a})})};var Z=n(58319),v=n(75905),b=n(90099),y=n(68833),_=n(98914),C=n(40894),w=n(6070),k=n(31377),x=n(60308),B=n(84864),S=n(47929);function N(){let e=(0,o._)(["This thread is only visible to "," subscribers of ",""]);return N=function(){return e},e}class M extends l.Component{onTopReached(){this.state.topReached||(this.setState({topReached:!0}),(0,y.j)(y.FP.POST_SEEN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type}))}onBottomReached(){this.state.bottomReached||(this.setState({bottomReached:!0}),(0,y.j)(y.FP.POST_BOTTOM_SEEN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type}))}async enableEmailNotifications(){try{await s().post("/api/v1/post/".concat(this.props.post.id,"/subscribe")),window.location.reload()}catch(e){console.error("Failed to subscribe to email notifications:",e),alert((0,_.zx)(e))}}render(e){let t,n,{className:i,pub:o,post:a,user:s,freeSignup:m,freeSignupEmail:p,isStatic:g,hidden:v,truncated:y,invisible:_,post_reaction_token:M,onChange:E,showCta:I=y,showUnsubscribeNotice:R,dataForEmailRender:X={},showReactions:L=!0,gap:T=16,iString:P,iTemplate:z,iPlural:H,language:A,showShare:O}=e;"boolean"!=typeof v&&(v=a.hidden),v?(t=P("Subscribe to view"),n=(0,x.n1t)("/subscribe",{simple:!0,next:document.location.href,utm_source:S.b3.thread,utm_medium:S.lP.web,utm_content:a.id})):(n=(0,x.uRy)(o,a,{noBase:!0}),t="thread"!==a.type||y?(0,B.getPostCtaText)(a,A):a.comment_count?H("View 1 comment","View %1 comments",a.comment_count):P("Reply"));let F=g&&!this.context.isAmp,D=(0,w.HD)({pub:o}),W=D?h.j:l.Fragment;return(0,r.tZ)(b.YF,{className:"thread-head typography ".concat(i||""),children:(0,r.tZ)("tr",{children:(0,r.tZ)("td",{children:(0,r.BX)(b.i$,{width:"100%",children:[!_&&!v&&(0,r.tZ)(Z.Z,{onVisible:()=>this.onTopReached()}),(0,r.BX)(b.i$,{gap:T,width:"100%",children:[I&&D&&(0,r.tZ)(f,{post:a,ctaUrl:n,ctaText:t,hidden:v}),(0,r.tZ)(c.mV,{pub:o,post:a,user:s,isStatic:g,reaction_token:M,allowEdit:!0,allowTruncate:y,showReactions:!!I||L,showShare:O,showComments:!!a.comment_count,inThreadHead:!0,onChange:E,showLabel:!0}),(0,r.tZ)(W,{inThreadHead:!0,children:(0,r.tZ)(u.Z,{user:s,freeSignup:m,freeSignupEmail:p,pub:o,post:a,html:v||y||!a.body_html?null:a.body_html,isStatic:g,dataForEmailRender:X,children:v?(0,r.tZ)("p",{children:(0,r.tZ)("i",{children:z(N(),(0,k.isFoundingAudience)(a.audience)?"founding":"paid",o.name)})}):y?(0,r.tZ)("p",{children:a.description}):null})}),I?!D&&(0,r.BX)("a",{className:"thread-head-cta",href:n,native:!0,children:[t," →"]}):v&&(0,r.BX)("p",{className:"thread-head-cta",children:[(0,r.tZ)("a",{href:(0,x.W1P)(o,{simple:!0,next:document.location.href,utm_source:S.b3.thread,utm_medium:S.lP.web,utm_content:a.id}),className:"button primary subscribe-btn",native:!g,children:(0,B.getSubscribeText)(o)}),(0,r.tZ)("a",{href:(0,x.uXE)({for_pub:o.subdomain}),className:"button",native:!0,children:P("Sign in")})]})]}),F&&(0,r.BX)(b.i$,{gap:T,style:{width:"100%"},children:[(0,r.tZ)(b.i$,{style:{width:"100%",textAlign:"center"},children:(0,r.tZ)("a",{role:"button",className:"button primary",style:{margin:"0 auto"},href:C.W.HALF_MAGIC_COMMENTS_URL,children:P("See the discussion")})}),(0,r.tZ)(d.yT,{isFooter:!0,customization:{showShare:!0,showComments:!0,showReactions:{showReactions:L},showRestack:!1,showLabels:!0,showCommentRestack:!o.hide_post_restacks}})]}),R&&a.unsubscribed&&(0,r.BX)("div",{className:"notifications-alert",children:[P("Email notifications are disabled for this thread.")," ",(0,r.tZ)("a",{href:"javascript:void(0)",onClick:()=>this.enableEmailNotifications(),children:P("Re-enable")})]}),!_&&!v&&(0,r.tZ)(Z.Z,{onVisible:()=>this.onBottomReached()})]})})})})}}(0,i._)(M,"contextType",v.E);let E=(0,p.fz)(M);class I extends l.Component{render(){return(0,r.BX)("div",{className:"thread-head-silhouette",children:[(0,r.tZ)("div",{className:"thread-head-silhouette-head"}),(0,r.BX)("div",{className:"thread-head-silhouette-content",children:[(0,r.tZ)("div",{className:"thread-head-silhouette-title"}),(0,r.tZ)("div",{className:"thread-head-silhouette-meta"}),(0,r.BX)("div",{className:"thread-head-silhouette-body",children:[(0,r.tZ)("div",{className:"thread-head-silhouette-body-line"}),(0,r.tZ)("div",{className:"thread-head-silhouette-body-line"}),(0,r.tZ)("div",{className:"thread-head-silhouette-body-line"})]})]})]})}}},41149:function(e,t,n){n.d(t,{N:()=>m});var i=n(16584),o=n(3312),r=n.n(o),l=n(32351),a=n(21540),s=n(32129),c=n(95355),d=n(33884),u=n(63651),h=n(84864);function m(e){var t,n,o,r;let a,m,g,{comment:f,post:Z,publication:v}=e,b="Substack | Notes";v&&f.name?b="".concat(f.name," on ").concat(v.name):f.name&&f.handle?b="".concat(f.name," (@").concat(f.handle,")"):f.name?b=f.name:v&&(b="".concat(v.name));let y=Z&&v?(0,s.getPageTitleAndMeta)(Z,v,{isCommentPage:!0}).title:"".concat(b,': "').concat((0,h.truncateText)(f.body,280),'"'),_=(null!==(t=f.attachments)&&void 0!==t?t:[]).filter(e=>"image"===e.type),C=1===_.length?_[0]:null,w=C&&"imageUrl"in C?C.imageUrl:void 0;w?a=w:(0,c.pO)(f)&&(m=680,g=680,a=(0,u.zF4)((0,d.IY)(f.id,{isSmall:!0,attachmentsOnly:!0}),g,{height:m}));let k=null!==(n=f.body)&&void 0!==n?n:"";return(0,i.BX)(i.HY,{children:[(0,i.tZ)(l.Metadata,{title:y,socialTitle:b,description:k,image:a,imageHeight:m,imageWidth:g,isLargeImage:!!a||void 0,siteName:v?v.name:"Substack",publishedTime:f.date.toString(),meta:[{name:"twitter:label1",content:"Likes"},{name:"twitter:data1",content:String(null!==(o=f.reaction_count)&&void 0!==o?o:0)},{name:"twitter:label2",content:"Replies"},{name:"twitter:data2",content:String(null!==(r=f.children_count)&&void 0!==r?r:0)}]}),(0,i.tZ)(p,{comment:f,includeBody:!0})]})}function p(e){let{comment:t,includeBody:n}=e;return t?(0,i.tZ)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:r()((0,a.J)(t,{includeViews:!1,includeBody:n}),{json:!0,isScriptContext:!0})}}):null}},83225:function(e,t,n){n.d(t,{$:()=>u});var i=n(16584),o=n(61932),r=n(13742),l=n(95441),a=n(49762),s=n(15771),c=n(84747),d=n(12144);let u=e=>{let{currentSort:t,isLoading:n,pub:r,handleSort:a,useMobileBottomSheet:u}=e,{iString:m}=(0,l.M1)();return(0,i.tZ)(c.M,{trigger:(0,i.tZ)(s.zx,{size:"sm",priority:"secondary",disabled:n,leading:(0,i.tZ)(o.Z,{size:18}),children:(0,d.Sh)(t,r.language)}),ariaLabel:m("Sort comments"),useMobileBottomSheet:u,children:(0,i.tZ)(h,{currentSort:t,pub:r,handleSort:a})})},h=e=>{let{currentSort:t,pub:n,handleSort:o}=e,l=!!(0,a.ZP)("like_comments_enabled");return(0,i.tZ)(i.HY,{children:(0,d.Hz)({likesEnabled:l,language:n.language}).map(e=>{let{key:n,text:l}=e;return(0,i.tZ)(c.u,{onClick:()=>o(n),trailing:n===t?(0,i.tZ)(r.Z,{}):void 0,children:l},n)})})}},70841:function(e,t,n){n.d(t,{L:()=>g});var i=n(58865),o=n(16584),r=n(56953),l=n(95441),a=n(53678),s=n(52513),c=n(6490),d=n(65523),u=n(58175),h=n(60308);function m(){let e=(0,i._)(["We've sent an email to ",". Click the magic link or enter the code below:"]);return m=function(){return e},e}function p(){let e=(0,i._)(["We've sent an email to ",". Click the magic link inside to continue."]);return p=function(){return e},e}function g(e){var t,n;let{isOpen:i,onClose:g,user:f,pub:Z,otpLoginEnabled:v,onboardingRedirect:b}=e,{iString:y,iTemplate:_}=(0,l.M1)();return(0,o.BX)(c.u_,{isOpen:i,onClose:g,className:"finish-magic-login-modal",children:[(0,o.tZ)(c.xB,{icon:(0,o.tZ)(d.AM,{icon:(0,o.tZ)(r.Z,{size:20})}),title:y("Check your email to continue"),description:v?(0,o.tZ)(u.xv,{children:_(m(),null!==(t=null==f?void 0:f.email)&&void 0!==t?t:"your email address")}):(0,o.tZ)(u.xv,{children:_(p(),null!==(n=null==f?void 0:f.email)&&void 0!==n?n:"your email address")}),showClose:!0,alignItems:"center",onClose:g}),(0,o.tZ)(c.fe,{children:v?(0,o.tZ)(s.E,{email:null==f?void 0:f.email,redirect:b||document.location.href}):(0,o.tZ)(u.xv.B4,{align:"center",color:"secondary",decoration:"underline",children:(0,o.tZ)(a.hh,{href:(0,h.uXE)({for_pub:Z.subdomain,with_password:!0}),children:y("Sign in with password instead")})})})]})}},77360:function(e,t,n){n.d(t,{L8:()=>eU,lf:()=>eW,eR:()=>ej,AM:()=>eK,sA:()=>eV,LB:()=>eJ});var i,o=n(27412),r=n(7409),l=n(99282),a=n(58865),s=n(16584),c=n(6400),d=n(98661),u=n(30396),h=n(94184),m=n.n(h),p=n(74691),g=n.n(p),f=n(14293),Z=n.n(f),v=n(43174),b=n.n(v),y=n(80569),_=n.n(y),C=n(79094),w=n(9721),k=n(57391),x=n(95441),B=n(8923),S=n(46914),N=n(68833),M=n(40116),E=n(74485);let I=()=>{let{iString:e}=(0,x.M1)();return[["1d",e("For 1 day")],["30d",e("For 30 days")],["90d",e("For 90 days")],["1y",e("For 1 year")],["1000y",e("Forever")]]};var R=((i={}).VISIBLE="visible",i.DELETE_THIS_COMMENT="delete_this_comment",i.DELETE_ALL_COMMENTS="delete_all_comments",i);let X=()=>{let{iString:e}=(0,x.M1)();return[[R.VISIBLE,e("Do not delete comments")],[R.DELETE_THIS_COMMENT,e("Delete this comment")],[R.DELETE_ALL_COMMENTS,e("Also delete all comments")]]};var L=n(69791),T=n(94874),P=n(71068),z=n(15771),H=n(19081),A=n(1844),O=n(6490),F=n(65523),D=n(98248),W=n(17688),V=n(43570),U=n(58175),J=n(98012);function j(){let e=(0,a._)(["Ban or suspend ",""]);return j=function(){return e},e}function q(){let e=(0,a._)(["Prevent this person from commenting on your publication in the future."]);return q=function(){return e},e}function Y(){let e=(0,a._)(["Ban ",""]);return Y=function(){return e},e}function G(){let e=(0,a._)(["Previously banned "," time(s), last on ",""]);return G=function(){return e},e}function $(){let e=(0,a._)([""," is permanently banned."]);return $=function(){return e},e}function K(){let e=(0,a._)([""," is banned until ","."]);return K=function(){return e},e}function Q(){let e=(0,a._)(["Leave a reply"]);return Q=function(){return e},e}let ee=e=>{var t,n,i,o;let{comment:r,onReply:l,onBan:a,onClose:c}=e,{sub:d,loading:h,bans:m,bansHistory:p,error:g,submitBan:f}=er(r,a),Z=I(),v=null===(t=Z[1])||void 0===t?void 0:t[0],[b,y]=(0,u.eJ)(v),[_,C]=(0,u.eJ)(R.VISIBLE),w=!!r||h,k=null!==(o=null===(i=Z.find(e=>{let[t]=e;return t===b}))||void 0===i?void 0:null===(n=i[1])||void 0===n?void 0:n.toLowerCase())&&void 0!==o?o:"",x=m.filter(e=>(0,J.Z)(e.expiry).isAfter((0,J.Z)()));return(0,s.BX)(O.u_,{isOpen:w,onClose:c,children:[0===x.length&&(0,s.tZ)(et,{comment:r,sub:d,bans:m,bansHistory:p,loading:h,error:g,selectedExpiry:b,setSelectedExpiry:y,selectedCommentVisibility:_,setSelectedCommentVisibility:C,expiryText:k,onClose:c,submitBan:f}),x.length>0&&(0,s.tZ)(eo,{comment:r,bans:m,onClose:c,onReply:()=>{l&&r&&(l(r.id),c())}})]})},et=e=>{var t,n;let{comment:i,sub:o,bans:r,bansHistory:l,loading:a,error:c,selectedExpiry:d,setSelectedExpiry:u,selectedCommentVisibility:h,setSelectedCommentVisibility:m,expiryText:p,onClose:g,submitBan:f}=e,{iString:Z,iTemplate:v}=(0,x.M1)(),b=I(),y=X();return(0,s.BX)(s.HY,{children:[(0,s.tZ)(O.xB,{showClose:!0,onClose:g,title:v(j(),null!==(t=null==i?void 0:i.name)&&void 0!==t?t:"user"),showDivider:!0,alignItems:"center",icon:(0,s.tZ)(T.qE,{photoUrl:null!==(n=null==i?void 0:i.photo_url)&&void 0!==n?n:void 0,size:56}),description:(0,s.BX)(H.sg,{alignItems:"center",gap:8,children:[(null==o?void 0:o.is_subscribed)&&(0,s.tZ)(V.Vp,{priority:"secondary",children:Z("Paid subscriber")}),(0,s.tZ)(U.xv,{children:v(q())})]})}),(0,s.tZ)(O.fe,{children:(0,s.BX)(H.sg,{gap:20,children:[(0,s.tZ)(ei,{bans:r,bansHistory:l}),c&&(0,s.tZ)(A.y,{children:Z("An error occurred. Please try again.")}),a&&(0,s.tZ)(D.$j,{padding:32,alignItems:"center",justifyContent:"center"}),!a&&(0,s.BX)(s.HY,{children:[(0,s.BX)(en,{children:[(0,s.tZ)(U.xv.B3,{weight:"semibold",children:Z("Ban duration")}),(0,s.BX)(W.i,{name:"expiry",value:d,onChange:e=>{u(e.target.value)},children:[(0,s.tZ)(W.d,{children:Z("Select a duration")}),b.map(e=>{let[t,n]=e;return(0,s.tZ)("option",{value:t,children:null==n?void 0:n.replace(/^For /,"")})})]})]}),(0,s.BX)(en,{children:[(0,s.tZ)(U.xv.B3,{weight:"semibold",children:Z("Delete comments")}),(0,s.BX)(W.i,{name:"comment_visibility",value:h,onChange:e=>{m(e.target.value)},children:[(0,s.tZ)(W.d,{children:Z("Select whether to delete comments")}),y.map(e=>{let[t,n]=e;return(0,s.tZ)("option",{value:t,children:n})})]})]})]})]})}),(0,s.tZ)(O.mz,{direction:"column",showDivider:!0,primaryButton:(0,s.tZ)(z.zx,{priority:"destructive",onClick:()=>f(d,h),children:v(Y(),p)})})]})},en=(0,P.zo)({display:"flex",justifyContent:"space-between",alignItems:"center"}),ei=e=>{let{bans:t,bansHistory:n}=e,{iTemplate:i}=(0,x.M1)();if(!t[0])return null;let o=n.length?n.length:t.filter(e=>e.user_id).length;return(0,s.tZ)(L.b,{title:i(G(),o,(0,J.Z)(t[0].start).standardDatetimeWithYear()),theme:"default",priority:"secondary",Icon:M.Z,showClose:!1})},eo=e=>{var t,n;let{comment:i,bans:o,onClose:r,onReply:l}=e,{iString:a,iTemplate:c}=(0,x.M1)(),d=o.find(e=>e.user_id),u=d&&(0,J.Z)(d.expiry).isAfter((0,J.Z)().add(100,"years"))?c($(),null!==(t=null==i?void 0:i.name)&&void 0!==t?t:"This user"):c(K(),null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"This user",(0,J.Z)(null==d?void 0:d.expiry).standardDatetimeWithYear());return d?(0,s.BX)(s.HY,{children:[(0,s.tZ)(O.xB,{title:u,alignItems:"center",icon:(0,s.tZ)(F.AM,{icon:(0,s.tZ)(E.Z,{})}),showClose:!0,onClose:r,description:a("We recommend leaving a reply to tell them why they are banned, and to let other readers know what kinds of comments are not acceptable.")}),(0,s.tZ)(O.ex,{}),(0,s.tZ)(O.mz,{direction:"column",primaryButton:(0,s.tZ)(z.zx,{priority:"primary-mono",onClick:l,children:c(Q())})})]}):null},er=(e,t)=>{let[n,i]=(0,u.eJ)(null),[o,r]=(0,u.eJ)(!1),[l,a]=(0,u.eJ)([]),[s,c]=(0,u.eJ)([]),[d,h]=(0,u.eJ)(null),m=e=>{e.forEach(t=>{-1==e.findIndex(e=>e.id===t.id)&&e.push(t)}),a(e)},p=async(n,i)=>{r(!0);try{if(!e)throw Error("comment undefined, cannot submitBan");let o=await _().post("/api/v1/comment_ban/".concat(e.id)).send({user_id:e.user_id,expiry:n,commentVisibility:i});i!==R.VISIBLE&&document.location.reload();let a=o.body;m(a.bans),r(!1),t&&t(e,l)}catch(e){console.error("Failed to submit ban",e),h(!0)}r(!1)};return(0,u.d4)(()=>{(async()=>{if(e){r(!0),a([]),c([]),h(null),i(null);try{var t;let[n,o]=await Promise.all([_().get("/api/v1/user/".concat(e.user_id,"/bans")),_().get("/api/v1/moderation/publications/".concat(e.publication_id,"/users/").concat(e.user_id,"/bans")).query({type:"comment",limit:20})]),r=n.body;a(r.bans),i(r.sub),c(null!==(t=o.body.data)&&void 0!==t?t:[])}catch(e){console.error("Failed to get bans:",e),h(!0)}r(!1)}})()},[e]),{sub:n,loading:o,bans:l,bansHistory:s,error:d,submitBan:p,setLoading:r,setError:h}};var el=n(5097),ea=n(25256),es=n(50137),ec=n(30329),ed=n(53678),eu=n(49762),eh=n(99916),em=n(39493);let ep={link:"link-_X6et2",withShareButton:"withShareButton-hQzuEn"};function eg(e){let{pub:t,post:n,comment:i,onChange:o}=e,{iString:r}=(0,x.M1)(),{canRestack:l,isRestacked:a,restacks:c,menuItems:d,nuxModal:u}=(0,em.K)({pub:t,post:n,comment:i,onRestack:e=>{o({restacked:e,restacks:c+(e?1:-1)})}});return l?(0,s.BX)("span",{children:[u,(0,s.tZ)(eh.v2,{trigger:(0,s.BX)("a",{className:m()("restack-button",a&&"restacked"),href:"javascript:void(0)",children:[(0,s.tZ)(es.Z,{}),r("Restack"),c>0&&" (".concat(c,")")]}),children:d})]}):null}let ef=e=>{var t,n;let{comment:i,pub:o,user:r,post:l,reaction_token:a,commentsEnabledForPost:c,noRestack:d,onChange:u,startReply:h,shareComment:p,updateCommentReacted:g,hideShare:f,commentActionsOverride:Z}=e,{iString:v}=(0,x.M1)(),b=(0,eu.ZP)("like_comments_enabled");return(0,s.tZ)(H.hs,{gap:16,alignItems:"center",justifyContent:"start",paddingTop:8,className:m()("comment-actions",{[null!==(n=ep.withShareButton)&&void 0!==n?n:"undefined"]:!!p}),children:!i.deleted&&[b&&(0,s.tZ)(ec.dJ,{user:r,pub:o,post:l,comment:i,height:16,countInParenthesesStyle:!0,token:a,onChange:e=>{let{comment:t}=e;return u(t)},onReactedChange:e=>{g&&g(i.id,e)},noSelfUpdate:!!g,commentActionsOverride:Z}),c&&(0,s.tZ)(ed.hh,{onClick:Z||(()=>h()),className:ep.link,children:(0,s.BX)(H.hs,{gap:6,alignItems:"center",children:[(0,s.tZ)(el.Z,{stroke:"var(--color-fg-secondary-themed)",size:16}),(0,s.BX)(U.xv.Meta,{color:"pub-secondary-text",children:[v("Reply"),(null===(t=i.children)||void 0===t?void 0:t.length)>0&&" (".concat(i.children.length,")")]})]})}),!f&&!!p&&(0,s.tZ)(ed.hh,{onClick:Z||(()=>p(i.id)),className:ep.link,children:(0,s.BX)(H.hs,{gap:6,alignItems:"center",children:[(0,s.tZ)(ea.Z,{stroke:"var(--color-fg-secondary-themed)",size:16}),(0,s.tZ)(U.xv.Meta,{color:"pub-secondary-text",children:v("Share")})]})}),!d&&(0,s.tZ)(eg,{pub:o,post:l,comment:i,onChange:u})]})};var eZ=n(46638),ev=n(60308),eb=n(84864),ey=n(47929),e_=n(12144);let eC=e=>{var t;let{comment:n,showHiddenComment:i,setShowHiddenComment:o}=e,{iString:r}=(0,x.M1)(),l=null===(t=n.bans)||void 0===t?void 0:t.find(e=>e.publication_id===n.publication_id),a=l&&(0,J.Z)(l.expiry).diff((0,J.Z)(),"years")>=1,c=(0,e_.Ng)(n)&&(n.user_banned_for_comment||n.reported_by_user),d=r(a?"User was indefinitely suspended for this comment. ":"User was temporarily suspended for this comment. "),u=n.user_banned_for_comment?d:r("You reported this comment. ");return c&&(0,s.tZ)("div",{className:"comment_notice",children:(0,s.BX)("i",{children:[u,(0,s.tZ)("a",{href:"javascript:void(0)",onClick:()=>o(!i),children:i?"Hide":"Show"})]})})},ew=e=>{let{comment:t}=e,{title:n,truncated_body_text:i,date:o,bylines:r,like_count:l,comment_count:a,url:c}=t.reply;return(0,s.BX)("a",{className:"reply-comment",href:(0,ev.n1t)(c,{utm_source:ey.b3.substack,utm_campaign:ey.VX.postReplyComment,utm_medium:ey.lP.web}),native:!0,children:[(0,s.tZ)("div",{className:"reply-comment-title",children:n}),i&&(0,s.tZ)("div",{className:"reply-comment-body",children:(0,eb.formatEllipsis)(i)}),(0,s.tZ)("button",{className:"reply-comment-read-more",children:"Read more"}),(0,s.tZ)("div",{className:"reply-comment-meta",children:(0,eb.getPostEmbedMeta)({date:o,bylines:r,like_count:l,comment_count:a})})]})},ek=e=>{let{comment:t,bodyRef:n,expandToggleClicked:i}=e,[o,r]=(0,u.eJ)(!1),l=(t.user_banned_for_comment||t.reported_by_user)&&!o;return(0,s.BX)("div",{className:"comment-body",ref:n,children:[(0,s.tZ)(eC,{comment:t,showHiddenComment:o,setShowHiddenComment:r}),t.hidden?(0,s.tZ)("i",{children:"Comment hidden"}):t.deleted?(0,s.tZ)("i",{children:"Comment deleted"}):l?(0,s.tZ)("i",{}):t.suppressed&&!o?(0,s.tZ)("i",{children:"Comment removed"}):"reply"===t.type?(0,s.tZ)(ew,{comment:t}):(0,eZ.Fs)(t.body),(0,s.tZ)("div",{role:"button",className:"show-all-toggle",onClick:()=>i(),children:(0,s.tZ)("div",{className:"show-all-toggle-label",children:"Expand full comment"})})]})};var ex=n(41990),eB=n(26419),eS=n(37921),eN=n(40647),eM=n(17540),eE=n(63474),eI=n(63651);function eR(e){let{comment:t,onClick:n,utm_content:i,noHover:o}=e,{getConfigFor:r}=(0,eN.xR)(),l=r("enable_user_status_ui"),a=(0,eZ.gz)(t),c=(0,eI.NNq)(a,{utm_source:"comment",utm_content:i}),d=null!=n?n:()=>{};if(t.user_banned)return(0,s.tZ)(eE.A0,{href:c,onClick:d,children:(0,s.tZ)(T.ky,{size:32,icon:(0,s.tZ)(eS.Z,{stroke:"var(--color-fg-tertiary)"})})});let u=eL(a,o,c,d),h=eX(t);return!l&&h?(0,s.tZ)(eM.zY,{tier:h,children:u}):u}let eX=e=>{let{metadata:t}=e;return(null==t?void 0:t.is_author)?"author":(null==t?void 0:t.founding)?"founding":(null==t?void 0:t.membership_state)==="subscribed"?"paid":null},eL=(e,t,n,i)=>t?(0,s.tZ)(T.On,{user:e,size:32,linkProps:{href:n,onClick:i}}):(0,s.tZ)(T.xV,{user:e,size:32,linkProps:{href:n,onClick:i}});function eT(e){let{onCollapse:t}=e;return(0,s.tZ)(H.sg,{className:"collapser-Xs0O6C",onClick:t,children:(0,s.tZ)(P.xu,{className:"threadLine-BvF1wF",animate:!0})})}var eP=n(12900),ez=n(23854);function eH(){let e=(0,a._)(["Comment by ",""]);return eH=function(){return e},e}let eA=Math.min(Math.ceil((g()(document.body.clientWidth,400,728)-140)/50),10);class eO extends c.Component{componentDidMount(){this.setSelectedHighlight(),this.setReplyStateFromHash(),this.updateOverflows()}componentDidUpdate(e){var t,n;(null===(t=e.comment)||void 0===t?void 0:t.id)!==(null===(n=this.props.comment)||void 0===n?void 0:n.id)&&this.setSelectedHighlight(),e.replying!==this.props.replying&&this.props.replying&&this.startReply()}setReplyStateFromHash(){if(this.props.comment.deleted||"undefined"==typeof window||!window.location.hash)return;let e=/^#comment-(\d+)-reply$/.exec(window.location.hash);e&&Number(e[1])===this.props.comment.id&&(window.location.hash=window.location.hash.replace(/-reply$/,""),this.startReply())}async startReply(){this.props.onStartReply?this.props.onStartReply(this.props.comment):await new Promise(e=>this.setState({replying:!0},e))}onDateClick(e){var t;let[n,i]=e.target.href.split("?")[0].split("#");n===(null===(t=window.location.href.split("?")[0])||void 0===t?void 0:t.split("#")[0])&&i&&(e.preventDefault(),this.setState({hideAnchors:!0},()=>{window.location.hash="#".concat(i),this.setState({hideAnchors:!1})}))}updateOverflows(){let e=this.bodyRef.current;if(!e)return;let t=e.scrollHeight-e.clientHeight;t>0&&t<200?e.classList.add("expanded"):t>=200&&(e.classList.add("long"),e.setAttribute("data-hidden-height",t))}render(e,t){var n,i,o,a;let{user:c,comment:d,freeSignup:u,freeSignupEmail:h,pub:p,post:g,reaction_token:f,depth:v,collapseAtDepth:b,onChange:y,scrollRef:_,retainUserCollapseState:C,onStartReply:w,noHoverProfile:k,onProfileClick:x,onShareComment:B,hideContextMenu:S,noRestack:N,updateCommentReacted:M,iString:E,iTemplate:I,hideShare:R,contextMenuUseMobileBottomSheet:X,commentActionsOverride:L}=e,{isSelected:T,replying:P,editing:A,hideAnchors:O,isCollapsed:F}=t,D=p.community_enabled&&g&&"none"!==g.write_comment_permissions,{user_banned:W}=d;if(A&&c)return(0,s.tZ)(ex._,{autoFocus:!0,user:c,freeSignup:u,freeSignupEmail:h,pub:p,post:g,commentBeingEdited:d,saveEdit:this.saveEdit,token:f,onCancel:()=>this.setState({editing:!1}),onSuccess:y?this.onSaveEditSuccess:null});let V=null===(n=(0,eZ.gz)(d))||void 0===n?void 0:n.name,U=V?I(eH(),V):E("Comment");return(0,s.BX)("div",{className:m()("comment",{selected:T,"post-reply":"reply"===d.type,collapsed:F}),children:[!O&&[(0,s.tZ)("div",{id:"comment-".concat(d.id),className:"comment-anchor"}),(0,s.tZ)("div",{id:"comment-".concat(d.id,"-reply"),className:"comment-anchor"})],(0,s.BX)(H.X2,{gap:12,paddingBottom:12,className:"comment-content",role:"article","aria-label":U,children:[(0,s.tZ)(H.sg,{ref:this.headContainerRef,children:(0,s.tZ)(eR,{comment:d,noHover:k,onClick:x?()=>x(d):void 0})}),(0,s.BX)(H.sg,{flex:"grow",children:[(0,s.tZ)(eB.J,{post:g,pub:p,comment:d,isCollapsed:F,toggleCollapse:()=>this.setCollapsed(!this.state.isCollapsed),onProfileClick:x,userBanned:null!=W&&W,userPendingApproval:d.status===ez.ql.new_commenter_approval_required&&!!(null==c?void 0:c.is_admin),onChange:this.onChange,startEdit:()=>this.startEdit(),startReport:this.showReportModal,openBan:this.openBan,hideContextMenu:S,useMobileBottomSheet:X}),(0,s.tZ)(ek,{comment:d,bodyRef:this.bodyRef,expandToggleClicked:this.expandToggleClicked}),(0,s.tZ)(ef,{comment:d,pub:p,user:c,post:g,reaction_token:f,commentsEnabledForPost:D,noRestack:N,onChange:this.onChange,startReply:()=>this.startReply(),updateCommentReacted:M,shareComment:B,hideShare:R,commentActionsOverride:L}),(0,s.tZ)(eP.H,{expanded:P&&D,clip:!1,children:(0,s.tZ)(eF,{children:(0,s.tZ)(ex._,{autoFocus:!0,user:c,freeSignup:u,freeSignupEmail:h,pub:p,post:g,parent:d,token:f,onCancel:()=>this.setState({replying:!1}),onSuccess:y?e=>{this.setState({replying:!1}),y((0,l._)((0,r._)({},d),{children:[e].concat(d.children)}))}:null,alwaysShowButtons:!0})})})]})]}),d.childrenSummary&&(0,s.tZ)("div",{className:"more-replies-container",children:(0,s.tZ)("a",{className:"more-replies",href:(0,eZ.aE)(g,d,p),children:d.childrenSummary})}),!d.childrenSummary&&!Z()(v)&&v>=eA&&!!(null===(i=d.children)||void 0===i?void 0:i.length)&&(0,s.tZ)(H.X2,{className:"more-replies-container",children:(0,s.tZ)(z.ZP,{size:"sm",priority:"secondary-outline",href:(0,eZ.aE)(g,d,p),children:E("Continue thread →")})}),!d.childrenSummary&&!Z()(v)&&v<eA&&(0,s.tZ)(e$,{user:c,freeSignup:u,freeSignupEmail:h,pub:p,post:g,comments:null!==(a=d.children)&&void 0!==a?a:[],parent:d,reaction_token:f,depth:(v||0)+1,collapseAtDepth:b,onChange:y,isChild:!0,scrollRef:_,retainUserCollapseState:C,onStartReply:w,noHoverProfile:k,onProfileClick:x,hideContextMenu:S,updateCommentReacted:M,noRestack:!0,hideShare:R,contextMenuUseMobileBottomSheet:X},d.id),!F&&(null===(o=d.children)||void 0===o?void 0:o.length)>0&&(0,s.tZ)(eT,{onCollapse:()=>this.setCollapsed(!0)})]},d.id)}constructor(e,t){super(e,t),(0,o._)(this,"bodyRef",(0,c.createRef)()),(0,o._)(this,"headContainerRef",(0,c.createRef)()),(0,o._)(this,"openBan",()=>{this.props.commentActions.openBanDialog({comment:this.props.comment,onReply:()=>{this.startReply()}})}),(0,o._)(this,"setSelectedHighlight",()=>{let e=(0,eZ.Jr)()===this.props.comment.id;this.setState({isSelected:e})}),(0,o._)(this,"startEdit",()=>{this.setState({editing:!0})}),(0,o._)(this,"saveEdit",async e=>{if(this.state.editing)return{res:await this.props.maybeOAuthRequest.patch("/api/v1/comment/".concat(this.props.comment.id)).send({body:e})}}),(0,o._)(this,"onSaveEditSuccess",e=>{var t,n;let{edited:i}=e;this.setState({editing:!1}),null===(t=(n=this.props).onChange)||void 0===t||t.call(n,(0,r._)({},this.props.comment,i))}),(0,o._)(this,"showReportModal",()=>{var e;let{pub:t,comment:n}=this.props;this.props.onReport({pub:t,canReportToAdmins:!!(null==t?void 0:t.moderation_enabled)&&!(null===(e=n.metadata)||void 0===e?void 0:e.is_author),onSubmit:async e=>{var i,o;let{reportCategory:a,reportedToSubstack:s,details:c}=e;await _().post("/api/v1/comment/".concat(n.id,"/report")).send({publication_id:null==t?void 0:t.id,details:c,reportCategory:a,reportedToSubstack:s}),null===(i=(o=this.props).onChange)||void 0===i||i.call(o,(0,l._)((0,r._)({},this.props.comment),{reported_by_user:!0}))}})}),(0,o._)(this,"expandToggleClicked",()=>{let e=this.bodyRef.current;e&&(e.classList.remove("long"),e.classList.add("expanded"),(0,N.j)(N.FP.COMMENT_EXPAND_TOGGLE_CLICKED,{hiddenHeight:e.getAttribute("data-hidden-height")}))}),(0,o._)(this,"onChange",e=>{this.props.onChange?this.props.onChange((0,r._)({},this.props.comment,e)):document.location.href=(0,eZ.Os)(this.props.post,this.props.pub)}),(0,o._)(this,"setComment",e=>{this.setState({comment:e})}),(0,o._)(this,"setCollapsed",e=>{var t,n;if(this.setState({isCollapsed:e}),e&&(null===(n=this.headContainerRef)||void 0===n?void 0:null===(t=n.current)||void 0===t?void 0:t.scrollIntoView)){let e=this.headContainerRef.current.getBoundingClientRect();e.top<0&&(document.documentElement.scrollTop+=e.top-80)}this.props.retainUserCollapseState&&(0,eZ.VS)(this.props.comment.id,e)}),this.state={editing:!1,replying:!1,hideAnchors:!1,isSelected:!1,isCollapsed:this.props.retainUserCollapseState&&(0,eZ.ei)(this.props.comment.id)}}}(0,o._)(eO,"contextType",k.kx);let eF=(0,P.zo)({display:"flex",flex:"grow",paddingTop:16}),eD=(0,d.memo)((0,x.fz)(function(e){let t=(0,d.useContext)(eQ),n=(0,C.T7)(),i=(0,B.Sn)();return(0,s.tZ)(eO,(0,l._)((0,r._)({},e),{commentActions:t,onReport:n,maybeOAuthRequest:i}))}));eO.displayName="Comment_Internal";let eW=5,eV=1,eU=16,eJ=50,ej=200;function eq(e){return e.reduce((e,t)=>e+1+eq(t.children||[]),0)}let eY=e=>{let{user:t,freeSignup:n,freeSignupEmail:i,pub:o,post:r,comments:l,reaction_token:a,depth:c,collapseAtDepth:d,onChange:h,pageSize:p,retainUserCollapseState:g,updateCommentReacted:f,parent:Z,scrollRef:v,className:y,onStartReply:_,noHoverProfile:C,onProfileClick:k,hideContextMenu:B,noRestack:N,hideShare:M,contextMenuUseMobileBottomSheet:E,commentActionsOverride:I}=e,R=p||eU,[X,L]=(0,u.eJ)(!1),[T,P]=(0,u.eJ)(!1),[H,A]=(0,u.eJ)(R),[O,F]=(0,u.eJ)(-1),[D,W]=(0,u.eJ)(new Set(l.map(e=>{let{id:t}=e;return t}))),[V,U]=(0,u.eJ)(!1),[J,j]=(0,u.eJ)(void 0),{iString:q,iPlural:Y}=(0,x.M1)();(0,u.d4)(()=>{O>=0&&window.scrollTo(window.scrollX,O)},[O]);let G=(0,S.z)(e=>{j(e),U(!0)});if(0===(l||[]).length)return null;let[$,K]=b()(null!=l?l:[],e=>{let{id:n,user_id:i}=e;return D.has(n)||i===(null==t?void 0:t.id)}),Q=$.slice(0,H);return(0,s.BX)(s.HY,{children:[(0,s.BX)("div",{className:m()("comment-list",y,{"has-new-comments":K.length>0}),children:[K.length>0&&(0,s.tZ)(z.zx,{size:"sm",priority:"secondary-outline",onClick:()=>{setTimeout(()=>{W(new Set(l.map(e=>{let{id:t}=e;return t}))),P(!1)},0),P(!0)},children:T?Y("loading 1 new reply","loading %1 new replies",eq(K)):Y("1 new reply","%1 new replies",eq(K))}),(0,s.tZ)("div",{className:"comment-list-items",children:Q.map(e=>(0,s.tZ)(eD,{user:t,freeSignup:n,freeSignupEmail:i,pub:o,post:r,comment:e,parent:Z,reaction_token:a,collapseAtDepth:d,depth:c||0,onChange:h,scrollRef:v,retainUserCollapseState:g,onStartReply:_,noHoverProfile:C,onShareComment:G,onProfileClick:k,hideContextMenu:B,noRestack:N,updateCommentReacted:f,hideShare:M,contextMenuUseMobileBottomSheet:E,commentActionsOverride:I},e.id))}),$.length>Q.length&&(0,s.tZ)(z.zx,{size:"sm",priority:"secondary-outline",loading:X,onClick:()=>{F(window.scrollY),setTimeout(()=>{A(H+R),L(!1)},0),L(!0)},children:q("Load More")})]}),(0,s.tZ)(w.V,{isOpen:V,onClose:()=>U(!1),pub:o,post:r,commentId:J,comments:l,user:null!=t?t:void 0,utm_campaign:ey.VX.commentListShareCta,medium:"web"})]})};eY.displayName="CommentList";let eG=(0,d.memo)(eY);eG.displayName="CommentList";let e$=eG;function eK(e){let[t,n]=(0,u.eJ)(null),i=(0,d.useMemo)(()=>({openBanDialog:n}),[]);return(0,s.BX)(eQ.Provider,{value:i,children:[(0,s.tZ)(e$,(0,r._)({},e)),(0,s.tZ)(ee,(0,l._)((0,r._)({},t),{onClose:()=>n(null),onBan:(t,n)=>{let{onChange:i}=e;i?i((0,l._)((0,r._)({},t),{user_banned:!0,bans:n.concat(t.bans)})):document.location.href=(0,eZ.Os)(e.post,e.pub)}}))]})}let eQ=(0,d.createContext)({openBanDialog:()=>void 0})},26419:function(e,t,n){n.d(t,{J:()=>eH});var i=n(58865),o=n(16584),r=n(30396),l=n(14293),a=n.n(l),s=n(95441),c=n(60807),d=n(25991),u=n(53678),h=n(16451),m=n(7409),p=n(99282),g=n(9404),f=n(60170),Z=n(90423),v=n(71787),b=n(22448),y=n(30143),_=n(27669),C=n(63618),w=n(13671),k=n(61108),x=n(73510),B=n(74485),S=n(42297),N=n(98848),M=n(64515);let E=e=>{var{size:t=24,fill:n="var(--color-fg-primary)"}=e,i=(0,N._)(e,["size","fill"]);return(0,o.tZ)(M.l,(0,p._)((0,m._)({},i),{name:"LinearIcon",svgParams:{viewBox:"0 0 24 24"},width:t,height:t,fill:n,children:(0,o.tZ)("path",{stroke:"none",fillRule:"evenodd",clipRule:"evenodd",d:"M19.0619 4.92341C15.1689 1.03032 8.8663 1.01517 4.95447 4.87797L19.1074 19.0309C22.9702 15.119 22.955 8.81651 19.0619 4.92341ZM2.95746 7.67367L16.3108 21.027C17.0035 20.6951 17.6661 20.2789 18.2829 19.7783L4.2062 5.70169C3.70565 6.31846 3.2894 6.98092 2.95746 7.67367ZM12.5482 21.9918L1.99316 11.4369C2.04331 10.5412 2.21326 9.65092 2.50301 8.79221L15.1928 21.4819C14.334 21.7717 13.4439 21.9416 12.5482 21.9918ZM4.90872 19.077C3.22167 17.3899 2.26284 15.2503 2.03226 13.049L10.9367 21.9534C8.73529 21.7228 6.59577 20.7639 4.90872 19.077Z"})}))},I=(0,n(6400).createContext)(null);function R(e){let{children:t,value:n}=e;return(0,o.tZ)(I.Provider,{value:n,children:t})}var X=n(80569),L=n.n(X),T=n(8923),P=n(98914),z=n(46638),H=n(98012),A=n(23854);function O(){let e=(0,i._)(["Are you sure you want to unpin this comment?"]);return O=function(){return e},e}function F(){let e=(0,i._)(["Are you sure you want to pin this comment?"]);return F=function(){return e},e}function D(){let e=(0,r.qp)(I);if(!e)throw Error("useCommentMenu must be used within a CommentMenuProvider");return e}let W=e=>{var t;let{iString:n}=(0,s.M1)(),i=null===(t=e.bans)||void 0===t?void 0:t.find(t=>t.publication_id===e.publication_id),o=i&&(0,H.Z)(i.expiry).diff((0,H.Z)(),"years")>=1,r=["moderator_removed","deleted"].includes(e.status),l=e.user_banned_for_comment;return{banText:o?n("Banned"):r?"":n("Suspended"),shouldShowBanText:l}};function V(e){let{iString:t}=(0,s.M1)(),{isOAuthProvider:n}=(0,T.wg)();return()=>!!n||window.confirm("".concat(t("Are you sure you want to ".concat(e," this comment? This action cannot be reversed."))))}var U=n(15771),J=n(19081),j=n(99916),q=n(84747),Y=n(40949),G=n(75419),$=n(40121),K=n(60308),Q=n(84864),ee=n(12144);function et(e){let{comment:t,pub:n,post:i,user:r,onChange:l,startEdit:a,startReport:s,openBan:c,isCollapsed:d,toggleCollapse:u,useMobileBottomSheet:h}=e;return!function(e){let{menuEnabled:t}=eZ(e);return t}({comment:t,user:r})?null:(0,o.tZ)(q.M,{trigger:(0,o.tZ)(J.X2,{className:"triggerContainer-eX588u",children:(0,o.tZ)(en,{})}),useMobileBottomSheet:h,children:(0,o.tZ)(eo,{comment:t,pub:n,post:i,user:r,onChange:l,startEdit:a,startReport:s,openBan:c,isCollapsed:d,toggleCollapse:u})})}function en(){return(0,o.tZ)(U.hU,{priority:"quaternary",size:"sm",className:"trigger-j08Uop",children:(0,o.tZ)(g.Z,{size:16})})}function ei(e){let{sections:t}=e,n=t.map(e=>(0,p._)((0,m._)({},e),{items:e.items.filter(e=>{var t;return null!==e&&(null===(t=e.props)||void 0===t?void 0:t.enabled)!==!1})})).filter(e=>e.items.length>0);return(0,o.tZ)(o.HY,{children:n.map((e,t)=>(0,o.tZ)(j.xw,{isFirst:0===t,children:e.items},e.key))})}function eo(e){var t;let{comment:n,pub:i,post:l,user:a,onChange:s,startEdit:c,startReport:d,openBan:u,isCollapsed:h,toggleCollapse:m}=e,p=(0,r.sO)(),g=eZ({comment:n,user:a}),f=[{key:"editing",items:[(0,o.tZ)(ea,{enabled:g.editCommentEnabled,onClick:c})]},{key:"sharing",items:[(0,o.tZ)(el,{enabled:!0}),(0,o.tZ)(eg,{enabled:g.restackCommentEnabled})]},{key:"actions",items:[(0,o.tZ)(es,{enabled:g.pinCommentEnabled}),(0,o.tZ)(er,{enabled:!0,isCollapsed:h,toggleCollapse:m}),(0,o.tZ)(ec,{enabled:g.giftSubscriptionEnabled}),(0,o.tZ)(ef,{enabled:null!==(t=null==a?void 0:a.is_global_admin)&&void 0!==t&&t}),(0,o.tZ)(ed,{enabled:g.subscriberDetailsEnabled})]},{key:"admin",items:[(0,o.tZ)(eu,{enabled:g.deleteCommentEnabled}),(0,o.tZ)(eh,{enabled:g.removeCommentEnabled}),(0,o.tZ)(em,{enabled:g.reportCommentEnabled,onClick:d}),(0,o.tZ)(ep,{enabled:g.banUserEnabled,onClick:u})]}];return(0,o.tZ)(R,{value:{comment:n,pub:i,post:l,onChange:s,onMenuClose:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.close()},toggleCollapse:m},children:(0,o.tZ)(ei,{sections:f})})}function er(e){let{enabled:t,isCollapsed:n,toggleCollapse:i}=e,{iString:r}=(0,s.M1)();return t?(0,o.tZ)(q.u,{leading:n?(0,o.tZ)(f.Z,{}):(0,o.tZ)(Z.Z,{}),onClick:i,children:r(n?"Expand":"Collapse")}):null}function el(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,post:r,pub:l}=D(),a=(0,Y.y)();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(v.Z,{}),onClick:()=>{a((0,z.aE)(r,i,l))},children:n("Copy link")}):null}function ea(e){let{enabled:t,onClick:n}=e,{iString:i}=(0,s.M1)();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(b.Z,{}),onClick:n,children:i("Edit")}):null}function es(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,onChange:l}=D(),{pinned:a,togglingPin:c,togglePinned:d}=function(e){let{comment:t,onChange:n}=e,{iTemplate:i}=(0,s.M1)(),[o,l]=(0,r.eJ)(!1),a=!!t.pinned_by_user_id,c=async()=>{if(!o&&window.confirm(a?i(O()):i(F()))&&!o){l(!0);try{await L().patch("/api/v1/comment/".concat(t.id,"/pin")).send({pinned:!a}),n({pinned:!a}),document.location.reload()}catch(e){alert((0,P.zx)(e)),l(!1)}}};return{pinned:a,togglingPin:o,togglePinned:c}}({comment:i,onChange:l});return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(y.Z,{}),onClick:d,children:n(c?a?"Unpinning...":"Pinning...":a?"Unpin":"Pin")}):null}function ec(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,pub:r}=D();if(!t)return null;let l="".concat(r.base_url,"/subscribe?gift=true&recipient=").concat(i.user_id,"-").concat((0,$.Hm)(i.name,{hashIfEmpty:!0}),"&comment_id=").concat(i.id,"}");return(0,o.tZ)(q.u,{leading:(0,o.tZ)(_.Z,{}),href:l,children:n("Gift a subscription")})}function ed(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,pub:r}=D();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(C.Z,{}),onClick:()=>{if(i.email)return window.open((0,K.pN7)(r,i.email),"_blank")},children:n("Subscriber details")}):null}function eu(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,onChange:l,onMenuClose:a}=D(),{isDeleting:c,deleteComment:d}=function(e){let{comment:t,onChange:n,onMenuClose:i}=e,[o,l]=(0,r.eJ)(!1),a=V("delete"),s=(0,T.Sn)(),c=async()=>{if(!o&&a()){l(!0);try{await s.delete("/api/v1/comment/".concat(t.id)).send(),n({status:A.ql.deleted,deleted:!0,user_id:null,name:null,body:null}),i()}catch(e){alert((0,P.zx)(e))}l(!1)}};return{isDeleting:o,deleteComment:c}}({comment:i,onChange:l,onMenuClose:a});return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(w.Z,{}),onClick:d,priority:"destructive",children:n(c?"Deleting...":"Delete")}):null}function eh(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,onChange:l,onMenuClose:a}=D(),{isRemoving:c,removeComment:d}=function(e){let{comment:t,onChange:n,onMenuClose:i}=e,[o,l]=(0,r.eJ)(!1),a=V("remove"),s=async()=>{if(!o&&a()){l(!0);try{await L().patch("/api/v1/comment/".concat(t.id,"/status")).send({status:A.ql.moderator_removed}),n({suppressed:!0,status:A.ql.moderator_removed,body:null}),i()}catch(e){alert((0,P.zx)(e))}l(!1)}};return{isRemoving:o,removeComment:s}}({comment:i,onChange:l,onMenuClose:a});return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(k.Z,{}),onClick:d,priority:"destructive",children:n(c?"Removing...":"Remove")}):null}function em(e){let{enabled:t,onClick:n}=e,{iString:i}=(0,s.M1)();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(x.Z,{}),onClick:n,priority:"destructive",children:i("Report")}):null}function ep(e){let{enabled:t,onClick:n}=e,{iString:i}=(0,s.M1)();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(B.Z,{}),onClick:n,priority:"destructive",children:i("Ban or suspend user")}):null}function eg(e){let{enabled:t}=e,n=(0,G.i3)(),{comment:i,pub:r,post:l}=D(),{iString:a}=(0,s.M1)();return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(S.Z,{}),onClick:()=>{n.open({restackUrl:(0,z.aE)(l,i,r)})},children:a("Restack")}):null}function ef(e){let{enabled:t}=e,{iString:n}=(0,s.M1)(),{comment:i,post:r,pub:l}=D(),{addCommentToLinear:a}=function(e){let{comment:t,post:n,pub:i}=e,o=()=>{let e=(0,z.aE)(n,t,i),o=encodeURIComponent("".concat(t.body,"\n\nComment author: [").concat(t.name,"](https://admin.substack.com/users/").concat(t.user_id,")\n\nLink: ").concat(e));return"https://linear.app/substackinc/team/TPT/new?description=".concat(o,"&status=Triage")};return{addCommentToLinear:()=>{window.open(o(),"_blank")}}}({comment:i,post:r,pub:l});return t?(0,o.tZ)(q.u,{leading:(0,o.tZ)(E,{}),onClick:a,children:n("Add to Linear")}):null}function eZ(e){let{comment:t,user:n}=e,i=!!(n&&n.id===t.user_id),o=!!(null==n?void 0:n.is_contributor)&&(0,ee.Ng)(t),r=(0,Q.canEditComment)(n,t),l=!!(null==n?void 0:n.is_contributor)&&(0,ee.Ng)(t)&&""===t.ancestor_path,a=!i&&!!t.metadata.eligibleForGift&&!t.metadata.is_author,s=!i&&!t.reported_by_user&&!t.hidden&&!t.suppressed,c=o&&!i,d=o&&!t.user_banned&&!i,u=!!o&&!!t.email&&!i,h=(0,ee.Ng)(t)&&!(null==n?void 0:n.is_oauth),m=r||l||a||s||c||d||u||h;return{editCommentEnabled:r,pinCommentEnabled:l,giftSubscriptionEnabled:a,reportCommentEnabled:s,deleteCommentEnabled:i,removeCommentEnabled:c,banUserEnabled:d,subscriberDetailsEnabled:u,restackCommentEnabled:h,menuEnabled:m}}var ev=n(82701);let eb=e=>{var{size:t=24,fill:n="var(--color-fg-primary)"}=e,i=(0,N._)(e,["size","fill"]);return(0,o.tZ)(M.l,(0,p._)((0,m._)({},i),{name:"CommentBadgeHeartIcon",svgParams:{viewBox:"0 0 20 20"},width:t,height:t,fill:n,children:(0,o.tZ)("path",{stroke:"none",d:"M9.99915 16.7256C9.90515 16.7256 9.79102 16.692 9.65674 16.6249C9.52246 16.5622 9.3949 16.4906 9.27405 16.41C8.02974 15.6044 6.94657 14.7584 6.02454 13.8722C5.10697 12.9815 4.3953 12.0662 3.88953 11.1262C3.38375 10.1818 3.13086 9.23067 3.13086 8.27283C3.13086 7.63725 3.23157 7.05762 3.43298 6.53394C3.63888 6.01025 3.92086 5.55819 4.27893 5.17773C4.64148 4.79728 5.05774 4.50635 5.52771 4.30493C6.00216 4.09904 6.51241 3.99609 7.05847 3.99609C7.73433 3.99609 8.31844 4.16618 8.81079 4.50635C9.30762 4.84652 9.70374 5.28963 9.99915 5.83569C10.299 5.28516 10.6951 4.84204 11.1875 4.50635C11.6843 4.16618 12.2707 3.99609 12.9465 3.99609C13.4836 3.99609 13.9894 4.09904 14.4639 4.30493C14.9428 4.50635 15.3613 4.79728 15.7194 5.17773C16.0774 5.55819 16.3572 6.01025 16.5586 6.53394C16.7645 7.05762 16.8674 7.63725 16.8674 8.27283C16.8674 9.23067 16.6145 10.1818 16.1088 11.1262C15.603 12.0662 14.8891 12.9815 13.967 13.8722C13.0495 14.7584 11.9708 15.6044 10.731 16.41C10.6056 16.4906 10.4758 16.5622 10.3416 16.6249C10.2118 16.692 10.0976 16.7256 9.99915 16.7256Z"})}))},ey=e=>{var{size:t=24,fill:n="var(--color-fg-primary)"}=e,i=(0,N._)(e,["size","fill"]);return(0,o.tZ)(M.l,(0,p._)((0,m._)({},i),{name:"CommentBadgePinIcon",svgParams:{viewBox:"0 0 20 20"},width:t,height:t,fill:n,children:(0,o.tZ)("path",{stroke:"none",d:"M4.62891 12.2131C4.62891 11.7253 4.75199 11.2486 4.99817 10.7831C5.24434 10.3131 5.5957 9.88566 6.05225 9.50073C6.51326 9.11133 7.05933 8.79801 7.69043 8.56079L7.91199 5.4187C7.57182 5.22624 7.26074 5.03153 6.97876 4.83459C6.69678 4.63765 6.45284 4.44967 6.24695 4.27063C6.04106 4.08712 5.87992 3.92151 5.76355 3.7738C5.57556 3.5321 5.48157 3.29041 5.48157 3.04871C5.48157 2.81596 5.56213 2.62349 5.72327 2.47131C5.88888 2.31466 6.10372 2.23633 6.3678 2.23633H13.6322C13.8963 2.23633 14.1089 2.31466 14.27 2.47131C14.4356 2.62349 14.5184 2.81596 14.5184 3.04871C14.5184 3.29041 14.4244 3.5321 14.2365 3.7738C14.1201 3.92151 13.9567 4.08712 13.7463 4.27063C13.5404 4.44967 13.2965 4.63765 13.0145 4.83459C12.737 5.02706 12.4282 5.22176 12.088 5.4187L12.3029 8.56079C12.9384 8.79801 13.4845 9.11133 13.941 9.50073C14.3976 9.88566 14.7489 10.3131 14.9951 10.7831C15.2413 11.2486 15.3644 11.7253 15.3644 12.2131C15.3644 12.5309 15.2659 12.7883 15.069 12.9852C14.872 13.1777 14.608 13.2739 14.2767 13.2739H10.7117V16.4697C10.7117 16.689 10.6848 16.9128 10.6311 17.1411C10.5774 17.3694 10.5103 17.5753 10.4297 17.7588C10.3491 17.9468 10.2686 18.0967 10.188 18.2086C10.1119 18.325 10.0492 18.3832 10 18.3832C9.95076 18.3832 9.88586 18.325 9.8053 18.2086C9.72473 18.0967 9.64417 17.9468 9.5636 17.7588C9.48303 17.5753 9.41589 17.3694 9.36218 17.1411C9.30847 16.9128 9.28162 16.689 9.28162 16.4697V13.2739H5.72327C5.39205 13.2739 5.12573 13.1777 4.92432 12.9852C4.72738 12.7883 4.62891 12.5309 4.62891 12.2131Z"})}))};var e_=n(63474),eC=n(43570),ew=n(87077);function ek(){let e=(0,i._)(["Pinned by ",""]);return ek=function(){return e},e}function ex(){let e=(0,i._)(["Liked by ",""]);return ex=function(){return e},e}let eB=e=>{let{comment:t}=e;return t.pinned_by_user_id?(0,o.tZ)(eS,{name:t.pinned_by_name}):t.metadata.is_author?(0,o.tZ)(eN,{}):t.reactor_names.length>0?(0,o.tZ)(eM,{names:t.reactor_names}):null},eS=e=>{let{name:t}=e,{iString:n,iTemplate:i}=(0,s.M1)();return t?(0,o.tZ)(ew.u,{text:i(ek(),t),layerOptions:{placement:"top-center",triggerOffset:8},children:(0,o.tZ)(eC.Vp,{priority:"secondary",cursor:"pointer",fillIcon:!0,leading:(0,o.tZ)(ey,(0,m._)({},eC.NH)),children:n("Pinned")})}):(0,o.tZ)(eC.Vp,{priority:"secondary-outline",fillIcon:!0,leading:(0,o.tZ)(ey,(0,m._)({},eC.NH)),children:n("Pinned")})},eN=()=>{let{iString:e}=(0,s.M1)();return(0,o.tZ)(eC.Vp,{priority:"secondary-outline",theme:"accent",children:e("Author")})},eM=e=>{let{names:t}=e,{iTemplate:n}=(0,s.M1)();return(0,o.tZ)(eC.Vp,{theme:"accent",priority:"secondary-outline",fillIcon:!0,leading:(0,o.tZ)(eb,(0,m._)({},eC.NH)),children:n(ex(),t.join(", "))})},eE=e=>{let{comment:t,userBanned:n}=e,{banText:i,shouldShowBanText:r}=W(t);return!r||n?null:(0,o.tZ)(eC.Vp,{priority:"secondary",children:i})},eI=e=>{let{comment:t,userPendingApproval:n}=e,{iString:i}=(0,s.M1)();return n?(0,o.tZ)(e_.A0,{href:"/publish/moderation/new-commenters?user=".concat(t.user_id),target:"_blank",rel:"noopener",children:(0,o.tZ)(eC.Vp,{priority:"secondary",cursor:"pointer",trailing:(0,o.tZ)(ev.Z,(0,m._)({},eC.NH)),children:i("Awaiting approval")})}):null},eR=e=>{let{children:t}=e;return(0,o.tZ)(J.X2,{gap:4,children:t})};var eX=n(71068),eL=n(58175),eT=n(33017),eP=n(47929);function ez(){let e=(0,i._)(["Edited"]);return ez=function(){return e},e}function eH(e){let{post:t,pub:n,comment:i,isCollapsed:r,onProfileClick:l,userBanned:a,toggleCollapse:s,userPendingApproval:u,disableHoverCard:h,onChange:m,startEdit:p,startReport:g,openBan:f,hideContextMenu:Z,useMobileBottomSheet:v}=e,b=(0,c.aF)();return(0,o.BX)(J.gq,{children:[(0,o.BX)(eJ,{children:[(0,o.tZ)(d.KF,{children:(0,o.BX)(d.Gf,{children:[(0,o.tZ)(eA,{comment:i,onClick:l,disableHoverCard:h}),(0,o.tZ)(eO,{comment:i}),(0,o.tZ)(eD,{comment:i,post:t,pub:n}),(0,o.tZ)(eW,{comment:i})]})}),!r&&(0,o.tZ)(eU,{comment:i,userBanned:a,userPendingApproval:u}),(0,o.tZ)(eV,{comment:i,isCollapsed:r,toggleCollapse:s})]}),(0,o.tZ)(ej,{onClick:s}),!Z&&(0,o.tZ)(et,{comment:i,pub:n,post:t,user:b,onChange:m,startEdit:p,startReport:g,openBan:f,isCollapsed:r,toggleCollapse:s,useMobileBottomSheet:v})]})}function eA(e){let{comment:t,onClick:n,disableHoverCard:i}=e,{iString:r}=(0,s.M1)();if(t.name&&!a()(t.user_id))return(0,o.tZ)(eL.xv.B4,{display:"flex",gap:6,children:(0,o.tZ)(d.Lg,{user:(0,z.gz)(t),onClick:n?()=>n(t):void 0,disableHoverCard:i})});let l=r(t.hidden?"Comment hidden":t.deleted?"Comment deleted":(0,ee.Ng)(t)?"Anonymous":"Comment removed");return(0,o.tZ)(eL.xv.B4,{color:"secondary",children:l})}function eO(e){var t,n,i,r,l;let{comment:a}=e,s=(null===(t=a.metadata)||void 0===t?void 0:t.author_on_other_pub)&&!a.metadata.is_author,c=(null===(i=a.metadata)||void 0===i?void 0:null===(n=i.author_on_other_pub)||void 0===n?void 0:n.id)&&!a.hidden;return s?c?(0,o.tZ)(eT.Sm,{publication_id:null!==(l=null===(r=a.metadata.author_on_other_pub)||void 0===r?void 0:r.id)&&void 0!==l?l:0,children:(0,o.tZ)(eF,{comment:a})}):(0,o.tZ)(eF,{comment:a}):null}function eF(e){var t;let{comment:n,disableHoverCard:i}=e,r=(0,c.aF)();return n.metadata.author_on_other_pub&&r?(0,o.tZ)(eL.xv.B4,{as:"span",color:"secondary",weight:"regular",children:(0,o.tZ)(u.G6,{publication:n.metadata.author_on_other_pub,utm_source:eP.b3.substackFeedItem,utm_content:eP.fZ.commentMetadata,disableHoverCard:i,user:r,children:(0,o.BX)("span",{children:[(0,Q.truncateText)(null===(t=n.metadata.author_on_other_pub)||void 0===t?void 0:t.name,32)," "]})})}):null}function eD(e){let{comment:t,post:n,pub:i}=e;return(0,o.tZ)(eL.hh,{href:(0,z.aE)(n,t,i),onClick:e=>null===this||void 0===this?void 0:this.onDateClick(e),rel:"nofollow",native:!0,color:"secondary",title:d.c9.format((0,H.Z)(t.date).toDate()),children:(0,o.tZ)(h.Ku,{timestamp:t.date})})}function eW(e){let{comment:t}=e,{iTemplate:n}=(0,s.M1)();return t.edited_at?(0,o.tZ)(eL.xv.B4,{as:"span",fontStyle:"italic",decoration:"hover-underline",cursor:"pointer",color:"tertiary",title:d.c9.format((0,H.Z)(t.edited_at).toDate()),children:n(ez())}):null}function eV(e){let{comment:t,toggleCollapse:n,isCollapsed:i}=e,{iString:l}=(0,s.M1)(),[a,c]=(0,r.eJ)(!1);if(!i||!n)return null;let d=e=>{var t,n;return(null!==(t=e.children)&&void 0!==t?t:[]).length+(null!==(n=e.children)&&void 0!==n?n:[]).reduce((e,t)=>e+d(t),0)},u=d(t),h=l(a?"Loading":u>0?"Show replies":"Show comment");return(0,o.tZ)(J.X2,{children:(0,o.tZ)(U.zx,{size:"sm",flex:"auto",priority:"secondary-outline",maxHeight:28,onClick:()=>{c(!0),setTimeout(()=>{n(),c(!1)},0)},children:h})})}function eU(e){let{comment:t,userBanned:n,userPendingApproval:i}=e,r=eB({comment:t}),l=eE({comment:t,userBanned:n}),a=eI({comment:t,userPendingApproval:i});return r||l||a?(0,o.BX)(eR,{children:[r,l,a]}):null}let eJ=(0,eX.zo)({display:"flex",direction:"column",gap:4}),ej=(0,eX.zo)({display:"flex",direction:"column",flex:"grow"})},1980:function(e,t,n){n.d(t,{l:()=>o});var i=n(16584);let o=()=>(0,i.BX)("div",{className:"comment-silhouette",children:[(0,i.tZ)("div",{className:"comment-silhouette-head"}),(0,i.BX)("div",{className:"comment-silhouette-content",children:[(0,i.tZ)("div",{className:"comment-silhouette-meta"}),(0,i.tZ)("div",{className:"comment-silhouette-body"}),(0,i.tZ)("div",{className:"comment-silhouette-actions"})]})]})},75496:function(e,t,n){n.d(t,{v:()=>function e(t,n){let r=[],l=!1,a=new Map(t.map(e=>[e.id,e]));for(let t of n){let n=a.get(t.id);if(n){var s,c;(n.children&&t.children?e(n.children,t.children):t.children)!==n.children||o.some(e=>n[e]!==t[e])||!(0,i.wU)(null!==(s=n.reactions)&&void 0!==s?s:{},null!==(c=t.reactions)&&void 0!==c?c:{})?(r.push(t),l=!0):r.push(n)}else r.push(t),l=!0}return l?r:t}});var i=n(75561);let o=["edited_at","deleted","status"]},21266:function(e,t,n){n.d(t,{H:()=>r});var i=n(7409),o=n(99282);function r(e,t){var n,r;return function e(t,n,r){let l=n[0];if(!l){let e=t.findIndex(e=>e.id===r.id);return e>=0?t.with(e,r):[...t,r]}let a=t.findIndex(e=>e.id===l);if(a>=0){let l=t[a];if(l.id===r.id)return t.with(a,r);if(l.children)return t.with(a,(0,o._)((0,i._)({},l),{children:e(l.children,n.slice(1),r)}))}return t}(e,null!==(r=null===(n=t.ancestor_path)||void 0===n?void 0:n.split(".").map(Number))&&void 0!==r?r:[],t)}},43570:function(e,t,n){n.d(t,{D7:()=>f,NH:()=>m,Vp:()=>g});var i=n(7409),o=n(99282),r=n(98848),l=n(16584),a=n(94184),s=n.n(a),c=n(98661),d=n(15771),u=n(19081);n(58175),n(76641);var h=n(66327);let m={size:14,strokeWidth:2.5},p={display:"flex",height:20,paddingX:6,paddingY:2,gap:4,fontSize:11,fontWeight:"medium",alignItems:"center"},g=(0,c.forwardRef)((e,t)=>{var{className:n,theme:a="default",priority:c="secondary",leading:m,trailing:g,children:f,fillIcon:Z,radius:v="xs",onClick:b,href:y}=e,_=(0,r._)(e,["className","theme","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let C=void 0!==b||void 0!==y;return(0,l.BX)(d.kG,(0,o._)((0,i._)((0,o._)((0,i._)({},_),{className:s()(n,h.Z.tag,h.Z["theme_".concat(a)],h.Z["priority_".concat(c)],C&&h.Z.clickable),onClick:b,href:y,ref:t,radius:v,cursor:C?"pointer":"inherit",tabIndex:C?0:-1}),p),{children:[m&&(0,l.tZ)(u.hs,{className:s()(h.Z.leading,Z&&h.Z.fillIcon),alignItems:"center",children:m}),f,g&&(0,l.tZ)(u.hs,{className:s()(h.Z.trailing,Z&&h.Z.fillIcon),alignItems:"center",children:g})]}))}),f=(0,c.forwardRef)((e,t)=>{var{className:n,priority:a="primary",leading:c,trailing:m,children:g,fillIcon:f,radius:Z="xs",onClick:v,href:b}=e,y=(0,r._)(e,["className","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let _=void 0!==v||void 0!==b;return(0,l.BX)(d.kG,(0,o._)((0,i._)((0,o._)((0,i._)({},y),{className:s()(n,h.Z.tag,h.Z.media,h.Z["priority_".concat(a)],_&&h.Z.clickable),onClick:v,href:b,ref:t,radius:Z,cursor:_?"pointer":"inherit",tabIndex:_?0:-1}),p),{children:[c&&(0,l.tZ)(u.hs,{className:s()(h.Z.leading,f&&h.Z.fillIcon),alignItems:"center",children:c}),g,m&&(0,l.tZ)(u.hs,{className:s()(h.Z.trailing,f&&h.Z.fillIcon),alignItems:"center",children:m})]}))});f.displayName="MediaTag"},33451:function(e,t,n){n.d(t,{A7:()=>M,Gt:()=>T,Ii:()=>P,KV:()=>w,P9:()=>N,aE:()=>x,bO:()=>R,pc:()=>k,xj:()=>B,xk:()=>S});var i=n(7409),o=n(99282),r=n(98848),l=n(16584),a=n(94184),s=n.n(a),c=n(48403),d=n.n(c);n(39693);var u=n(13766),h=n(71787);n(93974);var m=n(39535);n(3880),n(79094);var p=n(20888);n(19548),n(95441);var g=n(99259);n(40647),n(77906),n(48980),n(94874),n(17540);var f=n(80026),Z=n(86075);n(99916);var v=n(10510),b=n(63474);n(91021),n(70379),n(1669),n(16913),n(69304),n(93502),n(32223),n(97842),n(11308);var y=n(36889);n(76820),n(98012),n(60308);var _=n(63651),C=n(77859);function w(e){var t;let{user:n}=e,i=(0,g.M$)().isOnDestination;return(0,l.tZ)(f.xu,{paddingX:12,children:(0,l.tZ)(f.xv.B4,{as:"a",color:"secondary",decoration:"hover-underline",href:(0,_.NNq)(n,{noBase:i}),target:"_blank",children:null!==(t=n.name)&&void 0!==t?t:"Substack user"})})}let k=(0,f.zo)({className:C.Z.messageBubbleGroup,position:"relative",gap:2},b.sg);function x(e){let{direction:t,isLink:n,backgroundColor:i,isAuthorContributor:o}=e,r="incoming"===t&&o,a="".concat(i,"1A");return(0,l.BX)("svg",{viewBox:"0 0 16 13",className:s()(C.Z.bubbs,C.Z[t],n&&C.Z.isLink,o&&C.Z.author),style:r?{fill:a}:{},children:[(0,l.tZ)("circle",{cx:"5",cy:"5",r:"5",className:C.Z.bubb}),(0,l.tZ)("circle",{cx:"13.5",cy:"10.5",r:"2.5",className:C.Z.bubb}),r&&(0,l.BX)(l.HY,{children:[(0,l.tZ)("circle",{cx:"5",cy:"5",r:"5",fill:a}),(0,l.tZ)("circle",{cx:"13.5",cy:"10.5",r:"2.5",fill:a})]})]})}function B(e){var{messageDirection:t,isFirst:n=!1,isLast:a=!1,forceTheme:c,pubThemeAccentColor:u,isAuthorContributor:h,className:m}=e,p=(0,r._)(e,["messageDirection","isFirst","isLast","forceTheme","pubThemeAccentColor","isAuthorContributor","className"]);let g="incoming"===t&&h,Z=g&&u;return(0,l.tZ)(f.X2,(0,o._)((0,i._)({},p),{className:s()(C.Z.bubble,C.Z[t],n&&C.Z.isFirst,a&&C.Z.isLast,c&&C.Z["force".concat(d()(c),"Theme")],g&&C.Z.author,m),style:{"--color-chat-author-bg-overlay":Z?"".concat(u,"1A"):"oklch(from var(--color-bg-accent-themed) l c h / 0.1)"}}))}function S(e){let{metadata:t,publication:n,direction:i,isFirst:o,isLast:r}=e,a=N(t.url);return a?(0,l.tZ)(B,{messageDirection:i,isFirst:o,isLast:r,maxWidth:400,forceTheme:"incoming",outline:"detail",children:(0,l.tZ)(E,{videoId:a})}):(0,l.tZ)(B,{as:"a",href:t.url,target:"_blank",rel:"nofollow noopener ugc",messageDirection:i,isFirst:o,isLast:r,maxWidth:400,forceTheme:"incoming",outline:"detail",children:!function(e){let{metadata:t}=e;if(!t.image)return!1;let n=(0,_.zJH)(t.image);return!!n&&(n.width<401||n.height<401)}({metadata:t})?(0,l.tZ)(X,{publication:n,metadata:t}):(0,l.tZ)(R,{metadata:t})})}function N(e){try{let t=new URL(e);if("youtube.com"===t.hostname||"www.youtube.com"===t.hostname){let e=t.searchParams.get("v");if("/watch"===t.pathname&&e)return e}else if("youtu.be"===t.hostname){let e=t.pathname.slice(1);if(e)return e}}catch(e){console.error("Error parsing URL:",e)}return null}function M(e){try{var t,n;let i=new URL(e);if(i.pathname.startsWith("/player/v1/"))return null!==(t=i.pathname.split("/").pop())&&void 0!==t?t:null;if(i.pathname.includes("/video/")){let e=i.pathname.split("/"),t=e.indexOf("video")+1;if(t<e.length)return null!==(n=e[t])&&void 0!==n?n:null}}catch(e){console.error("Error parsing TikTok URL:",e)}return null}function E(e){let{videoId:t}=e;return(0,l.tZ)(I,{src:"https://www.youtube.com/embed/".concat(t),frameBorder:0})}let I=(0,f.zo)({className:C.Z.youtubeIframe,border:"unset",bg:"black",flex:"grow"},"iframe");function R(e){let{metadata:t}=e;return(0,l.BX)(f.X2,{flex:"grow",gap:12,padding:12,minWidth:0,children:[(0,l.tZ)(L,{metadata:t}),t.image?(0,l.tZ)(f.sg,{radius:"md",overflow:"hidden",bg:"tertiary",minWidth:0,children:(0,l.tZ)(p.e,{className:s()(C.Z.linkImage,C.Z.small),src:t.image,maxWidth:64,useRetinaSizing:!0,imageIsFixedWidth:!0,imageProps:{smartCrop:!0,aspect:"1:1"}})}):(0,l.tZ)(f.sg,{alignItems:"center",justifyContent:"center",radius:"md",height:64,width:64,bg:"tertiary",children:(0,l.tZ)(u.Z,{stroke:"var(--color-fg-secondary)"})})]})}function X(e){let{metadata:t,publication:n}=e;return(0,l.BX)(f.sg,{flex:"grow",maxWidth:400,minWidth:400,children:[t.image&&(0,l.tZ)(p.e,{className:C.Z.linkImage,src:t.image,maxWidth:400,useRetinaSizing:!0,imageIsFixedWidth:!0,imageProps:{aspect:"1.91:1",gravity:"auto",crop:"fill"}}),(0,l.tZ)(f.X2,{flex:"grow",padding:12,borderTop:t.image?"detail":void 0,children:(0,l.tZ)(L,{metadata:t,publication:n})})]})}function L(e){let{metadata:t,publication:n}=e;return(0,l.BX)(f.X2,{flex:"grow",gap:12,minWidth:0,children:[(0,l.BX)(f.sg,{minWidth:0,flex:"grow",gap:2,children:[t.host&&(0,l.BX)(f.X2,{alignItems:"center",gap:8,minWidth:0,paddingBottom:n?4:void 0,children:[n&&(0,l.tZ)(v.wk,{pub:n,size:18,radius:"xs"}),(0,l.tZ)(f.xv.B4,{color:"secondary",ellipsis:!0,children:t.host})]}),t.title&&(0,l.tZ)(f.xv.B3,{color:"primary",weight:"medium",clamp:2,children:t.title})]}),!t.image&&(0,l.tZ)(f.X2,{width:64,height:64,bg:"tertiary",radius:"md",alignItems:"center",justifyContent:"center",children:"twitter.com"===t.host||"x.com"===t.host?(0,l.tZ)(m.Z,{fill:"var(--color-fg-secondary)"}):(0,l.tZ)(h.Z,{stroke:"var(--color-fg-secondary)"})})]})}function T(){return(0,l.BX)(f.X2,{gap:12,padding:12,alignItems:"center",bg:"secondary",flex:"grow",children:[(0,l.BX)(f.sg,{minWidth:0,flex:"grow",gap:8,children:[(0,l.tZ)(y.V,{height:16,width:"".concat(30*Math.random()+60,"%")}),(0,l.tZ)(y.V,{height:16,width:"".concat(20*Math.random()+20,"%")})]}),(0,l.tZ)(y.V,{size:64,radius:"md"})]})}function P(){return(0,l.tZ)(f.X2,{gap:12,alignItems:"start",bg:"secondary",flex:"grow",children:(0,l.tZ)(Z.u,{title:"Error loading link",description:"Please try again"})})}},37155:function(e,t,n){n.d(t,{g:()=>i});function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>{setTimeout(t,e)})}},4953:function(e,t,n){n.d(t,{w6:()=>i});function*i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;for(let i=e;i<t;i+=n)yield i}}}]);